/*!
*  filename: ej2-spreadsheet.umd.min.js
*  version : 20.3.50
*  Copyright Syncfusion Inc. 2001 - 2020. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-lists"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-charts")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-data","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-popups","@syncfusion/ej2-navigations","@syncfusion/ej2-inputs","@syncfusion/ej2-buttons","@syncfusion/ej2-dropdowns","@syncfusion/ej2-lists","@syncfusion/ej2-grids","@syncfusion/ej2-charts"],t):t(e.ej={},e.ej2Base,e.ej2Data,e.ej2Splitbuttons,e.ej2Popups,e.ej2Navigations,e.ej2Inputs,e.ej2Buttons,e.ej2Dropdowns,e.ej2Lists,e.ej2Grids,e.ej2Charts)}(this,function(e,t,r,n,i,o,a,s,l,h,d,p){"use strict";function c(e){var t,r=[];return e=e.indexOf("!")>-1?e.split("!")[1]:e,(e=-1===e.indexOf(":")?e+":"+e:e).split(":").forEach(function(e){t=u(e),r.push(t[0]),r.push(t[1])}),r}function u(e){return[parseInt(e.match(/\d+/)[0],10)-1,f(e.match(/[A-Z]+/i)[0].toUpperCase())]}function f(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}function g(e,t){return v(t+1)+(e+1)}function m(e){return g(e[0],e[1])+":"+(t.isNullOrUndefined(e[2])?g(e[0],e[1]):g(e[2],e[3]))}function v(e){return e/26>1?v(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function y(e){return c(C(e))}function C(e){return e.split("!")[1]||e}function x(e){return e.name+"!"+e.selectedRange}function b(e,t){return{sheetIndex:S(e,t),indices:y(t)}}function S(e,t){return t.indexOf("!")>-1?fe(e,me(t)):e.activeSheetIndex}function w(e){var t=e.slice();return e[0]>e[2]&&I(t,0,2),e[1]>e[3]&&I(t,1,3),t}function I(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function E(e){return e[0]===e[2]&&e[1]===e[3]}function R(e,t,r,n,i){return new _t(e,t,r,n,i)}function A(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(k(r,n));return r/i+"/"+n/i}function k(e,t){return e=Number(e),(t=Number(t))?k(t,e%t):e}function F(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+r).toUTCString().replace(" GMT",""))}function T(e,t,r){var n=new Date("01/01/1900"),i=L(e)?e:new Date(e),o=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),a=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-o)/864e5;return(t?a:parseInt(a.toString(),10))+(r?0:a>60?2:1)}function L(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function N(e){return e-parseFloat(e)>=0}function D(e,r,n,i,o){var a=t.IntlBase.getDependables(t.cldrData,n,null).dateObject,s=a.dateTimeFormats.availableFormats,l={dateObj:null,isCustom:!1,type:""},h=e;if("string"==typeof e&&(e=e.toUpperCase()),i&&(l.dateObj=r.parseDate(h,{format:i}),l.dateObj&&(l.type=e.toString().indexOf(":")>-1?"time":"datetime",l.isCustom=!0)),t.isNullOrUndefined(l.dateObj)){if((e=e.toString())&&e.indexOf("/")>-1||e.indexOf("-")>0){var d=o&&o.format||i,p=d.includes("dd-MM-yy");if((p||d.includes("dd/MM/yy"))&&(d=p?"d-M-y":"d/M/y",l.dateObj=r.parseDate(e,{format:d,skeleton:"yMd"}),l.dateObj))return l.type="date",l}if(e.indexOf(":")<0)for(var c=0,u=Object.keys(a.dateFormats);c<u.length;c++){var f=u[c];if(l.dateObj=r.parseDate(e,{format:a.dateFormats[f],skeleton:f}),l.dateObj){l.type="date",l.isCustom=!1;break}}if(t.isNullOrUndefined(l.dateObj))for(var g=0,m=Object.keys(s);g<m.length;g++){f=m[g];if(l.dateObj=r.parseDate(e,{format:s[f],skeleton:f}),!l.dateObj&&e.indexOf(":")>-1&&s[f].indexOf(":")>-1&&(l.dateObj=r.parseDate(e,{format:s[f].split(" ")[0]})),l.dateObj){if(l.type=e.toString().indexOf(":")>-1?"time":"datetime","time"===l.type){var v=l.dateObj.toLocaleTimeString();l.dateObj=new Date("01/01/1900 "+v)}l.isCustom=!0;break}}if(t.isNullOrUndefined(l.dateObj))for(var y=0,C=Object.keys(a.timeFormats);y<C.length;y++){f=C[y];if(l.dateObj=r.parseDate(e,{format:a.timeFormats[f],skeleton:f}),l.dateObj){v=l.dateObj.toLocaleTimeString();l.dateObj=new Date("01/01/1900 "+v),l.type="time",l.isCustom=!1;break}}}return"#DIV/0!"===e||l.dateObj||"Invalid Date"===new Date(e).toString()||(l.dateObj=new Date(e),l.type="date"),l}function O(e){return e&&"."!==e&&/^\d*\.?\d*$/.test(e)?parseFloat(e):e}function M(e,t,r,n,i){var o=e.value;return N(o)?{isNumber:!0,value:o}:(i&&e.format.indexOf(i)>-1&&o&&o.indexOf(i)>-1&&(o=o.replace(i,"")),e.format.indexOf(r)>-1&&o&&o.indexOf(r)>-1&&(o=function(e,t,r,n){for(var i=!1,o=123456..toLocaleString(t).split(r).reverse(),a=e.split(n)[0].split(r),s=0;s<a.length&&(i=s===a.length-1?a[s].length===o[0].length:0==s?a[s].length<=o[1].length:a[s].length===o[1].length);s++);return i}(o,t,r,n)?o.split(r).join(""):o),{isNumber:N(o),value:o})}function P(e){var t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function H(e){var t="General";switch(e){case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':t="Accounting";break;case"mm-dd-yyyy":case"dd/MM/yyyy":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text";break;default:e&&e.indexOf("[$")>-1&&(t=e.indexOf("* ")>-1?"Accounting":"Currency")}return t}function B(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM-yyyy":case"MMM yyyy":e="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;case"ddd":e="E";break;default:e=""}return e}function U(t){var r=!1;for(var n in e.ExcelFileFormats)if(t.indexOf("."+n+"]")>-1){r=!0;break}return r}function _(e){var t=[];return e.includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t}function V(e,r){for(var n=r,i=e.replace(/\[/g,".").replace(/\]/g,"").split("."),o=0;o<i.length&&!t.isUndefined(n);o++)n=n[i[o]];return n}function z(e,r,n){var i,o,a=e.replace(/\[/g,".").replace(/\]/g,"").split("."),s=n||{},l=s,h=a.length;for(i=0;i<h;i++)o=a[i],i+1===h?l[o]=void 0===r?{}:r:t.isNullOrUndefined(l[o])&&(l[o]={}),l=l[o];return s}function q(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],o=0;o<r;o++)i[r-o-1]=t[o];return i.join("")}function j(e,t){return void 0===t&&(t=[]),t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),e.allowAutoFill&&t.push({member:"workbookautofill",args:[e]}),t}function W(e,t){return e&&"="===e[0]&&(e.length>1||t)}function G(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var r=t.split(":");if(te(r[0])&&te(r[1]))return!0}else if(t.indexOf(":")<0&&te(t))return!0;return!1}function Y(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function X(e,t){return 0===t[1]&&t[3]===e.colCount-1}function K(e,t){return 0===t[0]&&t[2]===e.rowCount-1}function $(e,t,r){return e&&t>=e[0]&&t<=e[2]&&r>=e[1]&&r<=e[3]}function Z(e,t,r){for(var n,i,o=e.split(" "),a=0,s=o.length;a<s&&(n=c(o[a]),!(i=$(n,t,r)));a++);return i}function Q(e,t,r){var n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(r){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function J(e,t,r){var n=v(r+1);return e?e.split(" ").forEach(function(r){var i=c(r);if(Q(i,t))e=e.split(r).join(n+(i[0]+1)+":"+n+t[0]+" "+n+(t[2]+2)+":"+n+(i[2]+1));else if(Q(i,t,!0)){var o=void 0;o=t[0]>i[0]?n+(i[0]+1)+":"+n+t[0]:n+(t[2]+2)+":"+n+(i[2]+1),e=e.split(r).join(o)}}):e=n+"1:"+n+t[0]+" "+n+(t[2]+2)+":"+n+"1048576",e}function ee(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function te(e){for(var t=e,r=0,n=0,i=[89,71,69],o="",a=t.length,s=0;s<a;s++)Y(t[s])&&r++;var l=(o=t.substring(0,r)).length;if(l!==a&&l<4&&1!==a&&isNaN(parseInt(t,10))){for(;n<l;){if(!(o[n]&&o[n].charCodeAt(0)<i[n])){if(!o[n]&&n>0)break;return!1}n++}var h=parseFloat(t.substring(r,a));if(h>0&&h<1048577)return!0}return!1}function re(e,t,r,n){if(void 0===n&&(n="rows"),r)for(var i=t;i<1/0&&(e[n][t]&&e[n][t].hidden);i++)t++;else for(i=t;i>-1&&(e[n][t]&&e[n][t].hidden);i--)t--;return t}function ne(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1||r.indexOf("borderTop")>-1||r.indexOf("borderBottom")>-1}function ie(e,t,r,n,i,o){var a,s;if(t&&(a=(s=n||ke(t[0],t[1],r,!1,!0)).formula?s.formula.toUpperCase():""),a){o&&i.notify(Er,{cellRef:g(t[0],t[1])}),0===a.indexOf("=")&&(a=a.slice(1));for(var l=["+","-","*","/",">=","<=","<>",">","<","=","%"],h=void 0,d=a=a.split("(").join(",").split(")").join(","),p=0;p<l.length;p++)d=(h=d.split(l[p])).join(",");h=d.split(",");for(var u=[],f=void 0,m=void 0,v=0;v<h.length;v++)if(G(h[v])){var y=c(h[v]),C=[e[0]-(t[0]-y[0]),e[1]-(t[1]-y[1]),e[0]-(t[0]-y[2]),e[1]-(t[1]-y[3])];C[1]<0||C[2]<0||C[3]<0||!o&&C[0]<0?f="#REF!":(o&&C[0]<0&&(C[0]=C[2]),f=g(C[0],C[1]),h[v].includes(":")&&(f+=":"+g(C[2],C[3])),f=G(f)?f:"#REF!"),(m={})[h[v]]=f,h[v].includes(":")?u.splice(0,0,m):u.push(m)}var x=void 0,b=void 0,S=a=s.formula;for(v=0;v<u.length;v++){x=Object.keys(u[v])[0],b=u[v][x].toUpperCase();for(var w=x.length,I=S.indexOf(x),E="",R=0;R<b.length;R++)E+=" ";a=a.slice(0,I)+b+a.slice(I+w),S=S.slice(0,I)+E+S.slice(I+w)}return a}return null}function oe(e,t,r){var n={cell:r.cell,rowIndex:r.rowIdx,colIndex:r.colIdx,cancel:!1,sheet:t.name};if(r.preventEvt||e.trigger(Xn,n),!r.eventOnly&&!n.cancel)if(r.valChange){var i=ke(n.rowIndex,n.colIndex,t),o=!r.preventEvt&&e.getDisplayText(i),a=!(!i||!i.formula);Fe(n.rowIndex,n.colIndex,t,n.cell,!r.pvtExtend);var s=ke(n.rowIndex,n.colIndex,t,!1,!0),l={action:"updateCellValue",address:[n.rowIndex,n.colIndex],sheetIndex:fe(e,t.name),value:a&&!s.formula?s.value||(0===s.value?"0":""):s.formula||s.value||(0===s.value?"0":"")};if(e.notify(cr,l),r.isFormulaDependent=l.isFormulaDependent,r.requestType&&null===n.cell&&Fe(n.rowIndex,n.colIndex,t,n.cell,!r.pvtExtend),r.cellDelete&&(delete s.value,delete s.formula,delete s.hyperlink),r.uiRefresh&&e.serviceLocator.getService("cell").refresh(n.rowIndex,n.colIndex,r.lastCell,r.td,r.checkCF,r.checkWrap),!r.preventEvt){var h=e.getDisplayText(s);if(h!==o){var d=ke(n.rowIndex,n.colIndex,t,!1,!0).value,p={value:d=d||(0===d?"0":""),oldValue:o,formula:s.formula||"",address:t.name+"!"+g(n.rowIndex,n.colIndex),displayText:h};r.requestType&&(p.requestType=r.requestType),e.trigger("cellSave",p)}}}else Fe(n.rowIndex,n.colIndex,t,n.cell,!r.pvtExtend);return n.cancel}function ae(e,r,n){for(var i=e,o=e,a=r,s=r,l=n.usedRange.rowIndex,h=n.usedRange.colIndex,d=function(e){for(var r=0;r<=h;r++)if(!t.isUndefined(ke(e,r,n,null,!0).value))return!1;return!0},p=function(e){for(var r=i;r<=o;r++)if(!t.isUndefined(ke(r,e,n,null,!0).value))return!1;return!0},c=i;c<=l&&(!t.isUndefined(ke(c,r,n,null,!0).value)||!d(c));c++)o=c;for(c=i;c>=0&&(!t.isUndefined(ke(c,r,n,null,!0).value)||!d(c));c--)i=c;for(c=a;c<=h&&(!t.isUndefined(ke(e,c,n,null,!0).value)||!p(c));c++)s=c;for(c=a;c>=0&&(!t.isUndefined(ke(e,c,n,null,!0).value)||!p(c));c--)a=c;return[i,a,o,s]}function se(e,t,r){var n=c(e.model.selectedRange),i=0,o=0;return"Column"===e.modelType?(r&&(n=[0,e.start,0,e.end]),"before"===e.insertType?t[1]<=n[1]&&t[3]>=n[1]?(i=0,o=n[3]-n[1]+1):n[1]<t[1]&&(i=o=n[3]-n[1]+1):t[1]<=n[3]&&t[3]>=n[3]?(i=0,o=n[3]-n[1]+1):n[3]<t[3]&&(i=o=n[3]-n[1]+1),[t[0],t[1]+i,t[2],t[3]+o]):(r&&(n=[e.start,0,e.end,0]),"above"===e.insertType?t[0]<=n[0]&&t[2]>=n[0]?(i=0,o=n[2]-n[0]+1):n[0]<t[0]&&(i=o=n[2]-n[0]+1):t[0]<=n[2]&&t[2]>=n[2]?(i=0,o=n[2]-n[0]+1):n[2]<t[2]&&(i=o=n[2]-n[0]+1),[t[0]+i,t[1],t[2]+o,t[3]])}function le(e,t){var r,n=0,i=0;return"Column"===e.modelType?((r=[0,e.start,e.model.usedRange.rowIndex,e.end])[3]<t[1]?n=i=r[3]-r[1]+1:r[1]>=t[1]&&r[3]<=t[3]?i=r[3]-r[1]+1:r[1]>=t[1]&&r[1]<=t[3]?i=t[3]-r[1]+1:r[1]<t[1]&&r[3]>=t[1]?(n=t[1]-r[1],i=r[3]-r[1]+1):r[1]<t[1]&&r[3]<t[3]&&(n=r[3]-t[1]+(r[3]-r[1])+1,i=r[3]-r[1]+1),[t[0],t[1]-n,t[2],t[3]-i]):((r=[e.start,0,e.end,e.model.usedRange.colIndex])[2]<t[0]?n=i=r[2]-r[0]+1:r[0]>=t[0]&&r[2]<=t[2]?i=r[2]-r[0]+1:r[0]>=t[0]&&r[0]<=t[2]?i=t[2]-r[0]+1:r[0]<t[0]&&r[2]>=t[0]?(n=t[0]-r[0],i=r[2]-r[0]+1):r[0]<t[0]&&r[2]<t[2]&&(n=r[2]-t[0]+(r[2]-r[0])+1,i=r[2]-r[0]+1),[t[0]-n,t[1],t[2]-i,t[3]])}function he(e,t,r,n){for(var i,o,a=e.length-1;a>=0;a--){i=e[a].range.trim().split(",");for(var s=0;s<i.length;s++)if(o=c(i[s].includes(":")?i[s]:i[s]+":"+i[s]),r>=o[0]&&n>=o[1]&&r<=o[2]&&n<=o[3]){t.push(e[a]),e.splice(a,1);break}}}function de(e,t){for(var r,n,i,o,a,s=t.trim().split(","),l=function(e){for(var t=0;t<s.length;t++){if(a=c(s[t].includes(":")?s[t]:s[t]+":"+s[t]),e[0]<=a[0]&&e[1]<=a[1]&&e[2]>=a[2]&&e[3]>=a[3])return!0;if(i=e[0]>=a[0]&&e[0]<=a[2],o=e[2]>=a[0]&&e[2]<=a[2],r=e[1]>=a[1]&&e[1]<=a[3],n=e[3]>=a[1]&&e[3]<=a[3],i&&o){if(r||n||e[1]<a[1]&&e[3]>a[3]){if(e[0]-a[0]>0)return!0;if(a[2]-e[2]>0)return!0}if(r&&e[1]!==a[1])return!0;if(n&&e[3]!==a[3])return!0}else if(r&&n){if(i||o||e[0]<a[0]&&e[2]>a[2]){if(e[1]-a[1]>0)return!0;if(a[3]-e[3]>0)return!0}if(i){if(e[0]!==a[0])return!0}else if(o&&e[2]!==a[2])return!0}else if(i||o)if(r){if(e[1]!==a[1])return!0;if(e[0]-a[0]>0)return!0;if(a[2]-e[2]>0)return!0}else if(n){if(e[3]!==a[3])return!0;if(e[0]-a[0]>0)return!0;if(a[2]-e[2]>0)return!0}}return!1},h=0;h<e.length;h++)if(l(e[h]))return!0;return!1}function pe(e,r,n,i,o,a,s,l,h,d,p,u){return void 0===h&&(h=!0),new Promise(function(f,m){f(function(){var f;r.indexOf("!")>-1?(f=fe(e,r.split("!")[0]),r=r.slice(r.indexOf("!")+1,r.length)):f=e.activeSheetIndex;var m=be(e,f),C=y(d||r),x={sheet:m,indexes:C,formulaCellRef:s,sheetIndex:l,isFinite:e.scrollSettings&&e.scrollSettings.isFinite,promise:new Promise(function(e,t){e(void 0)})};return e.notify(Wt,x),x.promise.then(function(){var s,l,d,f=C[0],y=e.frozenRowCount(m),x=e.frozenColCount(m),b=!!u;if(n){d=[];var S,w,I;r.split(",").forEach(function(r,n){for(C=c(r),S=0,f=C[0];f<=C[2];){for(w=d[S]||{},l=Me(m,f),s=C[1];s<=C[3];)if(h&&He(m,f)&&!a)f++;else{I=v(s+1);var o=l?ke(f,s,m):null;i?(w[I]=l?ce(e,ke(f,s,m),f,s):"","string"!=typeof w[I]||!N(w[I])||o.format&&"@"===o.format||(w[I]=parseFloat(w[I]))):(o&&(o.formula||!t.isNullOrUndefined(o.value))||Object.keys(w).length)&&(s===p?(w[I]=t.extend({},o,{value:ce(e,o,f,s,!0)}),"string"!=typeof w[I].value||!N(w[I].value)||o.format&&"@"===o.format||(w[I].value=parseFloat(w[I].value))):w[I]=o),s===C[3]&&Object.keys(w).length&&(w.__rowIndex=(f+1).toString(),d[S]=w,b&&0===n&&!Be(m,f)&&u.push(w),S++),s++}f++}})}else{d=new Map;for(var E=!(i||!o||!o.length);f<=C[2];)if(E&&f>=y&&f<o[0])f=o[0];else if(i||!He(m,f)){for(l=Me(m,f),s=C[1];s<=C[3];){var R={cell:ke(f,s,m),address:g(f,s),rowIndex:f,colIndex:s};e.trigger(en,R);var A=ke(f,s,m,!1,!0);if(A.colSpan>1&&A.rowSpan>1)for(var k=void 0,F=f,T=f+A.rowSpan;F<T;F++)for(var L=s,D=s+A.colSpan;L<D;L++)F===f&&L===s||(k=new Object,F!==f&&(k.rowSpan=f-F),L!==s&&(k.colSpan=s-L),m.rows[F]&&m.rows[F].cells&&m.rows[F].cells[L]&&(delete m.rows[F].cells[L].value,delete m.rows[F].cells[L].formula),Fe(F,L,m,k,!0));else if(A.colSpan>1)for(F=s+1,T=s+A.colSpan;F<T;F++)Fe(f,F,m,{colSpan:s-F},!0),m.rows[f]&&m.rows[f].cells&&m.rows[f].cells[F]&&(delete m.rows[f].cells[F].value,delete m.rows[f].cells[F].formula);else if(A.rowSpan>1)for(F=f+1,T=f+A.rowSpan;F<T;F++)Fe(F,s,m,{rowSpan:f-F},!0),m.rows[F]&&m.rows[F].cells&&m.rows[F].cells[s]&&(delete m.rows[F].cells[s].value,delete m.rows[F].cells[s].formula);if(i||!Ge(m,s))if(E&&s>=x&&s<o[1])s=o[1];else{if(A.style){var O={};Object.assign(O,A.style),A.style=O}d.set(R.address,A),s++}else s++}f++}else f++}return d})}())})}function ce(e,r,n,i,o){if(r){if(t.isNullOrUndefined(r.value))return"";if(r.format){var a={value:r.value,formattedText:r.value,cell:r,format:r.format,onLoad:!0,checkDate:!o,rowIndex:n,colIndex:i,dataUpdate:!0};return e.notify(ir,a),a.dateObj&&"Invalid Date"!==a.dateObj.toString()?a.dateObj:o?a.value:a.formattedText}return r.value}return""}function ue(e,r,n){for(var i,o,a,s=0,l=e.length,h=function(h){if(t.isNullOrUndefined(e[h])||t.isUndefined(e[h].index)||(o=s=e[h].index-h,delete e[h].index),s>0){for(i=0;s--;)r?(n.createSheet(h+i),i++):e.splice(h,0,null);h+=o,l+=o}if(r){e[h].id<1&&(e[h].id=we(n.sheets),e[h].properties&&(e[h].properties.id=e[h].id)),e[h].name||n.setSheetPropertyOnMute(e[h],"name","Sheet"+Se(n));var d=0;e[h].rows.forEach(function(e){d=Math.max(d,e&&e.cells&&e.cells.length-1||0)}),n.setSheetPropertyOnMute(e[h],"usedRange",{rowIndex:e[h].rows.length?e[h].rows.length-1:0,colIndex:d})}a=h},d=0;d<l;d++)h(d),d=a}function fe(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){r=n;break}return r}function ge(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r}function me(e){return e.split("!")[0].replace(/\'/gi,"")}function ve(e,t,r){for(var n=r.length,i=0;i<n;i++)if(r[i].sheet.toUpperCase()===t.toUpperCase())return r[i].index;return-1}function ye(e,t,r,n){void 0===r&&(r={}),e.setSheetPropertyOnMute(r,"selectedRange",n?r.selectedRange+" "+t:t)}function Ce(e){return e&&e.selectedRange||"A1"}function xe(e){return e.selectedRange.split(" ")[0]}function be(e,t){return e.sheets[t]}function Se(e){var t=[];e.sheets.forEach(function(e){t.push(e.name.toLowerCase())});for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function we(e){var t=0;return e.forEach(function(e){t=Math.max(e.id,t)}),t+1}function Ie(e,r){var n=r||e.sheets;n.forEach(function(r){if(r.id=r.id||0,r.name=r.name||"",r.rowCount=t.isUndefined(r.rowCount)?100:r.rowCount,r.colCount=t.isUndefined(r.colCount)?100:r.colCount,r.topLeftCell=r.topLeftCell||"A1",r.activeCell=r.activeCell||"A1",r.selectedRange=r.selectedRange||"A1:A1",r.usedRange=r.usedRange||{rowIndex:0,colIndex:0},e.setSheetPropertyOnMute(r,"ranges",r.ranges?r.ranges:[]),e.setSheetPropertyOnMute(r,"rows",r.rows&&t.extend([],r.rows,null,!0)||[]),e.setSheetPropertyOnMute(r,"columns",r.columns||[]),r.showHeaders=!!t.isUndefined(r.showHeaders)||r.showHeaders,r.showGridLines=!!t.isUndefined(r.showGridLines)||r.showGridLines,r.state=r.state||"Visible",r.maxHgts=[],r.protectSettings=r.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},r.isProtected=r.isProtected||!1,!r.paneTopLeftCell||"A1"===r.paneTopLeftCell){r.frozenRows=r.frozenRows?r.frozenRows:0,r.frozenColumns=r.frozenColumns?r.frozenColumns:0;var n=u(r.topLeftCell);e.setSheetPropertyOnMute(r,"paneTopLeftCell",g(r.frozenRows?n[0]+r.frozenRows:n[0],r.frozenColumns?n[1]+r.frozenColumns:n[1]))}ue(r.columns),function(e){e.forEach(function(e){e&&e.cells&&ue(e.cells)}),ue(e)}(r.rows)}),ue(n,!0,e)}function Ee(e,t){return void 0===t&&(t=e.activeSheetIndex),be(e,t).name}function Re(e,t,r,n,i){var o=!!r;r=r||[e.activeSheetIndex];var a=Ee(e),s={action:"moveSheet",eventArgs:{position:t=function(e,t,r){for(var n=t;r?n>=0:n<e.length;r?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:r,cancel:!1}};n&&e.trigger("actionBegin",s),s.eventArgs.cancel||(r.forEach(function(r,n){e.sheets.splice(t+n,0,e.sheets.splice(r+(t>r?-1*n:0),1)[0])}),e.setProperties({activeSheetIndex:i?fe(e,a):t>r[0]?t-(r.length-1):t},!0),e.notify(Pn,{refresh:o}),n&&(delete s.eventArgs.cancel,e.trigger("actionComplete",s)))}function Ae(e,r,n,i){var o={action:"duplicateSheet",eventArgs:{sheetIndex:r=t.isUndefined(r)?e.activeSheetIndex:r,cancel:!1}};if(n&&e.trigger("actionBegin",o),!o.eventArgs.cancel){var a=be(e,r),s=t.extend({},a.properties?a.properties:a,!0);s.id=we(e.sheets);var l=s.name;/^\(\d+\)$/.test("("+l.split(" (")[1])&&(l=l.split(" (")[0]);var h=[];e.sheets.forEach(function(e){h.push(e.name)});for(var d=2;;d++)if(-1===h.indexOf(l+" ("+d+")")){s.name=l+" ("+d+")";break}e.notify(Kn,{sheetIndex:r,newSheetIndex:r+1}),e.createSheet(r+1,[s]),e.notify(pr,{action:"addSheet",sheetName:"Sheet"+s.id,visibleName:s.name,sheetId:s.id}),i||e.setProperties({activeSheetIndex:r+1},!0),e.notify(Pn,{refresh:!0,isDuplicate:!0}),n&&(delete o.eventArgs.cancel,e.trigger("actionComplete",o))}}function ke(e,t,r,n,i){var o=Me(r,e);if(!o||!o.cells){if(!n)return i?{}:null;o?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]||(i?{}:null)}function Fe(e,r,n,i,o){n.rows[e]?n.rows[e].cells||(n.rows[e].cells=[]):n.rows[e]={cells:[]},o&&n.rows[e].cells[r]?t.extend(n.rows[e].cells[r],i,null,!0):n.rows[e].cells[r]=i}function Te(e,t){var r={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},n={};return Object.keys(t?r:e).forEach(function(t){e[t]!==r[t]&&(n[t]=e[t])}),n}function Le(e,t,r,n){void 0===t&&(t=!0);for(var i=r.getAddressInfo(e),o=i.indices,a=be(r,i.sheetIndex),s=i.sheetIndex===r.activeSheetIndex,l=o[0];l<=o[2];l++)for(var h=o[1];h<=o[3];h++)!oe(r,a,{cell:{wrap:t},rowIdx:l,colIdx:h,preventEvt:n})&&s&&r.notify(Hr,{range:[l,h,l,h],wrap:t,sheet:a});r.setProperties({sheets:r.sheets},!0)}function Ne(e){var t;if(e.indexOf("[")>-1){var r=e.split("[")[1].split("]")[0];["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(r)>-1&&(t=r)}return t}function De(){return["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"]}function Oe(e,t){return!(!e.format.includes("d")&&!e.format.includes("y")||-1!==e.format.indexOf("#")||Ne(e.format))||!(!t||!(e.format.includes("h")||e.format.includes("m")||e.format.includes("s"))||-1!==e.format.indexOf("#")||Ne(e.format))}function Me(e,t){return e.rows[t]}function Pe(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach(function(n){e.rows[t][n]=r[n]})}function He(e,t){return e.rows[t]&&e.rows[t].hidden}function Be(e,t){return e.rows[t]&&e.rows[t].isFiltered}function Ue(e,t,r,n){var i;if(e&&e.rows&&e.rows[t]){if(!n&&e.rows[t].hidden)return 0;i=void 0===e.rows[t].height?20:e.rows[t].height}else i=20;if(r&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function _e(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function Ve(e,t,r,n,i){void 0===r&&(r=t);var o,a=0;t>r&&(o=t,t=r,r=o);for(var s=t;s<=r;s++)a+=Ue(e,s,n,i);return a}function ze(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function qe(e,t,r){var n=ze(e,t);Object.keys(r).forEach(function(e){n[e]=r[e]})}function je(e,t,r,n){var i;if(e&&e.columns&&e.columns[t]){if(!r&&e.columns[t].hidden)return 0;i=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else i=64;if(n&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function We(e,t,r,n){void 0===r&&(r=t);var i=0;if(t>r){var o=t;t=r,r=o}for(var a=t;a<=r;a++)i+=je(e,a,null,n);return i}function Ge(e,t){return e.columns[t]&&e.columns[t].hidden}function Ye(e,t,r){return!!(e&&e.validation&&(!e.validation.address||e.validation.address&&Z(e.validation.address,t,r)))}function Xe(e){var t=[];return function(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]});e.showFormulaBar&&t.push({member:"formulaBar",args:[e]});e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]});e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]}));e.allowOpen&&t.push({member:"open",args:[e]});e.allowSave&&t.push({member:"save",args:[e]});e.enableContextMenu&&t.push({member:"contextMenu",args:[e]});e.allowAutoFill&&t.push({member:"autofill",args:[e]});"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]});e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]});e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]});e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]});e.enableClipboard&&t.push({member:"clipboard",args:[e]});e.allowCellFormatting&&t.push({member:"cellformat",args:[e]});e.allowSorting&&t.push({member:"sort",args:[e]});e.allowResizing&&t.push({member:"resize",args:[e]});t.push({member:"collaborativeEditing",args:[e]}),t.push({member:"protectSheet",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]});e.allowUndoRedo&&t.push({member:"undoredo",args:[e]});e.allowFiltering&&t.push({member:"filter",args:[e]});e.allowWrap&&t.push({member:"wrapText",args:[e]});e.allowInsert&&t.push({member:"insert",args:[e]});e.allowDelete&&t.push({member:"delete",args:[e]});e.allowDataValidation&&t.push({member:"dataValidation",args:[e]});e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]});e.allowMerge&&t.push({member:"merge",args:[e]});e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]});e.allowImage&&t.push({member:"spreadsheetImage",args:[e]});e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}(e,t),j(e,t),t}function Ke(e){requestAnimationFrame(function(){e()})}function $e(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Ze(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}function Qe(){if(null!==cl)return cl;var e=document.createElement("div"),t=0;return e.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth|0,document.body.removeChild(e),cl=t}function Je(e,t){void 0===t&&(t=fl);return et(e,"previous",t)+et(e,"next",t)}function et(e,t,r){for(var n=e[t+"ElementSibling"],i=0;n;)r.some(function(e){return n.classList.contains(e)})&&(i+=n.offsetHeight),n=n[t+"ElementSibling"];return i}function tt(e,t,r){if(e.scrollSettings.enableVirtualization){var n=e.getActiveSheet(),i=e.frozenRowCount(n),o=e.frozenColCount(n),a=e.viewport.topIndex+i,s=e.viewport.leftIndex+o,l=e.viewport.bottomIndex,h=e.viewport.rightIndex;if(n.frozenRows||n.frozenColumns){if(e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]))return!0}else if(a<=t[0]&&l>=t[2]&&s<=t[1]&&h>=t[3])return!0;var d=!1;if(r){if(t[0]<a&&t[2]<a||t[0]>l&&t[2]>l)return!1;if(t[0]<a&&t[2]>a&&t[0]>=i&&(t[0]=a,d=!0),t[2]>l&&(t[2]=l,d=!0),t[1]<s&&t[3]<s||t[1]>h&&t[3]>h)return!1;t[1]<s&&t[3]>s&&t[1]>=o&&(t[1]=s,d=!0),t[3]>h&&(t[3]=h,d=!0)}return d}return!0}function rt(e,t,r,n,i,o,a){var s,l={idx:0,size:0},h={idx:0,size:0},d=h.size,p=l.size;for(s=h.idx;s<t[0];s++)r&&r-1<t[0]&&s<r||(d+=Ue(e,s,!0));for(s=l.idx;s<t[1];s++)n&&n-1<t[1]&&s<n||(p+=je(e,s,null,!0));return r&&t[0]<r&&(e.showHeaders&&(d+=30),i&&(d-=i)),n&&t[1]<n&&(e.showHeaders&&(p+=a||30),o&&(p-=o)),{top:d,left:p}}function nt(e,r,n,i,o,a,s){void 0===i&&(i="e-selection");var l=e.getActiveSheet();if(!l.frozenRows&&!l.frozenColumns){var h=ot(e,r,n,l,e.enableRtl,0,0,o);return r&&!e.getMainContent().querySelector("."+i)&&e.getMainContent().appendChild(r),h}var d,p=e.frozenRowCount(l),c=e.frozenColCount(l);if("e-active-cell"===i){if(n[0]<p||n[1]<c){r.style.display="none";(m=(d=n[0]<p&&n[1]<c?e.getSelectAllContent():n[0]<p?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i))||(m=r.cloneNode(!0),d.appendChild(m)),ot(e,r=m,n,l,e.enableRtl,p,c,o,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth)}else ot(e,r,n,l,e.enableRtl,p,c,o);r.style.display&&(r.style.display=""),it(e.getSelectAllContent(),d,"e-active-cell"),it(e.getColumnHeaderContent(),d,"e-active-cell"),it(e.getRowHeaderContent(),d,"e-active-cell")}else if("e-autofill"===i){var u=void 0,f=e.frozenRowCount(l),g=e.frozenColCount(l);if(n[0]<f||n[1]<g){r.style.display="none";(m=(u=n[0]<f&&n[1]<g?e.getSelectAllContent():n[0]<f?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i))||(m=r.cloneNode(!0),u.appendChild(m)),ot(e,r=m,n,l,e.enableRtl,f,g,o,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-autofill")}else ot(e,r,n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-autofill");r.style.display&&(r.style.display=""),it(e.getSelectAllContent(),u,"e-autofill"),it(e.getColumnHeaderContent(),u,"e-autofill"),it(e.getRowHeaderContent(),u,"e-autofill")}else if("e-filloption"===i){u=void 0,f=e.frozenRowCount(l),g=e.frozenColCount(l);if(n[0]<f||n[1]<g)if(n[3]+1===g&&n[2]+1>f)ot(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-filloption",!0,{left:-4});else if(n[2]+1===f&&n[3]+1>g)ot(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-filloption",!0,{top:-4});else if(n[3]+1===g&&n[2]+1<f){(u=e.getColumnHeaderContent()).querySelector("."+i)||e.notify(_n,{id:e.element.id+"_autofilloptionbtn",appendElem:u}),r=e.autofillModule.autoFillDropDown.element,ot(e,r,n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-filloption",!0,{left:-4})}else if(n[2]+1===f&&n[3]+1===g)ot(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-filloption",!0,{top:-4,left:-4});else{var m;(m=(u=n[0]<f&&n[1]<g?e.getSelectAllContent():n[0]<f?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i))||e.notify(_n,{id:e.element.id+"_autofilloptionbtn",appendElem:u}),r=e.autofillModule.autoFillDropDown.element,ot(e,r,n,l,e.enableRtl,f,g,o,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-filloption",!0)}else ot(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,o,!1,0,0,0,"e-filloption",!0);r.style.display&&(r.style.display=""),it(e.getSelectAllContent(),u,"e-filloption"),it(e.getColumnHeaderContent(),u,"e-filloption"),it(e.getRowHeaderContent(),u,"e-filloption")}else{var v=w(n);if(v[0]<p||v[1]<c){r&&!r.classList.contains("e-multi-range")&&r.classList.add("e-hide");var y=[];v[0]<p&&v[1]<c?v[2]<p&&v[3]<c?(y.push(n),a||(it(e.getColumnHeaderContent(),d,i,!0),it(e.getRowHeaderContent(),d,i,!0))):v[2]>p-1?v[3]<c?(a||it(e.getColumnHeaderContent(),d,i,!0),y.push([v[0],v[1],p-1,v[3]]),y.push([p,v[1],v[2],v[3]])):(y.push([v[0],v[1],p-1,c-1]),y.push([p,v[1],v[2],c-1]),y.push([v[0],c,p-1,v[3]]),y.push([p,c,v[2],v[3]])):v[2]<p?(y.push([v[0],v[1],v[2],c-1]),y.push([v[0],c,v[2],v[3]]),a||it(e.getRowHeaderContent(),d,i,!0)):(y.push([p,v[1],v[2],c-1]),y.push([v[0],v[1],p-1,c-1]),y.push([p,c,v[2],v[3]]),y.push([v[0],c,p-1,v[3]])):v[0]<p?v[2]<p?(y.push(n),a||it(e.getRowHeaderContent(),d,i,!0)):(y.push([v[0],v[1],p-1,v[3]]),y.push([p,v[1],v[2],v[3]]),a||(it(e.getSelectAllContent(),d,i,!0),it(e.getRowHeaderContent(),d,i,!0))):v[3]<c?(y.push(n),a||it(e.getSelectAllContent(),d,i,!0)):(y.push([v[0],v[1],v[2],c-1]),y.push([v[0],c,v[2],v[3]]),a||(it(e.getSelectAllContent(),d,i,!0),it(e.getColumnHeaderContent(),d,i,!0)));var C;y.forEach(function(n){d=n[2]<p&&n[3]<c?e.getSelectAllContent():n[2]<p?e.getColumnHeaderContent():n[3]<c?e.getRowHeaderContent():e.getMainContent();var h;"e-copy-indicator"===i||"e-range-indicator"===i?(h=r.cloneNode(!0),d.appendChild(h),p&&(n[2]+1===p&&y.forEach(function(e){e!==n&&(C=h.getElementsByClassName("e-bottom")[0])&&e[0]===p&&t.detach(C)}),n[0]===p&&d.parentElement.classList.contains("e-main-panel")&&y.forEach(function(e){e!==n&&(C=h.getElementsByClassName("e-top")[0])&&e[2]+1===p&&t.detach(C)})),c&&(n[3]+1===c&&y.forEach(function(e){e!==n&&(C=h.getElementsByClassName("e-right")[0])&&e[1]===c&&t.detach(C)}),n[1]===c&&(d.classList.contains("e-sheet-content")||d.classList.contains("e-column-header"))&&y.forEach(function(e){e!==n&&(C=h.getElementsByClassName("e-left")[0])&&e[3]+1===c&&t.detach(C)}))):((h=d.querySelector("."+i))||(h=r.cloneNode(!0),a&&!h.classList.contains("e-multi-range")&&h.classList.add("e-multi-range"),d.appendChild(h)),s&&h.classList.remove(i)),ot(e,h,n,l,e.enableRtl,p,c,o,!1,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth),h.classList.contains("e-hide")&&h.classList.remove("e-hide")})}else a||(it(e.getSelectAllContent(),null,i,!0),it(e.getColumnHeaderContent(),null,i,!0),it(e.getRowHeaderContent(),null,i,!0)),ot(e,r,n,l,e.enableRtl,p,c,o),"e-range-indicator"!==i&&e.getMainContent().querySelector("."+i)||e.getMainContent().appendChild(r),r.classList.contains("e-hide")&&r.classList.remove("e-hide"),s&&r.classList.remove(i)}}function it(e,r,n,i,o){if(i||e!==r)if(o)for(var a=e.querySelectorAll("."+n),s=0;s<a.length;)a[s].classList.remove(n),s++;else{var l=e.querySelector("."+n);l&&!l.classList.contains("e-multi-range")&&t.detach(l)}}function ot(e,r,n,i,o,a,s,l,h,d,p,c,u,f,g){var m,v,y=w(n),C=rt(i,y,a,s,d,p,c),x=[re(i,0,!0),re(i,0,!0,"columns")];e.scrollSettings.isFinite?(m=y[0]>=i.rowCount?0:Ve(i,y[0],y[2]<i.rowCount?y[2]:i.rowCount-1,!0),v=y[1]>=i.colCount?0:We(i,y[1],y[3]<i.colCount?y[3]:i.colCount-1,!0)):(m=Ve(i,y[0],y[2],!0),v=We(i,y[1],y[3],!0));var b=0===y[1]&&y[3]===i.colCount-1,S=0===y[0]&&y[2]===i.rowCount-1,I=0,E=-5,R=-5,A=0,k=6,F=6;if(t.isNullOrUndefined(u)){if((T={top:(y[0]===x[0]?C.top:C.top-yt(1))+"px",height:m&&m+(y[0]===x[0]?0:yt(1))+"px",width:v&&v+(y[1]===x[1]?0:yt(1))+(h&&s&&y[1]<s&&y[3]>=s?1:0)+"px"})[o?"right":"left"]=(y[1]===x[1]?C.left:C.left-1)+"px",r){return at([{element:r,attrs:T}],l)}}else{b&&(E=-5,R=-2,k=6,F=3),S&&(R=-5,E=0,k=1,F=6),S||(I+=m),b||(A+=v),I+=Math.round(C.top)+E,A+=Math.round(C.left)+R;var T={};f?(t.removeClass([r],"e-hide"),T={top:(I=g&&g.top?g.top:I)+k+"px",left:(A=g&&g.left?g.left:A)+F+"px"},r&&at([{element:r,attrs:T}],l)):((T={top:I+"px"})[o?"right":"left"]=A+"px",r&&at([{element:r,attrs:T}],l))}}function at(e,r){return new Promise(function(n){var i=function(){e.forEach(function(e){t.setStyleAttribute(e.element,e.attrs),n()})};r?i():requestAnimationFrame(function(){return i()})})}function st(){return t.Browser.isPointer?"pointerdown":"mousedown touchstart"}function lt(){return t.Browser.isPointer?"pointermove":"mousemove touchmove"}function ht(){return t.Browser.isPointer?"pointerup":"mouseup touchend"}function dt(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function pt(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function ct(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function ut(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}function ft(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function gt(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function mt(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function vt(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function yt(e,t){if(window.devicePixelRatio%1>0){var r=e*window.devicePixelRatio%1;return e+(r?(r>.5||t?1-r:-1*r)/window.devicePixelRatio:0)}return e}function Ct(e,t){Object.keys(t).forEach(function(r){e&&e.setAttribute(gl[r],t[r])})}function xt(e,r){if(e){var n=t.getComponent(e,r);n&&n.destroy()}}function bt(e,t,r,n,i){var o,a,s,l,h,d,p,c,u,f=i.getActiveSheet(),g=i.frozenRowCount(f),m=i.frozenColCount(f);if(n){var v=e<m?i.getSelectAllContent():i.getColumnHeaderContent();o=v.getElementsByTagName("th")[t],a=v.getElementsByTagName("col")[t],s=(e<m?i.getRowHeaderContent():i.getMainContent()).getElementsByTagName("col")[t]}else{o=a=g||m?i.getRow(e,null,m-1):i.getRow(e,i.getRowHeaderTable()),a.style.height=parseInt(r,10)>0?yt(parseInt(r,10))+"px":"2px",(s=i.getRow(e,null,m)).style.height=parseInt(r,10)>0?yt(parseInt(r,10))+"px":"0px";var y=void 0;if(f.showHeaders){var C=i.getRowHeaderContent().getElementsByClassName("e-row"),x=[];x[0]=C[t].getElementsByTagName("td")[0].cloneNode(!0),y=wt(i.getRowHeaderTable(),x,!1,i)+1}for(var b=i.getMainContent().getElementsByClassName("e-row"),S=[],w=0;w<b[t].getElementsByTagName("td").length;w++)S[w]=b[t].getElementsByTagName("td")[w].cloneNode(!0);var I=wt(i.getContentTable(),S,!1,i)+1,E=y>=I?y:I;parseInt(s.style.height,10)<E||o&&o.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===E?(f.showHeaders&&(o.classList.add("e-reach-fntsize"),a.style.lineHeight=parseInt(r,10)>=4?parseInt(r,10)-4+"px":parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"),s.style.lineHeight=parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"):(a&&a.style.removeProperty("line-height"),s.style.removeProperty("line-height"),o&&o.classList.contains("e-reach-fntsize")&&o.classList.remove("e-reach-fntsize"))}if(d=s.previousElementSibling,u=s.nextElementSibling,d&&(f.showHeaders&&(l=o.previousElementSibling,h=a.previousElementSibling),d=s.previousElementSibling),u&&(f.showHeaders&&(p=o.nextElementSibling,c=a.nextElementSibling),u=s.nextElementSibling),parseInt(r,10)<=0&&!s.classList.contains("e-zero")&&!s.classList.contains("e-zero-start")){if(d&&u)if(n?(f.showHeaders&&(a.style.width="2px"),s.style.width="0px"):(f.showHeaders&&(a.style.height="2px"),s.style.height="0px"),d.classList.contains("e-zero-start")?(f.showHeaders&&o.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(f.showHeaders&&o.classList.add("e-zero"),s.classList.add("e-zero")),!p||p.classList.contains("e-zero")||p.classList.contains("e-zero-last")||(f.showHeaders&&o.classList.add("e-zero-last"),s.classList.add("e-zero-last")),d.classList.contains("e-zero-last")&&(f.showHeaders&&l.classList.remove("e-zero-last"),d.classList.remove("e-zero-last")),f.showHeaders&&l.classList.contains("e-zero")?(o.classList.contains("e-zero-end"),St(h,-2,n)):f.showHeaders&&St(h,-1,n),f.showHeaders&&l.classList.contains("e-zero-start")&&St(a,-1,n),f.showHeaders&&p.classList.contains("e-zero"))if(o.classList.contains("e-zero-start"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.height,10)&&!n||0!==parseInt(c.style.width,10)&&n){n?(a.style.width=parseInt(a.style.width,10)-1+"px",c.style.width=parseInt(c.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",c.style.height=parseInt(c.style.height,10)-1+"px"),p.classList.remove("e-zero"),p.classList.add("e-zero-start");break}var R=void 0;p.classList.remove("e-zero"),p.classList.add("e-zero-start"),n?(R=parseInt(p.getAttribute("aria-colindex"),10)-1,p=i.getColHeaderTable().getElementsByTagName("th")[R+1],c=i.getColHeaderTable().getElementsByTagName("col")[R+1]):(R=parseInt(p.getAttribute("aria-rowindex"),10)-1,p=i.getRowHeaderTable().getElementsByTagName("tr")[R+1],c=i.getRowHeaderTable().getElementsByTagName("tr")[R+1])}else St(a,-2,n);else f.showHeaders&&(p.classList.contains("e-zero-end")?n?a.style.width="0px":a.style.height="0px":St(c,-1,n));else if(d)n?(f.showHeaders&&(a.style.width="1px"),s.style.width="0px"):(f.showHeaders&&(a.style.height="1px"),s.style.height="0px"),f.showHeaders&&o.classList.add("e-zero-end"),s.classList.add("e-zero-end"),f.showHeaders&&o.classList.add("e-zero-last"),s.classList.add("e-zero-last"),f.showHeaders&&l.classList.contains("e-zero")?St(h,-2,n):St(h,-1,n);else if(p)if(o.classList.add("e-zero-start"),s.classList.add("e-zero-start"),p.classList.contains("e-zero")||(o.classList.add("e-zero-last"),s.classList.add("e-zero-last")),n?(a.style.width="1px",s.style.width="0px"):(a.style.height="1px",s.style.height="0px"),f.showHeaders&&p.classList.contains("e-zero"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.width,10)&&n||0!==parseInt(c.style.height,10)&&!n){n?(c.style.width=parseInt(c.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(c.style.height=parseInt(c.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)-1+"px"),p.classList.add("e-zero-start"),p.classList.remove("e-zero");break}R=void 0;p.classList.add("e-zero-start"),p.classList.remove("e-zero"),n?(R=parseInt(p.getAttribute("aria-colindex"),10)-1,c=i.getColHeaderTable().getElementsByTagName("col")[R+1],p=i.getColHeaderTable().getElementsByTagName("th")[R+1]):(R=parseInt(p.getAttribute("aria-rowindex"),10)-1,c=i.getRowHeaderTable().getElementsByTagName("tr")[R+1],p=i.getRowHeaderTable().getElementsByTagName("tr")[R+1])}else f.showHeaders&&St(c,-1,n)}else if(parseInt(r,10)>0){var A=yt(parseInt(r,10))+"px";n?(a.style.width=A,s.style.width=A):(a.style.height=A,s.style.height=A),f.showHeaders&&l&&p?(l.classList.contains("e-zero")?o.classList.contains("e-zero")?n?(h.style.width=parseInt(h.style.width,10)+2+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+2+"px",a.style.height=parseInt(a.style.height,10)-1+"px"):St(a,-1,n):o.classList.contains("e-zero")?St(h,1,n):o.classList.contains("e-zero-start")&&(n?(h.style.width=parseInt(h.style.width,10)+1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+1+"px",a.style.height=parseInt(a.style.height,10)-1+"px")),p.classList.contains("e-zero")?St(a,-1,n):(o.classList.contains("e-zero")||o.classList.contains("e-zero-start"))&&St(c,1,n),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),o.classList.contains("e-zero-last")&&o.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),d.classList.add("e-zero-last"))):f.showHeaders&&l?(l.classList.contains("e-zero")?o.classList.contains("e-zero")?n?(a.style.width=parseInt(a.style.width,10)-1+"px",h.style.width=parseInt(h.style.width,10)+2+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",h.style.height=parseInt(h.style.height,10)+2+"px"):St(a,-1,n):o.classList.contains("e-zero")?St(h,1,n):St(a,-1,n),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-end")&&o.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):f.showHeaders&&p&&(p.classList.contains("e-zero")?St(a,-1,n):o.classList.contains("e-zero-start")&&(St(c,1,n),o.classList.remove("e-zero-start")),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"))}}function St(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function wt(e,t,r,n,i,o){var a=n.createElement("div",{className:n.element.className,styles:"display: block"}),s=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),l=n.createElement("tr");r?t.forEach(function(e){var t=l.cloneNode();t.appendChild(e),s.appendChild(t)}):(t.forEach(function(e){l.appendChild(e.cloneNode(!0))}),s.appendChild(l)),a.appendChild(s),document.body.appendChild(a);var h,d,p=s.getBoundingClientRect().width,c=s.getBoundingClientRect().height;return o?(h=r&&parseInt(i,10)>p?p:parseInt(i,10),d=!r&&parseInt(i,10)>c?c:parseInt(i,10)):(d=c,h=p),document.body.removeChild(a),r?Math.ceil(h):Math.ceil(d)}function It(e,r,n,i,o,a){var s,l,h,d,p,c,u,f,g,m,v,C,x=e.eventArgs,w=e.isFromUpdateAction||t.isUndefined(n);if(e.isUndoRedo)return w=e.isFromUpdateAction=!0,delete e.isUndoRedo,void r.notify(Po,e);if(w&&!a){var I=x.address||x.range||x.pastedRange||x.addressCollection&&x.addressCollection[0]||x.dataRange;if((F=t.isUndefined(x.sheetIndex)?t.isUndefined(x.sheetIdx)?t.isUndefined(x.activeSheetIndex)?I?S(r,I):r.activeSheetIndex:x.activeSheetIndex:x.sheetIdx:x.sheetIndex)!==r.activeSheetIndex){var E={sheet:be(r,F),resolveAfterFullDataLoaded:!0,indexes:[0,0,0,0],promise:new Promise(function(e){e(void 0)})};return r.notify(Wt,E),void E.promise.then(function(){It(e,r,n,i,o,!0)})}}switch(e.action){case"sorting":d={args:{range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},promise:h=new Promise(function(e,t){e(void 0)})},r.notify(Ar,d),d.promise.then(function(e){r.serviceLocator.getService("cell").refreshRange(y(e.range))});break;case"cellSave":var R={element:(p=e.eventArgs).element,value:p.value,oldValue:p.oldValue,address:p.address,displayText:p.displayText,formula:p.formula,originalEvent:p.originalEvent};c=R.formula?{formula:R.formula}:{value:R.value},r.updateCell(c,R.address),!0===n&&r.trigger("cellSave",R);break;case"cellDelete":var A=b(r,e.eventArgs.address);Ut(r,A.indices,A.sheetIndex);break;case"format":if("CellFormat"===x.requestType){if(x.style&&x.style.border&&!t.isNullOrUndefined(x.borderType)){var k={};Object.assign(k,x.style,null,!0),x.style.border=void 0,r.notify(ar,{style:x.style,refreshRibbon:!0,range:x.range}),x.style.border=k.border,r.setBorder(x.style,x.range,x.borderType),x.style=k}else r.notify(ar,{style:x.style,refreshRibbon:!0,range:x.range});Ke(function(){return r.selectRange(r.getActiveSheet().selectedRange)})}else r.numberFormat(x.format,x.range);break;case"clipboard":u=new Promise(function(e){e(void 0)}),C=r.getAddressInfo(x.copiedRange),r.notify(x.copiedInfo.isCut?to:ro,{range:C.indices,sId:be(r,C.sheetIndex).id,promise:h,invokeCopy:!0,isPublic:!0,isFromUpdateAction:!0}),u.then(function(){return r.notify(no,{range:y(x.pastedRange),sIdx:fe(r,me(x.pastedRange)),type:x.type,isAction:!1,isInternal:!0,isFromUpdateAction:!0})});break;case"gridLines":r.setSheetPropertyOnMute(r.sheets[x.sheetIdx],"showGridLines",x.isShow),r.serviceLocator.getService("sheet").toggleGridlines(),r.notify(In,null);break;case"headers":r.setSheetPropertyOnMute(r.sheets[x.sheetIdx],"showHeaders",x.isShow),r.serviceLocator.getService("sheet").showHideHeaders(),r.notify(In,null);break;case"resize":case"resizeToFit":w&&(m=ze(g=r.sheets[x.sheetIndex],x.index),v=Me(g,x.index),(x.isCol&&m&&m.hidden||v&&v.hidden)&&r.notify(gn,{startIndex:x.index,endIndex:x.index,hide:!1,isCol:x.isCol,sheetIndex:x.sheetIndex})),x.isCol?void 0===x.hide?r.setColWidth(w&&!t.isUndefined(n)?x.oldWidth:x.width,x.index,x.sheetIndex):r.hideColumn(x.index,x.index,x.hide):void 0===x.hide?r.setRowHeight(w&&!t.isUndefined(n)?x.oldHeight:x.height,x.index,x.sheetIndex):r.hideRow(x.index,x.index,x.hide);break;case"renameSheet":var F=ge(r,x.index);r.setSheetPropertyOnMute(r.sheets[F],"name",x.value),r.notify(Oo,{items:r.element.querySelector(".e-sheet-tabs-items"),value:x.value,idx:F});break;case"hideSheet":r.notify(Mo,{sheetIndex:x.sheetIndex});break;case"showSheet":r.notify(ya,x);break;case"removeSheet":r.notify(Ki,{index:x.index,isAction:!0,count:x.sheetCount,clicked:!0});break;case"gotoSheet":r.notify(va,{selectedIndex:x.currentSheetIndex,previousIndex:x.previousSheetIndex});break;case"moveSheet":Re(r,x.position,x.sheetIndexes,null,w);break;case"wrap":Le(e.eventArgs.address,e.eventArgs.wrap,r);break;case"hideShow":x.isCol?r.notify(gn,{startIndex:x.startIndex,endIndex:x.endIndex,isCol:!0,hide:!1===n?!x.hide:x.hide,sheetIndex:x.sheetIndex}):r.notify(gn,{startIndex:x.startIndex,endIndex:x.endIndex,hide:!1===n?!x.hide:x.hide,sheetIndex:x.sheetIndex});break;case"replace":r.notify(Kr,{value:x.compareValue,replaceValue:x.replaceValue,sheetIndex:x.sheetIndex,address:x.address});break;case"replaceAll":r.notify($r,x);break;case"filter":h=new Promise(function(e,t){e(void 0)}),!1===n?r.notify(Vo,{predicates:x.previousPredicates,range:x.range,sIdx:x.sheetIndex,promise:h,isInternal:!0}):r.notify(Vo,{predicates:x.predicates,range:x.range,sIdx:x.sheetIndex,promise:h,isInternal:!0,useFilterRange:x.useFilterRange}),o&&!w&&h.then(function(){r.notify(Yo,t.extend({isUndo:!n,isUndoRedo:!w},o))});break;case"insert":if("Sheet"===e.eventArgs.modelType)g=r;else if(!(g=be(r,e.eventArgs.activeSheetIndex)))break;!1===n?r.notify(zr,{model:g,start:e.eventArgs.index,isUndoRedo:!0,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType}):r.notify(Vr,{model:g,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,checkCount:void 0===n?e.eventArgs.sheetCount:null,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:e.eventArgs.insertType,isFromUpdateAction:w});break;case"delete":if("Sheet"===e.eventArgs.modelType)g=r;else if(!(g=be(r,e.eventArgs.activeSheetIndex)))break;!1===n?r.notify(Vr,{model:g,start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,columnCellsModel:e.eventArgs.deletedCellsModel,definedNames:e.eventArgs.definedNames,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:"Row"===e.eventArgs.modelType?"above":"before",conditionalFormats:e.eventArgs.conditionalFormats,prevAction:e.action}):r.notify(zr,{model:g,start:e.eventArgs.startIndex,checkCount:e.eventArgs.sheetCount,end:e.eventArgs.endIndex,modelType:e.eventArgs.modelType,isUndoRedo:!0,insertType:"Row"===e.eventArgs.modelType?"above":"before"});break;case"validation":!1===n?r.notify(ga,{range:x.range}):r.notify(jr,{rules:{type:x.type,operator:x.operator,value1:x.value1,value2:x.value2,ignoreBlank:x.ignoreBlank,inCellDropDown:x.inCellDropDown},range:x.range});break;case"removeHighlight":case"addHighlight":r.notify(ea,{isRemoveHighlight:"removeHighlight"===e.action?!1!==n:!1===n,range:x.range,isPublic:!0});break;case"merge":e.eventArgs.isAction=!1,f=[];for(var T=0,L=x.model.length;T<L;T++){f.push({cells:[]});for(var N=0,D=x.model[T].cells.length;N<D;N++)f[T].cells[N]={},Object.assign(f[T].cells[N],x.model[T].cells[N])}r.notify(hn,e.eventArgs),x.model=f;break;case"clear":var O={options:e.eventArgs,isFromUpdateAction:w};r.notify(xa,O),!w&&O.cfClearActionArgs&&(x.cfClearActionArgs.previousConditionalFormats=O.cfClearActionArgs.previousConditionalFormats,x.cfClearActionArgs.conditionalFormats=O.cfClearActionArgs.conditionalFormats);break;case"conditionalFormat":!1===n?r.notify(yn,{range:x.range,cfModel:{type:x.type,cFColor:x.cFColor,value:x.value},sheetIdx:x.sheetIdx,isUndoRedo:!x.cancel,isFromUpdateAction:w}):r.notify(mn,{cfModel:{type:x.type,cFColor:x.cFColor,value:x.value,range:x.range},sheetIdx:x.sheetIdx,isUndoRedo:!0,isFromUpdateAction:w});break;case"clearCF":if(!1===n)r.notify(yn,{oldCFModel:x.previousConditionalFormats,updatedCFModel:x.conditionalFormats,range:x.selectedRange,isUndo:!0,sheetIdx:x.sheetIdx});else{var M={range:x.selectedRange,sheetIdx:x.sheetIdx,isUndoRedo:!0,isFromUpdateAction:w};r.notify(yn,M),w||(x.previousConditionalFormats=M.oldCFModel,M.updatedCFModel.length?x.conditionalFormats=M.updatedCFModel:delete x.conditionalFormats)}break;case"insertImage":!1===n?r.notify(Oa,{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range,preventEventTrigger:!0}):r.notify(Da,{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0});break;case"deleteImage":!1===n?r.notify(Da,{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.address,isPublic:!1,isUndoRedo:!0}):r.notify(Oa,{id:e.eventArgs.id,range:e.eventArgs.address,preventEventTrigger:!0});break;case"imageRefresh":l=document.getElementById(e.eventArgs.id),!1===n?r.notify(Ta,{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}):(e.eventArgs.isUndoRedo=!0,r.notify(Ta,e.eventArgs)),l&&(l.style.height=!1===n?e.eventArgs.prevHeight+"px":e.eventArgs.currentHeight+"px",l.style.width=!1===n?e.eventArgs.prevWidth+"px":e.eventArgs.currentWidth+"px",l.style.top=!1===n?e.eventArgs.prevTop+"px":e.eventArgs.currentTop+"px",l.style.left=!1===n?e.eventArgs.prevLeft+"px":e.eventArgs.currentLeft+"px");break;case"insertChart":if(!1===n)r.notify(Ma,{id:x.id,range:x.range,isUndoRedo:!0});else{var P=[{type:x.type,theme:x.theme,isSeriesInRows:x.isSeriesInRows,range:x.range,id:x.id,height:x.height,width:x.width}];r.notify(Sn,{chart:P,isUndoRedo:!1,range:x.posRange})}break;case"deleteChart":if(!1===n){var H=[{type:x.type,theme:x.theme,isSeriesInRows:x.isSeriesInRows,range:x.range,id:x.id,height:x.height,width:x.width,top:x.top,left:x.left}];r.notify(Sn,{chart:H,isUndoRedo:!1,range:x.posRange})}else r.notify(Ma,{id:x.id,range:x.range,isUndoRedo:!0});break;case"chartRefresh":(s=document.getElementById(e.eventArgs.id))&&(s.style.height=!1===n?e.eventArgs.prevHeight+"px":e.eventArgs.currentHeight+"px",s.style.width=!1===n?e.eventArgs.prevWidth+"px":e.eventArgs.currentWidth+"px",s.style.top=!1===n?e.eventArgs.prevTop+"px":e.eventArgs.currentTop+"px",s.style.left=!1===n?e.eventArgs.prevLeft+"px":e.eventArgs.currentLeft+"px"),!1===n?r.notify(Pa,t.extend({},e.eventArgs,{currentColIdx:e.eventArgs.prevColIdx,currentHeight:e.eventArgs.prevHeight,currentLeft:e.eventArgs.prevLeft,currentRowIdx:e.eventArgs.prevRowIdx,currentTop:e.eventArgs.prevTop,currentWidth:e.eventArgs.prevWidth,prevColIdx:e.eventArgs.currentColIdx,prevHeight:e.eventArgs.currentHeight,prevLeft:e.eventArgs.currentLeft,prevRowIdx:e.eventArgs.currentRowIdx,prevTop:e.eventArgs.currentTop,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0})):(e.eventArgs.isUndoRedo=!0,r.notify(Pa,e.eventArgs));break;case"chartDesign":r.notify(Wa,e.eventArgs);break;case"autofill":r.notify(Hn,{fillRange:e.eventArgs.fillRange,dataRange:e.eventArgs.dataRange,fillType:e.eventArgs.fillType,direction:e.eventArgs.direction});break;case"removeValidation":!1!==n&&r.notify(ga,{range:x.range});break;case"addDefinedName":if(!1===n)r.notify(pr,{action:"removeDefinedName",isRemoved:!1,definedName:x.name,scope:x.scope,isEventTrigger:!0});else{var B={name:x.name,refersTo:x.refersTo,scope:x.scope,comment:x.comment};r.notify(pr,{action:"addDefinedName",isAdded:!1,definedName:B,isEventTrigger:!0})}break;case"hyperlink":r.notify(Or,{hyperlink:x.hyperlink,cell:x.address,displayText:x.displayText,triggerEvt:!1}),r.serviceLocator.getService("cell").refreshRange(y(x.address));break;case"removeHyperlink":r.notify(No,{range:x.address,preventEventTrigger:!0});break;case"freezePanes":r.freezePanes(x.row,x.column,x.sheetIndex);break;case"duplicateSheet":Ae(r,x.sheetIndex,null,w);break;case"protectSheet":x.isProtected?r.notify(on,x):(r.setSheetPropertyOnMute(be(r,x.sheetIndex),"password",""),r.notify(ra,{isActive:!0,sheetIndex:x.sheetIndex}));break;case"protectWorkbook":x.isProtected?r.notify(es,x):r.notify(ts,null);break;case"lockCells":r.notify(ln,x)}}function Et(e,t,r,n){for(var i,o=e.sheets[n].ranges,a=0,s=o.length;a<s;a++)if(o[a].template&&(i=c(o[a].address.length?o[a].address:o[a].startCell))[0]<=t&&i[1]<=r&&i[2]>=t&&i[3]>=r)return!0;return!1}function Rt(e,t,r,n,i,o,a){void 0===a&&(a=!0);var s=Ue(t,n,!0),l=e.frozenColCount(t),h=yt(r);if((i=i||(t.frozenRows?e.getRow(n,null,l):e.getRow(n)))&&(i.style.height=h+"px"),t.frozenColumns)o=e.getRow(n,null,l-1);else{var d=e.frozenRowCount(t);o=o||e.getRow(n,n<d?e.sheetModule.getSelectAllTable():e.getRowHeaderTable())}o&&(o.style.height=h+"px"),_e(t,n,r),e.setProperties({sheets:e.sheets},!0),a&&e.notify(yo,{rowIdx:n,threshold:h-s})}function At(e,t,r,n){void 0===r&&(r=1);var i=t&&t.fontSize||e.cellStyle.fontSize,o=(i.indexOf("pt")>-1?parseInt(i,10)/.75:parseInt(i,10))*(n||kt(t&&t.fontFamily?t:e.cellStyle))*r;return Math.ceil(o%1>.9?o+1:o)}function kt(e){var t=ul;return e&&("Arial Black"===e.fontFamily||"Comic Sans MS"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}function Ft(e,t,r,n){t||(t=r);var i=document.createElement("canvas").getContext("2d");return i.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n?i.measureText(e).width:yt(i.measureText(e).width,!0)}function Tt(e,t,r,n){var i,o,a,s,l,h=0,d=e.toString().split(" "),p=Ft(" ",r,n),c=0,u=0,f=0,g=function(e,o){h&&c++,i/t>=1&&(e.split("").forEach(function(e){s=Ft(e,r,n,!0),(a+=s)>t&&(c++,a=s)}),i=yt(a,!0)),o||m(i),h=i},m=function(e){i+=(e+p)/t>=1?0:p};return d.forEach(function(e){a=0,s=0,i=Ft(e,r,n),(h+i)/t>1?(o=e.split("-")).length>1?o.forEach(function(p){a=0,s=0,l||(l=Ft("-",r,n)),i=Ft(p,r,n),o[o.length-1]!==p&&(i+=l),(h+i)/t>=1?g(p,o[o.length-1]!==p):(o[o.length-1]===p&&d[d.length-1]!==e&&m(h+i),h+=i)}):g(e,!1):(m(h+i),h+=i)}),h&&(u=(h-p)/t,f=parseFloat(u.toString().split(".")[0]),c+=u+.05>=f+1?Math.ceil(u)+1:Math.ceil(u)),c}function Lt(e,t,r){var n=0,i=ke(e,t,r,null,!0);i.style&&(i.style.border?n=(0===e?2:1)*parseFloat(i.style.border.split("px")[0]):(0===e&&i.style.borderTop&&(n=parseFloat(i.style.borderTop.split("px")[0])),i.style.borderBottom&&(n+=parseFloat(i.style.borderBottom.split("px")[0]))));var o=ke(e+1,t,r,null,!0);return i.style&&(i.style.border||i.style.borderBottom)||!o.style||!o.style.borderTop||(n+=parseFloat(o.style.borderTop.split("px")[0])),Math.ceil(n)||1}function Nt(e,t,r,n){return void 0===n&&(n=r),We(e,r,n,!0)-yt(4+(function(e,t,r){var n=0,i=ke(e,t,r,null,!0),o=ke(e,t+1,r,null,!0);return i.style&&(i.style.border?n=(0===t?2:1)*parseFloat(i.style.border.split("px")[0]):(0===t&&i.style.borderLeft&&(n=parseFloat(i.style.borderLeft.split("px")[0])),i.style.borderRight&&(n+=parseFloat(i.style.borderRight.split("px")[0])))),i.style&&(i.style.border||i.style.borderRight)||!o.style||!o.style.borderLeft||(n+=parseFloat(o.style.borderLeft.split("px")[0])),n>0&&n<1?1:n}(t,r,e)||1))}function Dt(e,t,r,n,i,o,a){return At(e,i,o,a)+Lt(t,r,n)}function Ot(e,t,r,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][r]=n}function Mt(e,t){var r=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach(function(e){n[e]>r&&(r=n[e])}),r}function Pt(e){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(t.Browser.isIE){var r=window.scrollX,n=window.scrollY;e.focus(),window.scrollTo(r,n)}else{if(e.classList.contains("e-input")){var i=e,o=i.value.length;i.setSelectionRange(o,o)}e.focus({preventScroll:!0})}}function Ht(e,r){for(var n,i=e.getActiveSheet(),o=t.isNullOrUndefined(r)?w(c(i.selectedRange)):r,a=o[0];a<=o[2];a++)for(var s=o[1];s<=o[3];s++){if(ee(ke(a,s,i),ze(i,s))){n=!0;break}}return n}function Bt(e){return e.includes(" ")}function Ut(e,t,r){for(var n,i,o,a,s,l,h=be(e,r),d=r===e.activeSheetIndex,p=h.conditionalFormats&&h.conditionalFormats.length&&[].slice.call(h.conditionalFormats),c=[],u=t[0],f=t[2];u<=f;u++)if(!Be(h,u))for(var g=t[1],m=t[3];g<=m;g++){var v={cellIdx:[u,g],isUnique:!1,uniqueRange:""};if(e.notify(wr,v),n=!1,""!==v.uniqueRange){var C=y(v.uniqueRange);n="#SPILL!"===ke(C[0],C[1],h).value}if((!v.isUnique||n)&&(i=ke(u,g,h))){if(o={},i.formula&&(o.formula=""),(i.value||0===i.value)&&(o.value=""),i.hyperlink&&(o.hyperlink=""),a=e.getCell(u,g),s={cell:o,rowIdx:u,colIdx:g,valChange:!0,uiRefresh:d,td:a,cellDelete:!0},!Object.keys(o).length||oe(e,h,s))continue;p&&!l&&((l=s.isFormulaDependent)||he(p,c,u,g)),a&&(a.querySelector(".e-cf-databar")&&a.removeChild(a.querySelector(".e-cf-databar")),a.querySelector(".e-iconsetspan")&&a.removeChild(a.querySelector(".e-iconsetspan")))}}(c.length||l)&&d&&e.notify(vn,{cfModel:!l&&c,refreshAll:l,isAction:!0})}var _t=function(){function e(e,t,r,n,i){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){throw this.terminate(),e.message||e},e.prototype.getFnCode=function(){var e,t,r="",n="",i=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),i=!0),r+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),i=!0),r+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return r+="self.onmessage = "+(i?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}(),Vt=function(){function e(e){this.parent=e,this.localeObj=t.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return e.prototype.numberFormatting=function(e){var t=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(t=fe(this.parent,e.range.split("!")[0]));for(var r,n=this.parent.sheets[t],i=c(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:n.selectedRange),o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++)oe(this.parent,n,{cell:{format:e.format},rowIdx:o,colIdx:a})||(r=ke(o,a,n),this.getFormattedCell({value:r.value,format:r.format,rowIndex:o,colIndex:a,sheetIndex:t,cell:r}))},e.prototype.getFormattedCell=function(e){var r,n=void 0===e.value||null===e.value?"":e.value,i=void 0===e.sheetIndex?this.parent.activeSheetIndex:e.sheetIndex,o=this.parent.sheets[i];r=void 0===e.rowIndex?c(o.activeCell):[e.rowIndex,e.colIndex];var a=e.cell||ke(r[0],r[1],o,!1,!0),s=!1,l={},h=new t.Internationalization;h.getNumberFormat(l);var d=t.getNumberDependable(this.parent.locale,l.currency);if(e.format&&"General"!==e.format)e.type=H(e.format);else{e.type=e.format="General";var p={value:n,updatedVal:n,cell:a};this.checkDateFormat(p),(p.isDate||p.isTime)&&(s=!0,a.value=e.value=p.updatedVal,a.format?e.format=a.format:a.format=e.format=P(p.isDate?"ShortDate":"Time"))}var u;if(a.format&&this.isCustomType(a)){e.type="Custom";var f=void 0,m=a.format;a.format=a.format.split("\\").join(""),this.currentRange=g(r[0],r[1]),a.format.indexOf(";")>-1?(a.format.indexOf("<")>-1||a.format.indexOf(">")>-1?e.result=this.processCustomConditions(a):(e.result=this.processCustomAccounting(a,r[0],r[1],e.td,d,e.skipRowFill),f=!(N(a.value)&&!(a.format&&a.format.indexOf("@")>-1))),a.format=m):Oe(a,!0)?(e.result=this.processCustomDate(e,a),f=""===e.result,e.result=e.result||a.value):a.format.indexOf("/")>-1?e.result=this.processCustomFraction(a):a.format.indexOf("@")>-1?(f=!0,e.result=this.processCustomText(a)):a.format.includes("E+0")&&N(n)?(e.format!==a.format&&(e.format=a.format),e.result=this.scientificFormat(e)):M(a,this.parent.locale,this.groupSep,this.decimalSep).isNumber?(e.result=this.processCustomNumberFormat(a,r[0],r[1],e.td),f=!N(a.value)):f=e.dataUpdate=!0,e.dataUpdate||(e.value=e.result),e.isRightAlign=!f&&!t.isNullOrUndefined(a.value)}else u=this.processFormats(e,n,s,a,h,d,l.currency);return e.isRowFill=this.isRowFill,e.onLoad||(o.id===this.parent.getActiveSheet().id&&(this.parent.notify(or,{isRightAlign:"Custom"===e.type?e.isRightAlign:u.rightAlign,result:"Custom"===e.type?e.value:u.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:d,value:"Custom"===e.type?e.value:e.value||"",isRowFill:this.isRowFill}),this.isRowFill=!1),this.parent.setUsedRange(e.rowIndex,e.colIndex)),this.isRowFill=!1,"Custom"===e.type?e.formattedText=void 0===e.value||null===e.value?"":e.value.toString():(e.formattedText=u.fResult||(void 0===e.value||null===e.value?"":e.value.toString()),e.isRightAlign=u.rightAlign),e.curSymbol=d,e.formattedText},e.prototype.isCustomType=function(e){var t=H(e.format),r=this.parent.serviceLocator.getService("spreadsheetLocale");return!!(t===r.getConstant("General")&&e.format!==r.getConstant("General")||t===r.getConstant("Time")&&this.parent.isEdit)},e.prototype.processCustomFill=function(e,t,r,n,i,o){var a,s,l=t.format.indexOf("*"),h=e[l+1],d=e.split(e[l]+h);if(""===d[1]){var p={format:e=e.split(e[l]+h).join(""),value:t.value};a=this.processCustomNumberFormat(p)}else{a=e.split(e[l]+h)[0];p={format:e=d[1],value:t.value};s=this.processCustomNumberFormat(p),0===parseFloat(t.value)&&(s=s.split("0").join(""))}return o||(this.isRowFill=!0,this.parent.notify(Vn,{cell:t,rowIdx:r,colIdx:n,value:h,formatText:a,secText:s,td:i})),a},e.prototype.processCustomDate=function(e,r){var n,i=this,o=F(parseFloat(r.value));if(isNaN(Number(o))&&!(n=r.value&&function(){var e=t.IntlBase.getDependables(t.cldrData,i.parent.locale,null).dateObject,n=e.months["stand-alone"]&&e.months["stand-alone"].abbreviated;return n&&!!Object.keys(n).find(function(e){return r.value.toString().includes(n[e])})}()))return r.value||"";var a,s=r.format,l=new t.Internationalization,h=function(h){var d;if(r.value.toString().includes("/")||r.value.toString().includes("-")||n){if(o=D(r.value,new t.Internationalization,i.parent.locale,s,r).dateObj,d=o&&"Invalid Date"!==o.toString()){if(o.getFullYear()<1900)return"";r.value=T(o).toString()}}else d=o&&"Invalid Date"!==o.toString();return h&&d&&(e.dateObj=o),d&&l.formatDate(o,{type:a,format:s})||""};if(r.format.indexOf("h")>-1&&(s=s.split("h").join("H"),a="time"),r.format.indexOf("s")>-1&&(a="time"),(r.format.indexOf("AM/PM")>-1||r.format.indexOf("A/P")>-1)&&(s=(s=s.split("H").join("h")).split("A/P").join("AM/PM").split("AM/PM").join("a"),a="time"),r.format.indexOf("d")>-1){a="date";for(var d=s.split(" "),p=void 0,c=0;c<d.length;c++)(p=d[c].match(/d/g))&&p.length>2&&(d[c]=d[c].split("d").join("E"));s=d.join(" ")}if(r.format.indexOf("m")>-1)if(r.format.indexOf("s")>-1||r.format.indexOf("h")>-1)a="time";else if(a="date",s=s.split("m").join("M"),r.format.indexOf("mmmmm")>-1){s="MMMM";var u=h()[0];return s=r.format.split("mmmmm").join("p"),h(e.checkDate).split("p").join(u)}return h(e.checkDate)},e.prototype.processCustomFraction=function(e){return""},e.prototype.processCustomConditions=function(e){if(N(e.value)){for(var t=e.format.split(";"),r=Number(e.value),n=[],i=void 0,o=void 0,a=void 0,s=void 0,l=0;l<t.length;l++){if(i=t[l],n.push(Ne(i)),n[l]&&(i=i.split("["+n[l]+"]").join("")),o=i.split("[")[1].split("]")[0],2===(a=o.split("<=")).length&&r<=Number(a[1])||1===a.length&&2===(a=o.split(">=")).length&&r>=Number(a[1])||1===a.length&&2===(a=o.split("<")).length&&r<Number(a[1])||1===a.length&&2===(a=o.split(">")).length&&r>Number(a[1])){e.format=t[l].split("["+o+"]")[0]+t[l].split("["+o+"]")[1],s=!1;break}s=2===a.length}return s?(e.style&&e.style.color&&n.indexOf(e.style.color)>-1&&this.parent.notify(ar,{style:{color:""},range:this.currentRange}),"#####"):this.processCustomNumberFormat(e)}return e.value},e.prototype.processCustomAccounting=function(e,r,n,i,o,a){var s,l=e.format.split(";"),h=M(e,this.parent.locale,this.groupSep,this.decimalSep,o),d=e.value;if(h.isNumber&&(e.value=h.value,s=parseFloat(h.value)),s>0)e.format=l[0];else if(0===s){if(!t.isNullOrUndefined(l[2]))return e.format=l[2]+"0",this.processCustomNumberFormat(e,r,n,i).split("0").join("");e.format=l[0]}else{if(!N(s))return e.format=l[3],t.isNullOrUndefined(l[3])?e.value?e.value.toString():"":this.processCustomText(e);e.format=l[1]}if(s<0){e.value=Math.abs(s).toString();var p=this.processCustomNumberFormat(e,r,n,i);return e.value=d,p}return this.processCustomNumberFormat(e,r,n,i,a)},e.prototype.processCustomText=function(e){var t=this.processCustomNumberFormat({format:e.format.split("@").join("#"),value:e.value?e.value.split(e.value).join("0"):""});return t&&t.split("0").join(e.value)},e.prototype.thousandSeparator=function(e,t){for(;e;)t/=1e3,e--;return t},e.prototype.getSeparatorCount=function(e){for(var t=0,r=["#","0"],n=0;n<e.format.length;n++)","!==e.format[n]||r.indexOf(e.format[n+1])>-1||t++;return t},e.prototype.processSeparator=function(e){var t=this.getSeparatorCount(e),r=this.thousandSeparator(t,parseInt(e.value,10));return e.format.indexOf(".")>-1||(r=Math.round(r)),e.value=this.getFormattedNumber(e.format.split(",").join(""),r),e.value=e.value.replace(",",""),0===r&&(e.value=e.value.replace("0","")),e.value},e.prototype.processDigits=function(e){var r=e.format.split("?").join("0"),n=e.value;return e.value=this.getFormattedNumber(r,parseFloat(e.value)),!t.isNullOrUndefined(e.value)&&e.value.includes(".")&&(e.value=e.value.split(".")[0]+"."+e.value.split(".")[1].split("0").join("  ")),""===e.value&&"0"===n&&(e.value=n),e.value},e.prototype.processSpace=function(e,t){var r={cell:t,char:" ",width:0};this.parent.notify(zn,r);for(var n,i=r.width,o=0;o<e.length;o++)if("_"===e[o]){r.char=e[o+1],this.parent.notify(zn,r);var a=r.width;n=Math.round(a/i),e=e.replace(e[o]+e[o+1]," ".repeat(n))}return e},e.prototype.processCustomNumberFormat=function(e,t,r,n,i){if(""===e.format)return"";var o=0,a=e.value,s=!1;if(o=M(e,this.parent.locale,this.groupSep,this.decimalSep).value,e&&N(o)){e.value=o,o=parseFloat(o.toString());var l=this.processCustomColor(e);this.getSeparatorCount(e)&&(s=!0,a=this.processSeparator(e)),l.indexOf("?")>-1&&(s=!0,l=e.format.split("?").join(""),a=this.processDigits(e)),l.indexOf("_")>-1&&(s=!0,l=e.format=this.processSpace(l,e),a=this.getFormattedNumber(l,o)),(e.format.indexOf('"')>-1||e.format.indexOf("\\")>-1)&&(l=this.processText(l)),l&&a&&l.indexOf("?")>-1&&(a=a.replace("?"," ")),l.indexOf("*")>-1&&(s=!0,a=this.processCustomFill(l,e,t,r,n,i)),"General"===l&&(s=!0,a=o.toString()),s||(a=this.getFormattedNumber(l,o)),null!=l&&l.split(".")[0].indexOf("#")>-1&&o<1&&(a=a.toString().replace(/^0+/,""))}return a},e.prototype.processText=function(e){var t=e;return t.indexOf('"')>-1?t=t.split('"').join(""):t.indexOf("\\")>-1&&(t=t.split("\\").join("")),t},e.prototype.processCustomColor=function(e){var t=e.format,r=Ne(t);return r?(t=e.format.split("["+r+"]")[0]+e.format.split("["+r+"]")[1],this.currentRange.indexOf("NaN")>-1&&(this.currentRange=void 0),this.parent.notify(ar,{style:{color:r},range:this.currentRange})):e.style&&["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(e.style.color)>-1&&this.parent.notify(ar,{style:{color:"black"}}),t},e.prototype.processFormats=function(e,t,r,n,i,o,a){var s;if(""!==t)switch(e.type){case"General":t=(s=this.autoDetectGeneralFormat({args:e,currencySymbol:o,fResult:t,intl:i,isRightAlign:r,curCode:a,cell:n,rowIdx:Number(e.rowIndex),colIdx:Number(e.colIndex)})).fResult,r=s.isRightAlign;break;case"Number":N(t)&&(t=this.applyNumberFormat(e,i),r=!0);break;case"Currency":var l=M({value:t,format:e.format},this.parent.locale,this.groupSep,this.decimalSep,o);l.isNumber&&(e.value=l.value,t=this.currencyFormat(e,i,a),r=!0);break;case"Percentage":N(t)&&(t=this.percentageFormat(e,i),r=!0);break;case"Accounting":N(t)&&(t=this.accountingFormat(e,i,o,a),r=!0);break;case"ShortDate":r=!!(t=this.shortDateFormat(e,i));break;case"LongDate":r=!!(t=this.longDateFormat(e,i));break;case"Time":r=!!(t=this.timeFormat(e,i));break;case"Fraction":N(t)&&(t=this.fractionFormat(e),r=!0);break;case"Scientific":N(t)&&(t=this.scientificFormat(e),r=!0);break;case"Text":r=!1}return{fResult:t,rightAlign:r}},e.prototype.autoDetectGeneralFormat=function(e){var r=!1,n=e.fResult;if(e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("ADDRESS(")>0&&(r=!0),N(e.fResult)){e.args.format&&""!==e.args.format&&(e.args.format.toString().indexOf("%")>-1?e.fResult=this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?e.fResult=this.currencyFormat(e.args,e.intl,e.curCode):e.fResult=this.applyNumberFormat(e.args,e.intl));var i=void 0;"General"===e.args.format&&(i=e.fResult||e.args.value)&&i.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args,5)),e.isRightAlign=!0}if(!t.isNullOrUndefined(e.fResult)){var o=e.fResult.toString();if(o.indexOf("%")>-1&&""!==o.split("%")[0]&&""===o.split("%")[1].trim()&&"NaN"!==Number(o.split("%")[0].split(this.groupSep).join("")).toString())e.args.value=Number(o.split("%")[0].split(this.groupSep).join(""))/100,e.cell.format=e.args.format=this.getPercentageFormat(o),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0;else if(o.indexOf(e.currencySymbol)>-1){var a=o.split(e.currencySymbol);""===a[0].trim()&&""!==a[1]&&N(a[1].split(this.groupSep).join(""))&&(e.args.value=Number(a[1].split(this.groupSep).join("")),e.cell.format=e.args.format=P("Currency"),e.fResult=this.currencyFormat(e.args,e.intl,e.curCode),e.cell.value=e.args.value.toString(),Fe(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}}return r&&(e.isRightAlign=!1,e.fResult=n),{isRightAlign:e.isRightAlign,fResult:e.fResult}},e.prototype.getPercentageFormat=function(e){return e.indexOf(this.decimalSep)>-1?P("Percentage"):"0%"},e.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},e.prototype.applyNumberFormat=function(e,r){e.format=this.isCustomFormat(e.format.toString());var n=e.format.toString().split(";");if(Number(e.value)>0)e.format=n[0];else if(0===Number(e.value)){if(e.format=n[2]?n[2]:n[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=t.isNullOrUndefined(n[1])?n[0]:n[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=n[3]?n[3]:n[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.decimalSep)>-1){var i=e.format.split(this.decimalSep)[1].length,o="";if(Number(e.value)%1){o=i>e.value.toString().split(".")[1].length?" ":"0"}e.format=e.format.split("?").join(o)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&(e.format=e.cell.format),r.formatNumber(Number(e.value),{format:e.format})},e.prototype.isCustomFormat=function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),e=""===e?P("Number"):e,e=e.toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},e.prototype.currencyFormat=function(e,r,n){e.format=""===e.format?P("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var i=e.format.toString().split(";");return Number(e.value)>=0?e.format=i[0]:e.format=t.isNullOrUndefined(i[1])?i[0]:i[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),r.formatNumber(Number(e.value),{format:e.format,currency:n})},e.prototype.percentageFormat=function(e,t){return e.format=""===e.format?P("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},e.prototype.accountingFormat=function(e,t,r,n){e.format=""===e.format?P("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var i=e.format.split(";");return Number(e.value)>=0?e.format=i[0]:e.format=i[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),0===Number(e.value)?r+"- ":t.formatNumber(Number(e.value),{format:e.format,currency:n}).split("-").join("")},e.prototype.getFormatForOtherCurrency=function(e){if(e.indexOf("[$")>-1){var t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e},e.prototype.shortDateFormat=function(e,r){var n,i=""===e.format||"General"===e.format?P("ShortDate"):e.format;if(i===P("ShortDate")?(i="MM-dd-yyyy",n={type:"date",skeleton:"yMd"}):n={type:"date",format:i},e.value&&(e.value=e.value.toString(),e.value.includes("/")||e.value.includes("-"))){"dd-MM-yyyy"!==i&&"dd/MM/yyyy"!==i||(i="");var o=D(e.value,new t.Internationalization,this.parent.locale,i,e.cell).dateObj;if(o&&"Invalid Date"!==o.toString())return o.getFullYear()<1900?"":(e.value=T(o).toString(),e.cell&&(e.cell.value=e.value),e.checkDate&&(e.dateObj=o),r.formatDate(o,n))}var a=F(e.value);return e.checkDate&&(e.dateObj=a),r.formatDate(a,n)},e.prototype.longDateFormat=function(e,t){var r=F(e.value),n=""===e.format||"General"===e.format?P("LongDate"):e.format.toString();return n===P("LongDate")&&(n="EEEE, MMMM d, y"),e.checkDate&&(e.dateObj=r),t.formatDate(r,{type:"date",format:n})},e.prototype.timeFormat=function(e,r){if(t.isNullOrUndefined(e.value))return"";var n=e.value.toString().split(this.decimalSep);t.isNullOrUndefined(n[1])||(e.value=parseFloat(n[0]+1+this.decimalSep+n[1])||e.value);var i=F(e.value),o=""===e.format||"General"===e.format?P("Time"):e.format.toString();return o===P("Time")&&(o="h:mm:ss a"),r.formatDate(i,{type:"time",skeleton:"medium",format:o})},e.prototype.scientificFormat=function(e,t){e.format=""===e.format?P("Scientific"):e.format;var r=e.format.split("+")[1]||"00";t=t||this.findDecimalPlaces(e.format,"Scientific");var n=Number(e.value).toExponential(t);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(r,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(r,n.split("e-")[1])),n},e.prototype.fractionFormat=function(e){e.format=""===e.format?P("Fraction"):e.format;var t,r="";return e.value.toString().indexOf(this.decimalSep)>-1&&N(e.value)?(r=e.value.toString().split(this.decimalSep)[0],t=A(Number(e.value)),0===Number(r)?" "+t:r+" "+t):r},e.prototype.findDecimalPlaces=function(e,t){var r,n;switch(t){case"Scientific":if(r=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep),r>-1)return e.substring(n+1,r).length}return 2},e.prototype.checkDateFormat=function(e){if(!t.isNullOrUndefined(e.value)){var r=e.cell||ke(e.rowIndex,e.colIndex,be(this.parent,t.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex),!1,!0),n=this.checkCustomDateFormat(e.value.toString(),r);if("Invalid"!==n.val){var i=D(n.val,new t.Internationalization,this.parent.locale,n.format,r);!t.isNullOrUndefined(i.dateObj)&&"Invalid Date"!==i.dateObj.toString()&&i.dateObj.getFullYear()>=1900&&(n.val=T(i.dateObj,n.val.indexOf(":")>-1,i.type&&"time"===i.type).toString(),r.format||("time"===i.type?r.format=P("Time"):r.format=P("ShortDate")),e.isDate="date"===i.type||"datetime"===i.type,e.isTime="time"===i.type,e.dateObj=i.dateObj),e.updatedVal=n.val}}},e.prototype.checkCustomDateFormat=function(e,t){var r;if(e.includes("/"))r="/";else{if(!e.includes("-"))return{val:e.includes(":")?e:"Invalid",format:""};r="-"}var n=e.split(r),i="",o=[],a=function(){i=o.join(r),t.format||(t.format=i)};if(2===n.length){var s,l=function(t){e=s,o[0]="MMM",Number(t)<=31?(e=t+r+e,o.splice(0,0,"dd"),a()):Number(t)>=1900&&Number(t)<=9999&&(e+=r+t.slice(2,4),o[1]="yy",a())},h=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];n[0]=n[0].toLowerCase().trim(),n[1]=n[1].toLowerCase().trim();var d=n[1].substring(0,3);(s=!Number(n[0])&&h.find(function(e){return n[0].includes(e)}))?n[0].includes(",")||l(n[1]):(s=!Number(n[1])&&h.find(function(e){return d.includes(e)}))?l(n[0]):n[0]&&Number(n[0])<=12&&Number(n[1])&&(s=h[Number(n[0])-1],l(n[1])),o.length||(e="Invalid")}else if(n.length>2){h=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];for(var p=function(t){Number(n[t])>-1||(h.filter(function(e){return n[t].toLowerCase().includes(e)}).length?1===t&&(o[1]="MMM",Number(n[0])<31&&Number(n[2])>=1900&&Number(n[2])<=9999&&(o[0]="d",o[2]="yy",a())):e="Invalid")},c=0;c<n.length;c++)p(c)}return{val:e,format:i}},e.prototype.formattedBarText=function(e){if(""!==e.value){var r=H(e.cell?e.cell.format:""),n=new t.Internationalization,i=e.value,o="ShortDate"===r&&e.cell&&e.cell.format?e.cell.format:P("ShortDate"),a=P("Time");switch(r){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:r,value:e.value,format:o,cell:e.cell},n);break;case"Time":i&&Number(i)>=1?e.value=this.shortDateFormat({type:r,value:e.value,format:o},n)+" "+this.timeFormat({type:r,value:e.value,format:a},n):e.value=this.timeFormat({type:r,value:e.value,format:a},n)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=i)}},e.prototype.getFormattedNumber=function(e,r){return(new t.Internationalization).formatNumber(Number(r),{format:e})||""},e.prototype.addEventListener=function(){this.parent.on(nr,this.numberFormatting,this),this.parent.on(ir,this.getFormattedCell,this),this.parent.on(ur,this.checkDateFormat,this),this.parent.on(fr,this.formattedBarText,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(nr,this.numberFormatting),this.parent.off(ir,this.getFormattedCell),this.parent.off(ur,this.checkDateFormat),this.parent.off(fr,this.formattedBarText))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookNumberFormat"},e}(),zt=function(){function e(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Wt,this.updateSheetFromDataSourceHandler,this),this.parent.on(Gt,this.dataSourceChangedHandler,this),this.parent.on(Yt,this.dataChangedHandler,this),this.parent.on(Xt,this.triggerDataChangeHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Wt,this.updateSheetFromDataSourceHandler),this.parent.off(Gt,this.dataSourceChangedHandler),this.parent.off(Yt,this.dataChangedHandler),this.parent.off(Xt,this.triggerDataChangeHandler))},e.prototype.updateSheetFromDataSourceHandler=function(e){var t,n,i,o,a,s,l,h,d,p,u=this,f=[],g=[],m=new r.Deferred;if(e.promise=m.promise,e.sheet&&e.sheet.ranges.length)for(var v=function(v){var C=e.indexes[0],x=e.indexes[2],b=e.sheet.ranges[v];h=c(b.startCell)[0],s=b.dataSource instanceof r.DataManager?b.dataSource:b.dataSource?new r.DataManager(b.dataSource):new r.DataManager,a=a||s.dataSource.url,e.sheet.isLocalData=!s.dataSource.url,h<=C?C-=h:h<=x?(x-=h,C=0):C=-1,b.showFieldAsHeader&&0!==C&&(C-=1);var S=!1,w=0;y.initRangeInfo(b);var I=y.getMaxCount(b);if(p=y.getLoadedInfo(C,x,b),C=p.unloadedRange[0],x=p.unloadedRange[1],b.info.insertRowRange&&(b.info.insertRowRange.forEach(function(e){w+=e[1]-e[0]+1}),C-=w,x-=w),C>=I?S=!0:x>I&&(x=I),y.requestedInfo.push({deferred:m,indexes:e.indexes,isNotLoaded:p.isNotLoaded}),C>=0&&p.isNotLoaded&&!S){g[v]=C,f[v]=!1;var E=(b.query?b.query:new r.Query).clone();s.executeQuery(E.range(C,x>=I?x:x+1).requiresCount()).then(function(r){if(u.parent&&!u.parent.isDestroyed){if(o=r.result&&r.result.result?r.result.result:r.result,i=c(b.startCell),h=i[0],d=i[1],o&&o.length){if(b.info.count||(I=r.count,b.info.count=r.count),n=Object.keys(o[0]),b.info.fldLen||(b.info.fldLen=n.length,b.info.flds=n),b.info.insertColumnRange){var a=0;b.info.insertColumnRange.forEach(function(e){for(var t=e[0];t<=e[1];t++)t<=d?n.splice(0,0,"emptyCell"+a):n.splice(t-d,0,"emptyCell"+a),a++})}0===g[v]&&b.showFieldAsHeader&&(l=h+g[v]+w,n.forEach(function(r,n){(t=ke(l,d+n,e.sheet,!0))?r.includes("emptyCell")||(t.value=r):e.sheet.rows[h+g[v]].cells[d+n]=r.includes("emptyCell")?{}:{value:r}}));e.formulaCellRef&&ge(u.parent,e.sheet.id);o.forEach(function(r,i){l=h+g[v]+i+(b.showFieldAsHeader?1:0)+w;for(var o=0;o<n.length;o++)(t=ke(l,d+o,e.sheet,!0))?n[o].includes("emptyCell")||Fe(l,d+o,e.sheet,u.getCellDataFromProp(r[n[o]]),!0):e.sheet.rows[l].cells[d+o]=n[o].includes("emptyCell")?{}:u.getCellDataFromProp(r[n[o]])})}else n=[];var s;s=h+(I||r.count)>0?h+(I||r.count)+(b.showFieldAsHeader?1:0)+w-1:e.sheet.usedRange.rowIndex;var m=d+n.length-1<0?e.sheet.usedRange.colIndex:d+n.length-1;if(e.isFinite?(e.sheet.usedRange.rowIndex=s<e.sheet.rowCount?s:e.sheet.rowCount-1,e.sheet.usedRange.colIndex=m<e.sheet.colCount?m:e.sheet.colCount-1):(e.sheet.usedRange.rowIndex=s,e.sheet.usedRange.colIndex=m),w?(p=u.getLoadedInfo(C,x,b),C=p.unloadedRange[0],x=p.unloadedRange[1],C>I&&(p.isNotLoaded=!1),p.isNotLoaded&&(x>I&&(x=I),b.info.loadedRange.push([C,x]))):b.info.loadedRange.push([C,x]),f[v]=!0,-1===f.indexOf(!1)){var y=void 0;if(x+h<h+b.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(v),y=!0;var S={sheet:e.sheet,indexes:[0,0,s,m],promise:new Promise(function(e,t){e(void 0)}),rangeSettingCount:e.rangeSettingCount,isFinite:e.isFinite,resolveAfterFullDataLoaded:e.resolveAfterFullDataLoaded};u.updateSheetFromDataSourceHandler(S),S.promise.then(function(){"workbook"!==u.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||u.parent.notify("created",null),e.formulaCellRef&&u.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex))})}else e.formulaCellRef&&u.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex);y&&e.resolveAfterFullDataLoaded||(u.checkResolve(e.indexes),e.resolveAfterFullDataLoaded&&u.checkResolve([0,0,0,0]))}}})}else 0===v&&-1===f.indexOf(!1)&&y.checkResolve(e.indexes)},y=this,C=e.sheet.ranges.length-1;C>=0;C--)v(C);else m.resolve()},e.prototype.notfyFormulaCellRefresh=function(e,t){this.parent.formulaRefCell=null,this.parent.notify("updateView",{indexes:c(e),sheetIndex:t,refreshing:!0})},e.prototype.checkResolve=function(e){var t,r,n=0;this.requestedInfo.forEach(function(i,o){((r=JSON.stringify(i.indexes)===JSON.stringify(e))||t)&&(0===o?(i.deferred.resolve(),n++,t=!0):!t||!i.isLoaded&&i.isNotLoaded?r&&t?(i.deferred.resolve(),n++):r?i.isLoaded=!0:t=!1:(i.deferred.resolve(),n++))}),this.requestedInfo.splice(0,n)},e.prototype.getCellDataFromProp=function(e){var r={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?r.formula=e.formula:t.isNullOrUndefined(e.value)||("string"==typeof e.value&&(0===e.value.indexOf("http://")||0===e.value.indexOf("https://")||0===e.value.indexOf("ftp://")||0===e.value.indexOf("www."))?(r.hyperlink=e.value,r.style={textDecoration:"underline",color:"#00e"}):r.value=e.value):W(e)?r.formula=e:"string"==typeof e&&(0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("ftp://")||0===e.indexOf("www."))?(r.hyperlink=e,r.style={textDecoration:"underline",color:"#00e"}):r.value=e,r},e.prototype.checkDataForFormat=function(e){if(""!==e.value){var t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1,sheetIndex:e.sheetIndex};this.parent.notify(ur,t),t.isDate?e.cell?(e.cell.format||(e.cell.format=P("ShortDate")),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=P("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format||(e.cell.format=P("Time")),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=P("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}},e.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach(function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}},e.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},e.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},e.prototype.dataSourceChangedHandler=function(e){var t,r=this,n=this.parent.sheets[e.sheetIdx],i=n.ranges[e.rangeIdx];if(i&&(this.checkRangeHasChanges(n,e.rangeIdx)||!i.info)){var o=i.showFieldAsHeader,a=u(i.startCell);i.info&&(i.info.loadedRange.forEach(function(e){for(var r=e[0];r<=e[1]&&r<i.info.count+(o?1:0);r++)if(t=n.rows[r+a[0]])for(var s=a[1];s<a[1]+i.info.fldLen;s++)t.cells&&t.cells[s]&&delete t.cells[s]}),i.info=null);var s=this.parent.viewport,l=[s.topIndex,s.leftIndex,s.bottomIndex,s.rightIndex],h={sheet:n,indexes:l,dataSourceChange:!0,promise:new Promise(function(e,t){e(void 0)})};this.updateSheetFromDataSourceHandler(h),h.promise.then(function(){r.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:Number(e.rangeIdx),sheetIndex:Number(e.sheetIdx)}),r.parent.notify("updateView",{indexes:l,checkWrap:!0,checkCF:!0})})}},e.prototype.checkRangeHasChanges=function(e,t){if(this.parent.isAngular){var r="changedRangeIdx";return e[r]===parseInt(t,10)&&(delete e[r],!0)}return!0},e.prototype.dataChangedHandler=function(e){var t,r,n,i,o,a,s,l,h,d=this,p=[{}],f=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,m=this.parent.sheets[f];m.ranges.forEach(function(v,y){if(v.dataSource){var C=void 0;if(i=u(v.startCell),n=i.concat([i[0]+v.info.count+(v.showFieldAsHeader?0:-1),i[1]+v.info.fldLen-1]),"Row"===e.modelType||"Column"===e.modelType){if("Column"===e.modelType){if(e.insertType)o=n[1]<e.index&&n[3]>=e.index,l=[e.index],o?(e.model.forEach(function(){v.info.flds.splice(e.index-i[1],0,"")}),v.info.fldLen+=e.model.length):n[3]+1===e.index&&"after"===e.insertType?(e.model.forEach(function(){v.info.flds.splice(e.index-i[1],0,"")}),v.info.fldLen+=e.model.length):n[1]>=e.index&&(v.startCell=g(i[0],i[1]+e.model.length));else if(o=n[1]<=e.startIndex&&n[3]>=e.startIndex)for(var x=e.startIndex;x<=e.endIndex;x++)x<=n[3]&&(v.info.flds.splice(e.startIndex,1),v.info.fldLen-=1);return}if(e.insertType){if(o=(v.showFieldAsHeader||"above"!==e.insertType&&!e.isMethod?n[0]<e.index:n[0]<=e.index)&&n[2]>=e.index,l=[e.index],o?(C=!0,v.info.count+=e.model.length):n[2]+1===e.index&&"below"===e.insertType?(C=!0,v.info.count+=e.model.length):n[0]>=e.index&&(v.startCell=g(i[0]+e.model.length,i[1])),e.isMethod)return}else o=n[0]<=e.startIndex&&n[2]>=e.startIndex,e.isDataRequest?l=[e.startIndex,n[1],e.startIndex,n[1]]:t="delete"}else{l=c(e.requestType&&e.requestType.toLowerCase().includes("paste")?e.pastedRange.split("!")[1]:e.sheetIdx>-1?e.address:(e.address||e.range||e.fillRange).split("!")[1]);var b=[v.showFieldAsHeader?n[0]+1:n[0]].concat(n.slice(1,4));if(v.showFieldAsHeader&&l[0]===i[0])for(x=l[1];x<=l[3];x++)x>=b[1]&&x<=b[3]&&(v.info.flds[x-i[1]]=ke(i[0],x,m,!1,!0).value||"");if(o=Q(b,l,!0),"paste"===e.requestType&&e.copiedInfo.isCut){if(h=[].slice.call(e.copiedInfo.range),v.showFieldAsHeader&&h[0]===i[0]){for(x=h[1];x<=h[3];x++)x>=b[1]&&x<=b[3]&&(v.info.flds[x-i[1]]="");o=!1}a=Q(b,h,!0)}}if(o||C||a){if("Row"!==e.modelType||e.insertType||e.isDataRequest){t=C?"add":"edit";var S=0;if(a){S=h[2]-h[0]+1;var w=function(e){p[e]={},v.info.flds.forEach(function(t,n){t&&(r=ke(h[0]+e,i[1]+n,m),p[e][t]=d.getFormattedValue(r))})};for(x=0;x<S;x++)w(x)}if(o||C)for(var I,E=!(e.isDataRequest||a||C||e.skipFilterCheck),R=function(e,t){if(E&&Be(m,l[0]+e))return I=t,"continue";p[t+S]={},v.info.flds.forEach(function(n,o){n&&(r=ke(l[0]+e,i[1]+o,m),p[t+S][n]=d.getFormattedValue(r))}),I=++t},A=(x=0,0);x<(C?e.model.length:l[2]-l[0]+1||1);x++)R(x,A),A=I}else{if(e.deletedModel.forEach(function(e,t){p[t]={},v.info.flds.forEach(function(n,o){e.cells?(r=e.cells[i[1]+o],p[t][n]=d.getFormattedValue(r)):p[t][n]=null}),v.info.count-=1}),e.isMethod)return;s={count:e.deletedModel.length,index:e.endIndex}}e.isDataRequest?e.data=p:d.parent.trigger("dataSourceChanged",{data:p,action:t,rangeIndex:y,sheetIndex:f})}else s&&s.count&&n[0]>s.index&&(v.startCell=g(i[0]-s.count,i[1]))}})},e.prototype.getFormattedValue=function(e){var t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t},e.prototype.triggerDataChangeHandler=function(e){var r=!0;if(("delete"===e.action||"insert"===e.action)&&["Sheet"].indexOf(e.eventArgs.modelType)>-1?r=!1:"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1?r=!1:"clipboard"===e.action&&"Formats"===e.eventArgs.requestType&&(r=!1),r&&["insert","delete","edit","cellDelete","cellSave","autofill","clipboard","clear"].indexOf(e.action)>-1){var n=void 0;!e.isUndo||"delete"!==e.action&&"insert"!==e.action?n=e.eventArgs:(n=t.extend({},e.eventArgs),"delete"===e.action?(n.index=n.startIndex,n.model=n.deletedModel,n.insertType="below"):(n.startIndex=n.index,n.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,n.deletedModel=n.model,delete n.insertType)),this.parent.notify(Yt,n)}},e.prototype.getModuleName=function(){return"dataBind"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},e}(),qt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.open=function(e){var r=this;if(this.parent.allowOpen)if(e.jsonObject)this.fetchSuccess(e.jsonObject,null,null,!0);else{var n=new FormData;if(e.file)n.append("file",e.file);else{if(!(e.sheetIndex>=0))return void(this.parent.isOpen=!1);n.append("sheetPassword",e.sheetPassword),n.append("sheetIndex",e.sheetIndex.toString())}var i={passWord:""};e.password&&e.password.length&&(i.passWord=e.password),i.passWord&&i.passWord.length&&(e.password=i.passWord),e.password&&n.append("password",e.password);var o={file:e.file||null,cancel:!1,requestData:{method:"POST",body:n},password:i.passWord},a=e.guid;t.isNullOrUndefined(e.sheetPassword)&&!a?(this.parent.trigger("beforeOpen",o),this.parent.notify(Zt,{eventArgs:o,action:"beforeOpen"})):a&&n.append("guid",a),o.cancel?this.parent.isOpen=!1:fetch(this.parent.openUrl,o.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(t){return r.fetchSuccess(t,o,e.orginalFile)}).catch(function(e){return r.fetchFailure(e)})}},e.prototype.fetchFailure=function(e){t.isUndefined(e.status)&&t.isUndefined(e.statusText)&&(e.statusText="Improper response"),this.parent.notify(vr,e),this.parent.isOpen=!1},e.prototype.fetchSuccess=function(e,t,r,n){var i=e,o=(i="string"==typeof e?JSON.parse(e):e).Workbook;if(["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded"].indexOf(o)>-1)return r&&(t.file=r),void this.parent.notify(mr,{context:this,data:o,guid:i.Guid,eventArgs:t,isOpenFromJson:n});this.updateModel(o,n),this.parent.notify(mr,{context:this,data:o,isOpenFromJson:n}),this.parent.isOpen=!1,t&&t.password&&t.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password="")},e.prototype.updateModel=function(e,t){this.parent.notify(pr,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,t),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify(Cr,{}),e.activeSheetIndex=e.activeSheetIndex||0,this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[]},!0),Ie(this.parent),this.parent.notify(yr,null),this.parent.notify(pr,{action:"registerSheet",isImport:!0}),this.parent.notify(pr,{action:"initiateDefinedNames"}),this.parent.notify(rn,null)},e.prototype.setSelectAllRange=function(e,r){var n,i,o=this;e.forEach(function(e){if(e.selectedRange){var a=c(e.selectedRange),s=(t.isUndefined(e.rowCount)?100:e.rowCount)-1,l=(t.isUndefined(e.colCount)?100:e.colCount)-1;65535===a[2]&&(a[2]=s),255===a[3]&&(a[3]=l),65535===a[0]&&(a[0]=s),255===a[1]&&(a[1]=l),e.selectedRange=m(a)}if(r&&o.parent.isAngular)for(var h=0;h<o.parent.sheets.length;h++)if(n=o.parent.sheets[h],e.name===n.name){e.ranges&&e.ranges.forEach(function(e,t){(i=n.ranges[t])&&i.template&&(e.template=i.template)});break}})},e.prototype.addEventListener=function(){this.parent.on(Kt,this.open.bind(this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Kt,this.open.bind(this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookOpen"},e}(),jt="workbookDestroyed",Wt="updateSheetFromDataSource",Gt="dataSourceChanged",Yt="dataChanged",Xt="triggerDataChange",Kt="workbookOpen",$t="beginSave",Zt="actionBegin",Qt="sortImport",Jt="ribbonFind",er="exportDialog",tr="getFilteredCollection",rr="saveCompleted",nr="applyNumber",ir="getFormattedCell",or="refreshCellElem",ar="setCellFormat",sr="findAllValues",lr="textDecorationUpdate",hr="applyCellFormat",dr="updateRowColCount",pr="workbookFormulaOperation",cr="workbookEditOperation",ur="checkDateFormat",fr="getFormattedBarText",gr="activeCellChanged",mr="openSuccess",vr="openFailure",yr="sheetCreated",Cr="sheetsDestroyed",xr="aggregateComputation",br="getUniqueRange",Sr="removeUniquecol",wr="checkUniqueRange",Ir="reApplyFormula",Er="clearFormulaDependentCells",Rr="formulaInValidation",Ar="initiateSort",kr="updateSortedDataOnCell",Fr="sortComplete",Tr="beforeHyperlinkCreate",Lr="afterHyperlinkCreate",Nr="beforeHyperlinkClick",Dr="afterHyperlinkClick",Or="setLinkModel",Mr="initiateFilter",Pr="filterRangeAlert",Hr="wrapText",Br="onSave",Ur="insert",_r="delete",Vr="insertModel",zr="deleteModel",qr="isValidation",jr="cellValidation",Wr="addHighlight",Gr="findNext",Yr="findPrevious",Xr="gotoHandler",Kr="replace",$r="replaceAll",Zr="ShowDialog",Qr="findKeyUp",Jr="removeHighlight",en="queryCellInfo",tn="count",rn="protectSheet",nn="updateToggleItem",on="protectsheetHandler",an="replaceAllDialog",sn="unprotectsheetHandler",ln="setLockCells",hn="setMerge",dn="applyMerge",pn="mergedRange",cn="activeCellMergedRange",un="insertMerge",fn="pasteMerge",gn="hideShow",mn="setCFRule",vn="applyCF",yn="clearCFRule",Cn="clear",xn="clearCF",bn="setImage",Sn="setChart",wn="initiateChart",In="refreshRibbonIcons",En="refreshChart",Rn="refreshChartSize",An="updateChart",kn="deleteChartColl",Fn="focusChartBorder",Tn="saveError",Ln="validationHighlight",Nn="updateFilter",Dn="beforeInsert",On="beforeDelete",Mn="deleteHyperlink",Pn="moveOrDuplicateSheet",Hn="setAutoFill",Bn="refreshCell",Un="getFillInfo",_n="getautofillDDB",Vn="rowFillHandler",zn="getTextSpace",qn="refreshClipboard",jn="updateView",Wn="selectionComplete",Gn="refreshInsertDelete",Yn="getUpdatedFormulaOnInsertDelete",Xn="beforeCellUpdate",Kn="duplicateSheetFilterHandler",$n="unMerge",Zn=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]},e.prototype.processSave=function(e,t,r,n){var i,o=new FormData,a=Object.keys(t);for(o.append("JSONData",JSON.stringify(e)),i=0;i<a.length;i++)o.append(a[i],t[a[i]]);for(a=Object.keys(r),i=0;i<a.length;i++)o.append(a[i],r[a[i]]);o.append("pdfLayoutSettings",JSON.stringify(n)),fetch(t.url,{method:"POST",body:o}).then(function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})}).then(function(e){new Promise(function(t){var r=new FileReader;r.onload=function(){var n=r.result.toString();if(n.indexOf("data:text/plain;base64,")>-1||n.indexOf("data:text/html;base64,")>-1||n.indexOf("data:application/json;base64,")>-1){var i=void 0;if(n=n.replace("data:text/plain;base64,",""),(n=n.replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(n=n.replace("data:application/json;base64,",""),i=atob(n).split(".")):i=atob(n).split(/(\r\n|\n|\r)/gm),i.length){var o=i[0].length>1&&'"'===i[0][0]?i[0].split('"')[1]+".":i[0];postMessage({dialog:o})}}else postMessage(e);t(r.result)},r.readAsDataURL(e)})}).catch(function(e){postMessage({error:e.message})})},e}(),Qn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jn=function(e){function r(t){var r=e.call(this,t)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.pdfLayoutSettings={fitSheetOnOnePage:!1},r.addEventListener(),r}return Qn(r,e),r.prototype.getModuleName=function(){return"workbookSave"},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on($t,this.initiateSave,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off($t,this.initiateSave)},r.prototype.initiateSave=function(e){var t=e.saveSettings;this.parent.notify(tr,null),this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.pdfLayoutSettings=e.pdfLayoutSettings,this.updateBasicSettings(),this.processSheets()},r.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat","beforeCellUpdate"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t},r.prototype.processSheets=function(){var e=["dataSource","startCell","query","showFieldAsHeader","result"];this.parent.isAngular&&e.push("template");for(var t=0,r=this.parent.sheets.length;t<r;t++)R(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[t],e,t),t])},r.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},r.prototype.getSheetLength=function(e){var t=0;return e.forEach(function(e){e&&t++}),t},r.prototype.save=function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify(Br,t),t.cancel||(this.isFullPost?this.initiateFullPostSave():R(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams,this.pdfLayoutSettings],!0)),this.saveJSON={}},r.prototype.updateSaveResult=function(e){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify(Tn,{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify(rr,t)},r.prototype.ClientFileDownload=function(e){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),r=URL.createObjectURL(e);t.href=r,document.body.appendChild(t),t.click(),URL.revokeObjectURL(r),document.body.removeChild(t)},r.prototype.initiateFullPostSave=function(){var e,r=Object.keys(this.saveSettings),n=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),i=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(i.value=JSON.stringify(this.saveJSON),n.appendChild(i),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.saveSettings[r[e]],n.appendChild(i);for(r=Object.keys(this.customParams),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.customParams[r[e]],n.appendChild(i);(i=this.parent.createElement("input",{attrs:{type:"hidden",name:"pdfLayoutSettings"}})).value=JSON.stringify(this.pdfLayoutSettings),n.appendChild(i),document.body.appendChild(n),n.submit(),t.detach(n),this.parent.notify(rr,{})},r.prototype.getStringifyObject=function(e,t,r){var n=this;return void 0===t&&(t=[]),0===r&&this.parent.notify(Sr,{clearAll:!0}),JSON.stringify(e,function(i,o){if(!(t.indexOf(i)>-1)){if(o&&o.cells)for(var a=0,s=o.cells.length;a<s;a++){var l=o.cells[a],h=[Number(i),a];l&&!l.value&&l.formula&&l.formula.indexOf("=UNIQUE(")<0&&(n.parent.notify(pr,{action:"refreshCalculate",value:l.formula,rowIndex:h[0],colIndex:a,isFormula:W(l.formula),sheetIndex:r,isRefreshing:!0}),l.value=ke(h[0],a,e).value)}return o&&"object"==typeof o&&o.hasOwnProperty("properties")?o.properties:null!==o?o:void 0}})},r.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},r.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},r}(Zn);!function(e){e[e.na=0]="na",e[e.value=1]="value",e[e.ref=2]="ref",e[e.divzero=3]="divzero",e[e.num=4]="num",e[e.name=5]="name",e[e.null=6]="null"}(e.CommonErrors||(e.CommonErrors={})),function(e){e[e.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",e[e.reservedWord_And=1]="reservedWord_And",e[e.reservedWord_Xor=2]="reservedWord_Xor",e[e.reservedWord_If=3]="reservedWord_If",e[e.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",e[e.reservedWord_Else=5]="reservedWord_Else",e[e.reservedWord_Not=6]="reservedWord_Not",e[e.invalid_char_in_number=7]="invalid_char_in_number",e[e.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",e[e.mismatched_parentheses=8]="mismatched_parentheses",e[e.unknown_formula_name=9]="unknown_formula_name",e[e.requires_a_single_argument=10]="requires_a_single_argument",e[e.requires_3_args=11]="requires_3_args",e[e.invalid_Math_argument=12]="invalid_Math_argument",e[e.requires_2_args=13]="requires_2_args",e[e.bad_index=14]="bad_index",e[e.too_complex=15]="too_complex",e[e.circular_reference=16]="circular_reference",e[e.missing_formula=17]="missing_formula",e[e.improper_formula=18]="improper_formula",e[e.invalid_expression=19]="invalid_expression",e[e.cell_empty=20]="cell_empty",e[e.bad_formula=21]="bad_formula",e[e.empty_expression=22]="empty_expression",e[e.virtual_mode_required=23]="virtual_mode_required",e[e.mismatched_tics=24]="mismatched_tics",e[e.wrong_number_arguments=25]="wrong_number_arguments",e[e.invalid_arguments=26]="invalid_arguments",e[e.iterations_do_not_converge=27]="iterations_do_not_converge",e[e.calculation_overflow=29]="calculation_overflow",e[e.already_registered=28]="already_registered",e[e.missing_sheet=30]="missing_sheet",e[e.cannot_parse=31]="cannot_parse",e[e.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator",e[e.spill=33]="spill",e[e.div=34]="div"}(e.FormulasErrorsStrings||(e.FormulasErrorsStrings={})),function(e){e.xlsx="xlsx",e.xlsm="xlsm",e.xlsb="xlsb",e.xltx="xltx",e.xltm="xltm",e.xls="xls",e.xml="xml",e.xlam="xlam",e.xla="xla",e.xlw="xlw",e.xlr="xlr",e.prn="prn",e.txt="txt",e.csv="csv",e.dif="dif",e.slk="slk"}(e.ExcelFileFormats||(e.ExcelFileFormats={}));var ei=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}(),ti=function(){function e(e){this.loadedModules=[],this.parent=e}return e.prototype.inject=function(e,t){var r=e.length;if(0!==r){this.loadedModules.length&&this.clearUnusedModule(e);for(var n=0;n<r;n++)for(var i=e[n],o=0,a=t;o<a.length;o++){var s=a[o],l=i.member;if(s.prototype.getModuleName()===i.member&&!this.isModuleLoaded(l)){var h=this.createInstance(s,i.args),d=this.getMemberName(l);i.isProperty?z(d,s,this.parent):z(d,h,this.parent);var p=i;p.member=d,this.loadedModules.push(p)}}}else this.clean()},e.prototype.createInstance=function(e,t){var r=t;return r.unshift(void 0),new(Function.prototype.bind.apply(e,r))},e.prototype.clean=function(){for(var e=0,t=this.loadedModules;e<t.length;e++){var r=t[e];r.isProperty||V(r.member,this.parent).destroy()}this.loadedModules=[]},e.prototype.clearUnusedModule=function(e){for(var t=this,r=e.map(function(e){return t.getMemberName(e.member)}),n=0,i=this.loadedModules.filter(function(e){return-1===r.indexOf(e.member)});n<i.length;n++){var o=i[n];o.isProperty||V(o.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(o),1),this.deleteObject(this.parent,o.member)}},e.prototype.getMemberName=function(e){return e[0].toLowerCase()+e.substring(1)+"Module"},e.prototype.deleteObject=function(e,t){delete e[t]},e.prototype.isModuleLoaded=function(e){for(var t=0,r=this.loadedModules;t<r.length;t++){if(r[t].member===this.getMemberName(e))return!0}return!1},e}(),ri=function(){function n(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"WEEKDAY",category:"Date",description:"Returns the day of the week corresponding to a date."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"T",category:"Text",description:"Checks whether a value is text or not and returns the text."},{formulaName:"EXACT",category:"Text",description:"Checks whether a two text strings are exactly same and returns TRUE or FALSE."},{formulaName:"LEN",category:"Text",description:"Returns a number of characters in a given string."},{formulaName:"MOD",category:"Math & Trig",description:"Returns a remainder after a number is divided by divisor."},{formulaName:"ODD",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest odd integer."},{formulaName:"PI",category:"Math & Trig",description:"Returns the value of pi."},{formulaName:"COUNTBLANK",category:"Statistical",description:"Returns the number of empty cells in a specified range of cells."},{formulaName:"EVEN",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest even integer."},{formulaName:"FACT",category:"Math & Trig",description:"Returns the factorial of a number."},{formulaName:"DECIMAL",category:"Math & Trig",description:"Converts a text representation of a number in a given base into a decimal number."},{formulaName:"DEGREES",category:"Math & Trig",description:"Converts radians to degrees."},{formulaName:"ADDRESS",category:"Lookup & Reference",description:"Returns a cell reference as text, given specified row and column numbers."},{formulaName:"TIME",category:"Date & Time",description:"Converts hours, minutes, seconds to the time formatted text."},{formulaName:"CHAR",category:"Text",description:"Returns the character from the specified number."},{formulaName:"CODE",category:"Text",description:"Returns the numeric code for the first character in a given string."},{formulaName:"DOLLAR",category:"Text",description:"Converts the number to currency formatted text."},{formulaName:"SMALL",category:"Statistical",description:"Returns the k-th smallest value in a given array."},{formulaName:"LARGE",category:"Statistical",description:"Returns the k-th largest value in a given array."},{formulaName:"MEDIAN",category:"Statistical",description:"Returns the median of the given set of numbers."},{formulaName:"EDATE",category:"Date & Time",description:"Returns a date with given number of months before or after the specified date."},{formulaName:"DATEVALUE",category:"Date & Time",description:"Converts a date string into date value."},{formulaName:"HOUR",category:"Date & Time",description:"Returns the number of hours in a specified time string."},{formulaName:"MINUTE",category:"Date & Time",description:"Returns the number of minutes in a specified time string."},{formulaName:"SECOND",category:"Date & Time",description:"Returns the number of seconds in a specified time string."},{formulaName:"NOW",category:"Date & Time",description:"Returns the current date and time."},{formulaName:"MONTH",category:"Date & Time",description:"Returns the number of months in a specified date string."},{formulaName:"PROPER",category:"Text",description:"Converts a text to proper case; first letter to uppercase and other letters to lowercase."}],this.isConcat=!1,this.parent=e,this.init()}return n.prototype.init=function(){for(var e,r=0;r<this.formulas.length;r++)e=t.getValue("Compute"+this.formulas[r].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[r].formulaName.toUpperCase(),e,this.formulas[r].category,this.formulas[r].description)},n.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},n.prototype.ComputeSUM=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,o,a=0,s=0;if(!t.isNullOrUndefined(r))for(var l=r,h=function(e){e.toString().indexOf(".")>-1&&(s=Math.max(s,e.split(".")[1].length))},d=0;d<l.length;d++){var p=l[d].toString();if(p.indexOf(":")>-1&&this.parent.isCellReference(p))for(var c=this.parent.getCellCollection(p.split(this.parent.tic).join("")),u=0;u<c.length;u++){if(i=this.parent.getValueFromArg(c[u]),this.parent.getErrorStrings().indexOf(i)>-1)return i;t.isNullOrUndefined(i[0])||isNaN(this.parent.parseFloat(i))||(h(i),a+=this.parent.parseFloat(i))}else{if(l[d].split(this.parent.tic).join("")===this.parent.trueValue&&(l[d]="1"),l[d].split(this.parent.tic).join("")===this.parent.falseValue&&(l[d]="0"),o=this.parent.getValueFromArg(l[d].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(o)>-1)return o;if(t.isNullOrUndefined(o)||isNaN(this.parent.parseFloat(o)))continue;o.length>0&&(h(o),a+=this.parent.parseFloat(o+""))}}return a.toString().indexOf(".")>-1?a.toFixed(s):a},n.prototype.ComputeINT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o,a;return(!t.isNullOrUndefined(r)&&1!==r.length||""===r[0])&&(i=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]),""!==r[0]&&1===r.length&&(a=(i=r[0]).indexOf('"'),i=(i=i.indexOf('"')>-1?i.replace('"',""):i).indexOf('"')>-1?i.replace('"',""):i,i="TRUE"===(i=this.parent.getValueFromArg(i)).toUpperCase()?"1":"FALSE"===i?"0":i,o=this.parent.parseFloat(i),o=Math.floor(o)),isNaN(o)&&(i=a>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]),o||i},n.prototype.ComputeTODAY=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n;if(t&&""!==t[0])n=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];else{var i=new Date(Date.now());"spreadsheet"===this.parent.parentObject.getModuleName()?(n=this.parent.parentObject.dateToInt(i),0===this.parent.parser.storedStringText.toUpperCase().indexOf("TODAY")&&this.parent.parentObject.setDateFormat(this.parent.getSheetId(this.parent.grid),this.parent.rowIndex(this.parent.cell)-1,this.parent.colIndex(this.parent.cell)-1)):n=i.getFullYear()+"/"+this.parent.calculateDate((i.getMonth()+1).toString())+"/"+this.parent.calculateDate(i.getDate().toString())}return n},n.prototype.ComputeWEEKDAY=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n;if(""===t[0])n=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];else{var i=this.parent.getValueFromArg(t[0]);n=Math.ceil(Number(i))%7||7}return n},n.prototype.ComputePROPER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n;if(t&&""===t[0]||1!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(t[0]).split(this.parent.tic).join("");if(i===this.parent.getErrorStrings()[e.CommonErrors.name])return this.parent.getErrorStrings()[e.CommonErrors.name];for(var o=i.toLowerCase().split(" "),a=0;a<o.length;a++)if(o[a][0])for(var s=0;s<o[a].length;s++)if(o[a].charCodeAt(s)>=97&&o[a].charCodeAt(s)<=122){o[a]=o[a].replace(o[a][s],o[a][s].toUpperCase());break}if((n=o.join(" ")).indexOf("-")>0){var l=n.split("-");for(a=0;a<l.length;a++)if(l[a][0])for(s=0;s<l[a].length;s++)if(l[a].charCodeAt(s)>=97&&l[a].charCodeAt(s)<=122){l[a]=l[a].replace(l[a][s],l[a][s].toUpperCase());break}n=l.join("-")}if(n.indexOf(",")>0){var h=n.split(",");for(a=0;a<h.length;a++)if(h[a][0])for(s=0;s<h[a].length;s++)if(h[a].charCodeAt(s)>=97&&h[a].charCodeAt(s)<=122){h[a]=h[a].replace(h[a][s],h[a][s].toUpperCase());break}n=h.join(",")}return n},n.prototype.ComputeSUMPRODUCT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n,i=0,o=0,a=null,s=t,l=0;l<s.length;++l){var h=s[l];if(h.startsWith(this.parent.tic)||!this.parent.isCellReference(h)){var d=this.parent.getValueFromArg(h);return n=d.indexOf('"'),this.parent.getErrorStrings().indexOf(d)>-1?d:n>-1?0:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]}var p=h.indexOf(":"),c=this.parent.rowIndex(h.substr(0,p)),u=this.parent.rowIndex(h.substr(p+1));if(!(-1!==c||-1===u)==(-1===c||-1!==u))return this.parent.getErrorStrings()[e.CommonErrors.name];var f=this.parent.colIndex(h.substr(0,p)),g=this.parent.colIndex(h.substr(p+1));if(null===a)for(o=(u-c+1)*(g-f+1),a=[],p=0;p<o;++p)a[p]=1;p=0;for(var m=c;m<=u;++m)for(var v=f;v<=g;++v){var y=this.getSheetReference(h)+this.parent.convertAlpha(v)+m,C=this.parent.getValueFromArg(y);if(isNaN(parseFloat(C)))a[p]=0;else{if(isNaN(a[p]))return this.parent.getErrorStrings()[e.CommonErrors.name];a[p]=a[p]*parseFloat(C)}p++}}for(p=0;p<o;++p)i+=a[p];return i},n.prototype.ComputeROUNDUP=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o,a,s,l,h=r.length;if(!t.isNullOrUndefined(r)&&h>2&&(i=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]),1===h&&""!==r[0])l=r[0].indexOf('"'),a="TRUE"===(a=(a=r[0].indexOf('"')>-1?r[0].replace('"',""):r[0]).indexOf('"')>-1?a.replace('"',""):a).toUpperCase()?"1":"FALSE"===a?"0":a,a=this.parent.getValueFromArg(a),(o=this.parent.parseFloat(a))>0?o+=.4999999999:o<0&&(o-=.4999999999),i=(o=this.parent.parseFloat(o.toFixed(0))).toString();else if(2===h&&""!==r[0]&&""!==r[1]){l=r[0].indexOf('"')>-1?r[0].indexOf('"'):r[1].indexOf('"')>-1?r[1].indexOf('"'):-1,a=(a=r[0].indexOf('"')>-1?r[0].replace('"',""):r[0]).indexOf('"')>-1?a.replace('"',""):a,s=(s=r[1].indexOf('"')>-1?r[1].replace('"',""):r[1]).indexOf('"')>-1?s.replace('"',""):s,a="TRUE"===a.toUpperCase()?"1":"FALSE"===a?"0":a,s="TRUE"===s.toUpperCase()?"1":"FALSE"===s?"0":s,a=this.parent.getValueFromArg(a),s=this.parent.getValueFromArg(s);var d=Math.ceil(this.parent.parseFloat(s));o=this.parent.parseFloat(a),d>0?(o>0?o+=.4999999999/Math.pow(10,d):o<0&&(o-=.4999999999/Math.pow(10,d)),i=(o=this.parent.parseFloat(o.toFixed(d))).toFixed(d),isNaN(o)&&(i=d.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name])):(o>0?o=o/Math.pow(10,-d)+.49999:o<0&&(o=o/Math.pow(10,-d)-.49999),i=(o=this.parent.parseFloat(o.toFixed(0))*Math.pow(10,-d)).toString(),isNaN(o)&&(i=d.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:i=this.parent.getErrorStrings()[e.CommonErrors.name]))}else i=l>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];return i},n.prototype.ComputeCOUNT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,o,a,s=r,l=0,h=0;h<s.length;h++)if((i=s[h]).indexOf(":")>-1&&this.parent.isCellReference(i)){o=this.parent.getCellCollection(i.split(this.parent.tic).join(""));for(var d=0;d<o.length;d++)a=this.parent.getValueFromArg(o[d]),isNaN(this.parent.parseFloat(a))||i.length>0&&""!==i&&" "!==i&&l++}else i=i.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(i)))||i.length>0&&""!==i&&" "!==i&&l++;return l},n.prototype.ComputeDATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(3!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var o=0;o<i.length;++o)i[o]=this.parent.getValueFromArg(i[o]);i[0]="TRUE"===i[0].split(this.parent.tic).join("")?"1":"FALSE"===i[0].split(this.parent.tic).join("")?"0":i[0],i[1]="TRUE"===i[1].split(this.parent.tic).join("")?"1":"FALSE"===i[1].split(this.parent.tic).join("")?"0":i[1],i[2]="TRUE"===i[2].split(this.parent.tic).join("")?"1":"FALSE"===i[2].split(this.parent.tic).join("")?"0":i[2];var a=this.parent.parseFloat(i[0].split(this.parent.tic).join("")),s=this.parent.parseFloat(i[1].split(this.parent.tic).join("")),l=this.parent.parseFloat(i[2].split(this.parent.tic).join("")),h=0;if(isNaN(a)||isNaN(s)||isNaN(l))return this.parent.getErrorStrings()[e.CommonErrors.value].toString();if(a<0)return this.parent.getErrorStrings()[e.CommonErrors.num].toString();for(;s>12;)s-=12,a++;if(0===(h=this.parent.getSerialDateFromDate(a,s,l)))return this.parent.getErrorStrings()[e.CommonErrors.num].toString();var d=this.parent.fromOADate(h);return"Invalid Date"!==d.toString()?this.parent.calculateDate((d.getMonth()+1).toString())+"/"+this.parent.calculateDate(d.getDate().toString())+"/"+d.getFullYear():h.toString()},n.prototype.ComputeFLOOR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,o,a=r,s=a.length,l=a[1].split(this.parent.tic).join(""),h=[];if(2!==s)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(h.push(i=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=l===this.parent.trueValue?"1":l===this.parent.falseValue?"0":a[1],h.push(o=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),i>0&&o<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if(i>0&&0===o)return this.parent.getErrorStrings()[e.CommonErrors.divzero];for(var d=0;d<a.length;d++)if(a[d].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.name]:Math.floor(i/o)*o},n.prototype.ComputeCEILING=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,o,a=r,s=[],l=a.length,h=a[1].split(this.parent.tic).join("");if(2!==l)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(s.push(i=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=h===this.parent.trueValue?"1":h===this.parent.falseValue?"0":a[1],s.push(o=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),i>0&&o<0)return this.parent.getErrorStrings()[e.CommonErrors.num];for(var d=0;d<a.length;d++)if(a[d].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.name]:0===o?0:Math.ceil(i/o)*o},n.prototype.ComputeDAY=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o=r;if(t.isNullOrUndefined(o)||1===o.length&&""===o[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(o.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a=this.parent.getValueFromArg(o[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(a))?(i=this.parent.parseDate(a),"[object Date]"===Object.prototype.toString.call(i)&&(i=i.getDate()),i):this.parent.getErrorStrings()[e.CommonErrors.name]},n.prototype.ComputeIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(this.parent.getErrorStrings().indexOf(r[0])>0)return r[0];var i,o=r;4===o.length&&"nestedFormulaTrue"===o[3]&&(i=!0,o.pop());var a,s;if(o.length>3||1===o.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(o.length<=3){if(a=this.parent.getValueFromArg(o[0]),this.parent.getErrorStrings().indexOf(a)>-1)return a;if(a===this.parent.trueValue||this.parent.parseFloat(a)>0||this.parent.parseFloat(a)<0)s=this.parent.getValueFromArg(o[1]);else{if(a!==this.parent.falseValue&&0!==this.parent.parseFloat(a))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.requires_3_args];if(t.isNullOrUndefined(o[2]))return this.parent.falseValue;s=this.parent.getValueFromArg(o[2])}}return!i&&s.indexOf(this.parent.tic)>-1?s.split(this.parent.tic).join(""):s},n.prototype.ComputeIFERROR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,o=r;return 2!==o.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:(i=this.parent.getValueFromArg(o[0]))===this.parent.trueValue||i===this.parent.falseValue?i:(i[0]===this.parent.arithMarker&&(i=i.replace(this.parent.arithMarker," ")),"#"===(i=this.parent.getValueFromArg(i).toUpperCase().split(this.parent.tic).join(""))[0]||i.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(i)>-1?this.parent.getValueFromArg(o[1]).split(this.parent.tic).join(""):i)},n.prototype.ComputePRODUCT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i,o,a,s=1,l=!0;if(!t.isNullOrUndefined(r))for(var h=r,d=0;d<h.length;d++){var p=h[d];if(p.indexOf(":")>-1&&this.parent.isCellReference(p))for(var c=this.parent.getCellCollection(p),u=0;u<c.length;u++){if(i=this.parent.getValueFromArg(c[u].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,a=this.parent.parseFloat(i),isNaN(a)||i.length>0&&(s*=a,l=!1)}else{if(o=this.parent.getValueFromArg(h[d].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(o)>-1)return o;if(o="TRUE"===o.split(this.parent.tic).join("")?"1":"FALSE"===o.split(this.parent.tic).join("")?"0":o,a=this.parent.parseFloat(o),isNaN(a)||o.length>0&&(s*=a,l=!1),this.parent.getErrorStrings().indexOf(o)>-1)return o}}return l?"0":s.toString()},n.prototype.ComputeDAYS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)&&1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o=r;o[0].split(this.parent.tic).join("")===this.parent.trueValue&&(o[0]="1"),o[0].split(this.parent.tic).join("")===this.parent.falseValue&&(o[0]="0");var a=this.parent.getValueFromArg(o[0].split(this.parent.tic).join("")),s=this.parent.getValueFromArg(o[1].split(this.parent.tic).join(""));if(s=""===s||null==s?new Date(Date.parse("1899-12-31")).toDateString():s,"#"===(a=""===a||null==a?new Date(Date.parse("1899-12-31")).toDateString():a)[0])return a;if("#"===s[0])return s;var l=this.parent.intToDate(a),h=this.parent.intToDate(s);return"#"===l.toString()[0]?l.toString():"#"===h.toString()[0]?h.toString():"[object Date]"!==Object.prototype.toString.call(l)||"[object Date]"!==Object.prototype.toString.call(h)?this.parent.getErrorStrings()[e.CommonErrors.value]:(i=Math.ceil(l.getTime()-h.getTime())/864e5,Math.round(i))},n.prototype.ComputeUNIQUE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o=r;if(t.isNullOrUndefined(r)||""===r[0]||o.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var a=o[1]?o[1].toUpperCase():"FALSE",s=o[2]?o[2].toUpperCase():"FALSE",l=[],h=this.parent.actCell;if(o[0].indexOf(":")>-1){if(t.isNullOrUndefined(o[0].match(/[0-9]/))){var d=o[0].split(":");o[0]=d[0]+"1:"+d[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if(t.isNullOrUndefined(o[0].toUpperCase().match(/[A-Z]/))){d=o[0].split(":");o[0]="A"+d[0]+":"+q(this.parent.spreadSheetUsedRange[1]+1)+d[1]}var p=o[0].split(":");if(this.parent.isCellReference(p[0])&&this.parent.isCellReference(p[1])){for(var c=this.parent.dependencyCollection,u=0;u<c.length;u++)c[u].split(":")[0]===o[0].split(":")[0]&&this.clearDependency(c[u]);-1===this.parent.dependencyCollection.indexOf(o[0])?this.parent.dependencyCollection.push(o[0]):this.clearDependency(o[0]);var f=o[0].indexOf(":"),g=void 0,m=this.parent.rowIndex(this.parent.substring(o[0],0,f)),v=this.parent.colIndex(this.parent.substring(o[0],0,f)),y=this.parent.rowIndex(this.parent.substring(o[0],f+1,f+o[0].length-f-1)),C=this.parent.colIndex(this.parent.substring(o[0],f+1,f+o[0].length-f-1));m>y&&(g=y,y=m,m=g),v>C&&(g=C,C=v,v=g);var x="";0===o[0].indexOf("!")&&(x=o[0].substring(0,o[0].replace("!","").indexOf("!")+2)),o[0]=x+q(v)+m+":"+q(C)+y;var b=this.parent.getCellCollection(o[0]),S=C-v,w=[];for(u=0;u<b.length;u++)w.push(b[u]);if("FALSE"===a)if(0===S)for(u=0;u<w.length;u++){k=""===(k=this.parent.getValueFromArg(w[u]))?"0":k,l.push(k)}else{var I="",E=S;for(u=0;u<w.length;u++){if(u===w.length-1){I=I+(k=""===(k=this.parent.getValueFromArg(w[u]))?"0":k)+"+",l.push(I.substring(0,I.length-1))}if(u<=E){I=I+(k=""===(k=this.parent.getValueFromArg(w[u]))?"0":k)+"+"}else{l.push(I.substring(0,I.length-1)),E=S+u;I=(k=""===(k=this.parent.getValueFromArg(w[u]))?"0":k)+"+"}}}else{I="",E=S+1;var R=y-m;for(u=0;u<E;u++){for(var A=0;A<=R;A++){var k;I=I+(k=""===(k=this.parent.getValueFromArg(w[A*E+u]))?"0":k)+"+"}l.push(I.substring(0,I.length-1)),I=""}}var F=[],T=[];for(u=0;u<l.length;u++)-1===F.indexOf(l[u])?F.push(l[u]):T.push(l[u]);if("TRUE"===s){var L=[];for(u=0;u<F.length;u++)-1===T.indexOf(F[u])&&L.push(F[u]);F=L}h=h.indexOf("!")>-1?h.split("!")[1]:h;var N=this.parent.rowIndex(h),D=this.parent.colIndex(h);if(0===this.parent.dependencyLevel){var O=!1;if("FALSE"===a)for(u=N,E=F.length+N;u<E;u++)for(var M=D,P=(V=F[0].split("+")).length+D;M<P;M++)u===E-1&&M===P-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+q(M)+u)&&this.parent.uniqueRange.push(this.parent.actCell+":"+q(M)+u),this.checkSpill(M,u)&&(O=!0);else for(u=D,E=F.length+D;u<E;u++){var H=N;for(P=(V=F[0].split("+")).length+N;H<P;H++)u===E-1&&H===P-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+q(u)+H)&&this.parent.uniqueRange.push(this.parent.actCell+":"+q(u)+H),this.checkSpill(u,H)&&(O=!0)}if(O)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.spill]}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(q(D)+N,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.spill];if("FALSE"===a){var B=this.parent.getSheetFamilyItem(this.parent.grid),U="",_=void 0;null!==B.sheetNameToParentObject&&B.sheetNameToParentObject.size>0&&(_=(U=B.parentObjectToToken.get(this.parent.grid))+h);for(u=0;u<F.length;u++){var V=F[u].split("+");u>0&&(N++,D=this.parent.colIndex(h));for(var z=0;z<V.length;z++)this.setValueRefresh(V[z],N,D,h),(u>0||z>0)&&this.parent.refresh(U+q(D)+N.toString(),_),V[z+1]&&D++}i=F[0].split("+")[0]}else{for(u=0;u<F.length;u++){V=F[u].split("+");for(var j=0;j<V.length;j++)this.setValueRefresh(V[j],N,D,h),V[j+1]?N++:(D++,N=this.parent.rowIndex(h))}i=F[0].split("+")[0]}}}else this.parent.isCellReference(o[0])&&(-1===this.parent.dependencyCollection.indexOf(o[0])?this.parent.dependencyCollection.push(o[0]):this.clearDependency(o[0]),i=this.parent.getValueFromArg(o[0]));return i},n.prototype.setValueRefresh=function(e,t,r,n){this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,e,t,r)},n.prototype.checkSpill=function(t,r){var n,i=!1,o=this.parent.getValueFromArg(q(t)+r,!0),a="!"+this.parent.getSheetID(this.parent.grid)+"!"+q(t)+r;return this.parent.getFormulaInfoTable().get(a)&&(n=this.parent.getFormulaInfoTable().get(a).formulaText),o&&(o.indexOf("UNIQUE")<0||n&&!n.toUpperCase().includes("UNIQUE"))&&o!==this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]&&(i=!0),i},n.prototype.clearDependency=function(e){var t=this.parent.actCell,r="";if(t.indexOf("!")>-1){var n=t.split("!");t=n[1],r=n[0]+"!"}for(var i=this.parent.rowIndex(t),o=this.parent.colIndex(t),a=e.indexOf(":"),s=this.parent.rowIndex(this.parent.substring(e,0,a)),l=this.parent.colIndex(this.parent.substring(e,0,a)),h=this.parent.rowIndex(this.parent.substring(e,a+1,a+e.length-a-1))-s+i,d=this.parent.colIndex(this.parent.substring(e,a+1,a+e.length-a-1))-l+o,p=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"",c=i;c<=h;c++)for(var u=o;u<=d;u++)if(this.parent.dependencyLevel>0||p.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+q(o)+i,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,"",c,u),this.parent.refresh("!"+this.parent.getSheetID(this.parent.grid)+"!"+q(u)+c,t),this.parent.actCell=r+t}},n.prototype.ComputeT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i="";if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var o=r[0];o=o.indexOf(":")>-1?o.split(":")[0]:o;return null===(o=this.parent.getValueFromArg(o)).match(/^[0-9.]+$/)&&"TRUE"!==o.toUpperCase()&&"FALSE"!==o.toUpperCase()&&(i=o),i},n.prototype.ComputeHOUR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];if(!this.parent.isCellReference(r[0])&&-1===r[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");i=this.parent.intToTime(i);var o=new Date(Date.parse(i));if(parseInt(i,10)<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if("Invalid Date"===o.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+i;o=new Date(Date.parse(a))}return"Invalid Date"===o.toString()&&(o=this.parent.fromOADate(parseInt(i,10))),"Invalid Date"===o.toString()?this.parent.getErrorStrings()[e.CommonErrors.value]:o.getHours()},n.prototype.ComputeMINUTE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];if(!this.parent.isCellReference(r[0])&&-1===r[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");i=this.parent.intToTime(i);var o=new Date(Date.parse(i));if(parseInt(i,10)<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if("Invalid Date"===o.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+i;o=new Date(Date.parse(a))}return"Invalid Date"===o.toString()&&(o=this.parent.fromOADate(parseInt(i,10))),"Invalid Date"===o.toString()?this.parent.getErrorStrings()[e.CommonErrors.value]:o.getMinutes()},n.prototype.ComputeSECOND=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(!this.parent.isCellReference(r[0])&&-1===r[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[e.CommonErrors.value];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");i=this.parent.intToTime(i);var o=new Date(Date.parse(i));if(parseInt(i,10)<0)return this.parent.getErrorStrings()[e.CommonErrors.num];if("Invalid Date"===o.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+i;o=new Date(Date.parse(a))}return"Invalid Date"===o.toString()&&(o=this.parent.fromOADate(parseInt(i,10))),"Invalid Date"===o.toString()?this.parent.getErrorStrings()[e.CommonErrors.value]:o.getSeconds()},n.prototype.ComputeMONTH=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];if(1!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(!this.parent.isCellReference(r[0])&&-1===r[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.spreadsheetFormat(r[0]),o=this.spreadsheetDisplayText(r[0]),a=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),s=this.parseDouble(a),l=0,h=new Date(Date.parse(a));!isNaN(s)&&h.getFullYear()>9999&&(h=this.parent.fromOADate(s));var d=parseInt(a,10);return d<0?this.parent.getErrorStrings()[e.CommonErrors.num]:(0===d&&a!==i&&i.indexOf("h:mm")>-1&&(h=this.parent.fromOADate(parseInt(o,10))),"Invalid Date"===h.toString()&&(h=this.parent.fromOADate(parseInt(a,10))),"Invalid Date"===h.toString()?this.parent.getErrorStrings()[e.CommonErrors.value]:("Invalid Date"!==h.toString()&&(l=h.getMonth()+1),l.toString()))},n.prototype.ComputeNOW=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||""!==r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=new Date(Date.now());return(new t.Internationalization).getDateFormat({format:"M/d/yyyy h:mm a"})(i)},n.prototype.ComputeEXACT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=!1;if(t.isNullOrUndefined(r)||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");return this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")===o&&(i=!0),i},n.prototype.ComputeLEN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");return"#NAME?"===i?this.parent.getErrorStrings()[e.CommonErrors.name]:i.length},n.prototype.ComputeMOD=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");if(""===o||"0"===o)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.div];if(""===i||"0"===i)return"0";if("#NAME?"===i||"#NAME?"===o)return this.parent.getErrorStrings()[e.CommonErrors.name];if(i.toUpperCase().match(/[A-Z]/)||o.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];var a=parseFloat(i.replace("-",""))%parseFloat(o);return parseFloat(o)<0&&(a*=-1),isNaN(a)?this.parent.getErrorStrings()[e.CommonErrors.name]:a},n.prototype.ComputeODD=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];if(t.isNullOrUndefined(r)||1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");if("#NAME?"===i)return this.parent.getErrorStrings()[e.CommonErrors.name];if(""===i)i="0";else if(i.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];var o=Math.ceil(parseInt(i,10)),a=0===o;return o=o%2==0?o>0?o+1:o-1:o,Math.ceil(parseInt(i,10))%2!=0&&(parseInt(i,10)>0&&parseFloat(i)>parseInt(i,10)?o+=2:parseInt(i,10)<0&&parseFloat(i)<parseInt(i,10)&&(o-=2)),isNaN(o)?this.parent.getErrorStrings()[e.CommonErrors.name]:a?1:o},n.prototype.ComputeEVEN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");if("#NAME?"===i)return this.parent.getErrorStrings()[e.CommonErrors.name];if(""===i)i="0";else if(i.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];var o=Math.ceil(parseFloat(i));return o=o%2==0?o:o>0?o+1:o-1,Math.ceil(parseFloat(i))%2==0&&(parseInt(i,10)>0&&parseFloat(i)>parseInt(i,10)?o+=2:parseInt(i,10)<0&&parseFloat(i)<parseInt(i,10)&&(o-=2)),isNaN(o)?this.parent.getErrorStrings()[e.CommonErrors.name]:o},n.prototype.ComputePI=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t&&""!==t[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]:Math.PI},n.prototype.ComputeMEDIAN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||""===r[0]||1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var o=this.parent.getCellCollection(r[0]),a=[],s=0;s<o.length;s++)a.push(parseInt(this.parent.getValueFromArg(o[s]).split(this.parent.tic).join(""),10));for(var l=(a=a.sort(function(e,t){return e-t})).length,h=0;h<l&&(!isNaN(a[h])||(a.splice(h,1),h--,0!==a.length));h++);if(a.length%2!=0&&a[parseInt((a.length/2).toString(),10)])i=a[parseInt((a.length/2).toString(),10)];else{if(isNaN(a[a.length/2])||isNaN(a[a.length/2-1]))return this.parent.getErrorStrings()[e.CommonErrors.num];i=(a[a.length/2]+a[a.length/2-1])/2}return i},n.prototype.ComputeEDATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o;if(2!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];var a=this.parent.getValueFromArg(r[0]);return o=this.parent.getValueFromArg(r[1]),o=parseInt(o,10),isNaN(o)?this.parent.getErrorStrings()[e.CommonErrors.num]:(i=isNaN(parseInt(a,10))?new Date(Date.parse(a)):this.parent.fromOADate(parseInt(a,10)),t.isNullOrUndefined(this.parent.isDate(i))?this.parent.getErrorStrings()[e.CommonErrors.value]:new Date(i.setMonth(i.getMonth()+o)).toLocaleDateString())},n.prototype.ComputeDATEVALUE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,o;return 1!==r.length||t.isNullOrUndefined(r)?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments]:""===r[0]||this.parent.isCellReference(r[0])?this.parent.getErrorStrings()[e.CommonErrors.value]:-1===r[0].indexOf(this.parent.tic)?this.parent.getErrorStrings()[e.CommonErrors.value]:(o=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),i=isNaN(parseInt(o,10))?new Date(Date.parse(o)):this.parent.fromOADate(parseInt(o,10)),t.isNullOrUndefined(this.parent.isDate(i))||5!==parseInt(o,10).toString().length?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.isDate(o)&&4!==this.parent.isDate(o).getFullYear().toString().length?this.parent.getErrorStrings()[e.CommonErrors.value]:parseFloat(o).toFixed(0).toString())},n.prototype.ComputeCOUNTBLANK=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=0;if(1!==r.length||t.isNullOrUndefined(r)||!this.parent.isCellReference(r[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];for(var o=this.parent.getCellCollection(r[0]),a=0;a<o.length;a++)""===this.parent.getValueFromArg(o[a])&&i++;return i},n.prototype.ComputeFACT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=1;if(t.isNullOrUndefined(r)||1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.value];var o=parseInt(this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),10);if(this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("").toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];if(o<0)return this.parent.getErrorStrings()[e.CommonErrors.num];for(var a=1;a<=o;a++)i*=a;return i},n.prototype.ComputeDECIMAL=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var o=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),a=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");return""===o&&""!==a?0:""!==o&&""===a?this.parent.getErrorStrings()[e.CommonErrors.value]:isNaN(parseInt(a,10))?this.parent.getErrorStrings()[e.CommonErrors.value]:(i=parseInt(o,parseInt(a,10)),isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.name]:i)},n.prototype.ComputeDEGREES=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var o=Math.PI,a=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");return a.toUpperCase().match(/[A-Z]/)?this.parent.getErrorStrings()[e.CommonErrors.value]:isNaN(parseInt(a,10))?this.parent.getErrorStrings()[e.CommonErrors.value]:(i=parseFloat(a)*(180/o),parseInt(i.toString(),10))},n.prototype.ComputeADDRESS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||r.length>5||""===r[0]||""===r[1]||r.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];r[2]=r[2]?r[2]:"1",r[3]=r[3]?r[3]:"TRUE";var o=this.parent.getValueFromArg(r[0]),a=this.parent.getValueFromArg(r[1]),s=this.parent.getValueFromArg(r[2]),l=this.parent.getValueFromArg(r[3]);if(s=s.split(this.parent.tic).join(""),l=l.split(this.parent.tic).join(""),o=o.split(this.parent.tic).join(""),a=a.split(this.parent.tic).join(""),parseInt(o,10)<=0||parseInt(a,10)<=0)return this.parent.getErrorStrings()[e.CommonErrors.value];if(o.toUpperCase().match(/[A-Z]/)||a.toUpperCase().match(/[A-Z]/)||s.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];"TRUE"===l||"1"===l?"1"===s?i="$"+q(parseInt(a,10))+"$"+parseInt(o,10):"2"===s?i=q(parseInt(a,10))+"$"+parseInt(o,10):"3"===s?i="$"+q(parseInt(a,10))+parseInt(o,10):"4"===s&&(i=q(parseInt(a,10))+parseInt(o,10)):"FALSE"!==l&&"0"!==l||("1"===s?i="R"+parseInt(o,10)+"C"+parseInt(a,10):"2"===s?i="R"+parseInt(o,10)+"C["+parseInt(a,10)+"]":"3"===s?i="R["+parseInt(o,10)+"]C"+parseInt(a,10):"4"===s&&(i="R["+parseInt(o,10)+"]C["+parseInt(a,10)+"]"));if(-1===["TRUE","FALSE","1","0"].indexOf(l))return this.parent.getErrorStrings()[e.CommonErrors.name];if(!t.isNullOrUndefined(r[4])&&""!==r[4]){var h=this.parent.getValueFromArg(r[4]).split(this.parent.tic).join("");if("#NAME?"===h)return this.parent.getErrorStrings()[e.CommonErrors.name];i=h+"!"+i}return i},n.prototype.ComputeTIME=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||3!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join(""),a=this.parent.getValueFromArg(r[2]).split(this.parent.tic).join("");if("#NAME?"===i||"#NAME?"===o||"#NAME?"===a)return this.parent.getErrorStrings()[e.CommonErrors.name];if(i=parseInt(i,10),o=parseInt(o,10),a=parseInt(a,10),isNaN(i)||isNaN(o)||isNaN(a))return this.parent.getErrorStrings()[e.CommonErrors.name];if(i.toString().toUpperCase().match(/[A-Z]/)||o.toString().toUpperCase().match(/[A-Z]/)||a.toString().toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[e.CommonErrors.value];if(i>32767||o>32767||a>32767)return this.parent.getErrorStrings()[e.CommonErrors.num];var s=new Date(1900,0,1,i,o,a),l=s.getHours(),h=s.getMinutes(),d="AM",p=l;return p>=12&&(p=l-12,d="PM"),0===p&&(p=12),h=h<10?"0"+h:h,(p=p<10?"0"+p:p)+":"+h+" "+d},n.prototype.ComputeCHAR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");if("#NAME?"===i)return this.parent.getErrorStrings()[e.CommonErrors.name];if(!i.toUpperCase().match(/^[0-9]+$/))return this.parent.getErrorStrings()[e.CommonErrors.value];var o=parseInt(i,10);return o>255||o<=0?this.parent.getErrorStrings()[e.CommonErrors.value]:String.fromCharCode(o)},n.prototype.ComputeCODE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");return"#NAME?"===i?this.parent.getErrorStrings()[e.CommonErrors.name]:""===i?this.parent.getErrorStrings()[e.CommonErrors.value]:i.charCodeAt(0)},n.prototype.ComputeDOLLAR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1===r.length&&r.push("2"),t.isNullOrUndefined(r)||2!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];var i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");if(i=""===i?"0":i,o=""===o?"0":o,"#NAME?"===i)return this.parent.getErrorStrings()[e.CommonErrors.name];if(!i.toUpperCase().match(/^[0-9.]+$/)||!o.toUpperCase().match(/^[0-9.]+$/))return this.parent.getErrorStrings()[e.CommonErrors.value];for(var a=new t.Internationalization,s=parseInt(o,10),l="",h=1;h<=s;h++)l+="0";return a.formatNumber(parseFloat(parseFloat(i).toFixed(parseInt(o,10))),{format:"$#,##."+l})},n.prototype.ComputeSMALL=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||""===r[0]||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=this.parent.getCellCollection(r[0]),o=[],a=0;a<i.length;a++)o.push(parseFloat(this.parent.getValueFromArg(i[a]).split(this.parent.tic).join("")));for(var s=(o=o.sort(function(e,t){return e-t})).length,l=0;l<s&&(!isNaN(o[l])||(o.splice(l,1),l--,0!==o.length));l++);var h=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");return"#NAME?"===h?this.parent.getErrorStrings()[e.CommonErrors.name]:(h=parseInt(h,10)).toString().toUpperCase().match(/^[0-9]+$/)&&o[h-1]&&o[h-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==h?o[h-1]:t.isNullOrUndefined(o[h-1])?this.parent.getErrorStrings()[e.CommonErrors.num]:this.parent.getErrorStrings()[e.CommonErrors.value]},n.prototype.ComputeLARGE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||2!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=this.parent.getCellCollection(r[0]),o=[],a=0;a<i.length;a++)o.push(parseFloat(this.parent.getValueFromArg(i[a]).split(this.parent.tic).join("")));o=o.sort(function(e,t){return t-e});for(var s=0;s<o.length&&(!isNaN(o[s])||(o.splice(s,1),s--,0!==o.length));s++);var l=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");return"#NAME?"===l?this.parent.getErrorStrings()[e.CommonErrors.name]:(l=parseInt(l,10)).toString().toUpperCase().match(/^[0-9]+$/)&&o[l-1]&&o[l-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==l?o[l-1]:t.isNullOrUndefined(o[l-1])?this.parent.getErrorStrings()[e.CommonErrors.num]:this.parent.getErrorStrings()[e.CommonErrors.value]},n.prototype.ComputeCHOOSE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];if(r.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){if(1!==(l=this.parent.getCellCollection(i[0])).length)return this.parent.getErrorStrings()[e.CommonErrors.value];i[0]=l[0]}var o=this.parent.getValueFromArg(i[0]);if(this.parent.getErrorStrings().indexOf(o)>-1)return o;var a=this.parent.parseFloat(this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")));if(a<1)return this.parent.getErrorStrings()[e.CommonErrors.value];a=Math.floor(a);var s;if(t.isNullOrUndefined(i[a]))return this.parent.getErrorStrings()[e.CommonErrors.value];if(""===(s=i[a])&&(s="0"),s.indexOf(":")>-1&&this.parent.isCellReference(s)){var l;if(1!==(l=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""))).length)return this.parent.getErrorStrings()[e.CommonErrors.value];i[0]=l[0]}return this.parent.getValueFromArg(s).split(this.parent.tic).join("")},n.prototype.ComputeSUMIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0])||n[2]&&n[2].indexOf(":")<0&&!this.parent.isCellReference(n[2]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(n.length>3||n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]},n.prototype.ComputeABS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t,o="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(""===i[0].toString().split(this.parent.tic).join("").trim()||i[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];if(this.parent.isCellReference(i[0])){if(""===(o=this.parent.getValueFromArg(i[0])))return this.parent.getErrorStrings()[e.CommonErrors.name];if(n=this.parent.parseFloat(o),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}else if(n=this.parent.parseFloat(i[0]),isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.name];return Math.abs(n)},n.prototype.ComputeAVERAGE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=r,o=0;o<i.length;o++)if(i[o].indexOf(":")>-1&&i[o].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.value];return this.parent.calculateAvg(i)},n.prototype.ComputeAVERAGEIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];var i=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])},n.prototype.ComputeCONCATENATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_arguments];for(var i=r,o="",a="",s=0;s<i.length;s++){if(i[s].indexOf(":")>-1&&this.parent.isCellReference(i[s])){if(!this.isConcat)return this.parent.getErrorStrings()[e.CommonErrors.value];for(var l=this.parent.getCellCollection(i[s]),h=0;h<l.length;h++)o+=a=this.parent.getValueFromArg(l[h])}else{if(1===i.length&&i[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[e.CommonErrors.name];o+=a=this.parent.getValueFromArg(i[s])}if(this.parent.getErrorStrings().indexOf(a)>-1)return a}return o.split(this.parent.tic).join("")},n.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},n.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},n.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},n.prototype.ComputeRAND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===t.length&&""===t[0]&&(t.length=0),t.length>0?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:Math.random().toString()},n.prototype.ComputeAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"and")},n.prototype.ComputeOR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"or")},n.prototype.ComputeFIND=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=r;if(i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o=this.parent.removeTics(this.parent.getValueFromArg(i[0])),a=this.parent.removeTics(this.parent.getValueFromArg(i[1]));if(this.parent.getErrorStrings().indexOf(o)>-1||this.parent.getErrorStrings().indexOf(a)>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];var s=1;if(3===i.length){if(s=this.parent.removeTics(this.parent.getValueFromArg(i[2])),this.parent.getErrorStrings().indexOf(s)>-1)return s;s=this.parent.parseFloat(s),isNaN(s)&&(s=1)}if(s<=0||s>a.length)return this.parent.getErrorStrings()[e.CommonErrors.value];var l=a.indexOf(o,s-1);return l<0?this.parent.getErrorStrings()[e.CommonErrors.value]:(Number(l)+Number(1)).toString()},n.prototype.ComputeINDEX=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r,o=i.length;if(t.isNullOrUndefined(r)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(o>3)return this.parent.getErrorStrings()[e.CommonErrors.ref];var a="",s=[];if(o>2)for(var l=0;l<o;l++){if(this.parent.isCellReference(i[l])&&i[l].indexOf(":")<0){var h=this.parent.getValueFromArg(i[l]);if(this.parent.getErrorStrings().indexOf(h)>-1)return this.parent.getErrorStrings()[e.CommonErrors.ref];s[l]=h}this.parent.isCellReference(i[l])&&(s[l]=i[l])}if(a=i[0],i[1]=""===i[1]?"1":i[1],i[1]=this.parent.getValueFromArg(i[1]),this.parent.getErrorStrings().indexOf(i[1])>-1)return i[1];if(!t.isNullOrUndefined(i[2])){if(i[2]=""===i[2]?"1":i[2],i[2]=this.parent.getValueFromArg(i[2]),this.parent.getErrorStrings().indexOf(i[2])>-1)return i[2];if("0"===i[2])return this.parent.getErrorStrings()[e.CommonErrors.value]}var d=parseFloat(i[1]);d=isNaN(d)?-1:d;var p=parseFloat(i[2]?i[2]:"1");if(p=isNaN(p)?-1:p,-1===d||-1===p)return this.parent.getErrorStrings()[e.CommonErrors.value];var c=i[0].indexOf(":"),u=this.parent.rowIndex(a.substring(0,c)),f=this.parent.rowIndex(a.substring(c+1)),g=this.parent.colIndex(a.substring(0,c)),m=this.parent.colIndex(a.substring(c+1));if(d>f-u+1||p>m-g+1)return this.parent.getErrorStrings()[e.CommonErrors.ref];d=u+d-1,p=g+p-1;var v=this.getSheetReference(a)+this.parent.convertAlpha(p)+d,y=this.parent.getValueFromArg(v);return""===y?0:y},n.prototype.getSheetReference=function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""},n.prototype.ComputeIFS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var o="",a="",s=0;s<i.length;s++){if((o=this.parent.getValueFromArg(i[s]))!==this.parent.trueValue&&o!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.value];if(o===this.parent.trueValue)return i[s+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(a=this.parent.isCellReference(i[s+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(i[s+1]):i[s+1].indexOf(this.parent.tic)>-1?i[s+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[e.CommonErrors.name],s+=1,a);o===this.parent.falseValue&&(s+=1)}return this.parent.getErrorStrings()[e.CommonErrors.na]},n.prototype.ComputeCOUNTA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,o=r,a=0,s=0;s<o.length;s++)if(o[s].indexOf(":")>-1&&this.parent.isCellReference(o[s])){i=this.parent.getCellCollection(o[s].split(this.parent.tic).join(""));for(var l=0;l<i.length;l++)this.parent.getValueFromArg(i[l]).length>0&&a++}else{this.parent.getValueFromArg(o[s].split(this.parent.tic).join("")).length>0&&a++}return a},n.prototype.ComputeAVERAGEA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var i,o,a,s=r,l=0,h=0,d=0;d<s.length;d++){if(s[d].indexOf(":")>-1&&this.parent.isCellReference(s[d])){i=this.parent.getCellCollection(s[d].split(this.parent.tic).join(""));for(var p=0;p<i.length;p++)if((o=this.parent.getValueFromArg(i[p])).toUpperCase()===this.parent.trueValue)o="1";else if(o.toUpperCase()===this.parent.falseValue||""===o)o="0";else{if(this.parent.getErrorStrings().indexOf(o)>-1)return o;o.length>0&&(a=parseFloat(o),l+=o=isNaN(a)?0:a,h+=1)}h=i.length}else{if(s[d]===this.parent.trueValue&&(s[d]="1"),s[d]!==this.parent.falseValue&&""!==s[d]||(s[d]="0"),o=this.parent.getValueFromArg(s[d].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(o)>-1)return o;o.length>0&&(a=parseFloat(o),l+=o=isNaN(a)?0:a,h+=1)}if(0===h)return this.parent.getErrorStrings()[e.CommonErrors.divzero]}return l/h},n.prototype.ComputeSORT=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o,a=n;if(t.isNullOrUndefined(n)||""===n[0]||a.length>4)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];a[1]=a[1]?a[1]:"1",a[2]=a[2]?a[2]:"1";var s="1"===a[2]?"Ascending":"Descending";a[3]=a[3]?a[3].toUpperCase():"FALSE",a[0]=a[0].split("$").join("");var l,h=[];if(a[0].indexOf(":")>-1){var d=a[0].split(":");if(this.parent.isCellReference(d[0])&&this.parent.isCellReference(d[1])){var p=a[0].indexOf(":"),c=void 0,u=this.parent.rowIndex(this.parent.substring(a[0],0,p)),f=this.parent.colIndex(this.parent.substring(a[0],0,p)),g=this.parent.rowIndex(this.parent.substring(a[0],p+1,p+a[0].length-p-1)),m=this.parent.colIndex(this.parent.substring(a[0],p+1,p+a[0].length-p-1));if(u>g&&(c=g,g=u,u=c),f>m&&(c=m,m=f,f=c),a[2]=this.parent.getValueFromArg(a[2]),"1"!==a[2]&&"-1"!==a[2])return this.parent.getErrorStrings()[e.CommonErrors.value];if(!isNaN(this.parseDouble(a[1]))&&this.parseDouble(a[1])<1)return this.parent.getErrorStrings()[e.CommonErrors.value];if(a[3].toUpperCase()!==this.parent.trueValue&&a[3].toUpperCase()!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.value];var v="";0===a[0].indexOf("!")&&(v=(v=(v=a[0]).replace("!","")).indexOf("!"),v=a[0].substring(0,v+2)),a[0]=v+q(f)+u+":"+q(m)+g,l=this.parent.getCellCollection(a[0]);for(var y=0;y<l.length;y++)h.push(this.parent.getValueFromArg(l[y]));var C=[],x=m-f+1;if("TRUE"===a[3])for(y=0;y<x;y++)h[y+(this.parseDouble(a[1])-1)*x]&&C.push(isNaN(this.parseDouble(h[y+(this.parseDouble(a[1])-1)*x]))?h[y+(this.parseDouble(a[1])-1)*x]:this.parseDouble(h[y+(this.parseDouble(a[1])-1)*x]));if("FALSE"===a[3])for(y=0;y<h.length;y++)h[y*x+this.parseDouble(a[1])-1]&&C.push(isNaN(this.parseDouble(h[y*x+this.parseDouble(a[1])-1]))?h[y*x+this.parseDouble(a[1])-1]:this.parseDouble(h[y*x+this.parseDouble(a[1])-1]));for(var b=r.DataUtil.sort(C,null,r.DataUtil.fnSort(s)),S=[],w=0;w<b.length;w++)for(var I=0;I<C.length;I++)JSON.stringify(b[w])===JSON.stringify(C[I])&&-1===S.indexOf(I)&&S.push(I);if("TRUE"===a[3]){for(var E=u,R=0;E<=g;E++,R++){w=0;for(var A=0;w<S.length;w++,A++){var k=this.parent.getValueFromArg(v+q(S[w]+f)+E);N=(N=this.parent.actCell).indexOf("!")>-1?N.split("!")[1]:N;var F=this.parent.rowIndex(N),T=this.parent.colIndex(N);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,k,F+R,T+A)}}o=this.parent.getValueFromArg(v+q(S[0]+f)+u)}if("FALSE"===a[3]){for(w=0,R=0;w<S.length;w++,R++){var L=f;for(A=0;L<=m;L++,A++){var N,D=this.parent.getValueFromArg(v+q(L)+(S[w]+u));N=(N=this.parent.actCell).indexOf("!")>-1?N.split("!")[1]:N;T=this.parent.colIndex(N),F=this.parent.rowIndex(N);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,D,F+R,T+A)}}o=this.parent.getValueFromArg(v+q(f)+(S[0]+u))}}}return o},n.prototype.ComputeCOUNTIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||""===r[0]||2!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o,a,s=0,l=[],h="equal",d=i[1].split(this.parent.tic).join("");if(d.startsWith("<=")?(h="lessEq",d=d.substring(2)):d.startsWith(">=")?(h="greaterEq",d=d.substring(2)):d.startsWith("<>")?(h="notEq",d=d.substring(2)):d.startsWith("<")?(h="less",d=d.substring(1)):d.startsWith(">")?(h="greater",d=d.substring(1)):d.startsWith("=")&&(h="equal",d=d.substring(1)),i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){o=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""));for(var p=0;p<o.length;p++)a=this.parent.getValueFromArg(o[p]),(d.indexOf("*")>-1||d.indexOf("?")>-1)&&(a=this.parent.findWildCardValue(d,a)),l.push(a),l.push(d),this.parent.processLogical(l,h)===this.parent.trueValue&&s++}return s},n.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue)},n.prototype.ComputeTEXT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];for(var i,o=r.length,a=0;a<o;a++)i=t.isNullOrUndefined(i)?r[a]:i+","+r[a];var s=i.indexOf(","),l=i.slice(0,s),h=i.slice(i.indexOf('"')+1,i.length),d=h.indexOf('"');if(s>-1&&d!==h.length-1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var p=l,c=h.slice(0,h.length-1),u=new Date(1900,0,1,0,0,0),f=p+","+c,g=new t.Internationalization;if(this.parent.getErrorStrings().indexOf(f)>-1)return f;if(p=this.parent.getValueFromArg(p),""===(c=c.split(this.parent.tic).join("")))return"";""===p&&(c.length>0&&(c.toUpperCase().indexOf("M")>-1||c.toUpperCase().indexOf("D")>-1||c.toUpperCase().indexOf("Y")>-1||c.toUpperCase().indexOf("S")>-1||c.toUpperCase().indexOf("T")>-1)||c.toUpperCase().indexOf("H")>-1)&&(p=u.toString());var m=this.parseDouble(p);if(isNaN(m)&&null!==this.parent.isDate(new Date(p))&&(m=this.parent.toOADate(new Date(p))),u=Date.parse(p.split(this.parent.tic).join("")),!isNaN(m)||!isNaN(u)){if("["===c[0])return this.parent.tic+p+this.parent.tic;if(c.length>0&&(c.toUpperCase().indexOf("M")>-1||c.toUpperCase().indexOf("D")>-1||c.toUpperCase().indexOf("Y")>-1||c.toUpperCase().indexOf("S")>-1||c.toUpperCase().indexOf("T")>-1)||c.toUpperCase().indexOf("H")>-1){var v=(c=(c=c.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),y=!1,C=!1,x=(a=0,0),b=0;for(a=0;a<v.length;){var S=v[a];"s"===S&&"M"===v[x]&&(v[x]="m","M"===v[x-1]&&(v[x-1]="m")),this.parent.isChar(S)?(x=a,"M"===S&&b++):b>1&&b++,"M"===S&&y&&(v[a]="m",C=!0),"h"===S?y=!0:this.parent.isChar(S)&&"M"!==S&&"h"!==S&&!C&&(y=!1,C=!1),a++}c=(c=String(v)).split(",").join("").split("\n").join(" ");var w=this.parent.fromOADate(m);0===m&&(w=u);var I=B(c);if(""===I)return this.parent.getErrorStrings()[e.CommonErrors.name];p=g.getDateFormat({skeleton:I,type:"date"})(new Date(w.toString()))}else p=g.formatNumber(m,{format:c})}return p},n.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},n.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue)},n.prototype.ComputeMATCH=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(i)||1===i.length&&""===i[0]||i.length<2||i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o,a=[],s=i[0].split(this.parent.tic).join("");if(this.parent.isCellReference(s)&&(s=this.parent.getValueFromArg(s)),!s.toString().length)return this.parent.getErrorStrings()[e.CommonErrors.na];i[2]=t.isNullOrUndefined(i[2])?"1":i[2].split(this.parent.tic).join(""),i[2].split(this.parent.tic).join("")===this.parent.trueValue&&(i[2]="1"),i[2].split(this.parent.tic).join("")===this.parent.falseValue&&(i[2]="0");var l=parseFloat(i[2]);if(-1!==l&&0!==l&&1!==l)return this.parent.getErrorStrings()[e.CommonErrors.na];var h=0,d="";if(i[1].indexOf(":")>-1||this.parent.isCellReference(i[1])){o=this.parent.getCellCollection(i[1].split(this.parent.tic).join(""));for(var p=0;p<o.length;p++)a[p]=this.parent.getValueFromArg(o[p]).split(this.parent.tic).join("");for(var c=0;c<a.length;c++)if(a[c].toString().length)if(1===l){if(s===a[c])return c+1;s>a[c]&&(d?a[c]>d&&(h=c+1,d=a[c]):(h=c+1,d=a[c]))}else if(0===l){if((s.indexOf("*")>-1||s.indexOf("?")>-1)&&(a[c]=this.parent.findWildCardValue(s,a[c])),s===a[c])return c+1;if(this.parent.parseFloat(s)===this.parent.parseFloat(a[c]))return c+1}else if(-1===l){if(s===a[c])return c+1;s<a[c]&&(d?a[c]<d&&(h=c+1,d=a[c]):(h=c+1,d=a[c]))}}return h||this.parent.getErrorStrings()[e.CommonErrors.na]},n.prototype.ComputeSUBTOTAL=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t,i="";if(n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o=this.parent.parseFloat(this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""))),a=n.slice(1,n.length);switch(o){case 1:case 101:i=this.ComputeAVERAGE.apply(this,a);break;case 2:case 102:i=this.ComputeCOUNT.apply(this,a);break;case 3:case 103:i=this.ComputeCOUNTA.apply(this,a);break;case 4:case 104:i=this.ComputeMAX.apply(this,a);break;case 5:case 105:i=this.ComputeMIN.apply(this,a);break;case 6:case 106:i=this.ComputePRODUCT.apply(this,a);break;case 7:case 107:i=this.ComputeDAY.apply(this,a);break;case 8:case 108:i=this.ComputeCONCAT.apply(this,a);break;case 9:case 109:i=this.ComputeSUM.apply(this,a);break;case 10:case 110:i=this.ComputeAVERAGEA.apply(this,a);break;case 11:case 111:i=this.ComputeABS.apply(this,a);break;default:i=this.parent.getErrorStrings()[e.CommonErrors.value]}return i},n.prototype.ComputeRADIANS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(""===n[0]||n.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(n[0].indexOf(":")>-1||""===n[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[e.CommonErrors.value];var i=n[0].split(this.parent.tic).join("");n[0]=isNaN(this.parent.parseFloat(i))?n[0]:i;var o=this.parent.getValueFromArg(n[0]),a=this.parent.parseFloat(o);return isNaN(a)?o.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:Math.PI*a/180},n.prototype.ComputeRANDBETWEEN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o,a=t.length;if(2!==a)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=0;s<a;s++){if(""===t[s])return this.parent.getErrorStrings()[e.CommonErrors.na];if(t[s].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(t[s].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.value];t[s]=t[s].split(this.parent.tic).join("")}if(o=parseFloat(this.parent.getValueFromArg(t[s])),this.parent.isCellReference(t[s])){if(o=""===this.parent.getValueFromArg(t[s])?0:o,0===s?n=o:i=o,0===n&&0===i)return"0";if(isNaN(o))return this.parent.getErrorStrings()[e.CommonErrors.value]}else{if(isNaN(o))return this.parent.getErrorStrings()[e.CommonErrors.name];0===s?n=o:i=o}}return i<n?this.parent.getErrorStrings()[e.CommonErrors.num]:0===n?Math.floor(Math.random()*(i-(n-1)))+n:i-n==1?Math.round(Math.random()*(i-n)+n):Math.floor(Math.random()*(i-(n-1)))+n},n.prototype.ComputeSLOPE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(2!==n.length||""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.getCellCollection(n[1].split(this.parent.tic).join("")),o=this.parent.getCellCollection(n[0].split(this.parent.tic).join(""));if(o.length!==i.length)return this.parent.getErrorStrings()[e.CommonErrors.na];var a=this.getDataCollection(o),s=this.getDataCollection(i);if(s.indexOf("#NAME?")>-1||a.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];for(var l=0,h=0,d=0,p=0,c=0,u=s.length;c<u;++c)"NaN"!==Number(s[c]).toString()&&"NaN"!==Number(a[c]).toString()&&(l+=Number(s[c])*Number(a[c]),d+=Number(s[c]),p+=Number(a[c]),h+=Number(s[c])*Number(s[c]));var f=((l-d*p/s.length)/(h-d*d/s.length)).toString();return"NaN"===f?this.parent.getErrorStrings()[e.CommonErrors.divzero]:f},n.prototype.ComputeINTERCEPT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(""===n[0]||2!==n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.getCellCollection(n[0].split(this.parent.tic).join("")),o=this.parent.getCellCollection(n[1].split(this.parent.tic).join(""));if(i.length!==o.length)return this.parent.getErrorStrings()[e.CommonErrors.na];var a=this.getDataCollection(o),s=this.getDataCollection(i);if(a.indexOf("#NAME?")>-1||s.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[e.CommonErrors.name];for(var l=0,h=0,d=0,p=a.length;d<p;++d)l+=Number(a[d]),h+=Number(s[d]);l/=a.length,h/=a.length;var c,u=0,f=0;for(d=0,p=a.length;d<p;++d)u+=(c=Number(a[d])-l)*(Number(s[d])-h),f+=c*c;var g=(h-u/f*l).toString();return"NaN"===g?this.parent.getErrorStrings()[e.CommonErrors.divzero]:g},n.prototype.ComputeLN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o=t,a="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(this.parent.isCellReference(o[0])){if(a=this.parent.getValueFromArg(o[0]),(n=this.parent.parseFloat(a))<=0||""===a)return this.parent.getErrorStrings()[e.CommonErrors.num];if(isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}else{if(i=this.parent.getValueFromArg(o[0].split(this.parent.tic).join("")),(n=this.parent.parseFloat(i))<=0||""===n.toString())return this.parent.getErrorStrings()[e.CommonErrors.num];if(isNaN(n))return this.parent.getErrorStrings()[e.CommonErrors.value]}return Math.log(n)},n.prototype.ComputeISNUMBER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.isCellReference(n[0])?this.parent.getValueFromArg(n[0]):this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""));if(""===i.toString())return!1;var o=this.parent.parseFloat(i);return!isNaN(o)},n.prototype.ComputeROUND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o,a,s,l=t,h=0,d=0;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments]:1===t.length?(n="TRUE"===l[0].split(this.parent.tic).join("")?"1":"FALSE"===l[0].split(this.parent.tic).join("")?"0":l[0],Math.round(this.parent.parseFloat(n)).toString()):(o=this.parent.getValueFromArg(l[0]),a=""===l[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(l[1].split(this.parent.tic).join("")),o="TRUE"===o.split(this.parent.tic).join("")?"1":"FALSE"===o.split(this.parent.tic).join("")?"0":o,a="TRUE"===a.split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,""!==o&&""!==a&&(h=this.parent.parseFloat(o),d=this.parent.parseFloat(a),!isNaN(d)&&!isNaN(h)&&d>0?i=h.toFixed(d):(s=Math.pow(10,-d),i=Math.round(h/s)*s)),i.toString())},n.prototype.ComputePOWER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o=t;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];n=this.parent.getValueFromArg(o[0]),i=this.parent.getValueFromArg(o[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i;var a=this.parent.parseFloat(n),s=this.parent.parseFloat(i);return isNaN(a)||isNaN(s)?this.parent.getErrorStrings()[e.CommonErrors.value]:0===a&&s<0?this.parent.getErrorStrings()[e.CommonErrors.divzero]:0===a&&0===s?this.parent.getErrorStrings()[e.CommonErrors.num]:Math.pow(a,s).toString()},n.prototype.ComputeLOG=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o=t;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];if(n=this.parent.getValueFromArg(o[0]),i=2===t.length?this.parent.getValueFromArg(o[1]):"10",""===n||null===n||""===i||null===i)return this.parent.getErrorStrings()[e.CommonErrors.num];n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i;var a=this.parent.parseFloat(n),s=this.parent.parseFloat(i);return a<=0||s<=0?this.parent.getErrorStrings()[e.CommonErrors.num]:1===s?this.parent.getErrorStrings()[e.CommonErrors.divzero]:isNaN(a)||isNaN(s)?this.parent.getErrorStrings()[e.CommonErrors.value]:(Math.log(a)/Math.LN10/(Math.log(s)/Math.LN10)).toString()},n.prototype.ComputeTRUNC=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t,o=0;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];2===t.length&&(o="TRUE"===(o=this.parent.getValueFromArg(i[1])).split(this.parent.tic).join("")?"1":"FALSE"===o.split(this.parent.tic).join("")?"0":o,o=this.parent.parseFloat(o)),n="TRUE"===(n=this.parent.getValueFromArg(i[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;var a=this.parent.parseFloat(n.split(this.parent.tic).join(""));if(isNaN(a)||isNaN(o))return i[0]===this.parent.tic||this.parent.isCellReference(i[0])||i[1]===this.parent.tic||this.parent.isCellReference(i[1])?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name];var s=Math.pow(10,o);return((a<0?-1:1)*Math.floor(s*Math.abs(a))/s).toString()},n.prototype.ComputeEXP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t;if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];""===(n="TRUE"===(n=this.parent.getValueFromArg(i[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n)&&(n="0");var o=this.parent.parseFloat(n);return o>709?this.parent.getErrorStrings()[e.CommonErrors.num]:isNaN(o)?i[0]===this.parent.tic||this.parent.isCellReference(i[0])?this.parent.getErrorStrings()[e.CommonErrors.value]:this.parent.getErrorStrings()[e.CommonErrors.name]:Math.exp(o).toString()},n.prototype.ComputeGEOMEAN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,o,a,s=t,l=1,h=0,d=0;if(0===t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(i=0;i<s.length;i++)if(s[i].indexOf(":")>-1){if(s[0]===this.parent.tic)return this.parent.getErrorStrings()[e.CommonErrors.value];for(a=this.parent.getCellCollection(s[i].split(this.parent.tic).join("")),o=0;o<a.length;o++){if(d=this.parent.getValueFromArg(a[o]),d="TRUE"===d.split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,(n=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[e.CommonErrors.num];isNaN(n)||(h++,l*=n)}}else if((d=this.parent.getValueFromArg(s[i])).length>0){if(d="TRUE"===d.split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,!this.parent.isCellReference(s[i])&&isNaN(this.parent.parseFloat(d)))return this.parent.getErrorStrings()[e.CommonErrors.name];if((n=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[e.CommonErrors.num];isNaN(n)||(h++,l*=n)}return h>0&&(l=Math.pow(l,1/h)),l.toString()},n.prototype.getDataCollection=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.parent.getValueFromArg(e[r]));return t},n.prototype.parseDouble=function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t},n.prototype.spreadsheetDisplayText=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getDisplayText(this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx])}return e},n.prototype.spreadsheetFormat=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx].format}return e},n.prototype.getModuleName=function(){return"basic-formulas"},n}(),ni=function(){function r(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return r.prototype.parse=function(r,n){if(this.parent.isTextEmpty(r))return r;if(U(r))return this.parent.getErrorStrings()[e.CommonErrors.ref];this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===r[0]&&(r=r.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(r=this.checkForNamedRangeAndKeyValue(r),this.findNamedRange=!1),r=(r=(r=(r=r.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var i=this.storeStrings(r);r=this.storedStringText;var o=0;if(t.isNullOrUndefined(i)&&(r=r.split(" ").join("")),r=r.split("=>").join(">="),(r=r.split("=<").join("<="))[r.length-1]===this.parent.arithMarker&&this.indexOfAny(r,this.tokens)===r.length-2||(r=r.toUpperCase()),r.indexOf(this.sheetToken)>-1){var a=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=a.sheetNameToParentObject&&a.sheetNameToParentObject.size>0){r[0]!==this.sheetToken.toString()&&(r=this.parent.setTokensForSheets(r));var s=this.parent.getSheetToken(r.split(this.parent.tic).join(this.emptyStr)),l=this.checkScopedRange(r.split('"').join(this.emptyStr).split(this.sheetToken).join(""));t.isNullOrUndefined(s)&&""!==s&&this.parent.namedRanges.size>0&&""!==l&&(r=l)}}r=this.markLibraryFormulas(r);try{r=this.formulaAutoCorrection(r)}catch(t){if(!(p={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0),!p.isForceCalculable||!p.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression];r=this.formulaAutoCorrection(r,p),this.parent.storedData.get(n).formulaText="="+r}if(!this.ignoreBracet)for(o=r.indexOf(")");o>-1;){var h=r.substring(0,o).lastIndexOf("(");if(-1===h)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);if(h===o-1)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.empty_expression]);var d=this.emptyStr;d=this.ignoreBracet?this.parent.substring(r,h,o-h+1):this.parent.substring(r,h+1,o-h-1);try{r=r.substring(0,h)+this.parseSimple(d)+r.substring(o+1)}catch(e){var p=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0);var c="string"==typeof p.exception?p.exception:p.message;return(this.parent.getErrorLine(e)?"":"#"+this.parent.getErrorLine(e)+": ")+c}o=r.indexOf(")")}if(!this.ignoreBracet&&r.indexOf("(")>-1)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);return r=this.parseSimple(r),null!==i&&i.size>0&&(r=this.setStrings(r,i)),r},r.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},r.prototype.formulaAutoCorrection=function(r,n){var i=["*","+","-","/","^","&"],o=[">","=","<"],a=0,s="",l="",h="",d="",p="",c="",u="",f=0;if(this.parent.formulaErrorStrings.indexOf(r)>-1)return r;if(this.indexOfAny(r,this.specialSym)>-1)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!1);for(;a<r.length;)if(r=r.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(r[a])&&r.length>a+1&&this.indexOfAny(r[a+1],i)>-1&&r.length>a+2&&!t.isNullOrUndefined(r[a+2])&&this.indexOfAny(r[a+2],i)>-1&&("-"!==r[a+2]||"*"!==r[a+1]&&"/"!==r[a+1])){if(t.isNullOrUndefined(n))throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression],!0);if(!n.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];this.parent.isDigit(r[a])?(f<1?(c=r[a],h=r[a+1],t.isNullOrUndefined(h)&&(h=this.emptyStr),f+=1,s=s+c+(h="&"===h?"":h)):f<2&&(u=r[a],d=r[a-1],p=r[a+1],f=0,s="-"===d?s+d+u+(p="&"===(p=t.isNullOrUndefined(p)?this.emptyStr:p)?"":p):s+u+(p=t.isNullOrUndefined(p)?this.emptyStr:p)),a+=2):(s="-"===r[a]?s+r[a]:s,a+=1)}else if((this.parent.isDigit(r[a])||r[a]===this.parent.rightBracket||this.parent.storedData.has(r[a].toUpperCase()))&&(t.isNullOrUndefined(r[a+1])||this.indexOfAny(r[a+1],i))>-1)l="&"===(l=t.isNullOrUndefined(r[a+1])?this.emptyStr:r[a+1])?"":l,s="-"===r[a-1]?s+r[a-1]+r[a]+l:s+r[a]+l,a+=2;else if(this.indexOfAny(r[a],o)>-1&&!t.isNullOrUndefined(r[a-1])&&!t.isNullOrUndefined(r[a+1]))s+=r[a],a+=1;else if("q"===r[a])for(;r[a]!==this.parent.leftBracket;)s+=r[a],a+=1;else r[a]===this.parent.leftBracket||r[a]===this.parent.rightBracket||"{"===r[a]||"}"===r[a]||"("===r[a]||")"===r[a]?(s+=r[a],a+=1):this.parent.isUpperChar(r[a])||r[a].indexOf(":")>-1||r[a]===this.parent.getParseArgumentSeparator()||"%"===r[a]&&this.parent.isDigit(r[a-1])?(s+=r[a],a+=1):r[a]===this.parent.tic||" "===r[a]||"."===r[a]||r[a]===this.sheetToken||"$"===r[a]?(s+=r[a],a+=1):(this.parent.isDigit(r[a])&&(s="-"===r[a-1]?s+r[a-1]+r[a]:s+r[a]),"-"!==r[a]&&"+"!==r[a]||(s=(s+=r[a]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==r[a]&&"*"!==r[a]&&"^"!==r[a]||(s+=r[a]),a+=1);return s=s===this.emptyStr?r:s,this.indexOfAny(s[s.length-1],i)>-1&&(s=s.substring(0,s.length-1)),s=s.split("--").join("-").split("-+").join("-").split("+-").join("-")},r.prototype.checkScopedRange=function(e){var r=this,n=this.emptyStr,i="NaN",o=this.parent.getSheetID(this.parent.grid),a=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var s=e.indexOf(this.sheetToken,1),l=parseInt(e.substr(1,s-1),10);s>1&&!this.parent.isNaN(l)&&(e=e.substring(s+1),o=l)}var h="!"+o.toString()+"!";return null===a||null==a.sheetNameToToken?i:(a.sheetNameToToken.forEach(function(o,s){if(a.sheetNameToToken.get(s).toString()===h){var l=r.emptyStr;r.parent.namedRanges.forEach(function(o,s){l=t.isNullOrUndefined(r.parent.parentObject)?a.sheetNameToToken.get(s).toUpperCase():(r.parent.parentObject.getActiveSheet().name+r.sheetToken+e).toUpperCase(),r.parent.getNamedRanges().has(l)&&(n=r.parent.getNamedRanges().get(l).toUpperCase(),i=n)})}}),i)},r.prototype.storeStrings=function(t){var r,n=0,i=0,o=0,a="",s=null;if(t.indexOf(this.parent.tic)>-1)for(n=t.indexOf(this.parent.tic);n>-1&&t.length>0;){if(null===s&&(s=this.stringsColl),-1===(i=n+1<t.length?t.indexOf(this.parent.tic,n+1):-1))throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_tics]);r=this.parent.substring(t,n,i-n+1),a=this.parent.tic+this.spaceString+o.toString()+this.parent.tic,s=s.set(a,r),t=t.substring(0,n)+a+t.substring(i+1),(n+=a.length)<=t.length&&(n=t.indexOf(this.parent.tic,n)),o++}return this.storedStringText=t,s},r.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach(function(t,r){e=e.split(r).join(t)});return e},r.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],o=[this.charMultiply,this.charDivide],a=[this.charAdd,this.charSubtract],s=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],h=[this.charEp,this.charEm],d=[this.tokenAnd],p=[this.charAnd],c=[this.charOr],u=[this.tokenOr];return t=this.parseSimpleOperators(t,r,h),t=this.parseSimpleOperators(t,u,c),t=this.parseSimpleOperators(t,n,o),t=this.parseSimpleOperators(t,i,a),t=this.parseSimpleOperators(t,s,l),t=this.parseSimpleOperators(t,d,p)},r.prototype.parseSimpleOperators=function(t,r,n){if(this.parent.getErrorStrings().indexOf(t)>-1)return t;for(var i=t,o=0,a="",s=0;s<n.length;s++)a+=n[s];(i=(i=i.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===i[0]?(i="0-"+(i=i.substring(1).split("-").join(this.tokenOr)),i=(i=this.parseSimpleOperators(i,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):i.length>0&&"+"===i[0]?i=i.substring(1):i.length>0&&"+"===i[i.length-1]&&(i=i.substring(0,i.length-1));try{if(this.indexOfAny(i,n)>-1){if(i.includes(" ")){for(var l="",h=0;h<i.length;h++){var d=i[h];if(n.indexOf(d)>=0)l=l.trim()+d;else{if(" "==d&&n.indexOf(l[l.length-1])>=0)continue;l+=d}}i=l}for(o=this.indexOfAny(i,n);o>-1;){var p="",c="",u=0,f=0,g=0;if(i[o]===this.charNOTop)u=o;else if(g=o-1,i[g]===this.parent.arithMarker){if((v=this.findLeftMarker(i.substring(0,g-1)))<0)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);p=this.parent.substring(i,v+1,g-v-1),u=v+1}else if(i[g]===this.parent.rightBracket){for(var m=0,v=g-1;v>0&&("q"!==i[v]||0!==m);)"q"===i[v]?m--:i[v]===this.parent.rightBracket&&m++,v--;if(v<0)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);p=this.parent.substring(i,v,g-v+1),u=v}else if(i[g]===this.parent.tic[0]){var y=i.substring(0,g-1).lastIndexOf(this.parent.tic);if(y<0)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);p=this.parent.substring(i,y,g-y+1),u=y}else{for(var C=!1;g>-1&&(this.parent.isDigit(i[g])||!C&&i[g]===this.parent.getParseDecimalSeparator());)i[g]===this.parent.getParseDecimalSeparator()&&(C=!0),g-=1;if(g>-1&&C&&i[g]===this.parent.getParseDecimalSeparator())throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points]);if(0===(g+=1)||g>0&&!this.parent.isUpperChar(i[g-1]))p="n"+this.parent.substring(i,g,o-g),u=g;else{for(g-=1;g>-1&&(this.parent.isUpperChar(i[g])||this.parent.isDigit(i[g]));)g-=1;if(g>-1&&i[g]===this.sheetToken){for(g-=1;g>-1&&i[g]!==this.sheetToken;)g-=1;g>-1&&i[g]===this.sheetToken&&(g-=1)}if(g>-1&&":"===i[g]){for(g-=1;g>-1&&this.parent.isDigit(i[g]);)g-=1;for(;g>-1&&this.parent.isUpperChar(i[g]);)g-=1;if(g>-1&&i[g]===this.sheetToken){for(g--;g>-1&&i[g]!==this.sheetToken;)g--;g>-1&&i[g]===this.sheetToken&&g--}g+=1,p=this.parent.substring(i,g,o-g),p=this.parent.getCellFrom(p)}else g+=1,p=this.parent.substring(i,g,o-g);this.parent.updateDependentCell(p),u=g}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(p.toUpperCase())||this.parent.storedData.has(p.toUpperCase()))&&(p="n"+this.checkForNamedRangeAndKeyValue(p))}if(o===i.length-1)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.expression_cannot_end_with_an_operator]);var x="u"===i[g=o+1];if(x&&(g+=1),i[g]===this.parent.tic[0]){if((v=i.substring(g+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];c=this.parent.substring(i,g,v+2),f=v+g+2}else if(i[g]===this.parent.arithMarker){if((v=this.findRightMarker(i.substring(g+1)))<0)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse]);c=this.parent.substring(i,g+1,v),f=v+g+2}else if("q"===i[g]){for(m=0,v=g+1;v<i.length&&(i[v]!==this.parent.rightBracket||0!==m);)i[v]===this.parent.rightBracket?m++:"q"===i[v]&&m--,v++;if(v===i.length)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.cannot_parse];c=this.parent.substring(i,g,v-g+1),x&&(c="u"+c),f=v+1}else if(this.parent.isDigit(i[g])||i[g]===this.parent.getParseDecimalSeparator()){C=i[g]===this.parent.getParseDecimalSeparator();for(g+=1;g<i.length&&(this.parent.isDigit(i[g])||!C&&i[g]===this.parent.getParseDecimalSeparator());)i[g]===this.parent.getParseDecimalSeparator()&&(C=!0),g+=1;if(g<i.length&&"%"===i[g]&&(g+=1),C&&g<i.length&&i[g]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.number_contains_2_decimal_points];c="n"+this.parent.substring(i,o+1,g-o-1),f=g}else if(this.parent.isUpperChar(i[g])||i[g]===this.sheetToken||"u"===i[g]){if(i[g]===this.sheetToken)for(g+=1;g<i.length&&i[g]!==this.sheetToken;)g+=1;g+=1;for(var b=0,S=!1;g<i.length&&(this.parent.isUpperChar(i[g])||"_"===i[g]||"."===i[g]||"["===i[g]||"]"===i[g]||"#"===i[g]||" "===i[g]||"%"===i[g]||i[g]===this.parent.getParseDecimalSeparator()&&S);)g!==i.length-1&&"["===i[g]&&"["===i[g+1]&&(S=!0),g!==i.length-1&&"]"===i[g]&&"]"===i[g+1]&&(S=!1),g++,b++;var w=g===i.length||!this.parent.isDigit(i[g]);if(b>1){for(;g<i.length&&(this.parent.isUpperChar(i[g])||this.parent.isDigit(i[g])||" "===i[g]||"_"===i[g]);)g++;w=!0}for(;g<i.length&&this.parent.isDigit(i[g]);)g+=1;if(g<i.length&&":"===i[g]){if((g+=1)<i.length&&i[g]===this.sheetToken){for(g++;g<i.length&&i[g]!==this.sheetToken;)g+=1;g<i.length&&i[g]===this.sheetToken&&g++}for(;g<i.length&&this.parent.isUpperChar(i[g]);)g+=1;for(;g<i.length&&this.parent.isDigit(i[g]);)g+=1;g-=1,c=this.parent.substring(i,o+1,g-o),c=this.parent.getCellFrom(c)}else g-=1,c=this.parent.substring(i,o+1,g-o),(x="u"===i[g])&&(c="u"+c);w&&c.startsWith(this.sheetToken)&&(w=!this.parent.isCellReference(c)),w||this.parent.updateDependentCell(c),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(c.toUpperCase())||this.parent.storedData.has(c.toUpperCase()))&&(c="n"+this.checkForNamedRangeAndKeyValue(c)),f=g+1}var I=a.indexOf(i[o]),E=this.parent.arithMarker+p+c+r[I]+this.parent.arithMarker;u>0&&(E=i.substring(0,u)+E),f<i.length&&(E+=i.substring(f)),i=E=E.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),o=this.indexOfAny(i,n)}}else if(i.length>0&&(this.parent.isUpperChar(i[0])||i[0]===this.sheetToken)){var R=!0,A=!0,k=!1,F=i.length;for(v=0;v<F;++v)if(i[v]===this.sheetToken){if(v>0&&!k)throw this.parent.getErrorStrings()[e.CommonErrors.ref];for(k=!0,v++;v<F&&this.parent.isDigit(i[v]);)v++;if(v===F||i[v]!==this.sheetToken){R=!1;break}}else{if(!A&&this.parent.isChar(i[v])){R=!1;break}if(!this.parent.isChar(i[v])&&!this.parent.isDigit(i[v])&&i[v]!==this.sheetToken){R=!1;break}A=this.parent.isUpperChar(i[v])}R&&this.parent.updateDependentCell(i)}return i}catch(e){return e}},r.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.parseFormula=function(r,n){if(r.length>0&&r[0]===this.parent.getFormulaCharacter()&&(r=r.substring(1)),r.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[e.CommonErrors.ref];r.length>0&&"+"===r[0]&&(r=r.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,r=this.parse(r.trim(),n),this.isFormulaParsed=!0}catch(e){var i=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",i),this.isFailureTriggered=!0);var o="string"==typeof i.exception?i.exception:i.message;r=(t.isNullOrUndefined(this.parent.getErrorLine(e))?"":"#"+this.parent.getErrorLine(e)+": ")+o,this.isError=!0}return r},r.prototype.markLibraryFormulas=function(r){var n=0,i=r.indexOf(")");if(-1===i)r=this.markNamedRanges(r);else for(;i>-1;){for(var o=0,a=i-1;a>-1&&("("!==r[a]||0!==o);)")"===r[a]&&o++,a--;if(-1===a)throw new si(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.mismatched_parentheses]);for(var s=a-1;s>-1&&this.parent.isChar(r[s]);)s--;var l=a-s-1,h=this.parent.substring(r,s+1,l);if(l>0&&!t.isNullOrUndefined(this.parent.getFunction(h))){"AREAS"===this.parent.substring(r,s+1,l)?this.ignoreBracet=!0:this.ignoreBracet=!1;var d=this.parent.substring(r,a,i-a+1);try{var p=void 0;d=d.split("(").join("").split(")").join(""),d="("+this.formulaAutoCorrection(d,p)+")"}catch(t){if(!(p={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0,n+=1),p.computeForceCalculate=n>0||p.computeForceCalculate,!p.isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];if(!p.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.improper_formula];d=d.split("(").join("").split(")").join(""),d="("+this.formulaAutoCorrection(d,p)+")"}d=this.markNamedRanges(d),d=this.swapInnerParens(d);-1===(d=this.addParensToArgs(d)).lastIndexOf(this.parent.getParseArgumentSeparator())&&d.length>2&&"("===d[0]&&")"===d[d.length-1]&&"{"!==d[1]&&"("!==d[1]&&(d=(d=d.substring(0,d.length-1)+"}"+d.substring(d.length-1))[0]+"{"+d.substring(1)),r=r.substring(0,s+1)+"q"+this.parent.substring(r,s+1,l)+d.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+r.substring(i+1)}else{if(l>0)return this.parent.getErrorStrings()[e.CommonErrors.name];var c=this.emptyStr;a>0&&(c=r.substring(0,a)),c=c+"{"+this.parent.substring(r,a+1,i-a-1)+"}",i<r.length&&(c+=r.substring(i+1)),r=c=this.markNamedRanges(c)}i=r.indexOf(")")}return r=r.split("{").join("(").split("}").join(")")},r.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},r.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{r=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var i=!0;r>-1;){var o=this.indexOfAny(e.substring(r+1,e.length),t);o>=0?o=r+o+1:-1===o&&")"===e[e.length-1]&&(o=e.length-1),o>0&&"{"!==e[r+1]&&"}"!==e[o-1]&&(e=(e=e.substr(0,o)+"}"+e.substr(o)).substr(0,r+1)+"{"+e.substr(r+1)),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),i&&-1===r&&"("===e[0]&&(r=0,i=!1)}return e=e.split("{}").join(this.emptyStr)},r.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.markNamedRanges=function(e){var r=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],n=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var i=this.indexOfAny(e.substring(n),r);i>-1&&i+n<e.length;){var o=this.emptyStr,a=null;if(this.parent.substring(e,n,i).indexOf("[")>-1?a=this.getTableRange(this.parent.substring(e,n,i)):this.parent.storedData.has(this.parent.substring(e,n,i))?a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i)):this.parent.namedRanges.has(this.parent.substring(e,n,i))&&(a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i))),t.isNullOrUndefined(a)&&("NaN"!==(o=this.checkScopedRange(this.parent.substring(e,n,i)))?(this.findNamedRange=!0,a=o):this.parent.substring(e,n,i).startsWith(this.sheetToken.toString()),!t.isNullOrUndefined(a)&&this.findNamedRange&&a.indexOf(this.fixedReference)>-1&&(a=a.split(this.fixedReference).join(this.emptyStr))),t.isNullOrUndefined(a)||(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a)),t.isNullOrUndefined(a)||a===this.emptyStr)for(n+=i+1;n<e.length&&!this.parent.isUpperChar(e[n])&&e[n]!==this.sheetToken;)n++;else e=e.substring(0,n)+a+e.substring(n+i),n+=a.length+1;for(i=n,n<e.length-1&&"{"===e[n]&&(n+=1),i=this.indexOfAny(e.substring(n),r);0===i&&n<e.length-1;)n++,i=this.indexOfAny(e.substring(n),r);if((-1===i||e.substring(n).indexOf("[")>-1)&&n<e.length){if(a=e.substring(n).indexOf("[")>-1?this.getTableRange(e.substring(n)):this.parent.storedData.has(e.substring(n))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):a:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):a,t.isNullOrUndefined(a)&&"NaN"!==(o=this.checkScopedRange(e.substring(n)))&&(a=o),!t.isNullOrUndefined(a)&&a!==this.emptyStr&&(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),null!=(a=this.markLibraryFormulas(a)))){var s=e.substring(n);e=")"===s[s.length-1]?e.substring(0,n)+a+")":e.substring(0,n)+a,n+=a.toString().length+1}i=n<e.length?this.indexOfAny(e.substring(n),r):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},r.prototype.checkForNamedRangeAndKeyValue=function(e){var r=this.emptyStr;if(e.indexOf("[")>-1){var n=this.getTableRange(e);t.isNullOrUndefined(n)||(this.findNamedRange=!0,e=n)}if("NaN"!==(r=this.checkScopedRange(e)))this.findNamedRange=!0,e=r;else{if(e.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid),o=e.split('"').join(this.emptyStr);if(o=o.substr(0,o.indexOf(this.sheetToken)),i.sheetNameToToken.has(o.toUpperCase()))parseInt(i.sheetNameToToken.get(o.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(t.isNullOrUndefined(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},r.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},r.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},r}(),ii=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),oi=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ai=function(r){function n(e){var n=r.call(this,null,null)||this;n.lFormulas=new Map,n.storedData=new Map,n.keyToRowsMap=new Map,n.rowsToKeyMap=new Map,n.rightBracket=String.fromCharCode(161),n.leftBracket=String.fromCharCode(162),n.sheetToken="!",n.emptyString="",n.leftBrace="{",n.rightBrace="}",n.cell=n.emptyString,n.cellPrefix="!0!A",n.treatEmptyStringAsZero=!1,n.tic='"',n.singleTic="'",n.trueValue="TRUE",n.falseValue="FALSE",n.parseDecimalSeparator=".",n.arithMarker=String.fromCharCode(180),n.arithMarker2=n.arithMarker+n.arithMarker,n.dependentCells=null,n.dependentFormulaCells=null,n.minValue=Number.MIN_SAFE_INTEGER,n.maxValue=Number.MAX_SAFE_INTEGER,n.categoryCollection=["All"],n.dependencyLevel=0,n.randomValues=new Map,n.isRandomVal=!1,n.randCollection=[],n.dependencyCollection=[],n.uniqueRange=[],n.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!","#DIV/0!"],n.errorStrings=null,n.parseArgumentSeparator=",",n.dateTime1900=new Date(1900,0,1,0,0,0),n.isParseDecimalSeparatorChanged=!1,n.isArgumentSeparatorChanged=!1,n.sheetFamilyID=0,n.defaultFamilyItem=null,n.sheetFamiliesList=null,n.modelToSheetID=null,n.tokenCount=0,n.sortedSheetNames=null,n.tempSheetPlaceHolder=String.fromCharCode(133),n.namedRanges=new Map,n.formulaInfoTable=null,n.oaDate=new Date(1899,11,30),n.millisecondsOfaDay=864e5,n.parseDateTimeSeparator="/";var o=new ti(n);return n.includeBasicFormulas&&i.Inject(ri),n.injectedModules&&n.injectedModules.length&&o.inject(n.requiredModules(),n.injectedModules),n.parentObject=t.isNullOrUndefined(e)?n:e,n.grid=n.parentObject,n.parser=new ni(n),n}ii(n,r),i=n,Object.defineProperty(n.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),n.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},n.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},n.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},n.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},n.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},n.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},n.prototype.requiredModules=function(){return _(this)},n.Inject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var r=0;r<e.length;r++)-1===this.prototype.injectedModules.indexOf(e[r])&&this.prototype.injectedModules.push(e[r])},n.prototype.getInjectedModules=function(){return this.injectedModules},n.prototype.onPropertyChanged=function(e,t){},n.prototype.getModuleName=function(){return"calculate"},n.prototype.getFormulaCharacter=function(){return"="},n.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},n.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},n.prototype.updateDependentCell=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.cell;if(r!==this.emptyString){if(null!==t.sheetNameToParentObject){var n=t.parentObjectToToken.get(this.grid);-1===r.indexOf(this.sheetToken)&&(r=n+r),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){var i=this.getDependentCells().get(e);i.indexOf(r)<0&&r!==e&&i.push(r)}else this.getDependentCells().set(e,[r]);this.addToFormulaDependentCells(e)}},n.prototype.addToFormulaDependentCells=function(e){var t=this.cell,r=this.getSheetFamilyItem(this.grid);if(null!=r.sheetNameToParentObject&&-1===t.indexOf(this.sheetToken)){t=r.parentObjectToToken.get(this.grid)+t}this.getDependentFormulaCells().has(t)?this.getDependentFormulaCells().get(t).has(e)||this.getDependentFormulaCells().get(t).set(e,e):(this.getDependentFormulaCells().set(t,new Map),this.getDependentFormulaCells().get(t).set(e,e))},n.prototype.getDependentCells=function(){return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},n.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},n.prototype.getLibraryFormulas=function(){return this.lFormulas},n.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},n.prototype.intToDate=function(e){var t=Number(e);return(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1),new Date(864e5*(t-1)+new Date("01/01/1900").getTime())},n.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},n.prototype.getFormula=function(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""},n.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},n.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},n.prototype.getSheetToken=function(t){var r=0,n=this.emptyString;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;n=t.substring(0,r+1)}if(r<t.length)return n;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);if(r){r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}}return-1},n.prototype.parseFloat=function(e){var t=Number(e);return isNaN(t)&&"string"==typeof e&&e.includes(",")&&(t=Number(e.split(",").join(""))),t},n.prototype.rowIndex=function(t){var r=0,n=!1;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;r++}for(;r<t.length&&this.isChar(t[r]);)n=!0,r++;var i=parseInt(t.substring(r),10);if(r<t.length&&!this.isNaN(i))return i;if(n)return-1;throw this.formulaErrorStrings[e.FormulasErrorsStrings.bad_index]},n.prototype.colIndex=function(e){var t=0,r=0;if(e=e.toUpperCase(),t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r},n.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings},n.prototype.substring=function(e,t,r){return e.substring(t,r+t)},n.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},n.prototype.getSheetFamilyItem=function(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new hi),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new hi),this.sheetFamiliesList.get(t)},n.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new li),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},n.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);r&&(r.forEach(function(r,n){var i=n,o=t.getDependentCells().get(i);t.arrayRemove(o,e),0===o.length&&t.getDependentCells().delete(i)}),this.getDependentFormulaCells().delete(e))},n.prototype.arrayRemove=function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},n.prototype.getKeyValue=function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var r=this.storedData.get(e),n=r.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),n=n.substring(1);try{r.setParsedFormula(this.parser.parseFormula(n,e))}catch(t){var i={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",i),r.setFormulaValue(i.message),this.storedData.get(e).getFormulaValue()}try{r.setFormulaValue(this.computeFormula(r.getParsedFormula()))}catch(e){i={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",i);var o="string"==typeof i.exception?i.exception:i.message;return(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+o}}return this.storedData.get(e).getFormulaValue()}return this.emptyString},n.prototype.getNamedRanges=function(){return this.namedRanges},n.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(r[0]))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},n.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},n.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],o=0;o<r;o++)i[r-o-1]=t[o];return i.join("")},n.prototype.getCellCollection=function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,r=e.indexOf(this.sheetToken);if(r>-1)for(var n=r+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var i,o,a,s,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var h=l-2;h>=0&&this.isDigit(e[h]);)h--;i=this.rowIndex(this.substring(e,0,l)),o=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),a=this.colIndex(this.substring(e,0,l)),s=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),i>o&&(l=o,o=i,i=l),a>s&&(l=s,s=a,a=l);var d,p=[],c=0;for(l=i;l<=o;l++)for(d=a;d<=s;d++)p[c]=t+this.emptyString+this.convertAlpha(d)+l.toString(),c++;return p},n.prototype.computeFormula=function(e){return this.calculateFormula(e,!1)},n.prototype.calculateFormula=function(r,n){var i,o,a,s,l=this,h=!1;if(this.parser.isError)return r;i=this.parser.isFormulaParsed?r:this.parser.parseFormula(r),this.parser.isFormulaParsed=!1;try{if((o=this.findLastIndexOfq(i))>0&&(h=!0),i!==this.emptyString&&o>-1)for(var d=o+1;d>-1;)if(i[d]===this.rightBracket){var p=i.substring(o,d+1),c=p.split(this.leftBracket)[0].split("q").join(this.emptyString),u=void 0;if(this.getLibraryFormulas().get(c.toUpperCase()).isCustom){u=p.substring(p.indexOf(this.leftBracket)+1,p.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());var f=0,g=[],m=void 0;for(f=0;f<u.length;f++)u[f].includes(":")&&this.isCellReference(u[f])&&(m=this.getCellCollection(u[f])).length>1?(g.push(u[f]),m.forEach(function(e){l.updateDependentCell(e)})):g.push(this.getValueFromArg(u[f]));u=g}else{if(u=p.substring(p.indexOf(this.leftBracket)+1,p.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator()),p.includes(this.getParseArgumentSeparator()+this.tic))for(var v=null,y=0;y<u.length;y++)u[y]&&u[y][0]===this.tic&&u[y][u[y].length-1]!==this.tic&&(v=y),null!==v&&v===y-1&&u[y][0]!==this.tic&&u[y][u[y].length-1]===this.tic&&(u[v]=u[v]+this.getParseArgumentSeparator()+u[y],u.splice(y,1),v=null);h&&c&&"IF"===c&&u.push("nestedFormulaTrue")}if(a=t.isNullOrUndefined(this.getFunction(c))?this.getErrorStrings()[e.CommonErrors.name]:this.getFunction(c).apply(void 0,u),!h)break;s=this.processNestedFormula(i,p,a);var C=this.findLastIndexOfq(s);0===C&&(h=!1),-1===C&&(a=this.computeValue(s,n)),o=d=C,i=s}else d++;else this.formulaErrorStrings.indexOf(i)>-1?a=i:i!==this.emptyString&&-1===o&&(a=this.computeValue(i,n))}catch(e){u={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",u);var x="string"==typeof u.exception?u.exception:u.message;a=(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+x}return a},n.prototype.computeSumIfAndAvgIf=function(r){if(t.isNullOrUndefined(r)||r[0]===this.emptyString||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var n=r,i=0;i<n.length;i++)if(this.isCellReference(n[i])&&t.isNullOrUndefined(n[i].match(/[0-9]/))&&n[i].indexOf("!")<0){var o=n[i].split(":");n[i]=o[0]+"1:"+o[1]+this.spreadSheetUsedRange[0]}var a=n.length;if(2!==a&&3!==a&&0===a)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var s=n[0],l=n[1].trim();if((l=l.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[e.CommonErrors.value];var h=l.includes("*"),d=h?l.replace(/\*/g,"").trim():l;d=this.isCellReference(d)?this.getValueFromArg(d):l,h&&("*"===l[0]&&(d="*"+d),"*"===l[l.length-1]&&(d+="*")),l=d;var p=this.parser.tokenEqual;l.startsWith("<=")?(p=this.parser.tokenLessEq,l=l.substring(2)):l.startsWith(">=")?(p=this.parser.tokenGreaterEq,l=l.substring(2)):l.startsWith("<>")?(p=this.parser.tokenNotEqual,l=l.substring(2)):l.startsWith("<")?(p=this.parser.tokenLess,l=l.substring(1)):l.startsWith(">")?(p=this.parser.tokenGreater,l=l.substring(1)):l.startsWith("=")&&(p=this.parser.tokenEqual,l=l.substring(1));var c=this.parseFloat(l),u=n[0],f=this.getCellCollection(a>2?n[2]:s),g=this.getCellCollection(u);if(g.length>f.length){var m=this.colIndex(f[f.length-1])+this.colIndex(g[g.length-1])-this.colIndex(g[0]),v=n[2].split(":");v[1]=(this.convertAlpha(m)+this.rowIndex(g[g.length-1])).toString(),f=this.getCellCollection(v.join(":"))}var y=this.getComputeSumIfValue(g,f,l,c,p,h);return[y[0],y[1]]},n.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=e[(a=e.indexOf("?"))-1],i=e[a+1];if(t.indexOf(n)>-1&&t.indexOf(i)>-1){var o=t.indexOf(n);r=t[o]===n&&t[o+2]===i?e:t}else r=t}else if(e.indexOf("*")>-1){for(var a=e.indexOf("*"),s="",l="",h=this.falseValue,d=this.falseValue,p=a-1;p>=0;p--)s+=e[p],d=this.trueValue;for(p=a+1;p<e.length;p++)l+=e[p],h=this.trueValue;var c=""===s?-1:t.indexOf(s.split("").reverse().join("")),u=""===l?-1:t.indexOf(l);c>-1||u>-1?d===this.trueValue?r=s.split("").reverse().join("")===t.substr(0,s.length)?e:t:h===this.trueValue&&(r=l===t.substring(t.length-l.length,t.length)?e:t):r=t}return r},n.prototype.getComputeSumIfValue=function(e,t,r,n,i,o){var a=0,s=0;switch(i){case this.parser.tokenEqual:for(var l=o?r.replace(/\*/g,""):r,h=0;h<e.length;h++){var d=this.getValueFromArg(e[h].split(this.tic).join("")),p=this.parseFloat(d);if(d===r&&p===n){var c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}else d===r?(a+=this.getValueFromRange(t,h),s+=1):o&&l&&d&&("*"===r[0]&&l.length<=d.length&&l===d.slice(0,l.length)&&(a+=this.getValueFromRange(t,h),s+=1),"*"===r[r.length-1]&&l.length<=d.length&&l===d.slice(d.length-l.length,d.length)&&(a+=this.getValueFromRange(t,h),s+=1))}break;case this.parser.tokenLess:for(h=0;h<e.length;h++){d=this.getValueFromArg(e[h].split(this.tic).join(""));if((p=this.parseFloat(d))<n){c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenGreater:for(h=0;h<e.length;h++){d=this.getValueFromArg(e[h].split(this.tic).join(""));if((p=this.parseFloat(d))>n){c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenLessEq:for(h=0;h<e.length;h++){d=this.getValueFromArg(e[h].split(this.tic).join(""));if((p=this.parseFloat(d))<=n){c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenGreaterEq:for(h=0;h<e.length;h++){d=this.getValueFromArg(e[h].split(this.tic).join(""));if((p=this.parseFloat(d))>=n){c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenNotEqual:for(h=0;h<e.length;h++){d=this.getValueFromArg(e[h].split(this.tic).join("")),p=this.parseFloat(d);if(d!==r&&p!==n){c=this.getValueFromArg(t[h].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}}return[a,s]},n.prototype.getValueFromRange=function(e,t){var r=e[t];return r=this.getValueFromArg(r),this.parseFloat(r.toString())},n.prototype.computeAndOr=function(t,r){var n,i,o="and"===r;if(0===t.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var a=0,s=t.length;a<s;a++)if(t[a].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];for(var l=t,h=0;h<l.length;h++){if(l[h]===this.tic)return this.getErrorStrings()[e.CommonErrors.value];if(l[h].indexOf(":")>-1&&this.isCellReference(l[h]))for(var d=this.getCellCollection(l[h]),p=0;p<d.length;p++){if(this.getErrorStrings().indexOf(d[p])>-1)return d[p];if(d[p][0]===this.tic)return this.getErrorStrings()[e.CommonErrors.name];if(""===(n=this.getValueFromArg(d[p]))&&(n=this.trueValue),this.getErrorStrings().indexOf(n)>-1)return n;i=this.parseFloat(n)}else{if(n=this.getValueFromArg(l[h]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(n)>-1)return n;var c=Date.parse(n.split(this.tic).join(""));if(isNaN(c)){if(n!==this.trueValue&&n!==this.falseValue)return this.getErrorStrings()[e.CommonErrors.value].toString()}else o=!0;i=this.parseFloat(n)}o="and"===r?o&&(n===this.trueValue||!isNaN(i)):o||n===this.trueValue||!isNaN(i)}return o?this.trueValue:this.falseValue},n.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},n.prototype.getCellFrom=function(e){var t,r="",n=e.indexOf(":")>-1?e.split(":"):[e],i=n.length-1,o=this.rowIndex(n[0]);if(o===this.rowIndex(n[i])){var a=this.colIndex(n[0]),s=this.colIndex(n[i]),l=this.colIndex(this.cell);l>=a&&l<=s&&(r=q(l).toString()+o.toString())}else if(this.colIndex(n[0])===this.colIndex(n[i])){t=this.colIndex(n[0]);var h=this.rowIndex(n[i]),d=this.rowIndex(this.cell);d>=o&&d<=h&&(r=q(t).toString()+d.toString())}return r},n.prototype.computeValue=function(t,r){try{var n=[],i=0,o="";for(n.length=0;i<t.length;){var a="u"===t[i];if(t[i]!==this.arithMarker){if(this.isDigit(t[i])){for(var s=this.emptyString;i<t.length&&(this.isDigit(t[i])||t[i]===this.parseDecimalSeparator);)s+=t[i],i+=1;if(n.push(s),!t[i])return n.toString()}if(t[i]===this.sheetToken){for(o=t[i],i+=1;i<t.length&&t[i]!==this.sheetToken;)o+=t[i],i+=1;i<t.length&&(o+=t[i],i+=1)}else if(this.isUpperChar(t[i])){s=this.emptyString;for(var l="";i<t.length&&this.isUpperChar(t[i]);){s+=t[i],i+=1}for(;i<t.length&&this.isDigit(t[i]);){s+=t[i],i+=1}if(i<t.length&&":"===t[i]){if(s+=t[i],(i+=1)<t.length&&t[i]===this.sheetToken)for(s+=t[i],i+=1;i<t.length&&t[i]!==this.sheetToken;)s+=t[i],i+=1;for(;i<t.length&&this.isUpperChar(t[i]);)s+=t[i],i+=1;for(;i<t.length&&this.isDigit(t[i]);)s+=t[i],i+=1;s=o+this.getCellFrom(s)}else s=o+s;if(l=this.getParentObjectCellValue(s,r).toString(),o="","string"==typeof l&&this.getErrorStrings().indexOf(l)>-1)return l;n.push(l)}else if("q"===t[i]){var h=t.substring(i+1).indexOf(this.leftBracket),d=t.substring(i+h+1).indexOf(this.rightBracket);t=this.substring(t,i+h+2,d-1)}else if(t[i]===this.tic[0]){s=t[i].toString();for(i+=1;i<t.length&&t[i]!==this.tic[0];)s+=t[i],i+=1;n.push(s.split(this.tic).join(this.emptyString)),i+=1}else if("%"===t[i]&&n.length>0){var p=n[0],c=this.parseFloat(p);this.isNaN(c)||(n.pop(),n.push((c/100).toString())),i+=1}else if(0===t.substring(i).indexOf(this.trueValue))n.push(this.trueValue),i+=this.trueValue.length;else if(0===t.substring(i).indexOf(this.falseValue))n.push(this.falseValue),i+=this.falseValue.length;else if(t[i]===this.tic[0]||"|"===t[i]){s=t[i].toString();for(i++;i<t.length&&t[i]!==this.tic[0];)s+=t[i],i+=1;n.push(s+this.tic),i+=1}else{if(" "===t[i]&&i<t.length-1){i+=1;continue}switch(t[i]){case"#":var u=0;this.getErrorStrings().indexOf(t.substring(i))>-1?(u=-1===t.indexOf("!")||-1===t.substring(i).indexOf("!")?t.indexOf("#N/A")>-1?t.indexOf("#N/A")+4+i:t.indexOf("?")+1+i:t.indexOf("!")+1+i,n.push(this.substring(t,i,u-i))):(u=i+1,n.push(this.substring(t,i,u-i))),i=u;break;case"n":s="";if("n"===t[i+=1])continue;if(0===t.substring(i).indexOf("Infinity"))i+=(s="Infinity").length;else{for(("u"===t[i]||a||"-"===t[i])&&(s="-",a?a=!1:i+=1);i<t.length&&this.isDigit(t[i])||t[i]===this.getParseDecimalSeparator();)s+=t[i],i+=1;if(i<t.length&&"%"===t[i])if(i+=1,""===s){if(n.length>0){p=n[0],c=this.parseFloat(p);this.isNaN(c)||(n.pop(),n.push((c/100).toString()))}}else s=(this.parseFloat(s)/100).toString()}n.push(s);break;case this.parser.tokenAdd:this.getValArithmetic(n,"add"),i+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(n,"sub"),i+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(n,"mul"),i+=1;break;case this.parser.tokenDivide:this.getValArithmetic(n,"div"),i+=1;break;case this.parser.tokenLess:this.processLogical(n,"less"),i+=1;break;case this.parser.tokenGreater:this.processLogical(n,"greater"),i+=1;break;case this.parser.tokenGreaterEq:this.processLogical(n,"greaterEq"),i+=1;break;case this.parser.tokenLessEq:this.processLogical(n,"lessEq"),i+=1;break;case this.parser.tokenNotEqual:this.processLogical(n,"notEq"),i+=1;break;case this.parser.tokenOr:this.processLogical(n,"or"),i+=1;break;case this.parser.tokenAnd:this.processLogical(n,"and"),i+=1;break;case this.parser.tokenEqual:this.processLogical(n,"equal"),i+=1;break;default:return this.getErrorStrings()[e.CommonErrors.value]}}}else i+=1}if(0===n.length)return this.emptyString;s=this.emptyString;for(var f=n.length;f>0;){if((s=n.pop()+s)===this.emptyString&&this.isCellReference(t)&&this.getTreatEmptyStringAsZero())return"0";f--}return s}catch(t){if(this.getErrorStrings().indexOf(t)>-1||this.formulaErrorStrings.indexOf(t)>-1)throw t;throw new si(this.formulaErrorStrings[e.FormulasErrorsStrings.invalid_expression])}},n.prototype.getValArithmetic=function(t,r){var n=t.pop();n=n===this.emptyString?"0":n;var i=Number(n);if(isNaN(i))throw n===this.getErrorStrings()[e.CommonErrors.divzero]?this.getErrorStrings()[e.CommonErrors.divzero]:this.getErrorStrings()[e.CommonErrors.value];var o=t.pop();if(o=o===this.emptyString?"0":o,i=Number(o),isNaN(i))throw n===this.getErrorStrings()[e.CommonErrors.divzero]?this.getErrorStrings()[e.CommonErrors.divzero]:this.getErrorStrings()[e.CommonErrors.value];"add"===r&&t.push((Number(o)+Number(n)).toString()),"sub"===r&&t.push((Number(o)-Number(n)).toString()),"mul"===r&&t.push((Number(o)*Number(n)).toString()),"div"===r&&(this.isNaN(this.parseFloat(n))||this.isNaN(this.parseFloat(o))?t.push(this.getErrorStrings()[e.CommonErrors.value]):0===this.parseFloat(n)?t.push(this.getErrorStrings()[e.CommonErrors.divzero]):t.push((Number(o)/Number(n)).toString()))},n.prototype.processLogical=function(e,t){var r,n,i,o;"and"!==t&&"equal"!==t&&(r=e.pop(),n=e.pop(),i=r.indexOf(this.tic)>-1?r:this.parseFloat(r),o=n.indexOf(this.tic)>-1?n:this.parseFloat(n));var a;return"less"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:o<i?this.trueValue:this.falseValue),"greater"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:o>i?this.trueValue:this.falseValue),"lessEq"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:o<=i?this.trueValue:this.falseValue),"greaterEq"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:o>=i?this.trueValue:this.falseValue),"notEq"===t&&(a=n!==r?this.trueValue:this.falseValue),"and"===t&&(r=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),a=(a=this.emptyString+n+r+this.emptyString).split(this.tic).join("")),"equal"===t&&(r=e.pop().toString(),""===(n=e.pop().toString())&&""!==r&&(n="0"),a=r===n?this.trueValue:this.falseValue),"or"===t&&(a=Math.pow(this.parseFloat(o),this.parseFloat(i)).toString()),e.push(a),a},n.prototype.computeStoreCells=function(e){for(var t=e.cellValue,r=e.cellRange,n=e.criteria,i=e.argArray,o=e.isCriteria,a=e.storedCells,s=e.isCountIfS,l=e.countVal,h=o===this.trueValue?a:t,d=[],p=0;p<h.length;p++){var c=[],u=this.getValueFromArg(t[p]),f=void 0,g="";if(f=i[2].split(this.tic).join(this.emptyString),f=this.isCellReference(f)?this.getValueFromArg(f):f,(o=s===this.trueValue?this.trueValue:o)===this.trueValue){var m="",v=0,y=0;for(a[p]=s===this.trueValue&&0===l?t[p]:a[p],m=a[p];!this.isDigit(m[v]);)v+=1;if(this.isCellReference(r[l])&&r[l].indexOf(":")>-1){var C=r[l].indexOf(":");for(g=this.substring(r[l],C);!this.isDigit(g[y]);)y+=1}var x=this.substring(m,v),b=this.substring(g,y);g=a[p].split(x).join(b),u=this.getValueFromArg(g),f=s===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}var S="equal";f.startsWith("<=")?(S="lessEq",f=f.substring(2)):f.startsWith(">=")?(S="greaterEq",f=f.substring(2)):f.startsWith("<>")?(S="notEq",f=f.substring(2)):f.startsWith("<")?(S="less",f=f.substring(1)):f.startsWith(">")?(S="greater",f=f.substring(1)):f.startsWith("=")&&(S="equal",f=f.substring(1)),(f.indexOf("*")>-1||f.indexOf("?")>-1)&&(u=this.findWildCardValue(f,u)),c.push(u.toLowerCase()),c.push(f.toLowerCase()),this.processLogical(c,S)===this.trueValue&&(o===this.falseValue?d.push(t[p]):d.push(g))}return a=d,d=[],a},n.prototype.computeIfsFormulas=function(r,n,i){if(t.isNullOrUndefined(r)||""===r[0]||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];var o=r,a=o.length;if(a<2||a>127)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=[],l=[],h=[],d=0,p=0;p<o.length;p++)o[p].indexOf(":")>-1&&this.isCellReference(o[p])?s.push(o[p]):l.push(o[p]);s=(s=s.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());var c=[];for(p=0;p<s.length;p++)c.push(this.getCellCollection(s[p]).length);for(var u=0;u<c.length;u++)if(c[u]&&c[u+1]&&c[u]!==c[u+1])return this.getErrorStrings()[e.CommonErrors.value];var f,g;if(n===this.falseValue){g=this.falseValue;var m={cellValue:f=this.getCellCollection(s[1]),cellRange:s,criteria:l,argArray:o,isCriteria:g,storedCells:h,isCountIfS:n};if(h=this.computeStoreCells(m),0===h.length)return i===this.trueValue?this.getErrorStrings()[e.CommonErrors.divzero]:0}for(p=n===this.trueValue?0:2;p<s.length;p++){g=this.trueValue,g=n===this.trueValue&&0===p?this.falseValue:this.trueValue;m={cellValue:f=this.getCellCollection(s[p]),cellRange:s,criteria:l,argArray:o,isCriteria:g,storedCells:h,isCountIfS:n,countVal:p};if(h=this.computeStoreCells(m),0===h.length)return 0}var v=0;for(u=0;u<h.length;u++){var y="",C="",x=0,b=0;for(y=h[u];!this.isDigit(y[x]);)x+=1;if(this.isCellReference(s[0])&&s[0].indexOf(":")>-1){var S=s[0].indexOf(":");for(C=this.substring(s[0],S);!this.isDigit(C[b]);)b+=1}var w=this.substring(y,x),I=this.substring(C,b);if(f=h[u].split(w).join(I),n===this.trueValue)d+=1;else{v++;var E=this.getValueFromArg(f);d+=parseFloat(""===E?"0":E)}}return i===this.trueValue&&(d/=v),d},n.prototype.processNestedFormula=function(e,t,r){return e.split(t).join("n"+r)},n.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},n.prototype.fromOADate=function(e){var t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t},n.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;for(;t<1;)t+=12,e--;i=!0;for(var o=new Date(e,t,1,-1).getDate();r>o;)o=new Date(e,t,1,-1).getDate(),t++,r-=o,i=!1;r<1&&(--t<1&&(t=12,e--),r=(o=new Date(e,t,1,-1).getDate())+r)}var a=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+r.toString());return this.isNaN(a)||(n=this.toOADate(new Date(a))),n},n.prototype.intToTime=function(e){if(t.isNullOrUndefined(e))return"";var r=e.toString().split(".");t.isNullOrUndefined(r[1])||(e=parseFloat(r[0]+1+"."+r[1])||e);var n=this.intToDate(e.toString());return(new t.Internationalization).formatDate(n,{type:"time",skeleton:"medium",format:"h:mm:ss a"})},n.prototype.toOADate=function(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay},n.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},n.prototype.isTextEmpty=function(e){return null===e||""===e},n.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},n.prototype.findLastIndexOfq=function(e){return e.lastIndexOf("q")},n.prototype.getValueFromArg=function(r,n){var i=r=r.trim(),o=this.dateTime1900,a=i;if(t.isNullOrUndefined(i)||this.isTextEmpty(i))return i;if(r[0]===this.tic||r[0]===this.singleTic)return o=this.isDate(r.split(this.tic).join("")),this.isNaN(this.parseFloat(r.split(this.tic).join("")))&&!t.isNullOrUndefined(o)&&!this.isNaN(o.getDate())&&this.dateTime1900<=o?this.toOADate(o).toString():r;if(r=r.split("u").join("-"),!this.isUpperChar(i[0])&&(this.isDigit(i[0])||i[0]===this.getParseDecimalSeparator()||"-"===i[0]||"n"===i[0]))return"n"===i[0]&&(i=i.substring(1)).indexOf('"n')>-1&&(i=i.replace('"n','"')),i;if(-1===this.parser.indexOfAny(i,["+","-","/","*",")",")","{"])&&this.isUpperChar(i[0])||i[0]===this.sheetToken){if(i!==this.trueValue&&i!==this.falseValue&&this.isCellReference(i)){var s=this.getSheetFamilyItem(this.grid);if(null!==s.sheetNameToParentObject&&s.sheetNameToParentObject.size>0&&-1===i.indexOf(this.sheetToken)){i=s.parentObjectToToken.get(this.grid)+i}}if(i===this.cell){var l=this.getDependentCells().get(i);if(null!=l&&l.indexOf(i)>-1&&this.arrayRemove(l,i),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!n)throw this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference]+i}return a=this.getParentObjectCellValue(i,!1,n),this.updateDependentCell(i),a.toString()}return this.getErrorStrings().indexOf(r)>-1?r:this.computeValue(a.toString(),!1)},n.prototype.isDate=function(e){if("object"==typeof e||null!==Date.parse(e)){var t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null},n.prototype.isValidCellReference=function(e){var r=0,n=0,i=[89,71,69],o=this.emptyString;if(this.namedRanges.has(e))return!1;for(var a=0;a<e.length;a++)this.isChar(e[a])&&r++;if((o=e.substring(0,r)).length<4){for(;n<o.length;){if(t.isNullOrUndefined(o[n])||!(o[n].charCodeAt(0)<i[n])){if(t.isNullOrUndefined(o[n])&&n>0)break;return!1}n++}if(this.parseFloat(e.substring(r,e.length))<1048576)return!0}return!1},n.prototype.parseDate=function(t){if(!this.isNaN(t)){if(t instanceof Date)return new Date(t);var r=parseInt(t,10);return r<0?this.getErrorStrings()[e.CommonErrors.num]:r<=60?new Date(this.dateTime1900.getTime()+864e5*(r-1)):new Date(this.dateTime1900.getTime()+864e5*(r-2))}return"string"!=typeof t||(t=new Date(t),this.isNaN(t))?this.getErrorStrings()[e.CommonErrors.value]:t},n.prototype.isCellReference=function(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var o=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),a=0;a<o.length;a++)if(this.isChar(o[a]))n=!0;else if(this.isDigit(o[a]))i=!0;else{if(":"!==o[a])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i)||!(!(n&&!i||!n&&i)||r):!(!n||!i||-1!==e.indexOf(this.tic))},n.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var o=this.singleTic+"SHEET"+r[n]+this.singleTic+this.sheetToken;-1===e.indexOf(o)&&(o="SHEET"+r[n]+this.sheetToken),e=e.split(o).join(i),o=r[n]+this.sheetToken,e=e.split(o).join(i)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var a=(e=e.replace("!!","!")).split("");a[1]=(parseInt(a[1],10)+1).toString(),e=a.join("")}return e},n.prototype.getParentObjectCellValue=function(t,r,n){if(t===this.trueValue||t===this.falseValue)return t;var i=t.lastIndexOf(this.sheetToken),o=0,a=0,s=this.grid,l=this.getSheetFamilyItem(s);if(i>-1&&null!==l.tokenToParentObject)this.grid=l.tokenToParentObject.get(t.substring(0,i+1)),o=this.rowIndex(t),a=this.colIndex(t);else if(-1===i){for(var h=0;h<t.length&&this.isChar(t[h]);)h++;if(h===t.length)return""===(t=t.toLowerCase())?this.getErrorStrings()[e.CommonErrors.value]:this.getErrorStrings()[e.CommonErrors.name];o=this.rowIndex(t),a=this.colIndex(t),l.isSheetMember&&null!=l.parentObjectToToken&&(t=l.parentObjectToToken.get(this.grid)+t)}var d=""===this.cell||null===this.cell?"":this.cell;if(this.cell=t,d===this.cell&&!n)throw this.formulaErrorStrings[e.FormulasErrorsStrings.circular_reference];var p=this.getParentCellValue(o,a,this.grid,d,s,r,n);return this.grid=s,this.cell=d,p},n.prototype.getParentCellValue=function(e,r,n,i,o,a,s){var l,h=this.getSheetId(n);return void 0!==this.parentObject.getValueRowCol?(i&&(i=o===n?"":i+","+(o&&"string"==typeof o&&Number(o)>-1?o:this.getSheetID(o))),l=this.parentObject.getValueRowCol(h,e,r,i,a,s),t.isNullOrUndefined(l)?this.emptyString:l.toString()):(""!==(l=this.getValueRowCol(h,e,r))&&void 0!==l||(l=""),l)},n.prototype.getSheetId=function(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1},n.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var o=this.parseFloat(i.substring(0,i.length-1));this.isNaN(o)&&(i=(Number(o)/100).toString())}return i},n.prototype.defineFunction=function(e,r,n){"string"==typeof r&&(r=t.getValue(r,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:r,isCustom:!0,description:n})},n.prototype.valueChanged=function(e,r,n,i,o,a){var s=e;this.spreadSheetUsedRange=i,this.grid=e;var l=!0,h=!0,d=this.getSheetFamilyItem(s),p=q(r.getColIndex())+r.getRowIndex().toString();if(this.actCell=a+"!"+p,null!==d.sheetNameToParentObject&&d.sheetNameToParentObject.size>0){p=d.parentObjectToToken.get(s)+p}var c=r.getValue().toUpperCase();if(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(p)){var u=this.randCollection.toString();this.randomValues.has(p)?this.randomValues.has(p)&&(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(p,r.getValue()):r.getValue().toUpperCase()!==this.randomValues.get(p.toUpperCase())&&(this.randomValues.delete(p),u=u.split(p+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+p).join("").split(p).join(""),this.randCollection=u.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(p,r.getValue()),this.randCollection.push(p),this.isRandomVal=!0)}if(r.getValue()&&r.getValue()[0]===this.getFormulaCharacter()){this.cell=p;var f=void 0;if(t.isNullOrUndefined(h)||(h=n),this.getFormulaInfoTable().has(p)){if(f=this.getFormulaInfoTable().get(p),r.getValue()!==f.getFormulaText()||null==f.getParsedFormula()){f.setFormulaText(r.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{f.setParsedFormula(this.parser.parseFormula(r.getValue()))}catch(e){f.setFormulaValue(e),h=!1}}if(h){this.parser.isFormulaParsed=!0;var g=this.calculateFormula(f.getParsedFormula(),o);l=g!==f.getFormulaValue(),f.setFormulaValue(g)}}else{(f=new li).setFormulaText(r.getValue()),this.getDependentFormulaCells().has(p)||this.getDependentFormulaCells().set(p,new Map);try{f.setParsedFormula(this.parser.parseFormula(r.getValue()))}catch(e){f.setFormulaValue(e),h=!1}h&&f.setFormulaValue(this.calculateFormula(f.getParsedFormula(),o)),this.getFormulaInfoTable().has(p),this.getFormulaInfoTable().set(p,f)}h&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(s)+1,f.getFormulaValue(),r.getRowIndex(),r.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(s),f.getFormulaValue(),r.getRowIndex(),r.getColIndex(),f.getFormulaText()))}else this.getFormulaInfoTable().has(p)&&(this.getFormulaInfoTable().delete(p),this.getDependentFormulaCells().has(p)&&this.clearFormulaDependentCells(p));h&&l&&this.getDependentCells().has(p)&&this.getDependentCells().get(p).toString()!==p&&this.refresh(p)},n.prototype.setValueRowCol=function(e,t,r,n){},n.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach(function(e,r){t.push(r),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames},n.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},n.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},n.prototype.computeMinMax=function(r,n){var i,o,a=0;if(t.isNullOrUndefined(r)||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.wrong_number_arguments];for(var s=0,l=r.length;s<l;s++)if(r[s].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[e.CommonErrors.value];i="max"===n?this.minValue:this.maxValue;var h=r;if(h.length>255)return this.getErrorStrings()[e.CommonErrors.value];for(var d=0;d<h.length;d++)if(h[d].indexOf(":")>-1&&this.isCellReference(h[d]))for(var p=this.getCellCollection(h[d]),c=0;c<p.length;c++){if(o=this.getValueFromArg(p[c]),this.getErrorStrings().indexOf(o)>-1)return o;var u=this.parseFloat(o);""===o||this.isNaN(this.parseFloat(u))?(a+=1)===p.length&&(i=0):i="max"===n?Math.max(i,u):Math.min(i,u)}else{var f=this.getValueFromArg(h[d])||"0";if(this.getErrorStrings().indexOf(f)>-1)return f;u=this.isNaN(this.parseFloat(f))?0:this.parseFloat(f);i="max"===n?Math.max(i,u):Math.min(i,u)}return i.toString()},n.prototype.calculateAvg=function(r){for(var n=0,i=r,o=[],a=0,s=0,l=0;l<i.length;l++)if(i[l].indexOf(":")>-1&&this.isCellReference(i[l])){s=0,o=this.getCellCollection(i[l]),a=0;for(var h=0;h<o.length;h++){var d=this.getValueFromArg(o[h]);t.isNullOrUndefined(d)||isNaN(this.parseFloat(d))||(a+=this.parseFloat(d),s+=1)}if(0===s)return this.getErrorStrings()[e.CommonErrors.divzero];n=(a/=s)+n}else{if(i[l].indexOf(this.tic)>-1&&isNaN(parseFloat(i[l].split(this.tic).join(""))))return this.getErrorStrings()[e.CommonErrors.value];0===i[l].length&&(i[l]="1");d=this.getValueFromArg(i[l].split(this.tic).join(""));if(t.isNullOrUndefined(d)||isNaN(this.parseFloat(d)))return this.getErrorStrings()[e.CommonErrors.name];n+=this.parseFloat(d)}return(n/(i.length-0)).toString()},n.prototype.registerGridAsSheet=function(e,r,n){t.isNullOrUndefined(this.modelToSheetID)&&(this.modelToSheetID=new Map),t.isNullOrUndefined(this.modelToSheetID.get(r))&&this.modelToSheetID.set(r,n);var i=this.getSheetFamilyItem(r);i.isSheetMember=!0;var o=e.toUpperCase();if(0===i.parentObjectToToken.size&&(i.parentObjectToToken=new Map),0===i.sheetNameToParentObject.size&&(i.sheetNameToParentObject=new Map),0===i.sheetNameToToken.size&&(i.sheetNameToToken=new Map),0===i.tokenToParentObject.size&&(i.tokenToParentObject=new Map),t.isUndefined(i.sheetNameToParentObject.get(o))){a=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,i.tokenToParentObject.set(a,r),i.parentObjectToToken.set(r,a),i.sheetNameToToken.set(o,a),i.sheetNameToParentObject.set(o,r)}else{var a=i.sheetNameToToken.get(o);i.tokenToParentObject.set(a,r),i.parentObjectToToken.set(r,a)}return e},n.prototype.unregisterGridAsSheet=function(e,r,n){var i=this,o=[r];n&&(o=[],t.isNullOrUndefined(this.modelToSheetID)||this.modelToSheetID.forEach(function(e,t){o.push(t)})),o.forEach(function(t){var r=i.getSheetFamilyItem(t),o=(n?t:e).toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(o)){r.sheetNameToParentObject.delete(o);var a=r.sheetNameToToken.get(o);r.sheetNameToToken.delete(o),r.tokenToParentObject.delete(a),r.parentObjectToToken.delete(t)}})},n.prototype.computeExpression=function(e){var t=this.parser.parseFormula(e);return this.computeFormula(t)},n.prototype.isSheetMember=function(){var e=this.getSheetFamilyItem(this.grid);return!t.isNullOrUndefined(e)&&e.isSheetMember},n.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},n.prototype.refreshRandValues=function(e){var t,r,n,i,o="",a=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),a=a.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===a?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=a.split(this.parseArgumentSeparator));for(var s=0;s<this.randomValues.size;s++)t=this.rowIndex(this.randCollection[s]),r=this.colIndex(this.randCollection[s]),o=(parseFloat(this.getSheetToken(this.randCollection[s]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(o),this.grid=i.sheetNameToParentObject.get(o),n=this.randomValues.get(this.randCollection[s]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,r)},n.prototype.refresh=function(e,t){if(this.getDependentCells().has(e)){var r=this.getSheetFamilyItem(this.grid);try{var n=this.getDependentCells().get(e),i=void 0;for(i=0;i<n.length;i++){var o=n[i];if(!(t&&o.indexOf(t)>-1||o===e)){var a=this.getSheetToken(o);if(a.length){this.grid=r.tokenToParentObject.get(a);var s=Number(this.grid),l=this.parentObject.sheets,h="";if(!this.isNaN(s)&&l)for(var d=0;d<l.length;d++)l[d].id===s&&(h=l[d].name);this.actCell=h+"!"+o.split(a)[1]}else this.actCell=o.split(a)[1];try{var p=this.rowIndex(o),c=this.colIndex(o),u=this.getFormulaInfoTable().get(o),f=void 0;u&&(this.cell=o,this.parser.isFormulaParsed=!0,f=this.calculateFormula(u.getParsedFormula(),!0),u.setFormulaValue(f)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,u.getFormulaValue(),p,c):this.parentObject.setValueRowCol(this.getSheetId(this.grid),u.getFormulaValue(),p,c,u.getFormulaText()),this.refresh(o)}catch(e){continue}}}}finally{this.grid=r.tokenToParentObject.get(this.getSheetToken(e))}}};var i;return oi([t.Property(!0)],n.prototype,"includeBasicFormulas",void 0),oi([t.Event()],n.prototype,"onFailure",void 0),n=i=oi([t.NotifyPropertyChanges],n)}(t.Base),si=function(){return function(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t}}(),li=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),hi=function(){return function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}}(),di=function(){return function(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getValue=function(){return r},this}}(),pi=function(){function r(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return r.prototype.init=function(){this.addEventListener(),this.initCalculate(),this.registerSheet()},r.prototype.destroy=function(){this.removeEventListener(),this.parent.refreshing&&this.clearAllUniqueFormulaValue(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null},r.prototype.addEventListener=function(){this.parent.on(pr,this.performFormulaOperation,this),this.parent.on(xr,this.aggregateComputation,this),this.parent.on(br,this.getUniqueRange,this),this.parent.on(Sr,this.removeUniquecol,this),this.parent.on(Er,this.clearFormulaDependentCells,this),this.parent.on(Rr,this.formulaInValidation,this),this.parent.on(Gn,this.refreshInsertDelete,this),this.parent.on(Yn,this.getUpdatedFormulaOnInsertDelete,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(pr,this.performFormulaOperation),this.parent.off(xr,this.aggregateComputation),this.parent.off(br,this.getUniqueRange),this.parent.off(Sr,this.removeUniquecol),this.parent.off(Er,this.clearFormulaDependentCells),this.parent.off(Rr,this.formulaInValidation),this.parent.off(Gn,this.refreshInsertDelete),this.parent.off(Yn,this.getUpdatedFormulaOnInsertDelete))},r.prototype.getModuleName=function(){return"workbookFormula"},r.prototype.initCalculate=function(){this.calculateInstance=new ai(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()},r.prototype.clearFormulaDependentCells=function(e){if(e.isOpen)return this.calculateInstance.getDependentCells().clear(),void this.calculateInstance.getFormulaInfoTable().clear();var r=e.cellRef.split(":")[0],n=this.parent.getActiveSheet().id.toString(),i=this.calculateInstance.getSheetFamilyItem(n);i.isSheetMember&&!t.isNullOrUndefined(i.parentObjectToToken)&&(r=i.parentObjectToToken.get(n)+r),this.calculateInstance.clearFormulaDependentCells(r)},r.prototype.formulaInValidation=function(e){var r=this.calculateInstance.getLibraryFormulas().get(e.value);e.skip=t.isNullOrUndefined(r)},r.prototype.performFormulaOperation=function(e){var r,n,i=e.action;"refreshCalculate"!==i&&(r=this.calculateInstance.getLibraryFormulas(),n=Array.from(r.values()));var o;switch(i){case"getLibraryFormulas":e.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":o=["All"];for(var a=1;a<Array.from(r.values()).length;a++)o.indexOf(n[a].category)<0&&o.push(n[a].category);e.categoryCollection=o;break;case"dropDownSelectFormulas":for(a=0;a<Array.from(r.values()).length;a++)e.selectCategory===n[a].category&&(e.formulaCollection[a]=Array.from(r.keys())[a]);break;case"getFormulaDescription":for(a=0;a<Array.from(r.values()).length;a++)e.selectedList===Array.from(r.keys())[a]&&(e.description=n[a].description,e.isCustom=n[a].isCustom);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"initSheetInfo":this.updateSheetInfo();break;case"refreshCalculate":e.isFormula&&(e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex,e.sheetIndex),e.isClipboard&&e.value.toString().toUpperCase().includes("UNIQUE")&&(this.parent.sheets[e.sheetIndex].rows[e.rowIndex].cells[e.colIndex].value="")),e.isFormulaDependent=this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex,e.isRefreshing),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index,e.isEventTrigger);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope,e.isEventTrigger);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.pName);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.sheetId});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":for(a=0;a<this.sheetInfo.length;a++)if(this.sheetInfo[a].index===e.sheetId){var s=this.sheetInfo[a].sheet;this.sheetInfo.splice(a,1);var l=e.sheetId.toString();this.sheetDeletion(s,l),this.calculateInstance.unregisterGridAsSheet(l,l);break}break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=q(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName,e.formulaDescription);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"dependentCellsAvailable":case"checkFormulaAdded":var h=this.calculateInstance.getSheetFamilyItem(e.sheetId);h.isSheetMember&&!t.isNullOrUndefined(h.parentObjectToToken)&&(e.address=h.parentObjectToToken.get(e.sheetId)+e.address),"checkFormulaAdded"===i?e.added=this.calculateInstance.getFormulaInfoTable().has(e.address):e.isAvailable=this.calculateInstance.getDependentCells().has(e.address)}},r.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[e.CommonErrors.ref]},r.prototype.getSheetInfo=function(){return this.sheetInfo},r.prototype.addCustomFunction=function(e,t,r){this.calculateInstance.defineFunction(t,e,r)},r.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach(function(t){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:t.id})})},r.prototype.sheetDeletion=function(e,r){var n,i,o,a,s,l,h,d=this,p=this.calculateInstance.getDependentCells(),c=this.calculateInstance.getSheetFamilyItem(r);p.forEach(function(p,u){p.forEach(function(p){n=d.calculateInstance.getFormulaInfoTable().get(p),t.isNullOrUndefined(n)||(i=n.formulaText,l=e.toUpperCase(),i=i.toUpperCase(),(h=i.indexOf(l))>-1&&("'"===i[h-1]&&"'"===i[h+l.length]&&(l="'"+l+"'"),l+=d.calculateInstance.sheetToken,i=i.split(l).join(d.referenceError()),o=d.calculateInstance.rowIndex(p),a=d.calculateInstance.colIndex(p),s=p.slice(0,p.lastIndexOf(d.calculateInstance.sheetToken)+1),d.updateDataContainer([o-1,a-1],{value:i,visible:!1,sheetId:c.tokenToParentObject.has(s)?Number(c.tokenToParentObject.get(s)):parseInt(p.split("!")[1],10)+1}),d.calculateInstance.refresh(n.getParsedFormula()))),s=u.slice(0,u.lastIndexOf(d.calculateInstance.sheetToken)+1),r===(c.tokenToParentObject.has(s)?c.tokenToParentObject.get(s):u.split("!")[1])&&(d.calculateInstance.getFormulaInfoTable().delete(u),d.calculateInstance.clearFormulaDependentCells(u))})})},r.prototype.renameUpdation=function(e,t){var r,n,i=this,o=t.toUpperCase(),a=new RegExp("[!@#$%^&()+=';,.{}|\\\":<>~_-]","g"),s=new RegExp(t.replace(a,"\\$&")+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi");this.sheetInfo.forEach(function(a,l){for(var h=0,d=(r=i.parent.sheets[l]).usedRange.rowIndex;h<=d;h++)for(var p=0,c=r.usedRange.colIndex;p<=c;p++)(n=ke(h,p,r,!1,!0)).formula&&W(n.formula)&&n.formula.toUpperCase().includes(o)&&n.formula.match(s)&&(n.formula=n.formula.replace(s,e));a.visibleName===t&&(a.visibleName=e)})},r.prototype.updateDataContainer=function(e,t){for(var r,n,i,o=0,a=this.parent.sheets.length;o<a;o++)if(this.parent.sheets[o].id===t.sheetId){r=this.parent.sheets[o],e[0]in r.rows?(n=r.rows[e[0]],e[1]in n.cells?((i=n.cells[e[1]]).formula=t.value,t.visible?o===this.parent.activeSheetIndex&&r.activeCell===g(e[0],e[1])&&this.parent.notify(Wn,{}):i.value=this.referenceError()):n.cells[e[1]]=i={}):(n=r.rows[e[0]]={})[e[1]]=i={};break}},r.prototype.parseSheetRef=function(e){var t,r=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),n=0,i=this.parent.sheets.length,o=[];o.length=0;var a,s,l,h,d,p=this.getSheetInfo(),c='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(n=0;n<i;n++)if(p[n].sheet!==p[n].visibleName&&(t=new RegExp(p[n].visibleName.replace(r,"\\$&")+c,"gi"),l=n,e.match(t))){for(var u=n+1;u<i;u++)a=new RegExp(p[u].visibleName.replace(r,"\\$&")+c,"gi"),s=e.search(a),h=e.search(t),s>-1&&(s<h||s===h&&p[u].visibleName.length>p[n].visibleName.length)&&(d=new RegExp("Sheet","gi"),0!==p[u].visibleName.search(d)&&(t=a,l=u));e=e.replace(t,l+"/"),o.push(l)}for(n=0;n<o.length;)t=new RegExp(o[n]+"/"+c,"gi"),e=e.replace(t,p[o[n]].sheet),n++;return e},r.prototype.registerSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);for(var r;e<t;)r=be(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},r.prototype.unRegisterSheet=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);var n;if(this.calculateInstance.tokenCount=0,r)this.calculateInstance.unregisterGridAsSheet(n,n,r);else for(;e<t;)n=be(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(n,n),e++},r.prototype.getUniqueRange=function(e){e.range=this.calculateInstance.uniqueRange},r.prototype.removeUniquecol=function(e){if(e&&e.clearAll)this.clearAllUniqueFormulaValue();else for(var t=this.parent.getActiveSheet(),r=0;r<this.calculateInstance.uniqueRange.length;r++){var n=this.calculateInstance.uniqueRange[r].split(":")[0].split("!");if(n[0]===t.name&&n[1]===t.activeCell){var i=c(this.calculateInstance.uniqueRange[r]);this.calculateInstance.uniqueRange.splice(r,1);for(var o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++){ke(o,a,this.parent.getActiveSheet()).formula="",this.parent.updateCell({value:"",formula:""},m([o,a]))}}}},r.prototype.refreshCalculate=function(e,r,n,i,o,a){var s=t.isNullOrUndefined(o)?this.parent.getActiveSheet():be(this.parent,o),l=s.id+"",h=s.name,d=this.calculateInstance.getSheetFamilyItem(l),p=v(r+1)+(e+1);if(d.isSheetMember&&!t.isNullOrUndefined(d.parentObjectToToken)&&(p=d.parentObjectToToken.get(l)+p),i){n=this.parseSheetRef(n);var u=new di(e+1,r+1,n),f=[s.usedRange.rowIndex,s.usedRange.colIndex];this.calculateInstance.valueChanged(l,u,!0,f,a,h);var g=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var m=void 0,y=void 0,C="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===g.length)for(var x=0;x<this.calculateInstance.randomValues.size;x++){m=this.calculateInstance.rowIndex(g[x]),y=this.calculateInstance.colIndex(g[x]),C=this.calculateInstance.randomValues.get(g[x]),l=(parseFloat(this.calculateInstance.getSheetToken(g[x]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var b=new di(m,y,C);this.calculateInstance.valueChanged(l,b,!0)}}}else this.calculateInstance.getFormulaInfoTable().has(p)&&(this.calculateInstance.getFormulaInfoTable().delete(p),this.calculateInstance.clearFormulaDependentCells(p)),this.calculateInstance.refresh(p),this.calculateInstance.refreshRandValues(p);this.calculateInstance.cell="";var S=ke(e,r,this.parent.getActiveSheet());if(n&&n.toString().toUpperCase().startsWith("=DOLLAR(")&&S&&S.value&&S.value.startsWith("$")&&this.dollarFormulaDecimalHandler(S),S&&n&&0===n.toString().toUpperCase().indexOf("=SUM(")){var w=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","invalid arguments"],I=n.toString().toUpperCase().replace("=SUM","").replace("(","").replace(")","").split(":")[0];if(G(I)){var E=c(I),R=ke(E[0],E[1],this.parent.getActiveSheet());R&&R.value&&R.format&&w.indexOf(S.value)<0&&w.indexOf(R.value)<0&&(S.format=R.format)}}return this.calculateInstance.getDependentCells().has(p)},r.prototype.dollarFormulaDecimalHandler=function(e){for(var t=e.value.split(".")[1].length,r="",n=1;n<=t;n++)r+="0";e.format="$#,##."+r},r.prototype.autoCorrectFormula=function(e,r,n,i){if(!t.isNullOrUndefined(e)){2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")");var o=void 0;0===e.indexOf("=")&&(e=e.slice(1),o=!0);var a=e.match(/</g),s=e.match(/>/g),l=e.match(/=/g);if(a){for(var h="",d=0;d<a.length;d++)h+=a[d];e=e.replace(h,"<")}if(s){for(var p="",c=0;c<s.length;c++)p+=s[c];e=e.replace(p,">")}if(l){for(var u="",f=0;f<l.length;f++)u+=l[f];e=e.split(u).join("=")}e=o?"="+e:e,(a||s||l)&&(ke(r,n,t.isNullOrUndefined(i)?this.parent.getActiveSheet():be(this.parent,i)).formula=e)}return e},r.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var r=e[t],n=this.parseSheetRef(r.refersTo),i=C(n),o=!1,a=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if(i=i.split("$").join(""),(i=i.split("=").join("")).indexOf(":")>-1){var s=i.split(":");G(s[0])&&G(s[1])&&(o=!0)}else i.indexOf(":")<0&&G(i)&&(o=!0);a&&(o=!1),o?this.addDefinedName(r,!0,void 0,!0):(this.removeDefinedName(r.name,r.scope,!0),t--),t++}},r.prototype.addDefinedName=function(e,t,r,n){(void 0===r||r<-1)&&(r=this.parent.definedNames.length);var i,o=!0,a=e.name;if(e.refersTo.indexOf("!")<0){var s=Ee(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s,e.refersTo=s+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var l=e.refersTo,h=this.parseSheetRef(e.refersTo);e.scope?(i=fe(this.parent,e.scope))>-1&&(a=Ee(this.parent,i)+"!"+a):e.scope="",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?o=!1:(this.calculateInstance.addNamedRange(a,"="===h[0]?h.substr(1):h),"="!==h[0]&&(e.refersTo="="+l),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.splice(r,0,e));var d={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};return n||this.parent.notify("actionComplete",{eventArgs:d,action:"addDefinedName"}),o},r.prototype.removeDefinedName=function(e,t,r){var n=!1,i=this.getIndexFromNameColl(e,t);if(i>-1){var o=e;if(t){var a=fe(this.parent,t);a&&(o=Ee(this.parent,a)+"!"+e)}if(this.calculateInstance.removeNamedRange(o),this.parent.definedNames.splice(i,1),!r){var s={name:e,scope:t,cancel:!1};this.parent.notify("actionComplete",{eventArgs:s,action:"removeDefinedName"})}n=!0}return n},r.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some(function(r){return r.name===e&&(t?r.scope===t:""===r.scope)})},r.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter(function(n,i){n.name===e&&n.scope===t&&(r=i)}),r},r.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},r.prototype.aggregateComputation=function(e){var t=this.parent.getActiveSheet(),r=xe(t),n=c(r.split(":")[1]);n[0]+1===t.rowCount&&n[1]+1===t.colCount&&(r="A1:"+g(t.usedRange.rowIndex,t.usedRange.colIndex));var i,o,a=this.calculateInstance.getCellCollection(r);for(o=0;o<a.length;o++)if(i=this.calculateInstance.getValueFromArg(a[o]),N(i)){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(r),e.Count&&!e.countOnly){var s=["SUM","AVERAGE","MIN","MAX"],l=[],h=c(t.activeCell),d=ke(h[0],h[1],t,!1,!0);for(o=0;o<4;o++){if(i=this.toFixed(this.calculateInstance.getFunction(s[o])(r)),d.format){var p={formattedText:i,value:i,format:d.format,cell:{value:i,format:d.format},onLoad:!0,skipRowFill:!0};this.parent.notify(ir,p),i=p.formattedText}l.push(i)}e.Sum=l[0],e.Avg=l[1],e.Min=l[2],e.Max=l[3]}},r.prototype.refreshInsertDelete=function(e){var t,r=this,n=this.calculateInstance.getDependentFormulaCells(),i=ge(this.parent,e.sheet.id);this.parent.sheets.forEach(function(n,o){for(var a=0,s=n.usedRange.rowIndex;a<=s;a++)for(var l=0,h=n.usedRange.colIndex;l<=h;l++)(t=ke(a,l,n,!1,!0)).formula&&W(t.formula)&&(o===i?!e.isInsert&&("Row"===e.modelType?a>=e.startIndex&&a<=e.endIndex:l>=e.startIndex&&l<=e.endIndex)||r.updateFormula(e,t,a,l):t.formula.includes(e.sheet.name)&&r.updateFormula(e,t,a,l,!0,n))}),n.clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),this.refreshNamedRange(e)},r.prototype.getUpdatedFormulaOnInsertDelete=function(e){this.updateFormula(e.insertDeleteArgs,e.cell,e.row,e.col)},r.prototype.updateFormula=function(t,r,n,i,o,a){var s,l,h,d,p;r.formula&&r.formula.includes("UNIQUE")&&this.clearUniqueRange(n,i,a||t.sheet);for(var u=function(){return h[0]===h[2]&&h[1]===h[3]?g(h[0],h[1]):m(h)},f=this.parseFormula(r.formula,!0),v=0;v<f.length;v++)if(s=f[v].trim().replace(/[$]/g,""),this.calculateInstance.isCellReference(s)){if((l=v&&f[v-1].trim())&&"!"===l[l.length-1]){if((l=l.replace(/['!]/g,""))!==t.sheet.name)continue}else if(o)continue;h=c(s),d=this.parent.updateRangeOnInsertDelete(t,h),p=w(h),d&&(f[v]=p[2]<p[0]||p[3]<p[1]?this.calculateInstance.getErrorStrings()[e.CommonErrors.ref]:u())}var y="="+f.join("");r.formula!==y&&(r.formula=y,r.value=null)},r.prototype.clearUniqueRange=function(e,t,r){var n={cellIdx:[e,t,e,t],isUnique:!1,uniqueRange:"",sheetName:r.name};this.parent.notify(wr,n);for(var i=c(n.uniqueRange),o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++)delete ke(o,a,r,!1,!0).value},r.prototype.clearAllUniqueFormulaValue=function(){for(var e,t,r,n,i=this.calculateInstance.uniqueRange,o=0;o<i.length;o++)if(e=i[o].split("!"),r=be(this.parent,fe(this.parent,e[0])),n=c(e[1]),!(t=ke(n[0],n[1],r))||"#SPILL!"!==t.value)for(var a=n[0];a<=n[2];a++)for(var s=n[1];s<=n[3];s++)(t=ke(a,s,r))&&t.value&&delete t.value},r.prototype.parseFormula=function(e,t){var r,n,i=0,o=[],a=[];a=this.markSpecialChar(e.replace("=",""),t);for(var s=(a=t?a.split(/\(|\)|=|\^|>|<|,|\+|-|\*|\/|%|&/g):a.split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;i<s;)(r=a[i])?(1===r.length?o.push(this.isUniqueChar(r)?this.getUniqueCharVal(r):r):(n=r[0],r.indexOf("!")>0?(this.isUniqueChar(n)&&(o.push(this.getUniqueCharVal(n)),r=r.substr(1)),n=r.indexOf("!")+1,o.push(r.substr(0,n)),o.push(r.substr(n))):this.isUniqueChar(n)?(o.push(this.getUniqueCharVal(n)),o.push(r.substr(1))):o.push(r)),i++):i++;return o},r.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},r.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},r.prototype.markSpecialChar=function(e,t){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=t?e.replace(/,/g,","+this.uniqueCSeparator):e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},r.prototype.refreshNamedRange=function(e){var t=this;if(e.definedNames&&e.definedNames.length)e.definedNames.forEach(function(e){t.parent.removeDefinedName(e.name,e.scope),t.parent.addDefinedName(e)});else{var r=this.parent.definedNames.length;if(r)for(var n,i,o,a,s,l=Object.assign({},this.parent.definedNames),h=0;h<r;h++)(i=(o=(a=l[h]).refersTo.split("!"))[0].split("=")[1])===e.sheet.name&&(n=c(o[1]),s=this.parent.updateRangeOnInsertDelete(e,n),e.isInsert?this.updateDefinedNames(a,i,n,s):"Row"===e.modelType?this.updateDefinedNames(a,i,n,s,[n[0],n[2]],e):"Column"===e.modelType&&this.updateDefinedNames(a,i,n,s,[n[1],n[3]],e))}},r.prototype.updateDefinedNames=function(e,t,r,n,i,o){if(n){var a=this.parent.definedNames.indexOf(e),s={action:"removeDefinedName",isRemoved:!1,definedName:e.name,scope:e.scope,isEventTrigger:!0};if(this.parent.notify(pr,s),i){var l={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(l=new Ls(this.parent,"definedNames",l,!0),o.definedNames?o.definedNames.push(l):o.definedNames=[l],i[1]<i[0])return}e.refersTo=t+"!"+m(r),this.parent.notify(pr,{action:"addDefinedName",definedName:e,isAdded:!1,index:a,isEventTrigger:!0});var h={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};this.parent.notify("actionComplete",{eventArgs:h,action:"refreshNamedRange"})}},r}(),ci=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Ar,this.initiateSortHandler,this),this.parent.on(kr,this.updateSortedDataOnCell,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ar,this.initiateSortHandler),this.parent.off(kr,this.updateSortedDataOnCell))},e.prototype.initiateSortHandler=function(e){var n=this,i=e.args,o=new r.Deferred,a=this.parent.getAddressInfo(i.range),s=be(this.parent,a.sheetIndex),l=w(a.indices),h=i.sortOptions||{sortDescriptors:{},containsHeader:!0},d=!1;if(e.promise=o.promise,l[0]>s.usedRange.rowIndex||l[1]>s.usedRange.colIndex)o.reject(this.parent.serviceLocator.getService(Ws).getConstant("SortOutOfRangeError"));else{var p=h.containsHeader,c=i.checkForHeader;if((l[0]===l[2]||c)&&(c||(l=ae(l[0],l[1],s)),d=!0,t.isNullOrUndefined(h.containsHeader)&&(p=typeof ke(l[0],l[1],s,null,!0).value!=typeof ke(l[0]+1,l[1],s,null,!0).value||!this.isSameStyle(ke(l[0],l[1],s,null,!0).style,ke(l[0]+1,l[1],s,null,!0).style))),(t.isNullOrUndefined(i.sortOptions)||t.isNullOrUndefined(i.sortOptions.containsHeader))&&!d){var f=ke(l[0],l[1],s),g=ke(l[0]+1,l[1],s);f&&g&&(p=typeof f.value!=typeof g.value||!this.isSameStyle(f.style,g.style))}l[0]=p?l[0]+1:l[0];var y=v(u(s.activeCell)[1]+1);delete h.containsHeader;var C=h.sortDescriptors,x=m(l);pe(this.parent,s.name+"!"+x,!0,null,null,null,null,null,void 0,null,l[1]).then(function(t){var a=new r.DataManager(t),d=new r.Query;if(Array.isArray(C)){C&&0!==C.length||(C=[{field:y}]);for(var p=C.length,c=p-1;c>-1;c--)if(C[p-1].field||(C[p-1].field=y),C[c].field){var u=C[c].sortComparer||n.sortComparer.bind(n,C[c],h.caseSensitive);d.sortBy(C[c].field,u)}}else{C||(C={field:y}),C.field||(C.field=y);u=C.sortComparer||n.sortComparer.bind(n,C,h.caseSensitive);d.sortBy(C.field,u)}a.executeQuery(d).then(function(r){n.parent.notify("setActionData",{args:{action:"beforeSort",eventArgs:{range:x,cellDetails:t,sortedCellDetails:r.result}}}),n.updateSortedDataOnCell({result:r.result,range:l,sheet:s,jsonData:t});var a={range:s.name+"!"+x,sortOptions:i.sortOptions};e.previousSort&&(a.previousSort=e.previousSort),o.resolve(a)})})}},e.prototype.updateSortedDataOnCell=function(e){for(var r,n,i=this,o=[],a=function(n,a){for(var s=e.range[1],l=0;s<=e.range[3];s++,l++){if(o[l]||(o[l]=v(s+1)),a[o[l]])r=t.extend({},a[o[l]],null,!0);else{if(!ke(n,s,e.sheet))continue;r=null}(r=i.skipBorderOnSorting(n,s,e.sheet,r))&&r.formula&&(r.formula=ie([n,s],[parseInt(a.__rowIndex,10)-1,s],e.sheet,r,i.parent,!0)),Fe(n,s,e.sheet,r)}},s=e.isUndo&&{},l=e.range[0],h=0;l<=e.range[2];l++,h++)if(He(e.sheet,l))h--;else if(e.isUndo){if(e.result[h]&&(n=parseInt(e.result[h].__rowIndex,10)-1,s[n]=!0,a(n,e.result[h]),l===n))continue;!s[l]&&e.sheet.rows[l]&&a(l,{})}else a(l,e.result[h]||{})},e.prototype.skipBorderOnSorting=function(e,t,r,n){var i=ke(e,t,r),o=["borderBottom","borderTop","borderRight","borderLeft","border"];if(n&&n.style)for(var a=0,s=o;a<s.length;a++){var l=s[a];delete n.style[l]}if(i&&i.style)for(var h=0,d=o;h<d.length;h++){l=d[h];i.style[l]&&(n||(n={}),n.style||(n.style={}),n.style[l]=i.style[l])}return n},e.prototype.isSameStyle=function(e,t){e||(e={}),t||(t={});for(var r=!0,n=Object.keys(e),i=0;i<n.length;i++){if(e[n[i]]!==t[n[i]]&&this.parent.cellStyle[n[i]]!==e[n[i]]){r=!1;break}r=!0}return r},e.prototype.sortComparer=function(e,n,i,o){var a=e.order||"",s=r.DataUtil.fnSort(a),l=!1;if(i&&o&&("string"==typeof i.value||"string"==typeof o.value)&&""!==i.value&&""!==o.value&&(N(i.value)&&(i.value=O(i.value)),N(o.value)&&(o.value=O(o.value),l=!0),!l&&!l)){var h={sensitivity:n?"case":"base"},d=new Intl.Collator(this.parent.locale,h);return a&&"ascending"!==a.toLowerCase()?-1*d.compare(i.value,o.value):d.compare(i.value,o.value)}var p=t.isNullOrUndefined(i)||i&&(t.isNullOrUndefined(i.value)||""===i.value),c=t.isNullOrUndefined(o)||o&&(t.isNullOrUndefined(o.value)||""===o.value);return p&&c?-1:p?1:c?-1:s(i?i.value:i,o?o.value:o)},e.prototype.getModuleName=function(){return"workbookSort"},e}(),ui=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Mr,this.initiateFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Mr,this.initiateFilterHandler)},e.prototype.initiateFilterHandler=function(e){var t=this,n=e.args,i=new r.Deferred,o=be(this.parent,S(this.parent,n.range)),a=n.filterOptions||{};if(e.promise=i.promise,a.datasource){this.setFilter(a.datasource,a.predicates,n.range,e.refresh);var s={range:n.range,filterOptions:a};i.resolve(s)}else{var l=w(y(n.range));if(l[0]>o.usedRange.rowIndex||l[1]>o.usedRange.colIndex)return void i.reject("Select a cell or range inside the used range and try again.");l[0]===l[2]&&l[2]-l[0]==0&&(l[0]=0,l[1]=0,l[3]=o.usedRange.colIndex),l[2]=o.usedRange.rowIndex,l[0]=l[0]+1;var h=m(l);pe(this.parent,o.name+"!"+h,!0,!0,null,null,null,null,!1).then(function(o){var s=new r.DataManager(o);t.setFilter(s,a.predicates,n.range,e.refresh);var l={range:h,filterOptions:a};i.resolve(l)})}},e.prototype.setFilter=function(e,t,n,i){var o=this;if(e&&t){var a=e.dataSource.json,s=new r.Query;t.length&&s.where(r.Predicate.and(t));var l,h,d=e.executeLocal(s),p="__rowIndex";if(n.indexOf("!")>-1?(h=fe(this.parent,n.split("!")[0]),l=this.parent.sheets[h]):(l=this.parent.getActiveSheet(),h=fe(this.parent,l.name)),"spreadsheet"===this.parent.getModuleName()){var u,f,g=this.parent;if(g.scrollSettings.enableVirtualization&&a.length>g.viewport.rowCount+2*g.getThreshold("row")||l.frozenRows||l.frozenColumns||i){a.forEach(function(e){u=d.indexOf(e)<0,Pe(l,Number(e[p])-1,{hidden:u,isFiltered:u})}),f=h===g.activeSheetIndex;var m=c(l.paneTopLeftCell);this.parent.updateTopLeftCell(re(l,m[0],!0)-this.parent.frozenRowCount(l),null,"col")}else a.forEach(function(e){if(u=d.indexOf(e)<0,f)Pe(l,Number(e[p])-1,{hidden:u,isFiltered:u});else{var t={startIndex:Number(e[p])-1,hide:u,isFiltering:!0,sheetIndex:h};t.endIndex=t.startIndex,o.parent.notify(gn,t),f=t.refreshUI}});f&&g.renderModule.refreshSheet(!1,!1,!0)}else{var v;a.forEach(function(e){v=d.indexOf(e)<0,Pe(l,Number(e[p])-1,{hidden:v,isFiltered:v})})}}},e.prototype.getModuleName=function(){return"workbookFilter"},e}(),fi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.setImage=function(e){var r,n=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?fe(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,o=c(n),a=t.isUndefined(i)?this.parent.getActiveSheet():this.parent.sheets[i],s=ke(o[0],o[1],a),l=e.options;if(s&&s.image){r=s.image;for(var h=0;h<l.length;h++)r.push(l[h])}Fe(o[0],o[1],a,{image:s&&s.image?r:l},!0)},e.prototype.addEventListener=function(){this.parent.on(bn,this.setImage,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(bn,this.setImage)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookImage"},e}(),gi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Sn,this.setChartHandler,this),this.parent.on(En,this.refreshChartData,this),this.parent.on(kn,this.deleteChartColl,this),this.parent.on(Rn,this.refreshChartSize,this),this.parent.on(Fn,this.focusChartBorder,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Sn,this.setChartHandler),this.parent.off(En,this.refreshChartData),this.parent.off(kn,this.deleteChartColl),this.parent.off(Rn,this.refreshChartSize),this.parent.off(Fn,this.focusChartBorder))},e.prototype.setChartHandler=function(e){var r=0;e.isInitCell=!t.isNullOrUndefined(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!t.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!t.isNullOrUndefined(e.isPaste)&&e.isPaste;var n=e.chart;if(n.length>0)for(;r<n.length;){if(!1===e.isCut&&document.getElementById(e.chart[r].id)&&(n[r]={range:n[r].range,id:t.getUniqueID("e_spreadsheet_chart"),isSeriesInRows:n[r].isSeriesInRows,theme:n[r].theme,type:n[r].type}),document.getElementById(e.chart[r].id))return;if(n[r].theme=n[r].theme||"Material",n[r].type=n[r].type||"Line",n[r].isSeriesInRows=n[r].isSeriesInRows||!1,n[r].range=n[r].range||this.parent.getActiveSheet().selectedRange,n[r].range.indexOf("!")<0&&(n[r].range=this.parent.getActiveSheet().name+"!"+n[r].range),t.isNullOrUndefined(n[r].id)&&(n[r].id=t.getUniqueID("e_spreadsheet_chart")),n[r].height=n[r].height||290,n[r].width=n[r].width||480,this.parent.notify(wn,{option:n[r],isInitCell:e.isInitCell,triggerEvent:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(n[r]),!e.isInitCell||e.isPaste){var i=n[r].range&&n[r].range.indexOf("!")>0?fe(this.parent,n[r].range.split("!")[0]):this.parent.activeSheetIndex,o=e.isPaste?c(e.range):c(n[r].range),a=t.isUndefined(i)?this.parent.getActiveSheet():this.parent.sheets[i],s=ke(o[0],o[1],a);s&&s.chart?s.chart.push(n[r]):Fe(o[0],o[1],a,{chart:[n[r]]},!0)}r++}},e.prototype.refreshChartData=function(e){if(this.parent.chartColl&&this.parent.chartColl.length)for(var t,r,n,i=0,o=this.parent.chartColl.length;i<o;i++){if((t=this.parent.chartColl[i]).range.includes("!")){if(r=t.range.split("!"),this.parent.activeSheetIndex!==fe(this.parent,r[0]))continue;n=r[1]}else n=t.range;(e.range?de([e.range],n):e.showHide?this.inRowColumnRange(c(n),e.rIdx,e.showHide):$(c(n),e.rIdx,e.cIdx))&&this.parent.notify(An,{chart:t})}},e.prototype.inRowColumnRange=function(e,t,r){return"rows"===r?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]},e.prototype.refreshChartSize=function(e){for(var r,n=1,i=this.parent.sheets.length+1;n<i;){var o=this.parent.chartColl;if(r=o?o.length:0)for(;r--;){var a=this.parent.chartColl[r];if(!t.isNullOrUndefined(e.overlayEle.querySelector("#"+a.id))){var s=this.parent.element.querySelector("."+a.id),l=t.getComponent(s,"chart");l&&(l.height=e.height,l.width=e.width)}}n++}},e.prototype.focusChartBorder=function(e){for(var r=0;r<this.parent.chartColl.length;r++){var n=document.getElementById(e.id),i=document.getElementById(this.parent.chartColl[r].id);n&&i&&t.closest(i,"."+n.classList[1])===n&&this.parent.notify(wn,{option:this.parent.chartColl[r],isRefresh:!0})}},e.prototype.deleteChartColl=function(e){for(var t=0;t<this.parent.chartColl.length;t++)this.parent.chartColl[t].id+"_overlay"===e.id&&this.parent.chartColl.splice(t,1)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookChart"},e}(),mi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var t,r=this,n=e.range;n&&"string"==typeof n&&n.indexOf("!")>-1?(n=n.split("!")[1],t=this.parent.sheets[fe(this.parent,e.range.split("!")[0])]):t=this.parent.getActiveSheet(),void 0===n&&(n=t.selectedRange);var i="object"!=typeof n&&e.onActionUpdate,o={range:n,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(o.borderType=e.borderType);var a={};if(Object.assign(a,o.style,null,!0),i&&(this.parent.trigger("beforeCellFormat",o),this.parent.notify("actionBegin",{eventArgs:o,action:"format"}),o.cancel))e.cancel=!0;else{var s="object"==typeof o.range?o.range:w(c(o.range));e.borderType&&(this.setTypedBorder(t,e.style.border,s,e.borderType,e.onActionUpdate),delete e.style.border,delete o.style.border);var l,h,d={cell:null,rowIdx:0,colIdx:0,eventOnly:!0,preventEvt:!i},p=function(e){return d.cell={style:e},d.rowIdx=l,d.colIdx=h,oe(r.parent,t,d)};if(void 0!==o.style.borderTop){for(h=s[1];h<=s[3];h++)l=s[0],p({borderTop:o.style.borderTop})||(this.checkAdjacentBorder(t,"borderBottom",l-1,h),this.checkFullBorder(t,"borderBottom",l-1,h),this.checkFullBorder(t,"borderTop",l,h),this.setCellBorder(t,d.cell.style,l,h,e.onActionUpdate,h===s[3]));delete o.style.borderTop}if(void 0!==o.style.borderBottom){var u=void 0,f=void 0;for(h=s[1];h<=s[3];h++)f=(u=ke(l=s[0],h,t,!1,!0)).rowSpan>0?ke(s[2],s[1],t,!1,!0):ke(s[2],s[3],t,!1,!0),u.rowSpan>1&&f.rowSpan<0||(l=s[2]),p({borderBottom:o.style.borderBottom})||(this.checkAdjacentBorder(t,"borderTop",s[2]+1,h),this.checkFullBorder(t,"borderTop",s[2]+1,h),this.checkFullBorder(t,"borderBottom",s[2],h),this.setCellBorder(t,d.cell.style,l,h,e.onActionUpdate,h===s[3]),this.setBottomBorderPriority(t,s[2],h));delete o.style.borderBottom}if(void 0!==o.style.borderLeft){for(var g=s[0];g<=s[2];g++)h=s[1],p({borderLeft:o.style.borderLeft})||(this.checkAdjacentBorder(t,"borderRight",g,h-1),this.checkFullBorder(t,"borderRight",g,h-1),this.checkFullBorder(t,"borderLeft",g,h),this.setCellBorder(t,d.cell.style,g,h,e.onActionUpdate));delete o.style.borderLeft}if(void 0!==o.style.borderRight){for(var m=s[0];m<=s[2];m++)h=s[3],p({borderRight:o.style.borderRight})||(this.checkAdjacentBorder(t,"borderLeft",m,h+1),this.checkFullBorder(t,"borderLeft",m,h+1),this.checkFullBorder(t,"borderRight",m,h),this.setCellBorder(t,d.cell.style,m,h,e.onActionUpdate));delete o.style.borderRight}var v,y,C;if(Object.keys(o.style).length){var x=this.parent,b=x.viewport&&this.parent.getActiveSheet().id===t.id,S=this.parent.frozenRowCount(t),I=this.parent.frozenColCount(t),E=[S+x.viewport.topIndex,I+x.viewport.leftIndex,x.viewport.bottomIndex,x.viewport.rightIndex],R=void 0,A=void 0,k=void 0;for(l=s[0];l<=s[2];l++)if(!(A=Me(t,l)||{}).isFiltered)for(R=l>=E[0]&&l<=E[2]||l<S,k=!1,h=s[1];h<=s[3];h++)if(!p(o.style)){if(void 0===y&&(void 0!==o.style.border?(v=o.style.border,delete o.style.border,y=!0):y=!1),(C=ke(l,h,t,!1,!0)).rowSpan>1||C.colSpan>1)for(var F=l,T=C.rowSpan>1?l+(C.rowSpan-1):l;F<=T;F++)for(var L=h,N=C.colSpan>1?h+(C.colSpan-1):h;L<=N;L++)y&&this.setFullBorder(t,v,s,F,L,e.onActionUpdate,!0),this.setCellStyle(t,F,L,o.style);y&&this.setFullBorder(t,v,s,l,h,e.onActionUpdate),this.setCellStyle(t,l,h,o.style),b&&(R&&(h>=E[1]&&h<=E[3]||h<I)?this.parent.notify(hr,{style:o.style,rowIdx:l,colIdx:h,lastCell:h===s[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate}):A.customHeight||(k=k||ne(o.style,e.onActionUpdate))&&this.parent.notify(hr,{rowIdx:l,colIdx:h,lastCell:h===s[3],checkHeight:!0,outsideViewport:!R,onActionUpdate:e.onActionUpdate}))}}y&&(o.style.border=v),this.parent.setUsedRange(s[2],s[3]),e.refreshRibbon&&this.parent.notify(gr,null),i&&(o.style=a,o.range=t.name+"!"+n,this.parent.notify("actionComplete",{eventArgs:o,action:"format"}))}},e.prototype.setBottomBorderPriority=function(e,t,r){if(He(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,r]).borderTop&&(e.rows[t].cells[r].style.bottomPriority=!0)}},e.prototype.setFullBorder=function(e,t,r,n,i,o,a){var s={};n===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",n-1,i),this.checkFullBorder(e,"borderBottom",n-1,i)),i===r[1]&&(this.checkAdjacentBorder(e,"borderRight",n,i-1),this.checkFullBorder(e,"borderRight",n,i-1)),i===r[3]?(this.checkAdjacentBorder(e,"borderLeft",n,i+1),this.checkFullBorder(e,"borderLeft",n,i+1)):this.checkAdjacentBorder(e,"border",n,i+1),s.borderRight=t,s.borderTop=t,s.borderLeft=t,s.borderBottom=t,this.setCellBorder(e,s,n,i,o,i===r[3],null,a),n===r[2]?(this.checkAdjacentBorder(e,"borderTop",n+1,i),this.checkFullBorder(e,"borderTop",n+1,i),this.setBottomBorderPriority(e,n,i)):this.checkAdjacentBorder(e,"border",n+1,i)},e.prototype.checkAdjacentBorder=function(e,t,r,n){var i={};""!==this.parent.getCellStyleValue([t],[r,n])[t]&&(i[t]=void 0,this.setCellStyle(e,r,n,i))},e.prototype.checkFullBorder=function(e,t,r,n){var i=this.parent.getCellStyleValue(["border"],[r,n]).border;if(""!==i){var o={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){e!==t&&(o[e]=i)}),this.setCellStyle(e,r,n,o)}},e.prototype.textDecorationActionUpdate=function(e){var t=this.parent.getActiveSheet(),r={range:t.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",r),this.parent.notify("actionBegin",{eventArgs:r,action:"format"}),r.cancel)e.cancel=!0;else{var n,i=w(c(t.selectedRange)),o=e.style.textDecoration,a=o,s=c(t.activeCell),l=this.parent.getCellStyleValue(["textDecoration"],s).textDecoration,h=!1;"underline"===l?a="underline"===o?"none":"underline line-through":"line-through"===l?a="line-through"===o?"none":"underline line-through":"underline line-through"===l&&(a="underline"===o?"line-through":"underline",h=!0),"none"===a&&(h=!0),this.format({style:{textDecoration:a},range:s,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var d=i[0];d<=i[2];d++)for(var p=i[1];p<=i[3];p++)if(d!==s[0]||p!==s[1]){if(n={},"none"===(l=this.parent.getCellStyleValue(["textDecoration"],[d,p]).textDecoration)){if(h)continue;n.textDecoration=o}else if("underline"===l||"line-through"===l)if(h){if(o!==l)continue;n.textDecoration="none"}else n.textDecoration=o!==l?"underline line-through":o;else if("underline line-through"===l){if(!h)continue;n.textDecoration="underline"===o?"line-through":"underline"}this.format({style:n,range:[d,p,d,p],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}r.range=t.name+"!"+r.range,r.style.textDecoration=a,this.parent.notify("actionComplete",{eventArgs:r,action:"format"})}},e.prototype.setTypedBorder=function(e,t,r,n,i){var o;if("Outer"===n){for(var a=r[1];a<=r[3];a++)this.checkAdjacentBorder(e,"borderBottom",r[0]-1,a),this.checkFullBorder(e,"borderBottom",r[0]-1,a),this.setCellBorder(e,{borderTop:t},r[0],a,i,a===r[3]),this.checkAdjacentBorder(e,"borderTop",r[2]+1,a),this.checkFullBorder(e,"borderTop",r[2]+1,a),this.setCellBorder(e,{borderBottom:t},r[2],a,i,a===r[3],n),this.setBottomBorderPriority(e,r[2],a);for(var s=r[0];s<=r[2];s++)this.checkAdjacentBorder(e,"borderRight",s,r[1]-1),this.checkFullBorder(e,"borderRight",s,r[1]-1),this.setCellBorder(e,{borderLeft:t},s,r[1],i),this.checkAdjacentBorder(e,"borderLeft",s,r[3]+1),this.checkFullBorder(e,"borderLeft",s,r[3]+1),this.setCellBorder(e,{borderRight:t},s,r[3],i,null,n)}else if("Inner"===n)for(var l=r[0];l<=r[2];l++)for(var h=r[1];h<=r[3];h++){var d={};""!==(o=this.parent.getCellStyleValue(["border"],[l,h]).border)&&(d.border=void 0,h!==r[3]&&h!==r[1]&&l!==r[0]&&l!==r[2]||(l===r[0]&&(d.borderTop=o),l===r[2]&&(d.borderBottom=o),h===r[3]&&(d.borderRight=o),h===r[1]&&(d.borderLeft=o))),h!==r[3]&&(d.borderRight=t),l!==r[0]&&(d.borderTop=t),l!==r[2]&&(d.borderBottom=t),h!==r[1]&&(d.borderLeft=t),this.setCellBorder(e,d,l,h,i,h===r[3])}else if("Vertical"===n)for(l=r[0];l<=r[2];l++)for(h=r[1];h<=r[3];h++){d={borderRight:t,borderLeft:t};h===r[1]&&(this.checkAdjacentBorder(e,"borderRight",l,h-1),this.checkFullBorder(e,"borderRight",l,h-1)),h===r[3]&&(this.checkAdjacentBorder(e,"borderLeft",l,h+1),this.checkFullBorder(e,"borderLeft",l,h+1)),this.setCellBorder(e,d,l,h,i)}else for(l=r[0];l<=r[2];l++)for(h=r[1];h<=r[3];h++){d={borderTop:t,borderBottom:t};l===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",l-1,h),this.checkFullBorder(e,"borderBottom",l-1,h)),this.setCellBorder(e,d,l,h,i,h===r[3]),l===r[2]&&(this.checkAdjacentBorder(e,"borderTop",l+1,h),this.checkFullBorder(e,"borderTop",l+1,h),this.setBottomBorderPriority(e,l,h))}},e.prototype.setCellBorder=function(e,t,r,n,i,o,a,s){if(this.setCellStyle(e,r,n,t),!s&&this.parent.getActiveSheet().id===e.id){if("Outer"===a&&(t.borderBottom||t.borderRight)){var l={range:[r,n,r,n]};this.parent.notify(cn,l),r=l.range[0],n=l.range[1]}this.parent.notify(hr,{style:t,rowIdx:r,colIdx:n,onActionUpdate:i,first:"",lastCell:o,isHeightCheckNeeded:!0,manualUpdate:!0})}},e.prototype.setCellStyle=function(e,t,r,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[r]||(e.rows[t].cells[r]={}),e.rows[t].cells[r].style||(e.rows[t].cells[r].style={}),Object.assign(e.rows[t].cells[r].style,n,null,!0)},e.prototype.skipHiddenRows=function(e,t){return t++,He(e,t)&&(t=this.skipHiddenRows(e,t)),t},e.prototype.addEventListener=function(){this.parent.on(ar,this.format,this),this.parent.on(lr,this.textDecorationActionUpdate,this),this.parent.on(Cn,this.clearCellObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ar,this.format),this.parent.off(lr,this.textDecorationActionUpdate),this.parent.off(Cn,this.clearCellObj))},e.prototype.clearCellObj=function(e){for(var t,r,n,i,o,a=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,s=e.range&&e.range.indexOf("!")>0?fe(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,l=be(this.parent,s),h=w(y(a)),d=h[0],p=h[2],c=l.conditionalFormats&&l.conditionalFormats.length&&[].slice.call(l.conditionalFormats),u=[];d<=p;d++)for(n=h[1],i=h[3];n<=i;n++){var f=ke(d,n,l);if(f)switch(e.type){case"Clear Formats":delete f.format,delete f.rowSpan,delete f.style,delete f.wrap,delete f.colSpan;break;case"Clear Contents":f.hyperlink&&this.parent.notify(Mn,{sheet:l,rowIdx:d,colIdx:n,preventRefresh:!0}),o=!(!f.value&&!f.formula),delete f.value,delete f.formula,o&&(r={action:"refreshCalculate",rowIndex:d,colIndex:n,sheetIndex:s},this.parent.notify(pr,r),c&&!t&&((t=r.isFormulaDependent)||he(c,u,d,n)));break;case"Clear Hyperlinks":delete f.hyperlink;break;case"Clear All":o=!(!f.value&&!f.formula),Fe(d,n,l,{},!1),o&&(r={action:"refreshCalculate",rowIndex:d,colIndex:n,sheetIndex:s},this.parent.notify(pr,r),c&&!t&&(t=r.isFormulaDependent))}}(u.length||t)&&s===this.parent.activeSheetIndex&&this.parent.notify(vn,{cfModel:!t&&u,refreshAll:t,isAction:!0})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),vi=function(){function e(e){this.parent=e,this.localeObj=t.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(cr,this.performEditOperation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(cr,this.performEditOperation)},e.prototype.getModuleName=function(){return"workbookEdit"},e.prototype.performEditOperation=function(e){switch(e.action){case"updateCellValue":e.isFormulaDependent=this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly,e.formula)}},e.prototype.checkDecimalPoint=function(e,t){if(Number(e)){var r=e.toString().indexOf(this.decimalSep)+1;e=e.toString().substr(r).length<=6?!t||t.includes("RANDBETWEEN")?r<7?e:parseFloat(e).toFixed(0):e.toString().length<11?e:r<11?parseFloat(e).toFixed(9-r+2):parseFloat(e).toFixed(0):r>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-r+2)}return e},e.prototype.updateCellValue=function(e,r,n,i,o){void 0===n&&(n=this.parent.activeSheetIndex);var a,s;a="string"==typeof e?c(e):e;var l=be(this.parent,n),h=ke(a[0],a[1],l,!0);if(h?h.value:h=l.rows[a[0]].cells[a[1]]={},i)r&&r.toString().indexOf(this.decimalSep)>-1&&(r=this.checkDecimalPoint(r,o)),h.value=r;else{var d=W(r);d="#SPILL!"===r||d;var p=!1;h.formula&&h.formula.indexOf("UNIQUE")>-1&&""===r&&(p=!0);var u="Text"!==H(h.format);d||p||(h.formula&&(h.formula=""),h.value=u?O(r):r);var f={action:"refreshCalculate",value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:n,isFormula:d};if(u){var m={value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:n,updatedVal:""};this.parent.notify(ur,m),!t.isNullOrUndefined(m.updatedVal)&&m.updatedVal.length>0&&(h.value=m.updatedVal)}if("#SPILL!"===r)h.value=r;else{var v={cellIdx:a,isUnique:!1};this.parent.notify(wr,v),p?r=h.value:(this.parent.notify(pr,f),s=f.isFormulaDependent),d?(h.formula=f.value,r=h.value,"=NOW()"===h.formula&&"M/d/yyyy h:mm"!==h.format&&(h.format="M/d/yyyy h:mm")):!h.value||"string"!=typeof h.value||0!==h.value.indexOf("www.")&&0!==h.value.indexOf("https://")&&0!==h.value.indexOf("http://")&&0!==h.value.indexOf("ftp://")||this.parent.notify(Or,{hyperlink:h.value,cell:l.name+"!"+g(a[0],a[1])})}}return this.parent.setUsedRange(a[0],a[1],l),this.parent.chartColl.length&&this.parent.notify(En,{cell:h,rIdx:a[0],cIdx:a[1],sheetIdx:n}),s},e}(),yi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Or,this.setLinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Or,this.setLinkHandler)},e.prototype.setLinkHandler=function(e){var r,n=e.hyperlink,i=e.cell;if(i&&-1!==i.indexOf("!")){var o=i.split("!");if(r=be(this.parent,fe(this.parent,o[0])),i=o[1],!r)return}else r=this.parent.getActiveSheet(),i=i||r.selectedRange;var a=w(c(i));"string"==typeof n?0===n.toLowerCase().indexOf("www.")&&(n="http://"+n):0===n.address.toLowerCase().indexOf("www.")&&(n.address="http://"+n.address);for(var s,l=c(r.activeCell),h=a[0];h<=a[2];h++)for(var d=a[1];d<=a[3];d++)s={hyperlink:n},e.displayText&&(e.triggerEvt?h===l[0]&&d===l[1]&&(s.value=e.displayText):t.isNullOrUndefined(ke(h,d,r,!1,!0).value)&&(s.value=e.displayText)),s.style={textDecoration:"underline",color:"#00e"},oe(this.parent,r,{cell:s,rowIdx:h,colIdx:d,preventEvt:!e.triggerEvt})},e.prototype.getModuleName=function(){return"workbookHyperlink"},e}(),Ci=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insertModel=function(e){var t,r,n,i,o=this;if("Column"===e.modelType){if("number"==typeof e.start)for(var a=0;a<=this.parent.getActiveSheet().usedRange.rowIndex+1;a++){var s={cellIdx:[a,e.start],isUnique:!1};if(this.parent.notify(wr,s),s.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(var l=0;l<=this.parent.getActiveSheet().usedRange.colIndex+1;l++){s={cellIdx:[e.start,l],isUnique:!1};if(this.parent.notify(wr,s),s.isUnique)return}if(e.model){var h,d,p,c,u=[];if("number"==typeof e.start){h=e.start,e.end=e.end||h,h>e.end&&(h=e.end,e.end=e.start),"Row"===e.modelType&&h<e.model.maxHgts.length&&(c=[]);for(a=h;a<=e.end;a++)u.push({}),c&&c.push(null)}else e.start?(h=e.start[0].index||0,u=e.start,p=!0):(h=0,u.push({})),"Row"===e.modelType&&h<e.model.maxHgts.length&&(c=[],u.forEach(function(){c.push(null)}));var f={model:u,index:h,modelType:e.modelType,insertType:e.insertType,cancel:!1,isUndoRedo:e.isUndoRedo},g={eventArgs:f,action:"insert"};if(e.isAction){if(this.parent.notify(Zt,g),f.cancel)return;delete f.cancel,f.isAction=e.isAction}var m={startIndex:h,endIndex:h+u.length-1,modelType:e.modelType,sheet:e.model,isInsert:!0};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.model.rows&&e.checkCount===e.model.rows.length)return;if(this.parent.notify(Gn,m),e.model=e.model,e.model.rows||(e.model.rows=[]),p&&e.model.usedRange.rowIndex>-1&&h>e.model.usedRange.rowIndex)for(a=e.model.usedRange.rowIndex;a<h-1;a++)u.splice(0,0,{});var v=this.parent.frozenRowCount(e.model);h<v&&(this.parent.setSheetPropertyOnMute(e.model,"frozenRows",e.model.frozenRows+u.length),f.freezePane=!0),(t=e.model.rows).splice.apply(t,[h,0].concat(u)),c&&(r=e.model.maxHgts).splice.apply(r,[h,0].concat(c)),this.setRowColCount(m.startIndex,m.endIndex,e.model,"row"),h>e.model.usedRange.rowIndex?this.parent.setUsedRange(h+(u.length-1),e.model.usedRange.colIndex,e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex+u.length,e.model.usedRange.colIndex,e.model,!0);var y,C=h+u.length,x=void 0,b=function(t){e.model.rows[C]&&e.model.rows[C].cells&&e.model.rows[C].cells[t]&&(void 0!==(x=e.model.rows[C].cells[t]).rowSpan&&x.rowSpan<0&&void 0===x.colSpan&&S.parent.notify(un,{range:[C,t,C,t],insertCount:u.length,insertModel:"Row"}),x.style&&ke(h-1,t,e.model,!1,!0).style&&(y=S.checkBorder(x.style,e.model.rows[h-1].cells[t].style))!=={}&&u.forEach(function(e){e.cells||(e.cells=[]),e.cells[t]||(e.cells[t]={}),e.cells[t].style||(e.cells[t].style={}),Object.assign(e.cells[t].style,y)}))},S=this;for(a=0;a<=e.model.usedRange.colIndex;a++)b(a);f.sheetCount=e.model.rows.length}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.model.columns&&e.checkCount===e.model.columns.length)return;this.parent.notify(Gn,m),e.model=e.model,e.model.columns||(e.model.columns=[]),h&&!e.model.columns[h-1]&&(e.model.columns[h-1]={}),(n=e.model.columns).splice.apply(n,[h,0].concat(u));var w=this.parent.frozenColCount(e.model);h<w&&(this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",e.model.frozenColumns+u.length),f.freezePane=!0),this.setRowColCount(m.startIndex,m.endIndex,e.model,"col"),h>e.model.usedRange.colIndex?this.parent.setUsedRange(e.model.usedRange.rowIndex,h+(u.length-1),e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex,e.model.usedRange.colIndex+u.length,e.model,!0),e.model.rows||(e.model.rows=[]);var I=[];e.columnCellsModel||(e.columnCellsModel=[]);for(a=0;a<u.length;a++)I.push(null);d=[];x=void 0;var E=void 0;for(a=0;a<=e.model.usedRange.rowIndex;a++){e.model.rows[a]?e.model.rows[a].cells||(e.model.rows[a].cells=[]):e.model.rows[a]={cells:[]},h&&!e.model.rows[a].cells[h-1]&&(e.model.rows[a].cells[h-1]={}),(i=e.model.rows[a].cells).splice.apply(i,[h,0].concat(e.columnCellsModel[a]&&e.columnCellsModel[a].cells?e.columnCellsModel[a].cells:I));C=h+u.length;if(e.model.rows[a].cells[C]&&(void 0!==(x=e.model.rows[a].cells[C]).colSpan&&x.colSpan<0&&void 0===x.rowSpan&&d.push({range:[a,C,a,C],insertCount:I.length,insertModel:"Column"}),x.style&&ke(a,h-1,e.model,!1,!0).style&&(E=this.checkBorder(x.style,e.model.rows[a].cells[h-1].style))!=={}))for(l=h;l<C;l++)e.model.rows[a].cells[l]||(e.model.rows[a].cells[l]={}),e.model.rows[a].cells[l].style||(e.model.rows[a].cells[l].style={}),Object.assign(e.model.rows[a].cells[l].style,E)}d.forEach(function(e){o.parent.notify(un,e)}),f.sheetCount=e.model.columns.length}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var R=u,A=Ee(this.parent),k=e.isFromUpdateAction;for(a=0;a<R.length;a++)if(R[a].name)for(l=0;l<this.parent.sheets.length;l++)if(R[a].name===this.parent.sheets[l].name){R.splice(a,1),a--;break}if(!R.length)return;delete u[0].index,this.parent.createSheet(h,u);var F;e.activeSheetIndex?(f.activeSheetIndex=e.activeSheetIndex,this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0)):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),k&&this.parent.setProperties({activeSheetIndex:fe(this.parent,A)},!0),u.forEach(function(e){p&&o.updateRangeModel(e.ranges),F=e.id,o.parent.notify(pr,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+F,sheetId:F})}),f.activeSheetIndex=e.activeSheetIndex,f.sheetCount=this.parent.sheets.length}"Sheet"!==e.modelType&&(this.insertConditionalFormats(e),this.parent.notify(qn,{start:h,end:h+u.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),f.activeSheetIndex=fe(this.parent,e.model.name)),this.parent.notify(Ur,g)}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";this.parent.setSheetPropertyOnMute(r,i,r[i]+(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(dr,{index:r[i]-1,update:n,isInsert:!0,start:e,end:t})},e.prototype.updateRangeModel=function(e){e.forEach(function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")})},e.prototype.checkBorder=function(e,t){var r={};return e.borderLeft&&e.borderLeft===t.borderLeft&&(r.borderLeft=e.borderLeft),e.borderRight&&e.borderRight===t.borderRight&&(r.borderRight=e.borderRight),e.borderTop&&e.borderTop===t.borderTop&&(r.borderTop=e.borderTop),e.borderBottom&&e.borderBottom===t.borderBottom&&(r.borderBottom=e.borderBottom),r},e.prototype.setInsertInfo=function(e,t,r,n,i){void 0===i&&(i="Row");var o=r=t+(r-1);e.ranges.forEach(function(e){e.info&&t<e.info[n]&&(e.info["insert"+i+"Range"]?e.info["insert"+i+"Range"].push([t,o]):e.info["insert"+i+"Range"]=[[t,o]],e.info[n]+=o-t+1)})},e.prototype.insertConditionalFormats=function(e){var t=e.model.conditionalFormats;if("delete"===e.prevAction)this.parent.setSheetPropertyOnMute(e.model,"conditionalFormats",e.conditionalFormats);else if(t)for(var r=0,n=t.length;r<n;r++)t[r].range=m(se(e,c(t[r].range),!e.isAction&&!e.isUndoRedo))},e.prototype.addEventListener=function(){this.parent.on(Vr,this.insertModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Vr,this.insertModel)},e.prototype.getModuleName=function(){return"workbookinsert"},e}(),xi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.deleteModel=function(e){var t=this,r=this.parent.sheets.length;if("Sheet"!==e.modelType||1!==r){if("Column"===e.modelType){if("number"==typeof e.start)for(var n=0;n<=this.parent.getActiveSheet().usedRange.rowIndex+1;n++){var i={cellIdx:[n,e.start],isUnique:!1};if(this.parent.notify(wr,i),i.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(var o=0;o<=this.parent.getActiveSheet().usedRange.colIndex+1;o++){i={cellIdx:[e.start,o],isUnique:!1};if(this.parent.notify(wr,i),i.isUnique)return}var a=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var s=e.start;e.start=e.end,e.end=s}var l={startIndex:e.start,endIndex:e.end,modelType:e.modelType,cancel:!1,isUndoRedo:e.isUndoRedo},h={eventArgs:l,action:"delete"};if(!e.isAction||(this.parent.notify(Zt,h),!l.cancel)){var d,p,c=[],u=e.end-e.start+1,f={startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model},g=this.parent.scrollSettings.isFinite;if("Row"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.rowIndex)return;if(this.parent.notify(Gn,f),e.model=e.model,g){if(e.start>=e.model.rowCount)return;e.end>=e.model.rowCount&&(e.end=e.model.rowCount-1)}else{if(e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex)}this.setRowColCount(e.start,e.end,e.model,"row"),e.start<=e.model.usedRange.rowIndex&&(e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0));var m=this.parent.frozenRowCount(e.model);e.start<m&&(m=e.end<m?e.end-e.start+1:m-e.start,m=e.model.frozenRows-m,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",m),l.freezePane=!0);var v=e.end+1,y=void 0,C=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(o=0;o<=e.model.usedRange.colIndex;o++){if(e.model.rows[e.start].cells[o]&&void 0!==e.model.rows[e.start].cells[o].rowSpan&&e.model.rows[e.start].cells[o].rowSpan<0&&void 0===e.model.rows[e.start].cells[o].colSpan&&(C={range:[e.start,o,e.start,o]},this.parent.notify(cn,C),C.range=C.range,C.range[2]<=e.end&&((p=ke(C.range[0],o,e.model))&&p.rowSpan>1&&(p.rowSpan-(C.range[2]-e.start+1)>1?Fe(C.range[0],o,e.model,{colSpan:p.rowSpan-(C.range[2]-e.start+1)},!0):delete e.model.rows[C.range[0]].cells[o].rowSpan),C=null)),e.model.rows[v]&&e.model.rows[v].cells&&e.model.rows[v].cells[o]&&void 0!==e.model.rows[v].cells[o].rowSpan&&e.model.rows[v].cells[o].rowSpan<0&&void 0===e.model.rows[v].cells[o].colSpan&&(C||(C={range:[v,o,v,o]},this.parent.notify(cn,C)),y=new Object,C.range=C.range,Object.assign(y,ke(C.range[0],C.range[1],e.model)),y&&y.rowSpan&&(y.rowSpan>1||y.colSpan>1))){(S=[])[1]=o,S[3]=y.colSpan>1?o+(y.colSpan-1):o,C.range=C.range,C.range[0]<e.start?(S[0]=S[2]=C.range[0],y.rowSpan-u>1&&(S[2]+=y.rowSpan-u-1)):(S[0]=S[2]=e.start,y.rowSpan-(e.end-C.range[0]+1)>1&&(S[2]+=y.rowSpan-(e.end-C.range[0]+1)-1)),c.push({range:S,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}C=null}l.sheetCount=e.model.usedRange.rowIndex}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.colIndex)return;if(this.parent.notify(Gn,f),e.model=e.model,g){if(e.start>=e.model.colCount)return;e.end>=e.model.colCount&&(e.end=e.model.colCount-1)}else{if(e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex)}this.setRowColCount(e.start,e.end,e.model,"col"),e.start<=e.model.usedRange.colIndex&&(e.model.usedRange.colIndex-=u,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0));var x=this.parent.frozenColCount(e.model);e.start<x&&(x=e.end<x?e.end-e.start+1:x-e.start,x=e.model.frozenColumns-x,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",x),this.parent.updateTopLeftCell(),l.freezePane=!0),d=[];for(v=e.end+1,y=void 0,C=void 0,o=0;o<=e.model.usedRange.rowIndex;o++)if(d.push({}),e.model.rows[o]&&e.model.rows[o].cells){if(e.model.rows[o].cells[e.start]&&void 0!==e.model.rows[o].cells[e.start].colSpan&&e.model.rows[o].cells[e.start].colSpan<0&&void 0===e.model.rows[o].cells[e.start].rowSpan&&(C={range:[o,e.start,o,e.start]},this.parent.notify(cn,C),C.range=C.range,C.range[3]<=e.end)){var b=ke(o,C.range[1],e.model);b&&b.colSpan>1&&(b.colSpan-(C.range[3]-e.start+1)>1?Fe(o,C.range[1],e.model,{colSpan:b.colSpan-(C.range[3]-e.start+1)},!0):delete e.model.rows[o].cells[C.range[1]].colSpan),C=null}if(e.model.rows[o].cells[v]&&void 0!==e.model.rows[o].cells[v].colSpan&&e.model.rows[o].cells[v].colSpan<0&&void 0===e.model.rows[o].cells[v].rowSpan&&(C||(C={range:[o,v,o,v]},this.parent.notify(cn,C)),y=new Object,C.range=C.range,Object.assign(y,ke(C.range[0],C.range[1],e.model)),y&&y.colSpan&&(y.colSpan>1||y.rowSpan>1))){var S;(S=[])[0]=o,S[2]=y.rowSpan>1?o+(y.rowSpan-1):o,C.range=C.range,C.range[1]<e.start?(S[1]=S[3]=C.range[1],y.colSpan-u>1&&(S[3]+=y.colSpan-u-1)):(S[1]=S[3]=e.start,y.colSpan-(e.end-C.range[1]+1)>1&&(S[3]+=y.colSpan-(e.end-C.range[1]+1)-1)),c.push({range:S,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}d[o].cells=e.model.rows[o].cells.splice(e.start,u),C=null}l.sheetCount=e.model.usedRange.colIndex,l.deletedCellsModel=d}else{if(e.end-e.start==this.parent.sheets.length-1||void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;l.sheetCount=this.parent.sheets.length,l.activeSheetIndex=this.parent.activeSheetIndex}var w=[],I="Row"===e.modelType&&e.start<e.model.maxHgts.length;for(o=e.start;o<=e.end;o++)"Sheet"===e.modelType&&e.model[a][o]&&this.parent.notify(pr,{action:"deleteSheetTab",sheetId:e.model[a][o].id}),e.model[a][e.start]||e.start<e.model[a].length?(w.push(e.model[a][e.start]||{}),e.model[a].splice(e.start,1)):w.push({}),o===e.start&&(w[0].index=e.start),I&&e.model.maxHgts.splice(e.start,1);c.forEach(function(e){return t.parent.notify(hn,e)}),this.parent.notify(On,e),"Sheet"!==e.modelType&&(this.parent.notify(qn,e),l.refreshSheet=e.refreshSheet,l.activeSheetIndex=fe(this.parent,e.model.name),l.conditionalFormats=[],this.deleteConditionalFormats(e,l)),l.definedNames=f.definedNames,l.isAction=e.isAction,l.deletedModel=w,delete l.cancel,this.parent.notify(_r,h)}}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";t>=r[i]&&(t=r[i]-1),t<e||(this.parent.setSheetPropertyOnMute(r,i,r[i]-(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(dr,{index:r[i]-1,update:n,isDelete:!0,start:e,end:t}))},e.prototype.setDeleteInfo=function(e,t,r,n){void 0===n&&(n="Row");var i=t-e+1,o=[];this.parent.getActiveSheet().ranges.forEach(function(a){a.info&&e<a.info[r]&&(a.info["delete"+n+"Range"]?a.info["delete"+n+"Range"].push([e,t]):a.info["delete"+n+"Range"]=[[e,t]],a.info[r]-=i,a.info["insert"+n+"Range"]&&(a.info["insert"+n+"Range"]=o))})},e.prototype.deleteConditionalFormats=function(e,r){var n=e.model.conditionalFormats;if(n)for(var i=0;i<n.length;i++){r.conditionalFormats.push(t.extend({},n[i],null,!0));var o=c(n[i].range),a=c(e.model.selectedRange);"Column"===e.modelType&&a[1]<=o[1]&&a[3]>=o[3]||"Row"===e.modelType&&a[0]<=o[0]&&a[2]>=o[2]?(n.splice(n.indexOf(n[i]),1),i--):n[i].range=m(le(e,o))}},e.prototype.addEventListener=function(){this.parent.on(zr,this.deleteModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(zr,this.deleteModel)},e.prototype.getModuleName=function(){return"workbookdelete"},e}(),bi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(jr,this.validationHandler,this),this.parent.on(Wr,this.addHighlightHandler,this),this.parent.on(Jr,this.removeHighlightHandler,this),this.parent.on(Dn,this.beforeInsertDeleteHandler,this),this.parent.on(On,this.beforeInsertDeleteHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(jr,this.validationHandler),this.parent.off(Wr,this.addHighlightHandler),this.parent.off(Jr,this.removeHighlightHandler),this.parent.off(Dn,this.beforeInsertDeleteHandler),this.parent.off(On,this.beforeInsertDeleteHandler))},e.prototype.validationHandler=function(e){var r,n=e.range,i="";e.range.indexOf("!")>-1&&(n=e.range.split("!")[1],i=e.range.split("!")[0]);var o=be(this.parent,i?fe(this.parent,i):this.parent.activeSheetIndex);this.parent.dataValidationRange=(this.parent.dataValidationRange.indexOf("!")>-1?"":o.name+"!")+this.parent.dataValidationRange+n+",";var a=!1,s=this.getRangeWhenColumnSelected(n,o);n=s.range,a=s.isFullCol,t.isNullOrUndefined(i)||(e.range=i+"!"+n),e.range=e.range||o.selectedRange;var l=w(c(e.range));if(a)for(var h=l[1];h<=l[3];h++)r=ze(o,h),a=!(a&&e.isRemoveValidation&&r&&!r.validation);if(a)for(h=l[1];h<=l[3];h++)r=ze(o,h),e.isRemoveValidation&&r&&r.validation?delete o.columns[h].validation:e.isRemoveValidation||(t.isNullOrUndefined(r)&&(o.columns[h]=ze(o,h)),o.columns[h].validation={operator:e.rules.operator,type:e.rules.type,value1:e.rules.value1,value2:e.rules.value2,inCellDropDown:e.rules.inCellDropDown,ignoreBlank:e.rules.ignoreBlank});else for(var d=void 0,p=l[0];p<=l[2];p++)for(h=l[1];h<=l[3];h++)e.isRemoveValidation?(p===l[2]&&(r=ze(o,h))&&r.validation&&(r.validation.address=J(r.validation.address,[l[0],h,l[2],h],h)),(d=ke(p,h,o))&&d.validation&&!oe(this.parent,o,{cell:{validation:{}},rowIdx:p,colIdx:h})&&(delete d.validation,this.parent.notify(hr,{rowIdx:p,colIdx:h,style:this.parent.getCellStyleValue(["backgroundColor","color"],[p,h])}))):(d={validation:Object.assign({},e.rules)},oe(this.parent,o,{cell:d,rowIdx:p,colIdx:h}))},e.prototype.addHighlightHandler=function(e){this.InvalidDataHandler(e.range,!1,e.td,e.isclearFormat)},e.prototype.removeHighlightHandler=function(e){this.InvalidDataHandler(e.range,!0)},e.prototype.getRange=function(e){var t=c(e),r=this.parent.getActiveSheet(),n=r.colCount,i=r.rowCount;return t[2]===i-1&&0===t[0]?e=e.replace(/[0-9]/g,""):t[3]===n-1&&0===t[2]&&(e=e.replace(/\D/g,"")),e},e.prototype.InvalidDataHandler=function(e,t,r,n){for(var i,o,a=e?S(this.parent,e):this.parent.activeSheetIndex,s=be(this.parent,a),l=(e=e||s.selectedRange).includes("!")?me(e):s.name,h=this.getRangeWhenColumnSelected(C(e),s),d=h.isFullCol,p=(e=l+"!"+h.range)?w(c(e)):[],u=(e=this.getRange(e))?p[0]:0,f=e?p[2]:s.rows.length;u<=f;u++)if(s.rows[u])for(var g=e?p[1]:0,m=e?p[3]:s.rows[u].cells.length;g<=m;g++){var v=void 0;if(s.rows[u].cells&&s.rows[u].cells[g]){var y=ze(s,g);if((i=s.rows[u].cells[g])&&i.validation){if(v=i.validation,n&&!v.isHighlighted)return;t?v.isHighlighted&&(i.validation.isHighlighted=!1):i.validation.isHighlighted=!0}else if(y&&y.validation){if(v=y.validation,n&&!v.isHighlighted)return;t&&d?v.isHighlighted&&(y.validation.isHighlighted=!1):d&&(y.validation.isHighlighted=!0)}o=i.value?i.value:"";var x=[u,g];if(v&&this.parent.allowDataValidation){var b={value:o,range:x,sheetIdx:a,isCell:!1,td:r,isValid:!0};this.parent.notify(qr,b);b.isValid||He(s,u)||a!==this.parent.activeSheetIndex||this.parent.notify(Ln,{isRemoveHighlightedData:t,rowIdx:u,colIdx:g,td:r})}}}},e.prototype.beforeInsertDeleteHandler=function(e){if("Sheet"!==e.modelType)for(var t,r,n=0,i=this.parent.sheets.length;n<i;n++)for(var o=0,a=(r=this.parent.sheets[n]).rows.length;o<a;o++)if(r.rows[o]&&r.rows[o].cells)for(var s=0,l=r.rows[o].cells.length;s<l;s++)if((t=r.rows[o].cells[s])&&t.validation){var h="beforeInsert"===e.name,d=e.index+(e.model.length-1),p="Row"===e.modelType?o>=e.index&&o<=d:s>=e.index&&s<=d,c=void 0;c=h?{insertDeleteArgs:{startIndex:e.index,endIndex:e.index+e.model.length-1,modelType:e.modelType,isInsert:!0,sheet:be(this.parent,e.activeSheetIndex)},row:o,col:s}:{insertDeleteArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model},row:o,col:s},W(t.validation.value1)&&!p&&(c.cell={formula:t.validation.value1},this.parent.notify(Yn,c),t.validation.value1=c.cell.formula),W(t.validation.value2)&&!p&&(c.cell={formula:t.validation.value2},this.parent.notify(Yn,c),t.validation.value2=c.cell.formula),e.activeSheetIndex===n&&h&&this.updateValidationForInsertedModel(e,r,o,s,t.validation)}},e.prototype.getRangeWhenColumnSelected=function(e,t){var r,n=e.split(":");return e.match(/\D/g)&&!e.match(/[0-9]/g)?(n[0]+=1,n[1]+=t.rowCount,e=n[0]+":"+n[1],r=!0):!e.match(/\D/g)&&e.match(/[0-9]/g)&&(n[0]="A"+n[0],n[1]=g(0,t.colCount-1).replace(/[0-9]/g,"")+n[1],e=n[0]+":"+n[1]),{range:e,isFullCol:r}},e.prototype.updateValidationForInsertedModel=function(e,r,n,i,o){var a=e.index+(e.model.length-1);if("Column"===e.modelType){if("before"===e.insertType&&a===i-1||"after"===e.insertType&&e.index-1===i)for(var s=e.index;s<=a;s++)Fe(n,s,r,{validation:t.extend({},o)},!0)}else if("Row"===e.modelType&&("above"===e.insertType&&a===n-1||"below"===e.insertType&&e.index-1===n))for(s=e.index;s<=a;s++)Fe(s,i,r,{validation:t.extend({},o)},!0)},e.prototype.getModuleName=function(){return"workbookDataValidation"},e}(),Si=function(){return(Si=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},wi=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Gr,this.findNext,this),this.parent.on(Yr,this.findPrevious,this),this.parent.on(Kr,this.replace,this),this.parent.on($r,this.replaceAll,this),this.parent.on(tn,this.totalCount,this),this.parent.on(sr,this.findAllValues,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Gr,this.findNext),this.parent.off(Yr,this.findPrevious),this.parent.off(Kr,this.replace),this.parent.off($r,this.replaceAll),this.parent.off(tn,this.totalCount),this.parent.off(sr,this.findAllValues))},e.prototype.findNext=function(e){var r,n,i,o=this.parent.sheets,a=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,s=o[a],l=u(s.activeCell),h=s.usedRange,d=h.colIndex,p=e.value.toString(),c=0,f=h.rowIndex,g=r=l[1],m=n=l[0];if(s.rows[n]&&s.rows[n].cells&&s.rows[n].cells[r])if(s.rows[n].cells[r].format){i=this.parent.getDisplayText(s.rows[n].cells[r]).toString()}else s.rows[n].cells[r].value&&(i=s.rows[n].cells[r].value.toString());if(i){var v=i.toLowerCase(),y=i.indexOf(e.value)>-1,C=v.indexOf(e.value.toString().toLowerCase())>-1;(p===i||p===v||y||C)&&("By Column"===e.searchBy?n++:r++,c++)}(l[0]>s.usedRange.rowIndex||l[1]>s.usedRange.colIndex)&&(l[0]>s.usedRange.rowIndex&&l[1]<=s.usedRange.colIndex?(n=0,r=l[1]):l[0]<=s.usedRange.rowIndex&&l[1]>s.usedRange.colIndex?(n=l[0],r=0):(n=0,r=0));var x={rowIndex:n,colIndex:r,usedRange:h,endRow:f,endColumn:d,startRow:m,mode:e.mode,loopCount:0,count:c,args:e,val:void 0,stringValue:p,sheetIndex:a,startColumn:g,sheets:o};"By Row"===e.searchBy&&this.findNxtRow(x),"By Column"===e.searchBy&&this.findNxtCol(x)},e.prototype.findNxtRow=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length;t=r.usedRange;var i=u(r.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++),e.rowIndex;e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex++,n===e.sheetIndex&&(e.sheetIndex=0),o===e.sheetIndex&&0===e.count)return void this.parent.notify(Zr,null);t=(r=e.sheets[e.sheetIndex]).usedRange,i=u(r.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=t.colIndex,e.endRow=t.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===i[0]&&0===i[1]){if(0===e.count)return void this.parent.notify(Zr,null)}else(0!==i[0]&&0!==i[1]||0!==i[0]||0!==i[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=t.colIndex,e.endRow=i[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&t.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),r.rows[e.rowIndex]){var a=r.rows[e.rowIndex];for(e.colIndex;e.colIndex<=e.endColumn;e.colIndex++)if(a&&a.cells&&a.cells[e.colIndex]){if(this.nextCommon(e))return}if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&i[0]===e.rowIndex)return void this.parent.notify(Zr,null)}}0!==e.count||this.parent.notify(Zr,null)},e.prototype.findNxtCol=function(e){var t,r=e.sheets[e.sheetIndex],n=u(r.activeCell),i=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++),e.colIndex;e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,i===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(Zr,null);r=e.sheets[e.sheetIndex],e.usedRange=r.usedRange,n=u(r.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===n[0]&&0===n[1]||n[1]>r.usedRange.rowIndex||n[0]>r.usedRange.colIndex){if(0===e.count)return void this.parent.notify(Zr,null)}else(0!==n[1]||0!==n[0]||0!==n[1]&&0!==n[0])&&(e.startRow=0,e.startColumn=0,e.endRow=n[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(e.rowIndex;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++)if(r.rows[e.rowIndex]&&r.rows[e.rowIndex].cells&&r.rows[e.rowIndex].cells[e.colIndex]){if(this.nextCommon(e))return}if(e.loopCount>0&&n[1]===e.colIndex)return void this.parent.notify(Zr,null)}}0!==e.count||this.parent.notify(Zr,null)},e.prototype.nextCommon=function(e){var t=e.sheets[e.sheetIndex],r=t.rows[e.rowIndex];if(r&&(!r.isFiltered||!r.hidden)){var n=r.cells[e.colIndex];if(n&&n.value){if(t.isProtected&&(n.isLocked||void 0===n.isLocked)&&t.protectSettings.selectUnLockedCells)return!1;var i=r.cells[e.colIndex];if(i){var o=void 0;if(i.format){o=this.parent.getDisplayText(r.cells[e.colIndex])}else o=r.cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(o===e.stringValue){var a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var s=o.indexOf(e.args.value)>-1;if(o===e.stringValue||s){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=o.toString().toLowerCase(),e.val===e.stringValue){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=o.toString().toLowerCase();s=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var l=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||o===e.stringValue||s||o===e.stringValue||l){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}}}}return!1},e.prototype.findPrevious=function(e){var t,r=this.parent.sheets,n=e.sheetIndex,i=r[n],o=u(i.activeCell),a=0,s=i.usedRange.rowIndex,l=i.usedRange.colIndex,h=e.value.toString(),d=o[1],p=o[0],c=d,f=p;if(i.rows[p]&&i.rows[p].cells[d])if(i.rows[p].cells[d].format){t=this.parent.getDisplayText(i.rows[p].cells[d]).toString()}else i.rows[p].cells[d].value&&(t=i.rows[p].cells[d].value.toString());if(t){var g=t.toLowerCase(),m=t.indexOf(e.value)>-1,v=g.indexOf(e.value.toString().toLowerCase())>-1;(h===t||h===g||m||v)&&("By Row"===e.searchBy&&d--,"By Column"===e.searchBy&&p--,a++)}(o[0]>i.usedRange.rowIndex||o[1]>i.usedRange.colIndex)&&(o[0]>i.usedRange.rowIndex&&o[1]<=i.usedRange.colIndex?(p=i.usedRange.rowIndex,d=o[1]):o[0]<=i.usedRange.rowIndex&&o[1]>i.usedRange.colIndex?(p=o[0],d=i.usedRange.colIndex):(p=i.usedRange.rowIndex,d=i.usedRange.colIndex));var y={rowIndex:p,colIndex:d,endRow:s,endColumn:l,startRow:f,loopCount:0,count:a,args:e,val:void 0,stringValue:h,sheets:r,sheetIndex:n,startColumn:c};"By Row"===e.searchBy&&this.findPreRow(y),"By Column"===e.searchBy&&this.findPreCol(y)},e.prototype.findPreRow=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length,i=!1,o=u(r.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--),e.rowIndex;e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),a===e.sheetIndex&&0===e.count)return void this.parent.notify(Zr,null);t=(r=e.sheets[e.sheetIndex]).usedRange,o=u(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}i=this.commonCondition(e,o)}if(!i){"Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex,e.colIndex=r.usedRange.colIndex);var s=r.rows[e.rowIndex];if(s){for(-1===e.colIndex&&(e.colIndex=r.usedRange.colIndex),e.colIndex;e.colIndex>=0;e.colIndex--)if(s&&s.cells&&s.cells[e.colIndex]){if(this.prevCommon(e))return}if(e.loopCount>0&&o[0]===e.rowIndex)return void this.parent.notify(Zr,null)}}}i||0!==e.count||this.parent.notify(Zr,null)},e.prototype.findPreCol=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length,i=!1,o=u(r.activeCell);for(e.colIndex;e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),a===e.sheetIndex&&0===e.count)return void this.parent.notify(Zr,null);t=(r=e.sheets[e.sheetIndex]).usedRange,o=u(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}i=this.commonCondition(e,o)}if(!i){e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=r.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=r.usedRange.colIndex,e.rowIndex--);var s=r.rows[e.rowIndex];for(s&&r.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex),e.rowIndex;e.rowIndex>=0;e.rowIndex--){if(s&&s.cells&&s.cells[e.colIndex]){if(this.prevCommon(e))return}if(e.loopCount>0&&o[1]===e.colIndex)return void this.parent.notify(Zr,null)}}}i||0!==e.count||this.parent.notify(Zr,null)},e.prototype.commonCondition=function(e,t){var r,n=e.sheets[e.sheetIndex];return t[0]!==e.endRow&&t[1]!==e.endColumn||t[0]!==e.endRow||t[1]!==e.endColumn?(e.startColumn=n.usedRange.colIndex,e.startRow=n.usedRange.rowIndex,e.endColumn=0,e.endRow=t[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,r=!1):(t[0]===n.usedRange.rowIndex&&t[1]===n.usedRange.colIndex||t[0]>n.usedRange.rowIndex||t[1]>n.usedRange.colIndex)&&0!==t[0]&&0!==t[1]&&(this.parent.notify(Zr,null),r=!0),r},e.prototype.prevCommon=function(e){var t=e.sheets[e.sheetIndex],r=t.rows[e.rowIndex];if(r&&(!r.isFiltered||!r.hidden)){var n=r.cells[e.colIndex];if(n&&n.value){if(t.isProtected&&(n.isLocked||void 0===n.isLocked)&&t.protectSettings.selectUnLockedCells)return!1;var i=r.cells[e.colIndex];if(i){var o=void 0;if(i.format){o=this.parent.getDisplayText(r.cells[e.colIndex])}else o=r.cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(o===e.stringValue){var a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var s=o.indexOf(e.args.value)>-1;if(o===e.stringValue||s){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=o.toString().toLowerCase(),e.val===e.stringValue){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=o.toString().toLowerCase();s=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var l=e.val.indexOf(e.args.value)>-1;if(o===e.stringValue||o===e.stringValue||s||e.val===e.stringValue||l){a=t.name+"!"+g(e.rowIndex,e.colIndex);return this.parent.notify(Xr,{address:a}),e.count++,!0}}}}}return!1},e.prototype.replace=function(e){var r=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=be(this.parent,e.sheetIndex);if(n.isProtected)this.parent.notify("editAlert",null);else{var i,o=c(e.address||n.activeCell),a=this.parent.getDisplayText(ke(o[0],o[1],n,!1,!0)).toString();e.value=e.value.toString(),e.isCSen||(i=e.value.toLowerCase());var s=this.getReplaceValue(e,a,i);if(s||(e.findOpt="next",this.findNext(e),o=u(n.activeCell),a=this.parent.getDisplayText(ke(o[0],o[1],n)).toString(),s=this.getReplaceValue(e,a,i))){var l={address:n.name+"!"+g(o[0],o[1]),cancel:!1,compareValue:e.value,replaceValue:e.replaceValue,sheetIndex:r};if(e.isAction){if(this.parent.notify(Zt,{action:"beforeReplace",eventArgs:l}),l.cancel)return;delete l.cancel}oe(this.parent,n,{cell:{value:s},rowIdx:o[0],colIdx:o[1],uiRefresh:!0,valChange:!0}),e.isAction&&this.parent.notify("actionComplete",{action:"replace",eventArgs:l})}}},e.prototype.replaceAll=function(e){for(var t,r,n,i=this,o="Sheet"===e.mode?e.sheetIndex:0,a=this.parent.sheets[o],s=a.usedRange.rowIndex,l=0,h=a.usedRange.colIndex,d=0,p=[],c=e.isAction,f=Si({addressCollection:p,cancel:!1},e),m=function(e,t){requestAnimationFrame?requestAnimationFrame(function(){if(!f.cancel&&f.addressCollection[t]){var r=u(f.addressCollection[t].split("!")[1]),n=S(i.parent,f.addressCollection[t]);oe(i.parent,i.parent.sheets[n],{cell:{value:e},rowIdx:r[0],colIdx:r[1],uiRefresh:!0,valChange:!0}),t===f.addressCollection.length-1&&c&&i.parent.notify("actionComplete",{action:"replaceAll",eventArgs:f})}}):i.parent.updateCell({value:e},f.addressCollection[t])};l<=s+1;l++){if(d>h&&l>s&&"Workbook"===e.mode){if(o++,!(a=this.parent.sheets[o]))break;d=0,l=0,h=a.usedRange.colIndex,s=a.usedRange.rowIndex}if(r=a.rows[l])for(d===h+1&&(d=0);d<=h;d++)if(r&&r.cells&&r.cells[d]&&(t=this.parent.getDisplayText(a.rows[l].cells[d]).toString()))if(e.isCSen)e.isEMatch?t===e.value&&(m(e.replaceValue,p.length),p.push(a.name+"!"+g(l,d))):t.indexOf(e.value)>-1&&(m(t.replace(e.value,e.replaceValue),p.length),p.push(a.name+"!"+g(l,d)));else if(e.isEMatch)t.toLowerCase()===e.value&&(m(e.replaceValue,p.length),p.push(a.name+"!"+g(l,d)));else{var v=t.toLowerCase();(t===e.value||v.indexOf(e.value.toString().toLowerCase())>-1||v===e.value||t===e.value||v.indexOf(e.value)>-1)&&(n=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),m(t.replace(n,e.replaceValue),p.length),p.push(a.name+"!"+g(l,d)))}}p.length&&c?(this.parent.notify("actionBegin",{action:"beforeReplaceAll",eventArgs:f}),f.cancel||this.parent.notify(an,{count:f.addressCollection.length,replaceValue:f.replaceValue})):this.parent.notify(an,{count:f.addressCollection.length,replaceValue:f.replaceValue})},e.prototype.getReplaceValue=function(e,t,r){return e.isCSen?e.isEMatch?t===e.value&&e.replaceValue:t.indexOf(e.value)>-1&&t.replace(e.value,e.replaceValue):e.isEMatch?t.toLowerCase()===r&&e.replaceValue:t.toLowerCase().includes(r)&&t.replace(new RegExp(e.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),e.replaceValue)},e.prototype.totalCount=function(e){var t=this,r=this.parent.sheets[e.sheetIndex],n=u(r.activeCell),i=0,o=0,a=e.value.toLowerCase();r.rows.filter(function(e,r){return e&&e.cells&&(!e.isFiltered||!e.hidden)&&e.cells.filter(function(e,s){e&&(e.value||0===e.value)&&(e.format?t.parent.getDisplayText(e):e.value.toString()).toLowerCase().includes(a)&&(i++,(r===n[0]&&s>=n[1]||r>n[0])&&o++)})});var s=i;(i=s-(o-=1))>s&&(i=s),0===i||this.parent.getDisplayText(ke(n[0],n[1],r)).toLowerCase().includes(a)||(i-=1),e.findCount=i+" of "+s},e.prototype.findAllValues=function(e){for(var r,n=e.sheetIndex,i=this.parent.sheets[n],o=i.usedRange.rowIndex,a=0,s=i.usedRange.colIndex,l=0,h=this.parent.sheets.length,d=e.sheetIndex;a<=o+1;a++){if(1!==d&&e.sheetIndex===h&&(n=1),a>o&&l>s&&"Workbook"===e.mode){if(n++,d===n)return void 0;n>h-1&&(n=0),(i=this.parent.sheets[n])&&(a=0,l=0,s=i.usedRange.colIndex,o=i.usedRange.rowIndex)}if(!t.isNullOrUndefined(i)&&i.rows[a]){var p=i.rows[a];for(l===s+2&&(l=0);l<=s+1;l++)if(p&&p.cells&&p.cells[l]){var c=i.rows[a].cells[l];if(c){var u=void 0;if(c.format){u=this.parent.getDisplayText(i.rows[a].cells[l]).toString()}else u=c.value.toString();if(e.isCSen&&e.isEMatch)u===e.value&&(r=i.name+"!"+g(a,l),e.findCollection.push(r),0);else if(e.isCSen&&!e.isEMatch){var f=u.indexOf(e.value)>-1;(u===e.value||f)&&(r=i.name+"!"+g(a,l),e.findCollection.push(r),0)}else if(!e.isCSen&&e.isEMatch){(m=u.toString().toLowerCase())===e.value&&(r=i.name+"!"+g(a,l),e.findCollection.push(r),0)}else if(!e.isCSen&&!e.isEMatch){var m;f=(m=u.toString().toLowerCase()).indexOf(e.value.toLowerCase())>-1;(m===e.value||u===e.value||f||u===e.value)&&(r=i.name+"!"+g(a,l),e.findCollection.push(r),0)}}}}}},e.prototype.getModuleName=function(){return"workbookfindAndReplace"},e}(),Ii=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.protectsheetHandler=function(e){var r=t.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=be(this.parent,r);this.parent.setSheetPropertyOnMute(n,"isProtected",!0),this.parent.setSheetPropertyOnMute(n,"protectSettings",{selectCells:e.protectSettings.selectCells,formatCells:e.protectSettings.formatCells,formatColumns:e.protectSettings.formatColumns,formatRows:e.protectSettings.formatRows,insertLink:e.protectSettings.insertLink,selectUnLockedCells:e.protectSettings.selectUnLockedCells}),this.parent.notify(rn,{sheetIndex:r,triggerEvent:e.triggerEvent}),this.parent.notify(nn,{props:"Protect"}),n.password=e.password?e.password:"",n.columns.forEach(function(e){e&&t.isUndefined(e.isLocked)&&(e.isLocked=!0)})},e.prototype.unprotectsheetHandler=function(e){var t=this.parent.getActiveSheet();e.sheet&&(t=this.parent.sheets[e.sheet]),t.protectSettings.formatCells=t.protectSettings.formatColumns=!1,t.protectSettings.formatRows=t.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(t,"isProtected",!1),this.parent.notify(rn,t.protectSettings),this.parent.notify(nn,{props:"Protect"})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(on,this.protectsheetHandler,this),this.parent.on(sn,this.unprotectsheetHandler,this),this.parent.on(ln,this.lockCells,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(on,this.protectsheetHandler),this.parent.off(ln,this.lockCells),this.parent.off(on,this.unprotectsheetHandler))},e.prototype.lockCells=function(e){var t=this.parent.getAddressInfo(e.range),r=w(t.indices),n=be(this.parent,t.sheetIndex),i=!!e.isLocked&&e.isLocked;if(0===r[0]&&r[2]===n.rowCount-1)for(var o=r[1];o<=r[3];o++)qe(n,o,{isLocked:e.isLocked});for(o=r[0];o<=r[2];o++)for(var a=r[1];a<=r[3];a++)Fe(o,a,n,{isLocked:i},!0);e.triggerEvent&&this.parent.notify("actionComplete",{action:"lockCells",eventArgs:e})},e.prototype.getModuleName=function(){return"workbookProtectSheet"},e}(),Ei=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){e.sheetIndex=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=c(e.range)),e.range=w(e.range),e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify(gr,null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"}),e.sheetIndex===this.parent.activeSheetIndex&&(this.parent.notify("selectRange",{address:be(this.parent,e.sheetIndex).selectedRange,skipChecking:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(En,{range:e.range}))},e.prototype.mergeAll=function(e){var r,n=0;e.range=e.range;for(var i,o,a,s,l=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():be(this.parent,e.sheetIndex),h=e.range[0];h<=e.range[2];h++){i=0,e.isAction&&e.model.push({cells:[]});for(var d=e.range[1];d<=e.range[3];d++){if((r=ke(h,d,l))&&(r.value||r.formula)&&!o&&(o=r.formula||r.value),e.isAction&&e.merge&&(e.model[h-e.range[0]].cells[d-e.range[1]]={},t.extend(e.model[h-e.range[0]].cells[d-e.range[1]],r,null,!0)),l.rows[h]&&l.rows[h].cells&&l.rows[h].cells[d]&&(delete l.rows[h].cells[d].rowSpan,delete l.rows[h].cells[d].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[h-e.range[0]]&&e.model[h-e.range[0]].cells[d-e.range[1]]&&e.model[h-e.range[0]].cells[d-e.range[1]]!=={}&&Fe(h,d,l,e.model[h-e.range[0]].cells[d-e.range[1]])),e.merge){if(r=new Object,h===e.range[0]&&d===e.range[1]){e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),Fe(e.range[0],e.range[1],l,r,!0);continue}h!==e.range[0]&&(r.rowSpan=-n),d!==e.range[1]&&(i++,r.colSpan=-i),l.rows[h]&&l.rows[h].cells&&l.rows[h].cells[d]&&(delete l.rows[h].cells[d].value,delete l.rows[h].cells[d].formula),a=ke(h,d,l)||{},Fe(h,d,l,Object.assign(r,a))}e.preventRefresh||(this.parent.notify(dn,{rowIdx:h,colIdx:d}),s=this.isFormulaDependent(l,h,d,s))}n++}e.merge&&(r=this.getCellValue(e.range[0],e.range[1],o,l),Fe(e.range[0],e.range[1],l,r,!0),e.preventRefresh||(this.parent.notify(dn,{rowIdx:e.range[0],colIdx:e.range[1]}),this.refreshCF(l,e.range[0],e.range[1],s)))},e.prototype.isFormulaDependent=function(e,t,r,n){if(!n){var i={action:"dependentCellsAvailable",sheetId:e.id.toString(),address:g(t,r)};return this.parent.notify(pr,i),i.isAvailable}return n},e.prototype.refreshCF=function(e,t,r,n){e.conditionalFormats&&e.conditionalFormats.length&&this.parent.notify(vn,{indexes:[t,r],refreshAll:n,isAction:!0})},e.prototype.mergeHorizontally=function(e){var t;e.range=e.range;for(var r,n,i,o,a,s=be(this.parent,e.sheetIndex),l=e.range[0];l<=e.range[2];l++){t=0,e.isAction&&e.model.push({cells:[]});for(var h=e.range[1];h<=e.range[3];h++){if(o=ke(l,h,s),r=new Object,e.isAction&&(e.model[l-e.range[0]].cells[h-e.range[1]]={},Object.assign(e.model[l-e.range[0]].cells[h-e.range[1]],o)),h===e.range[1]){if(l===e.range[0])continue;i=l-1,s.rows[i]&&s.rows[i].cells&&s.rows[i].cells[h]&&delete s.rows[i].cells[h].rowSpan,r=this.getCellValue(i,h,n,s),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),n=null,Fe(i,h,s,r,!0)}else o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),i=l,s.rows[i]&&s.rows[i].cells&&s.rows[i].cells[h]&&(delete s.rows[i].cells[h].rowSpan,delete s.rows[i].cells[h].value,delete s.rows[i].cells[h].formula),t++,r.colSpan=-t,Fe(i,h,s,r,!0);this.parent.notify(dn,{rowIdx:i,colIdx:h}),a=this.isFormulaDependent(s,i,h,a)}}s.rows[e.range[2]]&&s.rows[e.range[2]].cells&&s.rows[e.range[2]].cells[e.range[1]]&&delete s.rows[e.range[2]].cells[e.range[1]].rowSpan,r=this.getCellValue(e.range[2],e.range[1],n,s),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),Fe(e.range[2],e.range[1],s,r,!0),this.parent.notify(dn,{rowIdx:e.range[2],colIdx:e.range[1]}),this.refreshCF(s,e.range[2],e.range[1],a)},e.prototype.getCellValue=function(e,t,r,n){var i=new Object,o=ke(e,t,n);return!r||o&&(o.value||o.formula)||(W(r)?i.formula=r:i.value=r),i},e.prototype.mergeVertically=function(e){var t=0;e.range=e.range;for(var r,n,i,o,a,s=be(this.parent,e.sheetIndex),l=e.range[1];l<=e.range[3];l++)for(var h=e.range[0];h<=e.range[2];h++){if(o=ke(h,l,s),e.isAction&&(void 0===e.model[h-e.range[0]]&&(e.model[h-e.range[0]]={cells:[]}),e.model[h-e.range[0]].cells[l-e.range[1]]={},Object.assign(e.model[h-e.range[0]].cells[l-e.range[1]],o)),h===e.range[0]){if(t=0,l===e.range[1])continue;i=l-1,s.rows[h]&&s.rows[h].cells&&s.rows[h].cells[i]&&delete s.rows[h].cells[i].colSpan,r=this.getCellValue(h,i,n,s),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),n=null,Fe(h,i,s,r,!0)}else r=new Object,o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),t++,i=l,s.rows[h]&&s.rows[h].cells&&s.rows[h].cells[i]&&(delete s.rows[h].cells[i].colSpan,delete s.rows[h].cells[i].value,delete s.rows[h].cells[i].formula),r.rowSpan=-t,Fe(h,i,s,r,!0);this.parent.notify(dn,{rowIdx:h,colIdx:i}),a=this.isFormulaDependent(s,l,i,a)}s.rows[e.range[0]]&&s.rows[e.range[0]].cells&&s.rows[e.range[0]].cells[e.range[3]]&&delete s.rows[e.range[0]].cells[e.range[3]].colSpan,r=this.getCellValue(e.range[0],e.range[1],n,s),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),Fe(e.range[0],e.range[3],s,r,!0),this.parent.notify(dn,{rowIdx:e.range[0],colIdx:e.range[3]}),this.refreshCF(s,e.range[0],e.range[3],a)},e.prototype.activeCellRange=function(e){e.range=e.range;var r=this.parent.getActiveSheet(),n=ke(e.range[0],e.range[1],r);n&&(!t.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(e.range[0]+=n.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!t.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(e.range[1]+=n.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(n=ke(e.range[0],e.range[1],r))&&(n.rowSpan>1&&(e.range[0]+(n.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(n.rowSpan-1)),n.colSpan>1&&(e.range[1]+(n.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(n.colSpan-1))))},e.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=c(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},e.prototype.forward=function(e){e.range=e.range;var r,n,i=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():be(this.parent,e.sheetIndex),o=ke(e.range[0],e.range[1],i),a=r=e.range[0],s=n=e.range[1];if(o&&(!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(a=r=e.range[0]+o.rowSpan),!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(s=n=e.range[1]+o.colSpan),(o=ke(a,s,i))&&(o.rowSpan>1&&(r+=o.rowSpan-1,a+(o.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=a+(o.rowSpan-1))),o.colSpan>1&&(n+=o.colSpan-1,s+(o.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=s+(o.colSpan-1))))),e.range[0]=a,e.range[1]=s,e.range[0]===a&&e.range[1]===s&&e.range[2]===r&&e.range[3]===n&&(e.isActiveCell=!0),!e.skipChecking){for(var l=e.range[1];l<=e.range[3];l++)(o=ke(e.range[2],l,i))&&(a=e.range[2],s=l,!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(s+=o.colSpan)<e.range[1]&&(e.range[1]=s),!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(a+=o.rowSpan)<e.range[0]&&(e.range[0]=a),(o=ke(a,s,i))&&(o.colSpan>1&&s+(o.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(o.colSpan-1)),o.rowSpan>1&&a+(o.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(o.rowSpan-1))));var h,d;for(l=e.range[1];l<=e.range[3];l++)(o=ke(e.range[0],l,i))&&(d=l,h=e.range[0],!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(d+=o.colSpan)<e.range[1]&&(e.range[1]=d),!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(h+=o.rowSpan)<e.range[0]&&(e.range[0]=h));for(l=e.range[0];l<=e.range[2];l++)(o=ke(l,e.range[3],i))&&(a=l,s=e.range[3],!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(a+=o.rowSpan)<e.range[0]&&(e.range[0]=a),!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(s+=o.colSpan)<e.range[1]&&(e.range[1]=s),(o=ke(a,s,i))&&(o.rowSpan>1&&a+(o.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(o.rowSpan-1)),o.colSpan>1&&s+(o.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(o.colSpan-1))))}},e.prototype.forwardReverse=function(e){var r=this.parent.getActiveSheet();e.range=e.range;var n=e.range[1],i=ke(e.range[0],e.range[1],r),o=e.range[0];if(i&&(!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(n+=i.colSpan,e.range[3]>=n&&(e.range[3]=n)),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[0]&&(e.range[0]=o),(i=ke(o,n,r))&&(i.rowSpan>1&&o+(i.rowSpan-1)>=e.range[2]&&(e.range[2]=o+(i.rowSpan-1)),i.colSpan>1&&n+(i.colSpan-1)>=e.range[1]&&(e.range[1]=n+(i.colSpan-1)))),e.range[0]=o,!e.skipChecking){for(var a,s,l=e.range[3];l<=e.range[1];l++)(i=ke(e.range[2],l,r))&&(s=l,a=e.range[2],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[0]&&(e.range[0]=a),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<e.range[3]&&(e.range[3]=s),(i=ke(a,s,r))&&(i.rowSpan>1&&a+(i.rowSpan-1)>e.range[2]&&(e.range[2]=a+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[1]&&(e.range[1]=s+(i.colSpan-1))));var h;for(l=e.range[3];l<=e.range[1];l++)(i=ke(e.range[0],l,r))&&(s=l,h=e.range[0],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[0]&&(e.range[0]=h),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan),(i=ke(h,s,r))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[2]&&(e.range[2]=h+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[1]&&(e.range[1]=s,e.range[1]=s+(i.colSpan-1))));var d;for(l=e.range[0];l<=e.range[2];l++)(i=ke(l,e.range[3],r))&&(h=l,d=e.range[3],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[0]&&(e.range[0]=h),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(d+=i.colSpan)<e.range[3]&&(e.range[3]=d),(i=ke(h,d,r))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[2]&&(e.range[2]=h,e.range[2]=h+(i.rowSpan-1)),i.colSpan>1&&d+(i.colSpan-1)>e.range[1]&&(e.range[1]=d,e.range[1]=d+(i.colSpan-1))))}},e.prototype.reverse=function(e){e.range=e.range;var r=e.range[1],n=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():be(this.parent,e.sheetIndex),i=ke(e.range[0],e.range[1],n),o=e.range[0];i&&(!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(r+=i.colSpan),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan),e.range[2]>=o&&(e.range[2]=o,e.isActiveCell=!0),e.range[3]>=r?(e.range[3]=r,e.range[2]===o&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(i=ke(o,r,n))&&(i.rowSpan>1&&o+(i.rowSpan-1)>=e.range[0]&&(e.range[0]=o,e.range[0]=o+(i.rowSpan-1)),i.colSpan>1&&r+(i.colSpan-1)>=e.range[1]&&(e.range[1]=r,e.range[1]=r+(i.colSpan-1))));var a=e.range[3];if(!e.skipChecking){for(var s=e.range[3];s<=e.range[1];s++)(i=ke(e.range[2],s,n))&&(a=s,o=e.range[2],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[2]&&(e.range[2]=o),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan)<e.range[3]&&(e.range[3]=a),(i=ke(o,a,n))&&(i.rowSpan>1&&o+(i.rowSpan-1)>e.range[0]&&(e.range[0]=o,e.range[0]=o+(i.rowSpan-1)),i.colSpan>1&&a+(i.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(i.colSpan-1))));a=e.range[3];for(s=e.range[3];s<=e.range[1];s++)(i=ke(e.range[0],s,n))&&(a=s,o=e.range[0],!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan),(i=ke(o,a,n))&&(i.colSpan>1&&a+(i.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(i.colSpan-1)),i.rowSpan>1&&o+(i.rowSpan-1)>e.range[0]&&(e.range[0]=o,e.range[0]=o+(i.rowSpan-1))));var l,h;for(s=e.range[2];s<=e.range[0];s++)(i=ke(s,e.range[3],n))&&(h=s,l=e.range[3],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[2]&&(e.range[2]=h),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(l+=i.colSpan)<e.range[3]&&(e.range[3]=l),(i=ke(h,l,n))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[0]&&(e.range[0]=h,e.range[0]=h+(i.rowSpan-1)),i.colSpan>1&&l+(i.colSpan-1)>e.range[1]&&(e.range[1]=l,e.range[1]=l+(i.colSpan-1))))}},e.prototype.reverseForward=function(e){e.range=e.range;var r=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():be(this.parent,e.sheetIndex),n=e.range[0],i=e.range[1],o=ke(e.range[0],e.range[1],r);if(o&&(!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(n+=o.rowSpan,e.range[2]>=n&&(e.range[2]=n)),!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(i+=o.colSpan),(o=ke(n,i,r))&&(o.rowSpan>1&&n+(o.rowSpan-1)>=e.range[0]&&(e.range[0]=n,e.range[0]=n+(o.rowSpan-1)),o.colSpan>1&&i+(o.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=i+(o.colSpan-1)))),!e.skipChecking){for(var a,s=e.range[3],l=e.range[1];l<=e.range[3];l++)(o=ke(e.range[2],l,r))&&(a=e.range[2],s=l,!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(a+=o.rowSpan)<e.range[2]&&(e.range[2]=a),!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(s+=o.colSpan)<e.range[1]&&(e.range[1]=s),(o=ke(a,s,r))&&(o.colSpan>1&&s+(o.colSpan-1)>e.range[3]&&(e.range[3]=s+(o.colSpan-1)),o.rowSpan>1&&o.rowSpan-1+a>e.range[0]&&(e.range[0]=o.rowSpan-1+a)));var h,d;for(l=e.range[1];l<=e.range[3];l++)(o=ke(e.range[0],l,r))&&(d=l,h=e.range[0],!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(d+=o.colSpan)<e.range[1]&&(e.range[1]=d),!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(h+=o.rowSpan),(o=ke(h,d,r))&&o.rowSpan>1&&h+(o.rowSpan-1)>e.range[0]&&(e.range[0]=h+(o.rowSpan-1)));var p;for(l=e.range[2];l<=e.range[0];l++)(o=ke(l,e.range[3],r))&&(a=l,p=e.range[3],!t.isNullOrUndefined(o.rowSpan)&&o.rowSpan<0&&(a+=o.rowSpan)<e.range[2]&&(e.range[2]=a),!t.isNullOrUndefined(o.colSpan)&&o.colSpan<0&&(p+=o.colSpan)<e.range[1]&&(e.range[1]=p),(o=ke(a,p,r))&&(o.rowSpan>1&&o.rowSpan-1+a>e.range[0]&&(e.range[0]=o.rowSpan-1+a),o.colSpan>1&&o.colSpan-1+p>e.range[3]&&(e.range[3]=p,e.range[3]=o.colSpan-1+p)))}},e.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},e.prototype.pasteHandler=function(e){for(var t,r,n,i=this.parent.getActiveSheet(),o=u(i.activeCell),a=e.range[0],s=0;a<=e.range[2];a++,s++)for(var l=e.range[1],h=0;l<=e.range[3];l++,h++){if((t=ke(a,l,e.prevSheet)||{}).rowSpan>1&&(n=ke(o[0]+(t.rowSpan-1),o[1],i)||{},r=ke(o[0]+1,o[1],i)||{},void 0!==n.colSpan&&n.colSpan<0||void 0!==r.colSpan&&r.colSpan<0))return e.cancel=!0,void this.parent.notify(dn,{showDialog:!0});if(t.colSpan>1&&(n=ke(o[0],o[1]+(t.colSpan-1),i)||{},r=ke(o[0],o[1]+1,i)||{},void 0!==n.rowSpan&&n.rowSpan<0||void 0!==r.rowSpan&&r.rowSpan<0))return e.cancel=!0,void this.parent.notify(dn,{showDialog:!0})}},e.prototype.addEventListener=function(){this.parent.on(hn,this.merge,this),this.parent.on(pn,this.mergedRange,this),this.parent.on(cn,this.activeCellRange,this),this.parent.on(un,this.insertHandler,this),this.parent.on(fn,this.pasteHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(hn,this.merge),this.parent.off(pn,this.mergedRange),this.parent.off(cn,this.activeCellRange),this.parent.off(un,this.insertHandler),this.parent.off(fn,this.pasteHandler))},e.prototype.getModuleName=function(){return"workbookmerge"},e}(),Ri="ribbon",Ai="formulaBar",ki="sheetTabs",Fi="refreshSheetTabs",Ti="isFormulaBarEdit",Li="contentLoaded",Ni="mouseDown",Di="spreadsheetDestroyed",Oi="editOperation",Mi="formulaOperation",Pi="formulaBarOperation",Hi="click",Bi="keyUp",Ui="keyDown",_i="verticalScroll",Vi="horizontalScroll",zi="beforeContentLoaded",qi="beforeVirtualContentLoaded",ji="virtualContentLoaded",Wi="cellNavigate",Gi="mouseUpAfterSelection",Yi="contextmenuBeforeOpen",Xi="insertSheetTab",Ki="removeSheetTab",$i="renameSheetTab",Zi="ribboClick",Qi="enableToolbarItems",Ji="tabSwitch",eo="selectRange",to="cut",ro="copy",no="paste",io="clearCopy",oo="addContextMenuItems",ao="removeContextMenuItems",so="enableContextMenuItems",lo="enableFileMenuItems",ho="hideFileMenuItems",po="addFileMenuItems",co="hideRibbonTabs",uo="enableRibbonTabs",fo="addRibbonTabs",go="addToolbarItems",mo="hideToolbarItems",vo="beforeRibbonCreate",yo="rowHeightChanged",Co="colWidthChanged",xo="onContentScroll",bo="deInitProperties",So="activeSheetChanged",wo="renameSheet",Io="initiateCustomSort",Eo="applySort",Ro="collaborativeUpdate",Ao="autoFitRowsColumns",ko="updateToggleItem",Fo="initiateHyperlink",To="editHyperlink",Lo="openHyperlink",No="removeHyperlink",Do="createHyperlinkElement",Oo="sheetNameUpdate",Mo="hideSheet",Po="performUndoRedo",Ho="updateUndoRedoCollection",Bo="setActionData",Uo="getBeforeActionData",_o="clearUndoRedoCollection",Vo="initiateFilterUI",zo="renderFilterCell",qo="reapplyFilter",jo="filterByCellValue",Wo="clearFilter",Go="getFilteredColumn",Yo="actionComplete",Xo="filterCellKeyDown",Ko="getFilterRange",$o="setAutoFit",Zo="refreshFormulaDatasource",Qo="setScrollEvent",Jo="initiatedatavalidation",ea="invalidData",ta="protectSheet",ra="applyProtect",na="protectCellFormat",ia="renderGotoDlgt",oa="renderFindDlg",aa="findHandler",sa="created",la="editAlert",ha="setUndoRedo",da="enableFormulaInput",pa="protectSelection",ca="hiddenMerge",ua="checkPrevMerge",fa="checkMerge",ga="removeDataValidation",ma="showAggregate",va="goToSheet",ya="showSheet",Ca="renderCFDlg",xa="clearViewer",ba="initiateFormulaReference",Sa="initiateCur",wa="clearCellRef",Ia="editValue",Ea="addressHandle",Ra="initiateEdit",Aa="forRefSelRender",ka="insertImage",Fa="refreshImgElem",Ta="refreshImgCellObj",La="getRowIdxFromClientY",Na="getColIdxFromClientX",Da="createImageElement",Oa="deleteImage",Ma="deleteChart",Pa="refreshChartCellObj",Ha="refreshImagePosition",Ba="updateTableWidth",Ua="focusBorder",_a="clearChartBorder",Va="insertChart",za="chartRangeSelection",qa="insertDesignChart",ja="removeDesignChart",Wa="chartDesignTab",Ga="addChartEle",Ya="undoRedoForChartDesign",Xa="isReact",Ka="renderReactTemplates",$a="clearTemplate",Za="protectWorkbook",Qa="unProtectWorkbook",Ja="getPassWord",es="setProtectWorkbook",ts="removeWorkbookProtection",rs="importProtectWorkbook",ns="selectionStatus",is="freeze",os="overlayEleSize",as="updateScroll",ss="positionAutoFillElement",ls="hideAutoFillOptions",hs="performAutoFill",ds="selectAutoFillRange",ps="fillRange",cs="hideAutoFillElement",us="unProtectSheetPassword",fs="updateTranslate",gs="getUpdatedScrollPosition",ms="updateScrollValue",vs="beforeCheckboxfilterRenderer",ys="refreshCheckbox",Cs="renderInsertDlg",xs="toggleFormulaBar",bs="toggleProtect",Ss=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(mn,this.setCFRule,this),this.parent.on(yn,this.clearCFRule,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(mn,this.setCFRule),this.parent.off(yn,this.clearCFRule))},e.prototype.setCFRule=function(e){var t=e.cfModel,r=void 0===e.sheetIdx?S(this.parent,t.range):e.sheetIdx,n=be(this.parent,r);t.range=t.range||n.selectedRange;var i=w(c(t.range));if(t.range=m(i),e.isAction){var o={range:t.range,type:t.type,cancel:!1,cFColor:t.cFColor,value:t.value,sheetIdx:r};if(this.parent.notify(Zt,{eventArgs:o,action:"conditionalFormat"}),o.cancel)return;t.type=o.type,t.cFColor=o.cFColor,t.value=o.value,o.range!==t.range&&(t.range=o.range,i=c(o.range)),delete o.cancel}n.conditionalFormats||this.parent.setSheetPropertyOnMute(n,"conditionalFormats",[]),n.conditionalFormats.push(t),r!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(Xr,{address:n.name+"!"+t.range}):this.parent.notify(vn,{cfModel:[t],isAction:!0}),e.isAction&&this.parent.notify(Yo,{eventArgs:{range:t.range,type:t.type,cFColor:t.cFColor,value:t.value,sheetIdx:r},action:"conditionalFormat"})},e.prototype.clearCFRule=function(e){void 0===e.sheetIdx&&(e.sheetIdx=this.parent.activeSheetIndex);var t=be(this.parent,e.sheetIdx),r=t.conditionalFormats;if(e.isUndo){if(e.updatedCFModel){var n;e.updatedCFModel.forEach(function(e){(n=r.indexOf(e))>-1&&r.splice(n,1)})}return r.splice.apply(r,[r.length,0].concat(e.oldCFModel)),this.parent.notify(vn,{cfModel:e.oldCFModel,isAction:!0}),void(e.sheetIdx!==this.parent.activeSheetIndex&&this.parent.notify(Xr,{address:t.name+"!"+e.range}))}if(r&&r.length){var i,o,a,s,l,h,d,p,u,f=e.range&&("string"==typeof e.range?c(e.range):e.range);e.oldCFModel=[],e.updatedCFModel=[];for(var g=[],v=[],y=[],C=0;C<r.length;C++){o=(i=r[C]).range.split(",");for(var x=0;x<o.length;x++){if(a=c(o[x]),e.range)if(f[0]<=a[0]&&f[1]<=a[1]&&f[2]>=a[2]&&f[3]>=a[3])o.splice(x,1),x--;else{if(d=f[0]>=a[0]&&f[0]<=a[2],p=f[2]>=a[0]&&f[2]<=a[2],l=f[1]>=a[1]&&f[1]<=a[3],h=f[3]>=a[1]&&f[3]<=a[3],s=[],d&&p?((l||h||f[1]<a[1]&&f[3]>a[3])&&(f[0]-a[0]>0&&s.push(m([a[0],a[1],f[0]-1,a[3]])),a[2]-f[2]>0&&s.push(m([f[2]+1,a[1],a[2],a[3]]))),l&&f[1]!==a[1]&&s.push(m([f[0],a[1],f[2],f[1]-1])),h&&f[3]!==a[3]&&s.push(m([f[0],f[3]+1,f[2],a[3]]))):l&&h?((d||p||f[0]<a[0]&&f[2]>a[2])&&(f[1]-a[1]>0&&s.push(m([a[0],a[1],a[2],f[1]-1])),a[3]-f[3]>0&&s.push(m([a[0],f[3]+1,a[2],a[3]]))),d?f[0]!==a[0]&&s.push(m([a[0],f[1],f[0]-1,f[3]])):p&&f[2]!==a[2]&&s.push(m([f[2]+1,f[1],a[2],f[3]]))):(d||p)&&(l?(f[1]!==a[1]&&s.push(m([a[0],a[1],a[2],f[1]-1])),f[0]-a[0]>0?s.push(m([a[0],f[1],f[0]-1,a[3]])):a[2]-f[2]>0&&s.push(m([f[2]+1,f[1],a[2],a[3]]))):h&&(f[3]!==a[3]&&s.push(m([a[0],f[3]+1,a[2],a[3]])),f[0]-a[0]>0?s.push(m([a[0],a[1],f[0]-1,f[3]])):a[2]-f[2]>0&&s.push(m([f[2]+1,a[1],a[2],f[3]])))),!s.length)continue;o[x]=s.join(",")}else f=a,o.splice(x,1),x--;e.sheetIdx===this.parent.activeSheetIndex&&this.parent.notify(xn,{indexes:f})}if((u=o.join(","))!==i.range){if(e.cfModel&&(e.cfModel.cFColor!==i.cFColor||e.cfModel.type!==i.type||e.cfModel.value!==i.value)){y.push(i);continue}v.push(i.range),u?(e.oldCFModel.push({type:i.type,cFColor:i.cFColor,format:i.format,range:i.range,value:i.value}),i.range=u,i.result&&(delete i.result,this.parent.notify(vn,{cfModel:[i],isAction:!0})),e.updatedCFModel.push(i),g.push(i)):(e.oldCFModel.push(i),g.concat(r.splice(C,1)),C--)}}if(e.sheetIdx!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(Xr,{address:t.name+"!"+e.range}):y.length&&this.parent.notify(vn,{cfModel:y,isAction:!0}),(e.isAction||e.isClear)&&e.oldCFModel.length){var b={cFormats:g,oldRange:v,previousConditionalFormats:e.oldCFModel,sheetIdx:e.sheetIdx,selectedRange:e.range};e.updatedCFModel.length&&(b.conditionalFormats=e.updatedCFModel),e.isClear?e.cfClearActionArgs=b:this.parent.notify(Yo,{eventArgs:b,action:"clearCF"})}}},e.prototype.getModuleName=function(){return"workbookConditionalFormatting"},e}(),ws=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueLTOperator=String.fromCharCode(142),this.uniqueMOperator=String.fromCharCode(135),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.parent=e,this.addEventListener()}return e.prototype.getFillInfo=function(e){for(var r="",n=!0,i="CopyCells",o=[],a=["Down","Up"].indexOf(e.direction)>-1,s=this.getRangeData({range:e.dataRange,sheetIdx:this.parent.activeSheetIndex}),l=s.join().replace(/,/g,"").length,h=this.isRange(e.dataRange)&&l?s.length:1;h--;)if(r=s[h]&&!t.isNullOrUndefined(s[h].value)?s[h].value:"",N(r)||W(r)||N(r[r.length-1])){n=!1,i=this.parent.autoFillSettings.fillType;break}return l&&!n||(o.push("Fill Series"),i="FillSeries"===e.fillType?i:e.fillType),(!a||a&&e.dataRange[1]!==e.dataRange[3])&&o.push("Flash Fill"),{fillType:i,disableItems:o}},e.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},e.prototype.autoFill=function(e){if(e.dataRange&&e.fillRange&&e.direction&&this.parent.allowEditing&&(!this.parent.getActiveSheet().isProtected||!e.isLockedCell)){var t={dataRange:null,fillRange:null,fillType:null,direction:null,sheetIndex:S(this.parent,e.dataRange)},r=w(c(e.dataRange)),n=w(c(e.fillRange));switch(this.fillInfo=this.getFillInfo({dataRange:r,fillRange:n,fillType:e.fillType,direction:e.direction}),t.dataRange=r,t.fillRange=n,t.direction=e.direction,t.fillType=e.fillType||this.fillInfo.fillType,this.fillInfo.fillType=e.isFillOptClick?e.fillType:this.fillInfo.fillType,e.fillType){case"FillSeries":case"FillWithoutFormatting":this.fillSeries(t);break;case"CopyCells":case"FillFormattingOnly":this.copyCells(t)}}},e.prototype.fillSeries=function(e){for(var r,n,i,o,a,s,l,h,d,p,c,u,f,g,m,y,C,x,b,S,w,I,E={},R=0,A=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,k=be(this.parent,A),F=e.dataRange[0],T=e.dataRange[1],L=e.dataRange[2],D=e.dataRange[3],O=e.fillRange[0],M=e.fillRange[1],P=e.fillRange[2],H=e.fillRange[3],B=["Down","Up"].indexOf(e.direction)>-1,U=["Up","Left"].indexOf(e.direction)>-1,_=B?D-T:L-F,V="FillSeries"===e.fillType,z=k.conditionalFormats&&k.conditionalFormats.length&&[].slice.call(k.conditionalFormats),q=[];R<=_;){if(a=this.updateFillValues(B,F,T,L,D,O,M,P,H,R),s=a.patternRange,l=a.fillRange,i=this.getPattern(s,{isRFill:U,isVFill:B}),h=this.getRangeData({range:s,sheetIdx:A}),p=h.length,!i)return;for(n=i.length,x=(C=this.getSelectedRange(k,{rowIndex:l[0],colIndex:l[1]},{rowIndex:l[2],colIndex:l[3]})).length,U&&(C=C.reverse(),i=i.reverse(),i=this.ensurePattern(i),h=h.reverse()),c=0;c<x;){switch(b=C[c],o=i[c%n],N(o)&&(o=i[o]),f=c%p,o.type){case"number":if(r=this.round(o.regVal.a+o.regVal.b*o.i,5).toString(),(o=o).dataVal){if(void 0===o.copy&&(o.copy=o.val.length>2,o.copy))for(var j=2;j<o.val.length&&(o.copy=Math.abs(this.round(o.regVal.a+o.regVal.b*j,5))!==o.val[j],!o.copy);j++);r=o.copy?h[f]&&!t.isNullOrUndefined(h[f].value)?h[f].value:"":o.start?Math.abs(Number(r))+o.dataVal:o.dataVal+Math.abs(Number(r))}U?o.i--:o.i++;break;case"string":var G=o.i%o.val.length;r=o.val[G],o.i++;break;case"formula":for(y=!1,r="=",u=0,g=o.val.length;u<g;)"object"==typeof(d=o.val[u])?(y=!0,r+=(m=this.round(d.a+d.b*o.i,5))<1?"#REF!":B?d.c+(d.b?m:"$"+m):(d.b?v(m):d.c.substring(0,d.c.search(/\d/))+"$"+v(m))+d.c.trim()):r+=d,u++;y&&U?o.i--:o.i++;break;case"time":r=(o.regVal.a+o.regVal.b*o.i).toString(),U?o.i--:o.i++}S=ke(b.rowIndex,b.colIndex,k,!1,!0),V?Object.assign(E,h[f],null,!0):(E.style=S.style,E.format=S.format,E.wrap=S.wrap,E.rowSpan=S.rowSpan,E.colSpan=S.colSpan),E.value=r,W(r)&&(E.formula=r),w={cell:E,rowIdx:b.rowIndex,colIdx:b.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0},oe(this.parent,k,w),z&&!I&&((I=w.isFormulaDependent)||he(z,q,b.rowIndex,b.colIndex)),E={},c++}R++}(q.length||I)&&this.parent.notify(vn,{cfModel:!I&&q,refreshAll:I,isAction:!0})},e.prototype.copyCells=function(e){for(var r,n,i,o,a,s,l,h,d,p,c,u,f,g=0,m={},v=e.dataRange[0],y=e.dataRange[1],C=e.dataRange[2],x=e.dataRange[3],b=e.fillRange[0],S=e.fillRange[1],w=e.fillRange[2],I=e.fillRange[3],E=["Down","Up"].indexOf(e.direction)>-1,R=["Up","Left"].indexOf(e.direction)>-1,A=E?x-y:C-v,k=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,F=be(this.parent,k),T="FillFormattingOnly"===e.fillType,L=F.conditionalFormats&&F.conditionalFormats.length&&[].slice.call(F.conditionalFormats),N=[];g<=A;){for(i=(a=this.updateFillValues(E,v,y,C,x,b,S,w,I,g)).patternRange,o=a.fillRange,l=(s=this.getRangeData({range:i,sheetIdx:k})).length,d=(h=this.getSelectedRange(F,{rowIndex:o[0],colIndex:o[1]},{rowIndex:o[2],colIndex:o[3]})).length,r=0,R&&(h=h.reverse());r<d;)n=r%l,p=h[r],T&&(c=ke(p.rowIndex,p.colIndex,F)),Object.assign(m,s[n],null,!0),T&&(m.value=c.value,m.formula=c.formula),f={cell:m,rowIdx:p.rowIndex,colIdx:p.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0},oe(this.parent,F,f),L&&!u&&((u=f.isFormulaDependent)||he(L,N,p.rowIndex,p.colIndex)),m={},r++;g++}(N.length||u)&&this.parent.notify(vn,{cfModel:!u&&N,refreshAll:u,isAction:!0})},e.prototype.updateFillValues=function(e,t,r,n,i,o,a,s,l,h){var d,p,c,u;e?(d={rowIndex:t,colIndex:r+h},p={rowIndex:n,colIndex:r+h},c={rowIndex:o,colIndex:a+h},u={rowIndex:s,colIndex:a+h}):(d={rowIndex:t+h,colIndex:r},p={rowIndex:t+h,colIndex:i},c={rowIndex:o+h,colIndex:a},u={rowIndex:o+h,colIndex:l});return{patternRange:[d.rowIndex,d.colIndex,p.rowIndex,p.colIndex],fillRange:[c.rowIndex,c.colIndex,u.rowIndex,u.colIndex]}},e.prototype.getType=function(e,t){var r;return t?r="time":W(e)?r="formula":N(e)&&(r="number"),r||"string"},e.prototype.getDataPattern=function(e){var r,n,i,o=0,a={val:null,type:null},s=[],l=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex}),h=l.length;if(h){for(var d=void 0,p=void 0,c=function(e){return!i&&e&&"-"===e[e.length-1]?e.slice(0,e.length-1):e};o<h;){if(r=l[o]?l[o].formula?l[o].formula:t.isNullOrUndefined(l[o].value)?"":l[o].value:"",n=this.getType(r,l[o]&&"h:mm:ss AM/PM"===l[o].format),p="","string"===n){if(i=!1,N(r[0])){d=0;do{d++}while(N(r[d]));" "===r[d]&&(i=!0,n="number",p=r.slice(d,r.length),r=Number(r.slice(0,d)))}if(r=r,!i&&N(r[r.length-1])){d=1;do{d++}while(N(r[r.length-d]));n="number",d-=1,p=r.slice(0,r.length-d),r=Number(r.slice(r.length-d,r.length)),a.dataVal&&a.dataVal!==p&&a.dataVal===c(p)&&(p=a.dataVal)}}0===o?(a={val:[r],type:n},p&&(a.dataVal=p,a.start=i)):n!==a.type||a.dataVal&&c(a.dataVal)!==c(p)?(s.push(a),a={val:[r],type:n},p&&(a.dataVal=p,a.start=i)):a.val.push(r),o++}return s.push(a),s}return[{val:null,type:null}]},e.prototype.getPredictionValue=function(e,t){for(var r=0,n=0,i=0,o=0,a=0,s=0,l=0,h=e.length;r<h;)n+=r,i+=Number(e[r]),o+=r*Number(e[r]),a+=r*r,r++;return t?(s=(i*a-n*o)/(h*a-n*n),l=(h*o-n*i)/(h*a-n*n)):(s=this.round((i*a-n*o)/(h*a-n*n),5),l=this.round((h*o-n*i)/(h*a-n*n),5)),{a:s,b:l}},e.prototype.getPattern=function(e,t){var r,n,i,o,a,s,l=0,h=[],d=this.getDataPattern(e),p=d.length;if(d){for(;l<p;){switch((s=d[l]).type){case"number":if(n=h.length,a=s.val.length,o=t.isRFill?-1:a,1===a){var c=parseFloat(s.val[0])+1;s.val.push(c)}for(i={regVal:this.getPredictionValue(s.dataVal?s.val.slice(0,2):s.val),type:s.type,i:o},s.dataVal&&(i.dataVal=s.dataVal,i.val=s.val,i.start=s.start),h.push(i),r=1;r<a;)h.push(n),r++;break;case"string":for(n=h.length,i={val:s.val,type:s.type,i:0},h.push(i),r=1,a=s.val.length;r<a;)h.push(n),r++;break;case"formula":if(a=s.val.length,s=this.getFormulaPattern(s.val,t),o=t.isRFill?-1:a,s.isInPattern)for(n=h.length,i={val:s.val,type:"formula",i:o},h.push(i),r=1;r<a;)h.push(n),r++;else for(r=0,o=t.isRFill?-1:1;r<a;)h.push({val:s.val[r],type:"formula",i:o}),r++;break;case"time":if(n=h.length,a=s.val.length,o=t.isRFill?-1:1,1===a){var u=F(s.val[0]),f=T(new Date(u.getTime()+36e5),!0);s.val.push(f)}for(i={regVal:this.getPredictionValue(s.val,!0),type:s.type,i:o},h.push(i),r=1;r<a;)h.push(n),r++}l++}return h}return[{regVal:null}]},e.prototype.isCellReference=function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},e.prototype.round=function(e,t){return Number(Math.round(parseFloat(e+"e"+t))+"e-"+t)},e.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],o=e.range[1],a=e.range[2],s=e.range[3],l=o;i<=a;)if(He(n,i))i++;else{for(o=l;o<=s;)Ge(n,o)?o++:(t=ke(i,o,n),r.push(t),o++);i++}return r},e.prototype.getFormulaPattern=function(e,t){for(var r,n,i,o,a=[],s=0,l=e.length;s<l;)a.push(this.parseFormula(e[s])),s++;var h=this.isInPattern(a,t.isVFill);if(h){for(s=(i=a[0]).length;s--;)n=i[s],(o=this.isCellReference(n))&&"absolute"!==o&&(i[s]=this.getCellRefPrediction(n,t,null,o));return{isInPattern:h,val:i}}for(s=0;s<l;){for(r=(i=a[s]).length;r--;)n=i[r],(o=this.isCellReference(n.trim()))&&"absolute"!==o&&(a[s][r]=this.getCellRefPrediction(n,t,l,o));s++}return{isInPattern:h,val:a}},e.prototype.generateColCount=function(e){for(var t=0,r=e.split("").reverse().join(""),n=r.length-1;n>=0;n--)t+=(e[n].charCodeAt(parseInt(r[n],10))-64)*Math.pow(26,n);return t},e.prototype.getCellRefPrediction=function(e,t,r,n){e=e.toUpperCase();var i=new RegExp("[a-z$]","gi"),o=new RegExp("[0-9$]","g"),a=t.isVFill?e.replace(o,""):e.replace(i,""),s=t.isVFill?Number(e.replace(i,"")):this.generateColCount(e.replace(o,"").trim()),l=null,h=[s],d="$"===e[0];if(!d&&e.includes("$")&&"$"===e.trim()[0])for(var p=1;p<e.length;p++)if("$"===e[p]){l=p,d=!0;break}return r&&1!==r?h.push(s+r):h.push(s+1),s=this.getPredictionValue(h),n&&"mixed"===n&&(d===t.isVFill?a=l?a.substring(0,l)+"$"+a.substring(l):"$"+a:s.b=0),s.c=a,s},e.prototype.isInPattern=function(e,t){var r,n,i,o,a,s,l,h,d=0,p=1,c=e.length,u=new RegExp("[0-9$]","g"),f=new RegExp("[a-z$]","gi");if(1===c)return!1;for(;p<c;){if(r=e[d],i=e[p],n=r.length,o=i.length,n!==o)return!1;for(;n--;)if(a=r[n],s=i[n],this.isCellReference(a)===this.isCellReference(s)){if(t?(l=Number(a.replace(f,"")),h=Number(s.replace(f,""))):(l=this.generateColCount(a.replace(u,"")),h=this.generateColCount(s.replace(u,""))),l!==h-1)return!1}else if(a!==s)return!1;d++,p++}return!0},e.prototype.parseFormula=function(e){for(var t,r,n=0,i=[],o=(e=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;n<o;)(t=e[n])?(1===t.length?i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(r=t[0],t.indexOf("!")>0?(this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1)),r=t.indexOf("!")+1,i.push(t.substr(0,r)),i.push(t.substr(r))):this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t)),n++):n++;return i},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueSOperator:return"-";case this.uniqueOBracket:return"(";case this.uniqueCOperator:return":";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueModOperator:return"%";case this.uniquePOperator:return"+"}return""},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(parseInt(e,10));return t>=129&&t<=142},e.prototype.markSpecialChar=function(e){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.ensurePattern=function(e){for(var t,r=-1,n=e.length;n--;)"object"==typeof(t=e[n])?(r=n,"string"===t.type&&(t.val=t.val.reverse())):e[n]=r;return e},e.prototype.getSelectedRange=function(e,t,r){var n,i,o,a=[],s=w([t.rowIndex,t.colIndex,r.rowIndex,r.colIndex]);n=s[0];for(var l=s[2];n<=l;)if(Be(e,n))n++;else{for(i=s[1],o=s[3];i<=o;)a.push({rowIndex:n,colIndex:i}),i++;n++}return a},e.prototype.getFillType=function(e){return e.fillType=this.fillInfo.fillType,e.disableItems=this.fillInfo.disableItems,e},e.prototype.addEventListener=function(){this.parent.on(Hn,this.autoFill,this),this.parent.on(Un,this.getFillType,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Hn,this.autoFill),this.parent.off(Un,this.getFillType))},e.prototype.getModuleName=function(){return"workbookautofill"},e}(),Is=function(){function e(){ol.Inject(zt,Jn,qt,Vt,mi,vi,pi,ci,yi,ui,Ci,xi,wi,Ii,bi,Ei,Ss,fi,gi,ws)}return e.prototype.getModuleName=function(){return"workbookBasic"},e.prototype.destroy=function(){},e}(),Es=function(){function e(){ol.Inject(zt,Jn,Vt,mi,vi,pi,qt,ci,yi,ui,Ci,xi,wi,Ii,bi,Ei,Ss,fi,gi,ws)}return e.prototype.getModuleName=function(){return"workbook-all"},e.prototype.destroy=function(){},e}(),Rs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),As=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ks=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("Calibri")],r.prototype,"fontFamily",void 0),As([t.Property("bottom")],r.prototype,"verticalAlign",void 0),As([t.Property("left")],r.prototype,"textAlign",void 0),As([t.Property("0pt")],r.prototype,"textIndent",void 0),As([t.Property("#000000")],r.prototype,"color",void 0),As([t.Property("#ffffff")],r.prototype,"backgroundColor",void 0),As([t.Property("normal")],r.prototype,"fontWeight",void 0),As([t.Property("normal")],r.prototype,"fontStyle",void 0),As([t.Property("11pt")],r.prototype,"fontSize",void 0),As([t.Property("none")],r.prototype,"textDecoration",void 0),As([t.Property("")],r.prototype,"border",void 0),As([t.Property("")],r.prototype,"borderTop",void 0),As([t.Property("")],r.prototype,"borderBottom",void 0),As([t.Property("")],r.prototype,"borderLeft",void 0),As([t.Property("")],r.prototype,"borderRight",void 0),r}(t.ChildProperty),Fs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property()],r.prototype,"sheetIndex",void 0),As([t.Property()],r.prototype,"filterRange",void 0),As([t.Property(!1)],r.prototype,"hasFilter",void 0),As([t.Property()],r.prototype,"column",void 0),As([t.Property()],r.prototype,"criteria",void 0),As([t.Property()],r.prototype,"value",void 0),As([t.Property()],r.prototype,"dataType",void 0),As([t.Property()],r.prototype,"predicates",void 0),r}(t.ChildProperty),Ts=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property()],r.prototype,"sortRange",void 0),As([t.Property()],r.prototype,"columnIndex",void 0),As([t.Property()],r.prototype,"order",void 0),As([t.Property()],r.prototype,"sheetIndex",void 0),r}(t.ChildProperty),Ls=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("")],r.prototype,"name",void 0),As([t.Property("")],r.prototype,"scope",void 0),As([t.Property("")],r.prototype,"comment",void 0),As([t.Property("")],r.prototype,"refersTo",void 0),r}(t.ChildProperty),Ns=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property(!1)],r.prototype,"selectCells",void 0),As([t.Property(!1)],r.prototype,"selectUnLockedCells",void 0),As([t.Property(!1)],r.prototype,"formatCells",void 0),As([t.Property(!1)],r.prototype,"formatRows",void 0),As([t.Property(!1)],r.prototype,"formatColumns",void 0),As([t.Property(!1)],r.prototype,"insertLink",void 0),r}(t.ChildProperty),Ds=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("")],r.prototype,"address",void 0),r}(t.ChildProperty),Os=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("WholeNumber")],r.prototype,"type",void 0),As([t.Property("Between")],r.prototype,"operator",void 0),As([t.Property("0")],r.prototype,"value1",void 0),As([t.Property("0")],r.prototype,"value2",void 0),As([t.Property(!0)],r.prototype,"ignoreBlank",void 0),As([t.Property(!0)],r.prototype,"inCellDropDown",void 0),As([t.Property(!1)],r.prototype,"isHighlighted",void 0),As([t.Property("")],r.prototype,"address",void 0),r}(t.ChildProperty),Ms=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("General")],r.prototype,"format",void 0),As([t.Complex({},ks)],r.prototype,"style",void 0),As([t.Property(!0)],r.prototype,"isLocked",void 0),r}(t.ChildProperty),Ps=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("GreaterThan")],r.prototype,"type",void 0),As([t.Complex({},Ms)],r.prototype,"format",void 0),As([t.Property("RedFT")],r.prototype,"cFColor",void 0),As([t.Property("")],r.prototype,"value",void 0),As([t.Property("")],r.prototype,"range",void 0),r}(t.ChildProperty),Hs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property(!0)],r.prototype,"visible",void 0),As([t.Property("Auto")],r.prototype,"position",void 0),r}(t.ChildProperty),Bs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property(!1)],r.prototype,"visible",void 0),As([t.Property("Auto")],r.prototype,"position",void 0),r}(t.ChildProperty),Us=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property(0)],r.prototype,"width",void 0),r}(t.ChildProperty),_s=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property(0)],r.prototype,"width",void 0),r}(t.ChildProperty),Vs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("")],r.prototype,"title",void 0),As([t.Complex({},Us)],r.prototype,"majorGridLines",void 0),As([t.Complex({},_s)],r.prototype,"minorGridLines",void 0),As([t.Property(!0)],r.prototype,"visible",void 0),r}(t.ChildProperty),zs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("Line")],r.prototype,"type",void 0),As([t.Property("Material")],r.prototype,"theme",void 0),As([t.Property(!1)],r.prototype,"isSeriesInRows",void 0),As([t.Property("")],r.prototype,"range",void 0),As([t.Property("")],r.prototype,"id",void 0),As([t.Property("")],r.prototype,"title",void 0),As([t.Property(290)],r.prototype,"height",void 0),As([t.Property(480)],r.prototype,"width",void 0),As([t.Property(0)],r.prototype,"top",void 0),As([t.Property(0)],r.prototype,"left",void 0),As([t.Complex({},Hs)],r.prototype,"legendSettings",void 0),As([t.Complex({},Vs)],r.prototype,"primaryXAxis",void 0),As([t.Complex({},Vs)],r.prototype,"primaryYAxis",void 0),As([t.Complex({},Bs)],r.prototype,"dataLabelSettings",void 0),r}(t.ChildProperty),qs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("")],r.prototype,"src",void 0),As([t.Property("")],r.prototype,"id",void 0),As([t.Property(300)],r.prototype,"height",void 0),As([t.Property(400)],r.prototype,"width",void 0),As([t.Property(0)],r.prototype,"top",void 0),As([t.Property(0)],r.prototype,"left",void 0),r}(t.ChildProperty),js=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Rs(r,e),As([t.Property("FillSeries")],r.prototype,"fillType",void 0),As([t.Property(!0)],r.prototype,"showFillOptions",void 0),r}(t.ChildProperty),Ws="spreadsheetLocale",Gs={SortOutOfRangeError:"Select a cell or range inside the used range and try again."},Ys=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xs=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Ks=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ys(r,e),r.prototype.setProperties=function(t,r){var n=this,i="parentObj",o="currRangeIdx",a="controlParent";if(this[i].isComplexArraySetter&&this[a]&&this[a].isAngular)if(Object.keys(t).length){void 0===this[i][o]?this[i][o]=0:this[i][o]+=1;var s=this[i].ranges[this[i][o]];s&&s.info&&(this.info=s.info),setTimeout(function(){void 0!==n[i][o]&&delete n[i][o]})}else if(this[a].tagObjects[0].instance&&this[a].tagObjects[0].instance.hasChanges&&!this[a].tagObjects[0].instance.isInitChanges){var l=this[a].sheets.indexOf(this[i]);if(void 0===this[i].changedRangeIdx){for(var h,d=this[a].tagObjects[0].instance.list[l].tagObjects,p=0;p<d.length;p++)if("ranges"===d[p].name){d[p].instance.list.forEach(function(e,t){e.hasChanges&&(h=t)});break}this[i].changedRangeIdx=h}}e.prototype.setProperties.call(this,t,r)},Xs([t.Property(null)],r.prototype,"dataSource",void 0),Xs([t.Property("A1")],r.prototype,"startCell",void 0),Xs([t.Property(null)],r.prototype,"query",void 0),Xs([t.Property(!0)],r.prototype,"showFieldAsHeader",void 0),Xs([t.Property("")],r.prototype,"template",void 0),Xs([t.Property("A1")],r.prototype,"address",void 0),r}(t.ChildProperty),$s=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ys(r,e),Xs([t.Property(0)],r.prototype,"rowIndex",void 0),Xs([t.Property(0)],r.prototype,"colIndex",void 0),r}(t.ChildProperty),Zs=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ys(r,e),Xs([t.Property(null)],r.prototype,"rows",void 0),Xs([t.Property(null)],r.prototype,"columns",void 0),Xs([t.Complex({},Ns)],r.prototype,"protectSettings",void 0),Xs([t.Collection([],Ks)],r.prototype,"ranges",void 0),Xs([t.Collection([],Ps)],r.prototype,"conditionalFormats",void 0),Xs([t.Property(0)],r.prototype,"index",void 0),Xs([t.Property("")],r.prototype,"name",void 0),Xs([t.Property(100)],r.prototype,"rowCount",void 0),Xs([t.Property(100)],r.prototype,"colCount",void 0),Xs([t.Property("A1:A1")],r.prototype,"selectedRange",void 0),Xs([t.Property("A1")],r.prototype,"activeCell",void 0),Xs([t.Property({})],r.prototype,"usedRange",void 0),Xs([t.Property("A1")],r.prototype,"topLeftCell",void 0),Xs([t.Property(!0)],r.prototype,"showHeaders",void 0),Xs([t.Property(!0)],r.prototype,"showGridLines",void 0),Xs([t.Property(!1)],r.prototype,"isProtected",void 0),Xs([t.Property("Visible")],r.prototype,"state",void 0),Xs([t.Property(0)],r.prototype,"frozenRows",void 0),Xs([t.Property(0)],r.prototype,"frozenColumns",void 0),Xs([t.Property("A1")],r.prototype,"paneTopLeftCell",void 0),Xs([t.Property("")],r.prototype,"password",void 0),r}(t.ChildProperty),Qs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Js=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},el=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Qs(r,e),Js([t.Collection([],qs)],r.prototype,"image",void 0),Js([t.Collection([],zs)],r.prototype,"chart",void 0),Js([t.Property("")],r.prototype,"value",void 0),Js([t.Property("")],r.prototype,"formula",void 0),Js([t.Property(0)],r.prototype,"index",void 0),Js([t.Property("General")],r.prototype,"format",void 0),Js([t.Complex({},ks)],r.prototype,"style",void 0),Js([t.Property("")],r.prototype,"hyperlink",void 0),Js([t.Property(!1)],r.prototype,"wrap",void 0),Js([t.Property(!0)],r.prototype,"isLocked",void 0),Js([t.Property("")],r.prototype,"validation",void 0),Js([t.Property(1)],r.prototype,"colSpan",void 0),Js([t.Property(1)],r.prototype,"rowSpan",void 0),r}(t.ChildProperty),tl=function(){function e(){this.services={}}return e.prototype.getService=function(e){if(t.isNullOrUndefined(this.services[e]))throw"The service "+e+" is not registered";return this.services[e]},e.prototype.register=function(e,r){t.isNullOrUndefined(this.services[e])&&(this.services[e]=r)},e}(),rl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),nl=function(){return(nl=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},il=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ol=function(e){function r(t){var r=e.call(this,t)||this;return r.isEdit=!1,r.sheetNameCount=1,r.dataValidationRange="",r.isOpen=!1,r.chartColl=[],n.Inject(zt,Jn,qt,Vt,mi,vi,pi,ci,yi,ui,Ci,wi,bi,Ii,Ei,Ss,fi,gi,ws),r.commonCellStyle={},t&&t.cellStyle&&(r.commonCellStyle=t.cellStyle),"workbook"===r.getModuleName()&&(r.serviceLocator=new tl,r.initWorkbookServices(),r.dataBind(),r.initEmptySheet()),r}rl(r,e),n=r,r.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=Te(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()},r.prototype.initWorkbookServices=function(){this.serviceLocator.register(Ws,new t.L10n(this.getModuleName(),Gs,this.locale))},r.prototype.render=function(){},r.prototype.requiredModules=function(){return j(this)},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();t=t||r.selectedRange,this.notify(ar,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1})},r.prototype.lockCells=function(e,t){var r=this.getActiveSheet();e=e||r.selectedRange,this.notify(ln,{range:e,isLocked:t,triggerEvent:!0})},r.prototype.getCellStyleValue=function(e,t){var r=this,n=ke(t[0],t[1],this.getActiveSheet()),i={};return e.forEach(function(e){i[e]=r.cellStyle[e],n&&n.style&&n.style[e]&&(i[e]=n.style[e])}),i},r.prototype.numberFormat=function(e,t){this.notify(nr,{format:e,range:t})},r.prototype.createSheet=function(e,t){void 0===e&&(e=this.sheets.length),void 0===t&&(t=[{}]);var r;(r=this.sheets).splice.apply(r,[e,0].concat(t)),Ie(this,t),this.notify(yr,{sheetIndex:e||0,sheets:t}),this.notify(pr,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})},r.prototype.removeSheet=function(e){this.sheets.splice(e,1)},r.prototype.destroy=function(){this.notify(jt,null),e.prototype.destroy.call(this)},r.prototype.onPropertyChanged=function(e,r){for(var n=0,i=Object.keys(e);n<i.length;n++){switch(i[n]){case"cellStyle":t.merge(this.commonCellStyle,e.cellStyle);break;case"sheets":e.sheets===this.sheets?(this.notify(pr,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify(Cr,{}),Ie(this),this.notify(yr,null),this.notify(pr,{action:"registerSheet"})):Ie(this)}}},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)Pe(n,i,{hidden:r})},r.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)qe(n,i,{hidden:r})},r.prototype.setBorder=function(e,t,r){this.notify(ar,{style:e,borderType:r,range:t||this.getActiveSheet().selectedRange})},r.prototype.insertRow=function(e,t,r){this.notify(Vr,{model:this.getSheetModel(r),start:e,end:t,modelType:"Row",insertType:"below"})},r.prototype.insertColumn=function(e,t,r){this.notify(Vr,{model:this.getSheetModel(r),start:e,end:t,modelType:"Column",insertType:"after"})},r.prototype.insertSheet=function(e,t){this.notify(Vr,{model:this,start:e,end:t,modelType:"Sheet"})},r.prototype.delete=function(e,r,n,i){e=e||0;var o;if(n&&"Sheet"!==n){if(!(o=this.getSheetModel(i)))return}else o=this;this.notify(zr,{model:o,start:e,end:t.isNullOrUndefined(r)?e:r,modelType:n||"Sheet"})},r.prototype.moveSheet=function(e,t){Re(this,e,t)},r.prototype.duplicateSheet=function(e){Ae(this,e)},r.prototype.getSheetModel=function(e){if(t.isNullOrUndefined(e))return this.getActiveSheet();var r="string"==typeof e?fe(this,e):e;return t.isNullOrUndefined(r)||r>=this.sheets.length?null:this.sheets[r]},r.prototype.merge=function(e,t){var r,n;e?n=be(this,r=S(this,e)):e=(n=this.getActiveSheet()).selectedRange,this.notify(hn,{merge:!0,range:e,type:t||"All",sheetIndex:r,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==r})},r.prototype.unMerge=function(e){this.notify($n,{range:e})},r.prototype.computeExpression=function(e){var t={action:"computeExpression",formula:e};return this.notify(pr,t),t.calcValue},r.prototype.initEmptySheet=function(){this.sheets.length?Ie(this):this.createSheet()},r.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},r.prototype.skipHiddenSheets=function(e,t,r){return void 0===r&&(r=0),this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++r)),r===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e},r.prototype.setUsedRange=function(e,t,r,n,i){if(void 0===r&&(r=this.getActiveSheet()),i)return r.usedRange.rowIndex=e,void(r.usedRange.colIndex=t);e>r.usedRange.rowIndex&&(r.usedRange.rowIndex=e,r!==this.getActiveSheet()||n||this.notify(dr,{index:e,update:"row"})),t>r.usedRange.colIndex&&(r.usedRange.colIndex=t,r!==this.getActiveSheet()||n||this.notify(dr,{index:t,update:"col"}))},r.prototype.getData=function(e){return pe(this,e)},r.prototype.getModuleName=function(){return"workbook"},r.prototype.goTo=function(e){},r.prototype.getValueRowCol=function(e,r,n,i,o,a){var s={action:"getSheetInfo",sheetInfo:[]};if(this.notify(pr,s),-1===ve(0,"Sheet"+e,s.sheetInfo)){var l={action:"getReferenceError",refError:""};return this.notify(pr,l),l.refError}var h=ge(this,e),d=be(this,h),p=ke(r-1,n-1,d);if(i&&i.includes("!")&&!p&&d.ranges&&d.ranges.length){var c;if(this.formulaRefCell&&this.formulaRefCell===i)return p&&p.value;if(d.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(c=!0)}),c){if(this.formulaRefCell=i,h=ge(this,Number(i.substring(i.lastIndexOf(",")+1,i.length))),t.isNullOrUndefined(h))return p&&p.value;i=i.substring(i.lastIndexOf("!")+1,i.lastIndexOf(",")),pe(this,d.name+"!A1:"+g(r-1,n-1),null,null,null,null,i,h)}}else p&&p.formula&&(o||t.isNullOrUndefined(p.value))&&!a&&this.notify("calculateFormula",{cell:p,rowIdx:r-1,colIdx:n-1,sheetIndex:h,formulaRefresh:!0});return p&&p.value},r.prototype.setValueRowCol=function(e,t,r,n,i){this.notify(cr,{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:ge(this,e),isValueOnly:!0,formula:i})},r.prototype.open=function(e){this.notify(Kt,e)},r.prototype.openFromJson=function(e){this.isOpen=!0;var t="object"==typeof e.file?JSON.stringify(e.file):e.file;this.notify(Kt,{jsonObject:t})},r.prototype.save=function(e){if(void 0===e&&(e={}),this.allowSave){var t={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},r=nl({},t,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1,pdfLayoutSettings:{fitSheetOnOnePage:!1}});this.trigger("beforeSave",r),this.notify(Zt,{eventArgs:r,action:"beforeSave"}),r.cancel||this.notify($t,{saveSettings:r,isFullPost:r.isFullPost,needBlobData:r.needBlobData,customParams:r.customParams,pdfLayoutSettings:r.pdfLayoutSettings})}},r.prototype.saveAsJson=function(){var e=this;return new Promise(function(t){e.on(Br,function(r){r.cancel=!0,e.off(Br),t({jsonObject:{Workbook:r.jsonObject}}),e.notify(rr,r)}),e.save()})},r.prototype.addHyperlink=function(e,t){var r={hyperlink:e,cell:t};this.notify(Or,r)},r.prototype.findHandler=function(e){"next"===e.findOpt?this.notify(Gr,e):"prev"===e.findOpt&&this.notify(Yr,e)},r.prototype.replaceHandler=function(e){"replace"===e.replaceBy?this.notify(Kr,e):this.notify($r,e)},r.prototype.protectSheet=function(e,t,r){this.notify(on,{protectSettings:t,password:r,sheetIndex:e})},r.prototype.unprotectSheet=function(e){var t={sheet:e};this.notify(sn,t)},r.prototype.sort=function(e,t){if(!this.allowSorting)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify(Ar,r),r.promise},r.prototype.addDataValidation=function(e,t){"List"===e.type&&e.value1.length>256&&(e.value1=e.value1.substring(0,255)),this.notify(jr,{rules:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.removeDataValidation=function(e){this.notify(jr,{range:e,isRemoveValidation:!0})},r.prototype.addInvalidHighlight=function(e){this.notify(Wr,{range:e})},r.prototype.removeInvalidHighlight=function(e){this.notify(Jr,{range:e})},r.prototype.isValidCell=function(e){var t=u(e),r=ke(t[0],t[1],this.getActiveSheet());if(r&&r.validation){var n={value:r.value?r.value:"",range:t,sheetIdx:this.activeSheetIndex,isCell:!1,td:null,isValid:!0};return this.notify(qr,n),n.isValid}return!0},r.prototype.conditionalFormat=function(e){e.range=e.range||this.getActiveSheet().selectedRange,this.notify(mn,{cfModel:e})},r.prototype.clearConditionalFormat=function(e){var t={};if(e&&e.includes("!")){var r=e.split("!");t.range=r[1],t.sheetIdx=fe(this,r[0])}else t.range=e||this.getActiveSheet().selectedRange,t.sheetIdx=this.activeSheetIndex;this.notify(yn,t)},r.prototype.updateCell=function(e,r){var n,i;if(r||(r=this.getActiveSheet().activeCell),r.includes("!")){if(n=y(r),void 0===(i=fe(this,r.split("!")[0])))return}else n=c(r),i=this.activeSheetIndex;oe(this,this.sheets[i],{cell:e,rowIdx:n[0],colIdx:n[1],preventEvt:!0});var o=t.isNullOrUndefined(e.value)?e.formula||null:e.value;null!==o&&this.notify(cr,{action:"updateCellValue",address:n,value:o,sheetIndex:i}),i===this.activeSheetIndex&&(this.serviceLocator.getService("cell").refresh(n[0],n[1],!0,null,null!==o),this.notify(gr,null),$(c(this.sheets[i].activeCell),n[0],n[1])&&this.notify(Pi,{action:"refreshFormulabar",value:this.getDisplayText(e)||e.formula}))},r.prototype.getRowData=function(e,r){t.isNullOrUndefined(e)&&(e=0),t.isNullOrUndefined(r)&&(r=this.activeSheetIndex);var n={sheetIdx:r,startIndex:e,modelType:"Row",isDataRequest:!0};return this.notify(Yt,n),n.data},r.prototype.updateRange=function(e,r){var n=be(this,r=r?r-1:this.activeSheetIndex),i=n.ranges;t.isNullOrUndefined(n)||(i.push(e),n.ranges=i)},r.prototype.wrap=function(e,t){void 0===t&&(t=!0),Le(e,t,this)},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(pr,t),t.isAdded},r.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(pr,r),r.isRemoved},r.prototype.clearRange=function(e,t,r){},r.prototype.insertImage=function(e,t){this.notify(bn,{options:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.autoFill=function(e,t,r,n){var i={dataRange:t||this.getActiveSheet().selectedRange,fillRange:e,direction:r||"Down",fillType:n||"FillSeries"};this.notify(Hn,i)},r.prototype.insertChart=function(e){this.notify(Sn,{chart:e})},r.prototype.deleteChart=function(e){this.notify(Ma,{id:e})},r.prototype.filter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify(Mr,r),r.promise},r.prototype.addCustomFunction=function(e,t,r){var n={action:"addCustomFunction",functionHandler:e,functionName:t=t||("string"==typeof e?e:e.name.replace("bound ","")),formulaDescription:r};this.notify(pr,n)},r.prototype.clear=function(e){this.notify(Cn,e)},r.prototype.getDisplayText=function(e){if(!e)return"";if(e.format&&!t.isNullOrUndefined(e.value)){var r={formattedText:e.value,value:e.value,format:e.format,onLoad:!0,cell:e,skipRowFill:!0};return this.notify(ir,r),r.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value||"number"==typeof e.value?e.value.toString():""},r.prototype.freezePanes=function(e,t,r){void 0===e&&(e=1),void 0===t&&(t=1);var n=this.getSheetModel(r);!this.allowFreezePane||n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.id===this.getActiveSheet().id&&"spreadsheet"===this.getModuleName()&&this.renderModule.refreshSheet())},r.prototype.Unfreeze=function(e){this.freezePanes(0,0,e)},r.prototype.unfreezePanes=function(e){this.freezePanes(0,0,e)},r.prototype.updateTopLeftCell=function(e,r,n,i){i||(i=this.getActiveSheet());var o=u(i.topLeftCell);i.frozenRows||i.frozenColumns?(t.isNullOrUndefined(e)&&(e=i.frozenRows?0:o[0]),t.isNullOrUndefined(r)&&(r=i.frozenColumns?0:o[1]),e+=this.frozenRowCount(i),r+=this.frozenColCount(i),n&&("row"===n?e=u(i.paneTopLeftCell)[0]:r=u(i.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(e,r)),i.frozenRows&&(e=o[0]),i.frozenColumns&&(r=o[1])):(t.isNullOrUndefined(e)&&(e=o[0]),t.isNullOrUndefined(r)&&(r=o[1]),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(e,r))),this.setSheetPropertyOnMute(i,"topLeftCell",g(e,r))},r.prototype.getAddressInfo=function(e){return b(this,e)},r.prototype.setSheetPropertyOnMute=function(e,t,r){this.isProtectedOnChange=!0,e[t]=r,this.isProtectedOnChange=!1},r.prototype.frozenRowCount=function(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:u(e.topLeftCell)[0]+e.frozenRows:0},r.prototype.frozenColCount=function(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:u(e.topLeftCell)[1]+e.frozenColumns:0},r.prototype.updateRangeOnInsertDelete=function(e,t){var r,n=!1;return e.isInsert?(r=e.endIndex-e.startIndex+1,"Row"===e.modelType?(e.startIndex<=t[0]&&(t[0]+=r,n=!0),e.startIndex<=t[2]&&(t[2]+=r,n=!0)):(e.startIndex<=t[1]&&(t[1]+=r,n=!0),e.startIndex<=t[3]&&(t[3]+=r,n=!0))):"Row"===e.modelType?((r=t[0]-e.startIndex)>0&&(t[0]>e.endIndex?(r=e.endIndex-e.startIndex+1)>0&&(t[0]-=r,n=!0):(t[0]-=r,n=!0)),e.startIndex<=t[2]&&(e.endIndex<=t[2]?t[2]-=e.endIndex-e.startIndex+1:t[2]-=t[2]-e.startIndex+1,n=!0)):((r=t[1]-e.startIndex)>0&&(t[1]>e.endIndex?(r=e.endIndex-e.startIndex+1)>0&&(t[1]-=r,n=!0):(t[1]-=r,n=!0)),e.startIndex<=t[3]&&(e.endIndex<=t[3]?t[3]-=e.endIndex-e.startIndex+1:t[3]-=t[3]-e.startIndex+1,n=!0)),n},r.prototype.dateToInt=function(e){return T(e)},r.prototype.setDateFormat=function(e,t,r){var n=be(this,ge(this,e));ke(t,r,n,null,!0).format||Fe(t,r,n,{format:P("ShortDate")},!0)};var n;return il([t.Collection([],Zs)],r.prototype,"sheets",void 0),il([t.Property(0)],r.prototype,"activeSheetIndex",void 0),il([t.Property("100%")],r.prototype,"height",void 0),il([t.Property(!0)],r.prototype,"allowFindAndReplace",void 0),il([t.Property()],r.prototype,"filterCollection",void 0),il([t.Property()],r.prototype,"sortCollection",void 0),il([t.Property("100%")],r.prototype,"width",void 0),il([t.Property(!0)],r.prototype,"showRibbon",void 0),il([t.Property(!0)],r.prototype,"showFormulaBar",void 0),il([t.Property(!0)],r.prototype,"showSheetTabs",void 0),il([t.Property(!0)],r.prototype,"allowEditing",void 0),il([t.Property(!0)],r.prototype,"allowOpen",void 0),il([t.Property(!0)],r.prototype,"allowSave",void 0),il([t.Property(!0)],r.prototype,"allowSorting",void 0),il([t.Property(!0)],r.prototype,"allowFiltering",void 0),il([t.Property(!0)],r.prototype,"allowNumberFormatting",void 0),il([t.Property(!0)],r.prototype,"allowCellFormatting",void 0),il([t.Property(!0)],r.prototype,"allowHyperlink",void 0),il([t.Property(!0)],r.prototype,"allowInsert",void 0),il([t.Property(!0)],r.prototype,"allowDelete",void 0),il([t.Property(!0)],r.prototype,"allowMerge",void 0),il([t.Property(!0)],r.prototype,"allowDataValidation",void 0),il([t.Property(!0)],r.prototype,"allowImage",void 0),il([t.Property(!0)],r.prototype,"allowChart",void 0),il([t.Property(!0)],r.prototype,"allowAutoFill",void 0),il([t.Complex({},js)],r.prototype,"autoFillSettings",void 0),il([t.Property(!0)],r.prototype,"allowConditionalFormat",void 0),il([t.Complex({},ks)],r.prototype,"cellStyle",void 0),il([t.Property("")],r.prototype,"openUrl",void 0),il([t.Property("")],r.prototype,"saveUrl",void 0),il([t.Property("")],r.prototype,"password",void 0),il([t.Property(!1)],r.prototype,"isProtected",void 0),il([t.Collection([],Ls)],r.prototype,"definedNames",void 0),il([t.Event()],r.prototype,"beforeOpen",void 0),il([t.Event()],r.prototype,"openFailure",void 0),il([t.Event()],r.prototype,"beforeSave",void 0),il([t.Event()],r.prototype,"saveComplete",void 0),il([t.Event()],r.prototype,"beforeCellFormat",void 0),il([t.Event()],r.prototype,"queryCellInfo",void 0),il([t.Event()],r.prototype,"beforeCellUpdate",void 0),il([t.Property(!0)],r.prototype,"allowFreezePane",void 0),r=n=il([t.NotifyPropertyChanges],r)}(t.Component),al=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),sl=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ll=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return al(r,e),sl([t.Collection([],el)],r.prototype,"cells",void 0),sl([t.Property(0)],r.prototype,"index",void 0),sl([t.Property(20)],r.prototype,"height",void 0),sl([t.Property(!1)],r.prototype,"customHeight",void 0),sl([t.Property(!1)],r.prototype,"hidden",void 0),sl([t.Complex({},Ms)],r.prototype,"format",void 0),r}(t.ChildProperty),hl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dl=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},pl=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return hl(r,e),dl([t.Property(0)],r.prototype,"index",void 0),dl([t.Property(64)],r.prototype,"width",void 0),dl([t.Property(!1)],r.prototype,"customWidth",void 0),dl([t.Property(!1)],r.prototype,"hidden",void 0),dl([t.Complex({},Ms)],r.prototype,"format",void 0),dl([t.Property(!0)],r.prototype,"isLocked",void 0),dl([t.Property("")],r.prototype,"validation",void 0),r}(t.ChildProperty),cl=null,ul=1.24,fl=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"],gl={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"},ml=function(){function e(e){this.parent=e,this.init(),this.addEventListener()}return e.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))},e.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on(to,this.cut,this),this.parent.on(ro,this.copy,this),this.parent.on(no,this.paste,this),this.parent.on(io,this.clearCopiedInfo,this),this.parent.on(Ji,this.tabSwitchHandler,this),this.parent.on(Yi,this.cMenuBeforeOpenHandler,this),this.parent.on(Zi,this.ribbonClickHandler,this),this.parent.on(Li,this.initCopyIndicator,this),this.parent.on(yo,this.rowHeightChanged,this),this.parent.on(Co,this.colWidthChanged,this),this.parent.on(qn,this.refreshOnInsertDelete,this),t.EventHandler.add(e,"cut",this.cut,this),t.EventHandler.add(e,"copy",this.copy,this),t.EventHandler.add(e,"paste",this.paste,this)},e.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(to,this.cut),this.parent.off(ro,this.copy),this.parent.off(no,this.paste),this.parent.off(io,this.clearCopiedInfo),this.parent.off(Ji,this.tabSwitchHandler),this.parent.off(Yi,this.cMenuBeforeOpenHandler),this.parent.off(Zi,this.ribbonClickHandler),this.parent.off(Li,this.initCopyIndicator),this.parent.off(yo,this.rowHeightChanged),this.parent.off(Co,this.colWidthChanged),this.parent.off(qn,this.refreshOnInsertDelete)),t.EventHandler.remove(e,"cut",this.cut),t.EventHandler.remove(e,"copy",this.copy),t.EventHandler.remove(e,"paste",this.paste)},e.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({invokeCopy:!0});break;case t+"_copy":this.copy({invokeCopy:!0})}},e.prototype.tabSwitchHandler=function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(ph),n=[],i=[],o=[],a=[],s=u(t.activeCell),l=ke(s[0],s[1],t),h=t.isProtected&&ee(l,ze(t,s[1]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target&&"SelectAll"!==e.target||(this.parent.enableContextMenuItems([r.getConstant("Paste"),r.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!h)),this.parent.enableContextMenuItems([r.getConstant("Cut")],!h)),"Content"===e.target&&h&&this.parent.enableContextMenuItems([r.getConstant("Cut"),r.getConstant("Filter"),r.getConstant("Sort")],!1),"Content"===e.target&&h&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([r.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&t.isProtected&&(o=[r.getConstant("DeleteColumn"),r.getConstant("DeleteColumns"),r.getConstant("InsertColumn"),r.getConstant("InsertColumns")],a=[r.getConstant("HideColumn"),r.getConstant("HideColumns"),r.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(o,!1),this.parent.enableContextMenuItems(a,!!t.protectSettings.formatColumns)),"RowHeader"===e.target&&t.isProtected&&(n=[r.getConstant("DeleteRow"),r.getConstant("DeleteRows"),r.getConstant("InsertRow"),r.getConstant("InsertRows")],i=[r.getConstant("HideRow"),r.getConstant("HideRows"),r.getConstant("UnHideRows")],this.parent.enableContextMenuItems(n,!1),this.parent.enableContextMenuItems(i,!!t.protectSettings.formatRows))},e.prototype.rowHeightChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[0]>e.rowIdx?t.style.top=parseFloat(t.style.top)+e.threshold+"px":$(this.copiedInfo.range,e.rowIdx,this.copiedInfo.range[1])&&(t.style.height=parseFloat(t.style.height)+e.threshold+"px"))}},e.prototype.colWidthChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[1]>e.colIdx?t.style.left=parseFloat(t.style.left)+e.threshold+"px":$(this.copiedInfo.range,this.copiedInfo.range[0],e.colIdx)&&(t.style.width=parseFloat(t.style.width)+e.threshold+"px"))}},e.prototype.cut=function(e){this.setCopiedInfo(e,!0)},e.prototype.copy=function(e){this.setCopiedInfo(e,!1)},e.prototype.paste=function(e){if(!(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dlg-overlay").length>0)){var r,n=e&&e.clipboardData||window.clipboardData;if(!(n&&e.clipboardData&&e.clipboardData.getData("isInternalCut").length)||this.copiedInfo)if(n||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){e.isInternal=!n;var i=void 0,o=this.getCopiedIdx();e.isAction=!!n||e.isAction;var a=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,s=be(this.parent,a),l=w(e&&e.range||c(s.selectedRange)),h=n&&this.getExternalCells(e);if(!e.isInternal&&h&&h.internal&&(n=!1,!this.copiedInfo))return;if(n&&!h.length){if(h.file)return void this.parent.notify(ka,{file:h.file});if(!this.copiedInfo)return;n=!1}var d=Object.assign({isExternal:n},this.copiedInfo),p=1;if(h)for(var u=0;u<h.length;u++)p=h[u].cells.length>p?h[u].cells.length:p;var f=l[0],g=n?[0,0,h.length-1,p-1]:w(this.copiedShapeInfo?c(s.selectedRange):this.copiedInfo.range),v=(l[2]-l[0]+1)%(g[2]-g[0]+1)==0&&(l[3]-l[1]+1)%(g[3]-g[1]+1)==0;r=v?l:[l[0],l[1]].concat([l[0]+g[2]-g[0],l[1]+g[3]-g[1]||l[1]]);var y={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:m(g),pastedRange:m(r),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.parent.notify(Zt,{eventArgs:y,action:"clipboard"}),y.cancel)return;var C=void 0,x=void 0,b=void 0,S=[],I=n?a:o,R=be(this.parent,I),A=E(g)&&this.isRangeMerged(l,s);f=(l=c(y.pastedRange))[0],g=n?[0,0,h.length-1,p-1]:w(this.copiedShapeInfo?c(s.selectedRange):this.copiedInfo.range),r=(v=(l[2]-l[0]+1)%(g[2]-g[0]+1)==0&&(l[3]-l[1]+1)%(g[3]-g[1]+1)==0&&!A)?l:[l[0],l[1]].concat([l[0]+g[2]-g[0],l[1]+g[3]-g[1]||l[1]]);if(s.isProtected&&Ht(this.parent,r))return void this.parent.notify(la,null);if(this.copiedShapeInfo&&!this.copiedInfo){var k=this.copiedShapeInfo.pictureElem;k.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify(Sn,{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||s.selectedRange})):this.parent.notify(Da,{options:{src:k.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?k.id:""},range:m([f,l[1],f,l[1]]),isPublic:!1,isUndoRedo:!0});var F=ke(f,l[1],s);if(F&&!t.isNullOrUndefined(F.image)){var T=F.image?F.image.length-1:0,L={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:Ee(this.parent)+"!"+m([f,l[1],f,l[1]]),pastedPictureElement:document.getElementById(F.image[T].id)};this.parent.notify(Yo,{eventArgs:L,action:"clipboard"})}}else{var N={range:g,prevSheet:R,cancel:!1};if(this.parent.notify(fn,N),N.cancel)return;var D=y.type||e.type,O=[],M=this.isInRange(g,l,o),P=0===l[1]&&l[3]===s.colCount-1,H=0===l[0]&&l[2]===s.rowCount-1,B=!1,U=!1,_=0,V=[];v||"Values"===D||this.setCF(g,r,R,s,V);for(var z=void 0,q=!1,j=[],W=(u=g[0],0);u<=g[2];u++,W++)if(n||d.isCut||!Be(R,u)){M&&(O[l[0]+W]={cells:[]});for(var G=g[1],Y=0;G<=g[3];G++,Y++){if(M&&(O[l[0]+W].cells[l[1]+Y]=ke(l[0]+W,l[1]+Y,R,!1,!0)),C=n?h[u].cells[G]:t.extend({},M&&O[u]&&O[u].cells[G]?O[u].cells[G]:ke(u,G,R),null,!0),P||H){if(C&&C.rowSpan)if(C.rowSpan>0)C.rowSpan+u-1<=g[2]?B=!0:C={};else if(B){if(C.rowSpan<0){var X=C.rowSpan,K=C.colSpan?C.colSpan:0,Z=ke(f+X,l[1]+Y+K,s);Z&&!Z.rowSpan&&(C={})}}else C={};C&&C.colSpan&&(C.colSpan>0?C.colSpan+G-1<=g[3]?U=!0:C={}:U||(C={}))}if(C&&D){switch(D){case"Formats":C={format:C.format,style:C.style};break;case"Values":if((C={value:C.value}).value&&C.value.toString().indexOf("\n")>-1){this.parent.getCell(l[0],l[1]).classList.add("e-alt-unwrap")}}x=["Formats","Values"].indexOf(D)>-1}if(!this.parent.scrollSettings.isFinite&&(g[2]-g[0]>1048575-l[0]||g[3]-g[1]>16383-l[1])||this.parent.scrollSettings.isFinite&&(g[2]-g[0]>s.rowCount-1-l[0]||g[3]-g[1]>s.colCount-1-l[1]))return void this.showDialog();if(v){for(var Q=l[0];Q<=l[2];Q+=g[2]-g[0]+1)if(d.isCut||_||!Be(s,Q+W))for(var J=l[1];J<=l[3];J+=g[3]-g[1]+1){if(u!==g[0]||G!==g[1]||void 0!==z&&!z.length||"Values"===D||(z=this.setCF(g,[Q,J,Q+(g[2]-g[0]),J+(g[3]-g[1])],R,s,V,z)),b=ke(Q+W,J+Y,s,!1,!0),!n&&(void 0!==b.colSpan||void 0!==b.rowSpan)){if(P||H)continue;var ee={range:(N={range:[Q+W,J+Y,Q+W,J+Y]}).range,merge:!1,isAction:!1,type:"All"};S.push(ee),this.parent.activeSheetIndex===s.index&&this.parent.notify(hn,ee)}var te=J+Y;if(C=t.extend({},C||{},null,!0),!x&&this.copiedInfo&&!this.copiedInfo.isCut&&C.formula){var re=ie([Q+W,te],[u,G],R,M?C:null);t.isNullOrUndefined(re)||(C.formula=re)}s.isProtected&&C&&!1!==C.isLocked&&(C.isLocked=b.isLocked),b&&b.formula&&b.formula.indexOf("=UNIQUE(")>-1&&this.parent.notify(Sr,null);var ne={cellIdx:[u,G],isUnique:!1,uniqueRange:"",sheetName:R.name};this.parent.notify(wr,ne),ne.isUnique&&(C.value=null),q=!1,C&&C.formula&&C.formula.indexOf("=UNIQUE(")>-1&&(q=!0,j.push([Q,te]),C.value=null),this.setCell(Q+W,te,s,C,x,te===l[3],!!n,q)||C.formula&&this.copiedInfo.isCut&&this.parent.notify(Er,{cellRef:m([u,G,u,G])})}}else!n&&Et(this.parent,u,G,o)||(A?this.setCell(f,l[1]+Y,s,{value:C.value},!0,G===g[3]):this.setCell(f,l[1]+Y,s,C,x,G===g[3]));if(!n&&this.copiedInfo.isCut&&(!$(l,u,G)||o!==this.parent.activeSheetIndex)){var oe=ke(u,G,R);if(oe)if(oe.isLocked||t.isNullOrUndefined(oe.isLocked))if(!P&&!H||void 0===oe.rowSpan&&void 0===oe.colSpan)oe=null;else{if(!(oe.rowSpan>1||oe.colSpan>1))continue;this.parent.notify(hn,{merge:!1,range:[u,G,u,G],type:"All"}),oe=null}else!1===oe.isLocked&&(oe=R.isProtected?{isLocked:!1}:null);this.setCell(u,G,R,oe,!1,G===g[3])}}f++}else W--,_++;if(j.length)for(u=0;u<j.length;u++)this.parent.serviceLocator.getService("cell").refresh(j[u][0],j[u][1]);this.parent.notify(In,null),r[2]-=_,this.parent.setUsedRange(r[2],r[3]),a!==this.parent.activeSheetIndex||e.isFromUpdateAction||this.parent.notify(eo,{address:m(r)}),!n&&this.copiedInfo.isCut&&(i=this.copiedInfo.isCut,o===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(g),this.clearCopiedInfo()),(n||M)&&this.copiedInfo&&this.clearCopiedInfo();var ae=void 0;if(i){z&&z.length&&"Values"!==D&&(ae={range:g,sheetIdx:I,isClear:!0},this.parent.notify(yn,ae)),Ot(R,g[0],g[1],(this.parent.getRow(g[0],null,this.parent.frozenColCount(R))||{offsetHeight:20}).offsetHeight);var se=Mt(R,g[0]);Rt(this.parent,R,se,g[0])}V.length&&a===this.parent.activeSheetIndex&&this.parent.notify(vn,{cfModel:V,isAction:!0});var le=be(this.parent,o);if(!n&&g[0]===g[2]&&g[3]-g[1]==le.colCount-1){for(se=le.rows[g[0]].height,u=l[0];u<=l[2];u++)Rt(this.parent,this.parent.getActiveSheet(),se,u);i&&Rt(this.parent,le,20,g[0])}if(e.isAction){L={requestType:"paste",copiedInfo:d,mergeCollection:S,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:R.name+"!"+(d.range?m(d.range):R.selectedRange),pastedRange:s.name+"!"+m(r),type:D||"All"};_&&(L.skipFilterCheck=!0),ae&&ae.cfClearActionArgs&&(L.cfClearActionArgs=ae.cfClearActionArgs),V.length&&(L.cfActionArgs={cfModel:V,sheetIdx:a}),this.parent.notify(Yo,{eventArgs:L,action:"clipboard"})}}}else this.getClipboardEle().select()}},e.prototype.setCF=function(e,t,r,n,i,o){var a,s,l=this,h=function(r){a=[t[0]+(s[0]<=e[0]?0:s[0]-e[0]),t[1]+(s[1]<=e[1]?0:s[1]-e[1]),t[2]-(s[2]>=e[2]?0:e[2]-s[2]),t[3]-(s[3]>=e[3]?0:e[3]-s[3])],n.conditionalFormats||l.parent.setSheetPropertyOnMute(n,"conditionalFormats",[]);var o={range:m(a),type:r.type,cFColor:r.cFColor,value:r.value,format:r.format};n.conditionalFormats.push(o),i.push(o)};if(o)for(var d=0,p=o.length;d<p;d++)s=c(o[d].range),h(o[d]);else if(o=[],r.conditionalFormats)for(d=0,p=r.conditionalFormats.length;d<p;d++)((s=c(r.conditionalFormats[d].range))[0]>=e[0]&&s[0]<=e[2]||s[2]>=e[0]&&s[2]<=e[2])&&(s[1]>=e[1]&&s[1]<=e[3]||s[3]>=e[1]&&s[3]<=e[3])&&(o.push(r.conditionalFormats[d]),h(r.conditionalFormats[d]));return o},e.prototype.isRangeMerged=function(e,t){var r=ke(e[0],e[1],t);if(r&&(r.colSpan>1||r.rowSpan>1)){var n={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(cn,n),n.range[0]===e[0]&&n.range[1]===e[1]&&n.range[2]===e[2]&&n.range[3]===e[3]}return!1},e.prototype.updateFilter=function(e,t){var r,n;this.parent.notify(tr,null);for(var i=0;i<this.parent.sheets.length;i++)if(this.parent.filterCollection&&this.parent.filterCollection[i]&&this.parent.filterCollection[i].sheetIndex===ge(this.parent,e.sId)){var o=e.range,a=c(this.parent.filterCollection[i].filterRange);o=w(o),a[0]===o[0]&&a[2]===o[2]&&a[1]===o[1]&&a[3]===o[3]&&(r=!0,n=[Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),Math.abs(o[2]-a[2]),Math.abs(o[3]-a[3])])}var s=this.parent.getCell(e.range[0],e.range[1]),l=(s=s?s.querySelector(".e-filter-icon")?s:this.parent.getCell(e.range[2],e.range[3]):s)?s.querySelector(".e-sortasc-filter"):s,h=s?s.querySelector(".e-sortdesc-filter"):s;if(r)for(var d=0;d<this.parent.filterCollection.length;d++){var p=this.parent.filterCollection[d],u=e&&e.sId?ge(this.parent,e.sId):this.parent.activeSheetIndex;if(p.sheetIndex===u&&this.parent.notify(Vo,{predicates:null,range:p.filterRange,sIdx:u,isCut:!0}),p.sheetIndex===u&&u===this.parent.activeSheetIndex&&(n=[t[0]+n[0],t[1]+n[1],Math.abs(t[2]-n[2]),Math.abs(t[3]-n[3])],this.parent.notify(Vo,{predicates:null,range:m(n),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var f=this.parent.getCell(t[0],t[1]);l&&f&&f.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),h&&f&&f.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},e.prototype.isInRange=function(e,t,r){var n=this.parent.activeSheetIndex;return $(e,t[0],t[1])&&r===n||$(e,t[2],t[3])&&r===n},e.prototype.setCell=function(e,t,r,n,i,o,a,s){var l=oe(this.parent,r,{cell:n,rowIdx:e,colIdx:t,pvtExtend:!i,valChange:!s,lastCell:o,uiRefresh:r.name===this.parent.getActiveSheet().name,requestType:"paste"});if(!l&&n&&n.style&&a){var h=Dt(this.parent,e,t,r,n.style||this.parent.cellStyle,n.wrap?Tt(this.parent.getDisplayText(n),Nt(r,e,t),n.style,this.parent.cellStyle):1);(h=Math.round(h))<20&&(h=20),Ot(r,e,t,h);var d=Ve(r,e),p=Mt(r,e);p>d&&Rt(this.parent,r,p,e)}return l},e.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},e.prototype.setCopiedInfo=function(e,n){var i=this;if(!this.parent.isEdit){var o=new r.Deferred;e.promise=o.promise;var a,s=this.parent.getActiveSheet();if(e&&e.range){var l=0===e.range[1]&&e.range[3]===s.colCount-1,h=0===e.range[0]&&e.range[2]===s.rowCount-1,d={range:e.range};l||h||this.parent.notify(pn,d),a=d.range}else a=c(s.selectedRange);if(e&&!e.isPublic&&!e.clipboardData){var p={copiedRange:s.name+"!"+m(a),cancel:!1,action:n?"cut":"copy"};if(this.parent.notify(Zt,p),p.cancel)return}var u={sheet:s,indexes:[0,0,s.rowCount-1,s.colCount-1],isFinite:this.parent.scrollSettings.isFinite,promise:new Promise(function(e,t){e(void 0)})},f=document.getElementsByClassName("e-ss-overlay-active"),g=f.length;!s.isLocalData||e&&e.clipboardData||0!==a[0]||a[2]!==s.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",u)),this.checkForUncalculatedFormula(a,e&&e.sId?e.sId:s.id),u.promise.then(function(){if(g>0){var r={clientY:f[0].offsetTop,isImage:!0};i.parent.notify(La,r);var l={clientX:f[0].offsetLeft,isImage:!0};i.parent.notify(Na,l),i.copiedShapeInfo={sId:e&&e.sId?e.sId:s.id,sheetIdx:s.index,isCut:n,pictureElem:f[0],copiedRange:m([r.clientY,l.clientX,r.clientY,l.clientX]),height:f[0].offsetHeight,width:f[0].offsetWidth,chartInfo:i.getChartElemInfo(f[0])},i.hidePaste(!0),n&&(f[0].classList.contains("e-datavisualization-chart")?i.parent.deleteChart(i.copiedShapeInfo.chartInfo.id):i.parent.notify(Oa,{id:i.copiedShapeInfo.pictureElem.id,sheetIdx:i.copiedShapeInfo.sId,range:i.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(i.copiedInfo&&i.clearCopiedInfo(),i.copiedInfo={range:a,sId:e&&e.sId?e.sId:s.id,isCut:n},i.hidePaste(!0),e.isFromUpdateAction||i.initCopyIndicator(),t.Browser.isIE||i.getClipboardEle().select(),e&&e.invokeCopy&&document.execCommand(n?"cut":"copy"),i.parent.hideSpinner());t.Browser.isIE&&i.setExternalCells(e,n),o.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e,n),this.getClipboardEle().setAttribute("aria-label",s.selectedRange+" "+this.parent.serviceLocator.getService(ph).getConstant(n?"Cut":"Copy")))}},e.prototype.checkForUncalculatedFormula=function(e,r){for(var n,i=ge(this.parent,r),o=be(this.parent,i),a=e[0];a<=e[2];a++)for(var s=e[1];s<=e[3];s++)(n=ke(a,s,o,null,!0)).formula&&t.isUndefined(n.value)&&this.parent.notify(pr,{action:"refreshCalculate",value:n.formula,rowIndex:a,colIndex:s,isFormula:W(n.formula),sheetIndex:i})},e.prototype.getChartElemInfo=function(e){var t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var r=e.getElementsByClassName("e-control")[0].id,n=0;n<t.length;n++)if(t[n].id===r){return t[n]}return null},e.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},e.prototype.removeIndicator=function(e){if(e){var r=e.getElementsByClassName("e-copy-indicator")[0];r&&t.detach(r)}},e.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),nt(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}},e.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(ch).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(ph).getConstant("PasteAlert"),beforeOpen:function(t){var r={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0)}})},e.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify(Qi,[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},e.prototype.setExternalCells=function(e,r){for(var n,i,o="",a=w(this.copiedInfo.range),s=this.parent.getActiveSheet(),l='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>',h=a[0];h<=a[2];h++)if(r||!Be(s,h)){l+="<tr>";for(var d=a[1];d<=a[3];d++)if(!((n=ke(h,d,s,!1,!0)).colSpan<0||n.rowSpan<0)){if(l+="<td",n.colSpan&&(l+=' colspan="'+n.colSpan+'"'),n.rowSpan&&(l+=' rowspan="'+n.rowSpan+'"'),l+=' style="white-space:'+(n.wrap?"normal":"nowrap")+";vertical-align:bottom;",n.style&&Object.keys(n.style).forEach(function(e){var t=e.match(/[A-Z]/);l+=("backgroundColor"===e?"background":t?e.replace(t[0],"-"+t[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?n.style[e].slice(0,7):n.style[e])+";"}),l+='"',t.isNullOrUndefined(n.value))l+="></td>";else{if(i=n.value,n.format&&"General"!==n.format){l+=n.value.toString().includes('"')?" cell-value='"+i+"'":' cell-value="'+n.value+'"';var p={formattedText:i,value:i,format:n.format,onLoad:!0,cell:n,rowIndex:h,colIndex:d};this.parent.notify(ir,p),i=p.formattedText}l+=">",l+=i,o+=i,l+="</td>"}o+=d===a[3]?"":"\t"}l+="</tr>",o+=h===a[2]?"":"\n"}l+="</tbody></table></body></html>",t.Browser.isIE?(window.clipboardData.setData("text",o),r&&window.clipboardData.setData("isInternalCut",o)):(e.clipboardData.setData("text/html",l),e.clipboardData.setData("text/plain",o),r&&e.clipboardData.setData("isInternalCut",o),e.preventDefault())},e.prototype.getExternalCells=function(e){var r,n,i=this,o=[],a=this.parent.createElement("span");if(t.Browser.isIE?n=window.clipboardData.getData("text"):(r=e.clipboardData.getData("text/html"),n=e.clipboardData.getData("text/plain"),a.innerHTML=r),a.querySelector("table")){var s=!1;if(this.copiedInfo&&!this.copiedInfo.isCut){var l=this.parent.filterCollection;if(l)for(var h=0;h<l.length;h++){var d=c(l[h].filterRange),p=this.copiedInfo.range;if(d[0]===p[0]&&d[1]===p[1]&&d[2]===p[2]&&d[3]===p[3]){s=!0;break}}}a.querySelector(".e-spreadsheet")&&this.copiedInfo&&!s?o={internal:!0}:this.generateCells(a,o)}else if(a.querySelector("img")){var u=a.querySelector("img");this.parent.notify(Da,{options:{src:u.src,height:u.height,width:u.width},isPublic:!0})}else if(n){var f,g,m,v=[];r&&(g=[].slice.call(a.children)),n.split("\n").forEach(function(e){f=null,r&&(m=g.filter(function(t){return t.textContent&&t.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===e.trim()})[0])&&(f=i.getStyle(m,a),g.splice(g.indexOf(m),1)),e.split("\t").forEach(function(e,t){(e||f)&&(v[t]={},f&&(f.whiteSpace&&"nowrap"!==f.whiteSpace?(v[t].wrap=!0,delete f.whiteSpace,Object.keys(f).length&&(v[t].style=f)):v[t].style=f),e&&(W(e)?v[t].formula=e:v[t].value=O(e.trim())))}),o.push({cells:v}),v=[]})}else if(1===e.clipboardData.types.length&&"Files"===e.clipboardData.types[0]&&e.clipboardData.files[0]&&e.clipboardData.files[0].type.includes("image"))return{file:e.clipboardData.files[0]};return setTimeout(function(){i.getClipboardEle().innerHTML=""},0),o},e.prototype.generateCells=function(e,r){var n,i,o=this,a=e.querySelector("table"),s=[],l=0;[].slice.call(a.rows||[]).forEach(function(a){r[l]||(r[l]={cells:[]}),s=r[l].cells,i=0,[].slice.call(a.cells||[]).forEach(function(a){if(s[i]&&(i=o.getNewIndex(s,i)),s[i]={},n=o.getStyle(a,e),a.textContent=a.textContent.replace(/(\r\n|\n|\r)/gm,""),a.textContent=a.textContent.replace(/\s+/g," "),n.whiteSpace&&"nowrap"!==n.whiteSpace&&(s[i].wrap=!0,delete n.whiteSpace),Object.keys(n).length&&(n.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){n[e]=n.border}),delete n.border),s[i].style=n),a.textContent&&(s[i].value=O(a.textContent.trim())),a.getAttribute("number-format")&&(s[i].format=a.getAttribute("number-format"),s[i].value&&a.getAttribute("cell-value")&&(s[i].value=O(a.getAttribute("cell-value").trim()))),a.getAttribute("colspan")&&parseInt(a.getAttribute("colspan"),10)>1&&(s[i].colSpan=parseInt(a.getAttribute("colspan"),10)),a.getAttribute("rowspan")&&parseInt(a.getAttribute("rowspan"),10)>1&&(s[i].rowSpan=parseInt(a.getAttribute("rowspan"),10)),s[i].colSpan>1&&s[i].rowSpan>1)for(var h=void 0,d=l,p=l+s[i].rowSpan;d<p;d++)for(var c=i,u=i+s[i].colSpan;c<u;c++)d===l&&c===i||(h=s[i].style?{style:t.extend({},s[i].style)}:{},d!==l&&(h.rowSpan=l-d),c!==i&&(h.colSpan=i-c),r[d]||(r[d]={cells:[]}),r[d].cells[c]=h);else if(s[i].colSpan>1)for(d=i+1,p=i+s[i].colSpan;d<p;d++)s[d]={colSpan:i-d,style:t.extend({},n)};else if(s[i].rowSpan>1)for(d=l+1,p=l+s[i].rowSpan;d<p;d++)r[d]||(r[d]={cells:[]}),r[d].cells[i]={rowSpan:l-d,style:t.extend({},n)};i++}),l++})},e.prototype.getNewIndex=function(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t},e.prototype.getStyle=function(e,t){var r=[],n={},i=Object.keys(this.parent.commonCellStyle);if(t.querySelector("style")&&e.classList.length&&t.querySelector("style").innerHTML.indexOf(e.classList[0])>-1){var o=t.querySelector("style").innerHTML.split(e.classList[0]);r.push(o[o.length-1].split("{")[1].split("}")[0])}var a=[].slice.call(e.querySelectorAll("*"));if(a.unshift(e),a.forEach(function(e){e.getAttribute("style")&&r.push(e.getAttribute("style")),"B"===e.tagName&&r.push("font-weight:bold"),"I"===e.tagName&&r.push("font-style:italic"),"U"===e.tagName&&r.push("text-decoration:underline")}),i.length&&t.querySelector("style")){var s=t.querySelector("style").innerHTML.includes("td")?t.querySelector("style").innerHTML.split("td")[1]:t.querySelector("style").innerHTML;s=s.includes("{")?s.split("{")[1].split("}")[0]:s.split("}")[0];for(var l=0;l<i.length;l++){var h=i[l],d=h.match(/[A-Z]/);d&&(h=h.replace(d[0],"-"+d[0].toLowerCase())),s.indexOf(h)>-1&&(n[i[l]]=s.split(h+":")[1].split(";")[0].trim())}}if(r.length){var p,c,u,f,g,m=["font-family","vertical-align","text-align","text-indent","color","white-space","font-weight","font-style","font-size","text-decoration","background"],v=["fontFamily","verticalAlign","textAlign","textIndent","color","whiteSpace","fontWeight","fontStyle","fontSize","textDecoration","backgroundColor"],y=["border-bottom","border-top","border-right","border-left","border"],C=["borderBottom","borderTop","borderRight","borderLeft","border"];r.forEach(function(e){e.split(";").forEach(function(e){if(c=e.split(":")[0].trim(),(p=m.indexOf(c))>-1)c=e.split(":")[1].trim(),n[v[p]]=c;else if((p=y.indexOf(c))>-1){if("none"===(c=e.split(":")[1].trim()))c=void 0;else if(c.includes("pt")){u=c.split("pt"),f=u[0].split(" ");for(var t=0;t<f.length;t++)if(g=parseFloat(f[t])){f.splice(t,1),f.unshift((g/.75).toFixed(2)+"px"),u[0]=f.join(" ");break}c=u.join("")}n[C[p]]=c}})})}return e.querySelector("S")&&(n.textDecoration=n.textDecoration?"underline line-through":"line-through"),n.textDecoration&&-1===["underline","line-through","underline line-through","none"].indexOf(n.textDecoration)&&(n.textDecoration="none"),n.textAlign&&-1===["left","center","right"].indexOf(n.textAlign)&&(n.textAlign="left"),n.verticalAlign&&-1===["bottom","middle","top"].indexOf(n.verticalAlign)&&(n.verticalAlign="bottom"),n.fontSize&&(n.fontSize=Math.round(parseFloat(n.fontSize.indexOf("px")>-1?(.75*parseFloat(n.fontSize)).toString():n.fontSize))+"pt"),n.fontWeight&&-1===["bold","normal"].indexOf(n.fontWeight)&&(n.fontWeight=n.fontWeight>"599"?"bold":"normal"),n},e.prototype.refreshOnInsertDelete=function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){var r=e.end-e.start+1;t[1]+=r,t[3]+=r}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){r=e.end-e.start+1;t[0]+=r,t[2]+=r}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}},e.prototype.performAction=function(){var e=this.getCopyIndicator();e&&nt(this.parent,e,this.copiedInfo.range,"e-copy-indicator")},e.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},e.prototype.getCopyIndicator=function(){return this.parent.element.getElementsByClassName("e-copy-indicator")[0]},e.prototype.getModuleName=function(){return"clipboard"},e.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();t.detach(e),this.parent=null},e}(),vl=function(){function e(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&",":"],this.formulaBarCurStartPos=null,this.curEndPos=null,this.curStartPos=null,this.selectionStart=null,this.selectionEnd=null,this.uniqueColl="",this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.isEdit&&this.cancelEdit(!0,!1),this.removeEventListener(),this.parent=null,this.editorElem=null},e.prototype.addEventListener=function(){t.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on(Ni,this.mouseDownHandler,this),this.parent.on(Bi,this.keyUpHandler,this),this.parent.on(Ui,this.keyDownHandler,this),this.parent.on(Oi,this.performEditOperation,this),this.parent.on(Sa,this.initiateCurPosition,this),this.parent.on(Ia,this.updateFormulaBarValue,this),this.parent.on(Ea,this.addressHandler,this),this.parent.on(Ra,this.initiateRefSelection,this),this.parent.on(Aa,this.refSelectionRender,this),this.parent.on(wr,this.checkUniqueRange,this),this.parent.on(Ir,this.reApplyFormula,this),this.parent.on(So,this.sheetChangeHandler,this)},e.prototype.removeEventListener=function(){t.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off(Ni,this.mouseDownHandler),this.parent.off(Bi,this.keyUpHandler),this.parent.off(Ui,this.keyDownHandler),this.parent.off(Oi,this.performEditOperation),this.parent.off(Sa,this.initiateCurPosition),this.parent.off(Ia,this.updateFormulaBarValue),this.parent.off(Ea,this.addressHandler),this.parent.off(Ra,this.initiateRefSelection),this.parent.off(Aa,this.refSelectionRender),this.parent.off(wr,this.checkUniqueRange),this.parent.off(Ir,this.reApplyFormula),this.parent.off(So,this.sheetChangeHandler))},e.prototype.getModuleName=function(){return"edit"},e.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var t={isEdit:!1};this.parent.notify(Ti,t),t.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}},e.prototype.keyUpHandler=function(e){if(this.isEdit){var t=this.getEditElement(this.parent.getActiveSheet());e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&this.refreshEditor(t.textContent,this.isCellEdit);if(W(this.editCellData.value,!0)&&(!e||16!==e.keyCode)&&(this.updateFormulaReference(t),this.endFormulaRef)){var r=this.getCurPosition();r.end&&this.validCharacters.indexOf(this.editCellData.value[r.end-1])>-1&&(this.endFormulaRef=!1)}}},e.prototype.updateFormulaReference=function(e){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0);var r=this.editCellData.sheetIndex,n=this.editCellData.value;this.parent.notify(ba,{range:n,formulaSheetIdx:r})},e.prototype.keyDownHandler=function(e){var r=e.target,n=e.keyCode,i=this.parent.getActiveSheet(),o=u(i.activeCell),a=ke(o[0],o[1],i,!1,!0);if(!t.closest(r,".e-dialog"))if(i.isProtected&&!r.classList.contains("e-sheet-rename")&&ee(a,ze(i,o[1]))){if((n>=this.keyCodes.FIRSTALPHABET&&n<=this.keyCodes.LASTALPHABET||n>=this.keyCodes.FIRSTNUMBER&&n<=this.keyCodes.LASTNUMBER||n===this.keyCodes.DELETE||n===this.keyCodes.BACKSPACE||n===this.keyCodes.SPACE||n>=this.keyCodes.FIRSTNUMPAD&&n<=this.keyCodes.LASTNUMPAD||n>=this.keyCodes.SYMBOLSETONESTART&&n<=this.keyCodes.SYMBOLSETONEEND||n>=219&&n<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&n===this.keyCodes.F2)&&67!==n&&89!==n&&90!==n){if(i.protectSettings.insertLink&&75===n)return;e.ctrlKey||70===e.keyCode||this.parent.element.querySelector(".e-editAlert-dlg")||r.parentElement.classList.contains("e-unprotectpwd-content")||r.parentElement.classList.contains("e-password-content")||r.parentElement.classList.contains("e-sheet-password-content")||r.parentElement.classList.contains("e-unprotectsheetpwd-content")||r.parentElement.classList.contains("e-reenterpwd-content")||this.parent.notify(la,null)}}else if(this.isEdit){var s=this.getEditElement(i),l=W(this.editCellData.value,!0);if((this.isCellEdit||l&&this.editCellData.value!==s.textContent&&16!==e.keyCode)&&(o[1]<this.parent.frozenColCount(i)&&(!i.frozenRows||o[0]>=this.parent.frozenRowCount(i))&&s&&"auto"!==s.style.height&&Ft(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)&&(s.style.height="auto"),Ft(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)-5&&(s.style.height="auto"),o[0]<this.parent.frozenRowCount(i)&&s&&!s.style.overflow&&Ft(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)&&(s.style.overflow="auto"),this.refreshEditor(s.textContent,this.isCellEdit,!1,!1,!1)),!e.altKey)switch(n){case this.keyCodes.ENTER:if(t.Browser.isWindows&&e.preventDefault(),this.isAltEnter){var h=s.textContent;h&&h.indexOf("\n")>-1&&(Le(this.parent.getActiveSheet().selectedRange,!0,this.parent,!0),this.refreshEditor(s.textContent,this.isCellEdit,!1,!1,!1),this.isAltEnter=!1)}if(l){var d=this.parent.element.querySelector(".e-formularef-indicator");d&&d.parentElement.removeChild(d),be(this.parent,this.editCellData.sheetIndex).id===i.id?this.endEdit(!1,e):(this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e))}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(r.classList.contains("e-spreadsheet")||t.closest(r,".e-sheet-panel")){13===n&&"true"===r.contentEditable&&e.preventDefault();var p=String.fromCharCode(n),c=n>=this.keyCodes.FIRSTALPHABET&&n<=this.keyCodes.LASTALPHABET||p.toLowerCase()!==p.toUpperCase(),f=n>=this.keyCodes.FIRSTNUMBER&&n<=this.keyCodes.LASTNUMBER,g=n>=this.keyCodes.FIRSTNUMPAD&&n<=this.keyCodes.LASTNUMPAD,m=n>=this.keyCodes.SYMBOLSETONESTART&&n<=this.keyCodes.SYMBOLSETONEEND;m||(m=n>=this.keyCodes.SYMBOLSETTWOSTART&&n<=this.keyCodes.SYMBOLSETTWOEND);var v=n===this.keyCodes.FIREFOXEQUALPLUS||n===this.keyCodes.FIREFOXMINUS,y=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&n===this.keyCodes.F2,C=n===this.keyCodes.BACKSPACE;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&n===this.keyCodes.SPACE||c||f||g||m||"mozilla"===t.Browser.info.name&&v)||y||C){y&&(this.isNewValueEdit=!1);var x=document.getElementsByClassName("e-ss-overlay-active");x.length?n===this.keyCodes.DELETE&&this.parent.notify(Oa,{id:x[0].id,sheetIdx:this.parent.activeSheetIndex+1}):(this.startEdit(null,null,!0,!0),this.getEditElement(i).focus())}if(n===this.keyCodes.DELETE){i.isProtected&&Ht(this.parent)?this.parent.notify(la,null):(this.editingHandler("delete"),this.parent.notify(gr,null))}}},e.prototype.renderEditor=function(){if(!this.editorElem||!t.select("#"+this.parent.element.id+"_edit",this.parent.element)){var e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit",attrs:{contentEditable:"true",role:"textbox",spellcheck:"false","aria-multiline":"true"}});this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove();var r=this.parent.element.querySelector(".e-sheet-content");if(!r)return;r.appendChild(e),this.editorElem=e}this.parent.notify(Mi,{action:"renderAutoComplete"})},e.prototype.refreshEditor=function(e,t,r,n,i){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e;var o=this.getEditElement(this.parent.getActiveSheet());r&&o&&(o.textContent=e),t&&this.parent.notify(Pi,{action:"refreshFormulabar",value:e}),this.parent.isEdit&&o&&i&&this.editCellData.value===o.textContent&&this.triggerEvent("cellEditing").cancel&&this.cancelEdit()},e.prototype.startEdit=function(e,t,r,n){void 0===r&&(r=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var i=this.parent.getActiveSheet(),o=u(i.activeCell),a=ke(o[0],o[1],i,!1,!0);if(Et(this.parent,o[0],o[1],this.parent.activeSheetIndex)){var s=this.parent.getCell(o[0],o[1]),l=!1,h=s.innerHTML;if(s&&h.indexOf("<")>-1&&h.indexOf(">")>-1&&h.indexOf("input")>-1&&(l=!0),l)return}this.updateEditCellDetail(e,t),this.initiateEditor(r),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify(io,null),this.parent.notify(Qi,[{enable:!1}]),a.formula&&!n&&this.parent.notify(ba,{range:a.formula,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.setCursorPosition=function(){var e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},e.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},e.prototype.editingHandler=function(e){var r,n=document.getElementsByClassName("e-ss-overlay-active"),i=n.length;switch(e){case"delete":if(i>0)n[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Ma,{id:n[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify(Oa,{id:n[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var o=this.parent.getActiveSheet(),a=o.selectedRange,s=y(a);a=m(s=s[0]>s[2]?w(s):s);var l={address:o.name+"!"+a,cancel:!1};if(this.parent.notify(Zt,{action:"cellDelete",eventArgs:l}),l.cancel)return;s=c(a=C(l.address)),Ut(this.parent,s,this.parent.activeSheetIndex),this.parent.notify(Wn,{}),0===s[0]&&0===s[1]&&s[2]>=o.usedRange.rowIndex&&s[3]>=o.usedRange.colIndex&&this.parent.setUsedRange(0,0,o,!1,!0);var h={cellIdx:s,isUnique:!1};if(this.checkUniqueRange(h),h.isUnique){var d=c(this.uniqueColl);(b=ke(d[0],d[1],this.parent.getActiveSheet()))&&(r=b.value.toString().indexOf("#SPILL!")>-1)}if(h.isUnique&&this.uniqueColl.split(":")[0]===a.split(":")[0]){for(var p=c(this.uniqueColl),u=p[0];u<=p[2];u++)for(var f=p[1];f<=p[3];f++)this.parent.updateCell({value:"",formula:""},m([u,f]));this.parent.notify(Sr,null),this.uniqueColl=""}else if(h.isUnique){var g=c(this.uniqueColl);if("#SPILL!"===ke(g[0],g[1],o).value){var v=!1;for(f=g[0];f<=g[2];f++)for(var x=g[1];x<=g[3];x++){var b=ke(f,x,o);f===g[0]&&x===g[1]?v=!1:t.isNullOrUndefined(b.value)||""===b.value||(v=!0)}v||this.reApplyFormula()}}h.isUnique?this.parent.notify(Yo,{action:"cellDelete",eventArgs:{address:o.name+"!"+a,isSpill:r}}):this.parent.notify(Yo,{action:"cellDelete",eventArgs:{address:o.name+"!"+a}})}}},e.prototype.getCurPosition=function(){var e={},t=window.getSelection();if(this.editorElem.textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){var r=e.start;e.start=e.end,e.end=r}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")&&this.editorElem.textContent===this.editCellData.value){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];e.start=n.selectionStart,e.end=n.selectionEnd}return e},e.prototype.mouseDownHandler=function(e){if(!t.closest(e.target,".e-findtool-dlg")&&!t.closest(e.target,".e-validationerror-dlg")&&this.isEdit){var r=this.getCurPosition();r.start&&(this.curStartPos=this.selectionStart=r.start),r.end&&(this.curEndPos=this.selectionEnd=r.end);var n=e.target,i=this.parent.getActiveSheet(),o=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=n.classList.contains("e-spreadsheet-edit");var a=W(this.editCellData.value,!0),s=this.getEditElement(i);if(n.classList.contains("e-cell")||n.classList.contains("e-header-cell")||n.classList.contains("e-selectall")||t.closest(n,".e-toolbar-item.e-active")||t.closest(n,".e-table")){if(this.isAltEnter){var l=s.textContent;l&&l.indexOf("\n")>-1&&(this.isAltEnter=!1,Le(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(s.textContent,this.isCellEdit))}if(!a||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{var h=this.selectionEnd,d=u(i.activeCell),p=ke(d[0],d[1],i);if(this.selectionStart!==this.selectionEnd&&this.editCellData.value===s.textContent&&-1!==this.validCharacters.indexOf(s.textContent.substring(this.selectionStart-1,this.selectionStart))&&G(s.textContent.substring(this.selectionStart,this.selectionEnd))&&s.textContent.indexOf(":")!==this.selectionEnd&&(this.editCellData.value=s.textContent.substring(0,this.selectionStart)+s.textContent.substring(this.selectionEnd,s.textContent.length)),this.editCellData.value===s.textContent&&s.textContent.indexOf("(")!==s.textContent.length-1&&-1!==s.textContent.indexOf("(")&&this.selectionStart===this.selectionEnd)if(this.editCellData.sheetIndex!==fe(this.parent,i.name)){var c=this.parent.element.querySelector(".e-formula-bar");if(","!==s.textContent.substring(c.selectionEnd-1,c.selectionEnd)&&!e.shiftKey)return o&&o.parentElement.removeChild(o),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(s.textContent.substring(h-1,h)))return o&&o.parentElement.removeChild(o),void this.endEdit(!1,e);if(!p)return;if((a=!!p.formula&&(W(ke(d[0],d[1],i).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){var f=this.selectionEnd;this.editCellData.value.length===f?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||N(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(o&&o.parentElement.removeChild(o),this.endEdit(!1,e)):this.editCellData.value===s.textContent&&(-1===this.validCharacters.indexOf((this.editCellData.value+i.selectedRange).substring(f-1,f))?(o&&o.parentElement.removeChild(o),this.endEdit(!1,e)):(-1===this.validCharacters.indexOf(s.textContent.substring(f-1,f))||")"!==s.textContent.substring(f,f+1)&&-1===this.validCharacters.indexOf(s.textContent.substring(f,f+1)))&&(o&&o.parentElement.removeChild(o),this.endEdit(!1,e)))}}}else if(a&&this.editCellData.value===s.textContent&&s.textContent.indexOf("(")!==s.textContent.length-1&&!this.isCellEdit&&-1===this.validCharacters.indexOf(this.editCellData.value.substring(this.selectionStart-1,this.selectionStart))&&be(this.parent,this.editCellData.sheetIndex).id===i.id){h=window.getSelection().focusOffset;if(-1===this.validCharacters.indexOf(s.textContent.substring(h-1,h)))return o&&o.parentElement.removeChild(o),this.parent.goTo(this.editCellData.fullAddr),void(this.isEdit&&this.endEdit(!1,e))}}},e.prototype.dblClickHandler=function(e){var r=e.target,n=this.parent.getActiveSheet(),i=u(n.activeCell),o=ke(i[0],i[1],n)||{};if(!t.closest(r,".e-datavisualization-chart"))if(n.isProtected&&ee(o,ze(n,i[1])))(r.classList.contains("e-active-cell")||r.classList.contains("e-cell"))&&this.parent.notify(la,null);else if(r.className.indexOf("e-ss-overlay")<0&&(r.classList.contains("e-active-cell")||r.classList.contains("e-cell")||t.closest(r,".e-sheet-content")||r.classList.contains("e-table")))if(this.isEdit)if(W(this.editCellData.value)){var a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===a&&this.endEdit()}else r.className.indexOf("e-spreadsheet-edit")<0&&this.endEdit();else this.isNewValueEdit=!1,this.startEdit()},e.prototype.updateEditCellDetail=function(e,r){var n,i;if(n=t.isNullOrUndefined(this.editCellData.sheetIndex)?e&&e.split("!").length>1?fe(this.parent,me(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?W(this.editCellData.value,!0)&&(i=be(this.parent,n),this.isNewValueEdit=!1):(i=be(this.parent,n),e=e?C(e):i.activeCell),e){var o=c(e),a=o[0],s=o[1],l=this.parent.getCell(a,s),h=rt(i,o,this.parent.frozenRowCount(i),this.parent.frozenColCount(i),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:Ee(this.parent,n)+"!"+e,rowIndex:a,colIndex:s,sheetIndex:n,element:l,value:r||"",position:h}}},e.prototype.initiateEditor=function(e){var r=this;this.parent.getData(this.editCellData.fullAddr).then(function(n){r.parent&&n.forEach(function(n){var i={cell:n,value:n?n.value:""};r.parent.notify(fr,i);var o=n?i.value:"";n&&n.formula&&(o=n.formula),r.editCellData.oldValue=o,r.editCellData.value?o=r.editCellData.value:r.editCellData.value=o,r.isNewValueEdit?o="":r.isNewValueEdit=!0,t.isUndefined(o)||r.refreshEditor(o,!1,!0,!1,!1),e&&r.setCursorPosition(),r.triggerEvent("cellEdit").cancel&&r.cancelEdit(!0,!1)})})},e.prototype.positionEditor=function(e){var r,n=this.editCellData.element,i={isEdit:!1};if(this.parent.notify(Ti,i),i.isEdit&&t.isNullOrUndefined(n)&&(n=r=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=r),n){n.classList.add("e-ss-edited");var o=this.parent.getActiveSheet(),a=ke(this.editCellData.rowIndex,this.editCellData.colIndex,o,!1,!0),s=this.editCellData.position.left+1,l=this.editCellData.position.top+1,h={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(cn,h);var d=Ve(o,h.range[0],h.range[2])-3,p=We(o,h.range[1],h.range[3])-3,c=this.parent.getMainContent(),u=c.parentElement,f=void 0,g=this.parent.frozenColCount(o),m=void 0,v=void 0,y=this.parent.frozenRowCount(o),C=void 0;if(this.editCellData.colIndex<g)f=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-n.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<y?"2"===this.parent.getRowHeaderContent().style.zIndex&&(m="3"):Ft(a.value,a.style,this.parent.cellStyle)>f&&(C=!0);else{f=u.offsetWidth-(s-c.scrollLeft)-28-this.parent.sheetModule.getRowHeaderWidth(o);var x=n.getBoundingClientRect(),b=u.getBoundingClientRect().width,S=this.parent.enableRtl?x.left:x.right,w=this.parent.getScrollElement();b<S&&(w.scrollLeft+=S-b+this.parent.sheetModule.getScrollSize())}this.editCellData.rowIndex<y&&(v=!0);var I=!v&&(a&&a.wrap||n&&e||C)?"auto;":d+"px;",E="display:block;top:"+l+"px;"+(this.parent.enableRtl?"right:":"left:")+s+"px;min-width:"+p+"px;max-width:"+(a&&a.wrap?p:f)+"px;height:"+I+(a&&a.wrap?"width:"+p+"px;":"")+"min-height:"+d+"px;"+(m?"z-index: "+m+";":"")+(v&&(a&&!a.wrap||n&&e)&&(Ft(a.value,a.style,this.parent.cellStyle)>f||n&&e)?"overflow: auto;":"");E+=n.style.cssText;var R=this.getEditElement(o,!0);R.setAttribute("style",E),Ft(R.textContent,a.style,this.parent.cellStyle)>f&&(R.style.height="auto");var A=this.parent.element.querySelector(".e-active-cell");A&&(A.style.height=d+4+"px"),n.classList.contains("e-right-align")?R.classList.add("e-right-align"):n.classList.contains("e-center-align")&&R.classList.add("e-center-align")}},e.prototype.updateEditedValue=function(e,r){void 0===e&&(e=!0);var n=this.editCellData.oldValue,i=n?n.toString().toUpperCase():"",o=!0,a=this.editCellData.addr,s=c(this.parent.getActiveSheet().activeCell),l=this.parent.getActiveSheet(),h=ke(s[0],s[1],l),d=ze(l,s[1]);r&&(this.editCellData.value=r);var p=this.editCellData.value;if(this.parent.notify(Bo,{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&(h&&h.validation||Ye(d,s[0],s[1]))){var u=p||this.getEditElement(l).innerText,f=this.parent.activeSheetIndex,g={value:u,range:"string"==typeof a?c(a):a,sheetIdx:f,isCell:!0,td:null,isValid:!0};this.parent.notify(qr,g),(o=g.isValid)?this.editCellData.value=u:this.isCellEdit=!0}if((n!==this.editCellData.value||i.indexOf("=RAND()")>-1||i.indexOf("RAND()")>-1||i.indexOf("=RANDBETWEEN(")>-1||i.indexOf("RANDBETWEEN(")>-1)&&o){var m=this.parent.getActiveSheet(),v=c(m.activeCell);n&&n.toString().indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify(Sr,null);var y={cellIdx:v,isUnique:!1};this.checkUniqueRange(y);var C=y.isUnique;if(C&&""!==n&&""===this.editCellData.value){if(-1===ke((w=c(this.uniqueColl))[0],w[1],m).value.toString().indexOf("#SPILL!"))return o}n&&n.toString().indexOf("UNIQUE")>-1&&this.editCellData.value&&this.editCellData.value.toString().indexOf("UNIQUE")>-1&&C&&this.updateUniqueRange("");var x={action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value};this.parent.notify(cr,x),m.conditionalFormats&&m.conditionalFormats.length&&this.parent.notify(vn,{indexes:[this.editCellData.rowIndex,this.editCellData.colIndex],isAction:!0,refreshAll:x.isFormulaDependent,isEdit:!0});var b=ke(v[0],v[1],m,!0),S=this.getRefreshNodeArgs(b);if(this.editCellData.value=S.value,b&&b.formula&&(this.editCellData.formula=b.formula),b&&b.wrap&&this.parent.notify(Hr,{range:v,wrap:!0,sheet:m}),e&&this.parent.refreshNode(this.editCellData.element,S),b&&b.hyperlink&&this.parent.serviceLocator.getService("cell").refreshRange(v),C){var w;if(ke((w=c(this.uniqueColl))[0],w[1],m).value.toString().indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==n&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&n!==this.editCellData.formula){for(var I=!1,E=w[0];E<=w[2];E++)for(var R=w[1];R<=w[3];R++){var A=ke(E,R,m);E===w[0]&&R===w[1]?I=!1:A&&!t.isNullOrUndefined(A.value)&&""!==A.value&&(I=!0)}I||this.reApplyFormula()}else this.updateUniqueRange(p)}}return o},e.prototype.checkUniqueRange=function(e){var t={range:[]};this.parent.notify(br,t);var r=t.range;e.sheetName||(e.sheetName=this.parent.getActiveSheet().name);for(var n=0;n<r.length;n++)if(r[n].split("!")[0]===e.sheetName)for(var i=c(r[n]),o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++)if(e.cellIdx[0]===o&&e.cellIdx[1]===a){e.isUnique=!0,this.uniqueCell=!0;var s=""!==this.uniqueColl?c(this.uniqueColl):[0,0,0,0],l=c(r[n]);if(s[0]===l[0]&&s[1]===l[1]){var h=[s[0],l[1],s[0],l[1]];h[2]=s[2]>l[2]?s[2]:l[2],h[3]=s[3]>l[3]?s[3]:l[3],this.uniqueColl=m(h),e.uniqueRange=m(h)}else this.uniqueColl=r[n],e.uniqueRange=r[n]}},e.prototype.updateUniqueRange=function(e){var t=c(this.uniqueColl),r=!1;"#SPILL!"!==ke(t[0],t[1],this.parent.getActiveSheet()).value&&(r=!0);for(var n=t[0];n<=t[2];n++)for(var i=t[1];i<=t[3];i++)r&&(n===t[0]&&i===t[1]?this.parent.updateCell({value:"#SPILL!"},m([n,i])):m([n,i]).split(":")[0]===this.editCellData.addr?this.parent.updateCell({value:e},m([n,i])):this.parent.updateCell({value:""},m([n,i])))},e.prototype.reApplyFormula=function(){var e=c(this.uniqueColl),t=ke(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCell({value:""},m([e[0],e[1]]));for(var r=this.parent.sheets,n=t.formula,i=0;i<r.length;i++)n.indexOf(r[i].name)>-1&&(n=n.replace(r[i].name,"!"+i));this.parent.computeExpression(n),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")},e.prototype.refreshDependentCellValue=function(e,t,r){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===r||this.uniqueCell&&this.parent.activeSheetIndex===r)){var n=be(this.parent,r),i=void 0;if(He(n,e)||Ge(n,t)||(i=this.parent.getCell(e,t)),i){if(i.parentElement){var o=i.parentElement.getAttribute("aria-rowindex");if(o&&Number(o)-1!==e)return}var a=ke(e,t,n),s=c(n.activeCell);s[0]===e&&s[1]===t&&(this.uniqueActCell=a.value);var l=this.getRefreshNodeArgs(a,e,t);this.parent.refreshNode(i,l)}}},e.prototype.getRefreshNodeArgs=function(e,t,r){var n={value:(e=e||{}).value,format:e.format,onLoad:!0,formattedText:"",isRightAlign:!1,type:"General",cell:e,rowIndex:void 0===t?this.editCellData.rowIndex:t,colIndex:void 0===r?this.editCellData.colIndex:r,isRowFill:!1};this.parent.notify(ir,n),n.formattedText=this.parent.allowNumberFormatting?n.formattedText:n.value;return{isRightAlign:n.isRightAlign,result:n.formattedText,type:n.type,value:n.value,curSymbol:n.curSymbol,isRowFill:n.isRowFill}},e.prototype.endEdit=function(e,t){void 0===e&&(e=!1),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1);var r=this.triggerEvent("beforeCellSave");if(r.cancel)this.parent.isEdit&&t&&t.preventDefault();else{r.value&&r.value.toString().indexOf("\n")>-1&&(Le(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(r.value,this.isCellEdit,!1,!1,!1));this.updateEditedValue(!0,r.value)?(this.triggerEvent("cellSave",t,r.value),this.resetEditState(),this.focusElement()):t&&t.preventDefault(),this.parent.showSheetTabs&&!this.parent.isProtected&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")}},e.prototype.cancelEdit=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave",r),this.resetEditState(),this.focusElement()},e.prototype.focusElement=function(){Pt(this.parent.element),this.parent.notify(Qi,[{enable:!0}])},e.prototype.triggerEvent=function(e,t,r){var n=this.parent.getActiveSheet(),i=ke(this.editCellData.rowIndex,this.editCellData.colIndex,n),o={element:this.editCellData.element,value:r||this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(i)};if(o.address){var a={cellIdx:c(o.address),isUnique:!1};this.checkUniqueRange(a),a.isUnique&&(o.isSpill=this.isSpill)}if(o.value!==o.oldValue){if("cellSave"!==e&&(o.cancel=!1),"beforeCellSave"===e){this.parent.notify(Zt,{eventArgs:o,action:"cellSave",preventAction:!0}),i=W(o.value)?{formula:o.value}:{value:o.value};if(oe(this.parent,n,{cell:i,rowIdx:this.editCellData.rowIndex,colIdx:this.editCellData.colIndex,eventOnly:!0}))return this.cancelEdit(!1,!1),o.cancel=!0,o}this.parent.trigger(e,o),"cellSave"===e&&(this.editCellData.formula&&(o.formula=this.editCellData.formula),o.originalEvent=t,this.parent.notify(Yo,{eventArgs:o,action:"cellSave"}))}else"cellSave"!==e&&"beforeCellSave"!==e&&this.parent.trigger(e,o);return{value:o.value,oldValue:null,element:null,address:null,cancel:o.cancel}},e.prototype.altEnter=function(){this.positionEditor(!0);var e,t=window.getSelection(),r=t.anchorNode,n=document.createRange();0===(e=3===r.nodeType?t.anchorOffset:r.textContent.length)&&r.textContent.length>0&&(e=r.textContent.length);var i=r.textContent,o=i.slice(0,e),a=i.slice(e)||" ";r.textContent=o+"\n"+a,n=document.createRange(),3===r.nodeType?(n.setStart(r,e+1),n.setEnd(r,e+1)):1===r.nodeType&&(n.setStart(r.firstChild,e+1),n.setEnd(r.firstChild,e+1)),t.removeAllRanges(),t.addRange(n)},e.prototype.resetEditState=function(e){if(void 0===e&&(e=!0),e){var r=this.getEditElement(this.parent.getActiveSheet());(W(r.textContent)||""===r.textContent)&&this.parent.notify(wa,null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",r===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):t.detach(r))}this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify(Mi,{action:"endEdit"})},e.prototype.refSelectionRender=function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&W(e.textContent)&&this.parent.notify(ba,{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),t=this.editCellData.value;this.parent.getActiveSheet().name===e&&W(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify(ba,{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).innerHTML=t,this.initiateCurPosition()):this.initiateCurPosition()},e.prototype.addressHandler=function(e){var t=window.getSelection();if(this.selectionStart=t.anchorOffset,this.selectionEnd=t.focusOffset,this.selectionStart>this.selectionEnd){var r=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=r}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];this.selectionStart=n.selectionStart,this.selectionEnd=n.selectionEnd}var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,i);var o=e.range,a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),s=this.editCellData.sheetIndex,l=this.getEditElement(this.parent.getActiveSheet());if(this.parent.getActiveSheet().name!==a&&(o="'"+this.parent.getActiveSheet().name+"'!"+o),e.isSelect)this.parent.notify(ba,{range:i.editedValue+o,formulaSheetIdx:s});else{var h=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));if(this.parent.getActiveSheet().name===h){var d=i.editedValue;this.selectionStart!==this.selectionEnd?(this.formulaBarCurStartPos=this.selectionStart,this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+o.length,l.textContent=d.substring(0,this.selectionStart)+o+d.substring(this.selectionStart)):d.indexOf(")")===d.length-1&&this.selectionEnd===d.length?(l.textContent=d.substring(0,d.length-1)+o+d.substring(d.length-1),this.curEndPos=l.textContent.length-1):d.indexOf(")")!==d.length-1?(l.textContent=d+o,this.curEndPos=l.textContent.length):l.textContent!==d?(l.textContent=d.substring(0,this.curStartPos)+o+d.substring(this.curStartPos),this.curEndPos=this.curStartPos+o.length):this.selectionStart!==this.selectionEnd||-1===this.validCharacters.indexOf(d.substring(this.selectionStart-1,this.selectionEnd))||-1===this.validCharacters.indexOf(d.substring(this.selectionStart,this.selectionEnd+1))&&")"!==d.substring(this.selectionStart,this.selectionEnd+1)||(l.textContent=d.substring(0,this.selectionStart)+o+d.substring(this.selectionEnd),this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+o.length,this.formulaBarCurStartPos=this.curStartPos)}}},e.prototype.updateFormulaBarValue=function(){var e=window.getSelection(),r=this.editCellData.value,n=this.parent.getActiveSheet().selectedRange;n=E(y(n))?n.split(":")[0]:n;var i=this.parent.element.querySelector(".e-formula-bar");if(r&&W(r,!0)){var o=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==o&&(n="'"+this.parent.getActiveSheet().name+"'!"+n),t.isNullOrUndefined(this.formulaBarCurStartPos)?r.indexOf(")")===r.length-1&&e.focusOffset===r.length?i.value=r.substring(0,r.length-1)+n+r.substring(r.length-1):r.indexOf(")")!==r.length-1?i.value=r+n:i.value!==r&&(i.value=r.substring(0,this.curStartPos)+n+r.substring(this.curStartPos)):i.value=r.substring(0,this.formulaBarCurStartPos)+n+r.substring(this.formulaBarCurStartPos),this.curEndPos=this.curStartPos+n.length}},e.prototype.setFormulaBarCurPosition=function(e,t,r){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,r))},e.prototype.initiateCurPosition=function(e){void 0===e&&(e={isCellEdit:!1});var t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var r=this.getCurPosition();this.endFormulaRef||r.start!==r.end||(this.updateFormulaReference(t),r.end&&-1===this.validCharacters.indexOf(this.editCellData.value[r.end-1])&&(this.endFormulaRef=!0))}else{var n=t.innerText,i=window.getSelection();if(i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")){var o=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(o,this.curEndPos,this.curEndPos)}else{if(n){var a=document.createRange();n.indexOf(")"),n.length,a.setStart(t.childNodes[0],this.curEndPos),a.setEnd(t.childNodes[0],this.curEndPos),i.removeAllRanges(),i.addRange(a)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){var s=this.parent.element.querySelector(".e-formula-bar");if(s.value){var l=s.value.length;s.value.indexOf(")")===l-1?this.setFormulaBarCurPosition(s,l-1,l-1):this.setFormulaBarCurPosition(s,l,l)}}}}},e.prototype.getEditElement=function(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){var r=this.parent.frozenRowCount(e),n=this.parent.frozenColCount(e),i=u(e.activeCell),o=void 0;if(i[0]<r&&i[1]<n)o=this.parent.getSelectAllContent();else if(i[0]<r)o=this.parent.getColumnHeaderContent();else{if(!(i[1]<n))return this.editorElem;o=this.parent.getRowHeaderContent()}var a=o.getElementsByClassName("e-spreadsheet-edit")[0];return!a&&t&&(a=o.appendChild(this.editorElem.cloneNode())),a}return this.editorElem},e.prototype.sheetChangeHandler=function(){this.isEdit||(this.editCellData.value=null)},e}(),yl=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return e.prototype.addEventListener=function(){this.parent.on(Li,this.init,this),this.parent.on(Ni,this.mouseDownHandler,this),this.parent.on(ji,this.virtualContentLoadedHandler,this),this.parent.on(Wi,this.cellNavigateHandler,this),this.parent.on(eo,this.selectRange,this),this.parent.on(yo,this.rowHeightChanged,this),this.parent.on(Co,this.colWidthChanged,this),this.parent.on(pa,this.protectHandler,this),this.parent.on(ba,this.initiateFormulaSelection,this),this.parent.on(wa,this.clearBorder,this),this.parent.on(La,this.getRowIdxFromClientY,this),this.parent.on(Na,this.getColIdxFromClientX,this),this.parent.on(Ua,this.chartBorderHandler,this),this.parent.on(ns,this.isTouchSelectionStarted,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Li,this.init),this.parent.off(Ni,this.mouseDownHandler),this.parent.off(ji,this.virtualContentLoadedHandler),this.parent.off(Wi,this.cellNavigateHandler),this.parent.off(eo,this.selectRange),this.parent.off(yo,this.rowHeightChanged),this.parent.off(Co,this.colWidthChanged),this.parent.off(pa,this.protectHandler),this.parent.off(ba,this.initiateFormulaSelection),this.parent.off(wa,this.clearBorder),this.parent.off(La,this.getRowIdxFromClientY),this.parent.off(Na,this.getColIdxFromClientX),this.parent.off(Ua,this.chartBorderHandler),this.parent.off(ns,this.isTouchSelectionStarted))},e.prototype.isTouchSelectionStarted=function(e){e.touchSelectionStarted=this.touchSelectionStarted},e.prototype.rowHeightChanged=function(e){var t=this;e.threshold&&Ke(function(){if(t.parent){var r=t.parent.getActiveSheet(),n=t.getActiveCell();if(n&&(r.frozenRows||r.frozenColumns||r.selectedRange.includes(" ")))t.selectRange({address:r.selectedRange});else{var i,o=w(c(r.selectedRange)),a={range:o,isActiveCell:!1,skipChecking:!0};if(n){var s=u(r.activeCell)[0];if(t.parent.notify(pn,a),a.isActiveCell){i=ke(o[0],o[1],r,!1,!0).rowSpan>1&&o[0]<=e.rowIdx&&o[2]>=e.rowIdx}s===e.rowIdx||i?n.style.height=parseFloat(n.style.height)+e.threshold+"px":s>e.rowIdx&&(n.style.top=parseFloat(n.style.top)+e.threshold+"px")}if(n=t.getSelectionElement()){if(i||o[0]===o[2]&&o[1]===o[3])return;var l=o[0],h=o[2];l<=e.rowIdx&&h>=e.rowIdx&&n?n.style.height=parseFloat(n.style.height)+e.threshold+"px":l>e.rowIdx&&n&&(n.style.top=parseFloat(n.style.top)+e.threshold+"px")}}}})},e.prototype.colWidthChanged=function(e){var t=this;e.threshold&&Ke(function(){if(t.parent){var r=t.parent.getActiveSheet(),n=t.getActiveCell();if(n&&(r.frozenRows||r.frozenColumns||r.selectedRange.includes(" ")))t.selectRange({address:r.selectedRange});else{var i,o=w(c(r.selectedRange)),a={range:o,isActiveCell:!1,skipChecking:!0};if(n){t.parent.notify(pn,a);var s=u(r.activeCell)[1];if(a.isActiveCell){var l=ke(o[0],o[1],r,!1,!0);i=l.rowSpan>1||l.colSpan>1}s===e.colIdx||i?n.style.width=parseFloat(n.style.width)+e.threshold+"px":s>e.colIdx&&(n.style.left=parseFloat(n.style.left)+e.threshold+"px")}if((n=t.getSelectionElement())&&!i&&(o[0]!==o[2]||o[1]!==o[3])){var h=o[1],d=o[3];h<=e.colIdx&&d>=e.colIdx&&n?n.style.width=parseFloat(n.style.width)+e.threshold+"px":h>e.colIdx&&n&&(n.style.left=parseFloat(n.style.left)+e.threshold+"px")}}}})},e.prototype.selectRange=function(e){e.address="Single"===this.parent.selectionSettings.mode?m(u(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking)},e.prototype.init=function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),t=w(c(e.selectedRange)),r=u(e.activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectMultiRange(e.selectedRange,!0,n)},e.prototype.selectMultiRange=function(e,t,r,n){var i=this,o=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(o=fe(this.parent,me(e)),e=e.split("!")[1]),this.parent.activeSheetIndex===o?e.split(" ").forEach(function(e,o){i.selectRangeByIdx(c(e),{type:"mousedown",ctrlKey:0!==o},null,r,t,n)}):ye(this.parent,e,this.parent.sheets[o])},e.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)},e.prototype.mouseDownHandler=function(e){if(!(t.closest(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))){var r={action:"getCurrentEditValue",editedValue:""},n=this.parent.getActiveSheet();this.parent.notify(Oi,r);var i=W(r.editedValue,!0);if(!this.parent.isEdit||i){var o=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else o&&o.classList.remove("e-ss-overlay-active");if(t.closest(e.target,".e-datavisualization-chart"))return;if(n.isProtected&&!n.protectSettings.selectCells&&!n.protectSettings.selectUnLockedCells)return;if(!t.closest(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var a=this.parent.getActiveSheet(),s=this.parent.selectionSettings.mode,l=this.getRowIdxFromClientY({clientY:vt(e),target:e.target}),h=this.getColIdxFromClientX({clientX:mt(e),target:e.target}),d=u(a.activeCell),p=ke(l,h,a),f=void 0,g=void 0;if(a.isProtected&&a.protectSettings.selectUnLockedCells&&!a.protectSettings.selectCells)if(t.isNullOrUndefined(p)){if(!a.protectSettings.selectCells)return}else{if(!0===p.isLocked||t.isNullOrUndefined(p.isLocked))return;var v=this.parent.element.getElementsByClassName("e-sheet-panel")[0];v&&v.classList.contains("e-protected")&&v.classList.remove("e-protected")}if(a.showHeaders){var C=e.target;if(a.frozenColumns||a.frozenRows){var x=this.parent.getSelectAllContent().querySelector("thead");g=x?(this.parent.getColumnHeaderContent().contains(C)||x.contains(C))&&C.classList.contains("e-header-cell"):this.parent.getColumnHeaderContent().contains(C)&&C.classList.contains("e-header-cell"),f=(x=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(C)||x.contains(C))&&C.classList.contains("e-header-cell"):this.parent.getRowHeaderContent().contains(C)&&C.classList.contains("e-header-cell")}else f=this.parent.getRowHeaderContent().contains(e.target),g=this.parent.getColumnHeaderContent().contains(e.target)}if(3===e.which&&this.isSelected(l,h))return;if(e.target.classList.contains("e-autofill")){this.isautoFillClicked=!0;var b=e.target.parentElement.querySelector(".e-dragfill-ddb");b&&!b.classList.contains("e-hide")||(this.dAutoFillCell=a.selectedRange)}var S=c(a.topLeftCell),w=void 0;f?(this.isRowSelected=!0,e.shiftKey&&"Single"!==s||(this.startCell=[l,0]),w=[this.startCell[0],a.frozenColumns?S[1]:0,l,a.colCount-1]):g?(this.isColSelected=!0,e.shiftKey&&"Single"!==s||(this.startCell=[0,h]),w=[a.frozenRows?S[0]:0,this.startCell[1],a.rowCount-1,h]):t.closest(e.target,".e-select-all-cell")?(this.startCell=[a.frozenRows?S[0]:0,a.frozenColumns?S[1]:0],w=[].concat(this.startCell,[a.rowCount-1,a.colCount-1])):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==s||(this.startCell=[l,h]),this.isautoFillClicked||t.closest(e.target,".e-filloption")||(w=[].concat(this.startCell?this.startCell:u(a.activeCell),[l,h])));var I=e.ctrlKey&&w&&a.selectedRange.includes(m(w));if(!I&&"Multiple"===s&&(!ct(e)&&(!dt(e)||dt(e)&&d[0]===l&&d[1]===h)||g||f)?(document.addEventListener(lt().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||document.addEventListener(lt().split(" ")[1],this.mouseMoveEvt,{passive:!1}),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,I||ct(e)||t.EventHandler.add(document,ht(),this.mouseUpHandler,this),dt(e)&&!g&&!f)return void(this.touchEvt=e);w&&this.selectRangeByIdx(w,e),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(i&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-wrap-content")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){w=E(y(w=this.parent.getActiveSheet().selectedRange))?w.split(":")[0]:w,this.parent.notify(Ea,{range:w,isSelect:!1})}}},e.prototype.mouseMoveHandler=function(e){var r=this,n=this.parent.getActiveSheet();pt(e)&&e.preventDefault();var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,i);var o,a=W(i.editedValue,!0),s=this.parent.getMainContent().parentElement,l=this.parent.element.getElementsByClassName("e-scroller")[0],h=s.getBoundingClientRect(),d=this.parent.frozenColCount(n),p=h.left+this.parent.sheetModule.getRowHeaderWidth(n),f=h.top,g=h.right,m=h.bottom,v=mt(e),y=vt(e),C=this.isRowSelected?n.colCount-1:this.getColIdxFromClientX({clientX:Math.min(v,g),target:e.target}),x=this.isColSelected?n.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(y,m),target:e.target});if(e.ctrlKey){var b=n.selectedRange.split(" ");o=c(b[b.length-1])}else o=c(n.selectedRange);var S={range:[x,C,x,C]};if(this.parent.notify(cn,S),S.range[2]!==o[2]||S.range[3]!==o[3]){var w=this.parent.frozenRowCount(n),I=y>m&&(!d||v<p)&&x<n.rowCount,E=y<f&&x>=0&&!this.isColSelected&&!!s.scrollTop;w>x&&(I=!1,E=!1);var R=v>g&&C<n.colCount,A=v<p&&C>=0&&!this.isRowSelected&&!!l.scrollLeft;d>C&&(R=!1,A=!1),this.clearInterval();var k,F;if(a||this.isColSelected||this.isRowSelected||(o=u(n.activeCell)),I||E||R||A)(E||A)&&(k=x,F=C),this.scrollInterval=setInterval(function(){if((I||E)&&!r.isColSelected){if((x=r.getRowIdxFromClientY({clientY:I?m:f}))>=n.rowCount)return void r.clearInterval();s.scrollTop+=(I?1:-1)*Ue(n,x)}if((R||A)&&!r.isRowSelected){if((C=r.getColIdxFromClientX({clientX:R?g:p}))>=n.colCount)return void r.clearInterval();l.scrollLeft+=(R?1:-1)*je(n,C)}if(E&&!s.scrollTop||A&&!l.scrollLeft)return r.selectRangeByIdx([].concat(o[0],o[1],[k,F]),e),void r.clearInterval();r.selectRangeByIdx([].concat(o[0],o[1],[x,C]),e)},100);else{var T=[].concat(o[0],o[1],[x,C]);if(w&&T[0]<w&&T[2]>=w&&s.scrollTop&&(s.scrollTop=0,T[2]=w),d&&T[1]<d&&T[3]>=d&&l.scrollLeft&&(l.scrollLeft=0,T[3]=d),this.isautoFillClicked){e.target.classList.contains("e-autofill")&&(this.dAutoFillCell=n.selectedRange);var L={e:e,indexes:null};this.parent.notify(ds,L),T=L.indexes}this.selectRangeByIdx(T,e)}if(a&&this.parent.isEdit&&!t.closest(e.target,"#"+this.parent.element.id+"_edit")){var N=this.parent.getActiveSheet().selectedRange;this.parent.notify(Ea,{range:N,isSelect:!1})}}},e.prototype.mouseUpHandler=function(e){var r=this.getRowIdxFromClientY({clientY:vt(e),target:e.target}),n=this.getColIdxFromClientX({clientX:mt(e),target:e.target});this.clearInterval(),!ct(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:vt(this.touchEvt),target:e.target})!==r||this.getColIdxFromClientX({clientX:mt(this.touchEvt),target:e.target})!==n||this.mouseDownHandler(e),document.removeEventListener(lt().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||document.removeEventListener(lt().split(" ")[1],this.mouseMoveEvt),t.EventHandler.remove(document,ht(),this.mouseUpHandler);var i=this.parent.getActiveSheet();if((i.frozenRows||i.frozenColumns)&&it(this.parent.element,null,"e-cur-selection",!0,!0),this.parent.notify(Gi,e),this.isautoFillClicked){var o=c(this.parent.getActiveSheet().selectedRange);this.isColSelected&&o[1]===n||this.isRowSelected&&o[0]===r||this.parent.notify(hs,{event:e,dAutoFillCell:this.dAutoFillCell}),this.isautoFillClicked=!1}else e.ctrlKey||Bt(Ce(this.parent.getActiveSheet()))?this.parent.notify(cs,null):this.parent.notify(ss,null);var a={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,a);(W(a.editedValue)||a.editedValue&&0===a.editedValue.toString().indexOf("="))&&this.parent.isEdit&&this.parent.notify(Sa,{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})},e.prototype.isSelected=function(e,t){for(var r,n=!1,i=this.parent.getActiveSheet().selectedRange.split(" "),o=0;o<i.length;o++)if((r=w(c(i[o])))[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]){n=!0;break}return n},e.prototype.virtualContentLoadedHandler=function(e){var t,r,n,i=this,o=this.parent.getActiveSheet();o.selectedRange.split(" ").forEach(function(a,s){if(t=c(a),n=0===t[1]&&t[3]===e.prevRowColCnt.colCount-1,r=0===t[0]&&t[2]===e.prevRowColCnt.rowCount-1,n||r)t=r&&n?[0,0,o.rowCount-1,o.colCount-1]:r?[0,t[1],o.rowCount-1,t[3]]:[t[0],0,t[2],o.colCount-1],o.frozenRows||o.frozenColumns?i.selectRangeByIdx(t,{type:"mousedown",ctrlKey:0!==s},!1,!1,!1,!1,void 0,!0):i.selectRangeByIdx(t,null,!0,null,null,null,s);else{t=c(a);var l=i.parent.viewport.topIndex+i.parent.frozenRowCount(o),h=i.parent.viewport.leftIndex+i.parent.frozenColCount(o);i.highlightHdr(t,0!==s,t[0]>=l||t[2]>=l,t[1]>=h||t[3]>=h)}})},e.prototype.clearInterval=function(){clearInterval(this.scrollInterval),this.scrollInterval=null},e.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},e.prototype.cellNavigateHandler=function(e){var t=this.parent.getActiveSheet();(!t.isProtected||t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells)&&this.selectRangeByIdx(e.range.concat(e.range),void 0,!1,!1,!1,!1,void 0,e.preventAnimation)},e.prototype.getColIdxFromClientX=function(e){var r=0,n=this.parent.getActiveSheet(),i=0;if(e.isImage)i=Number(this.addDPRValue(e.clientX).toFixed(2));else{var o=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();if(i=this.parent.enableRtl?o.right-this.parent.sheetModule.getRowHeaderWidth(n,!0)-1-e.clientX:e.clientX-(o.left+this.parent.sheetModule.getRowHeaderWidth(n,!0)+1),i+=this.parent.viewport.beforeFreezeWidth,!e.target||!t.closest(e.target,".e-row-header")&&!t.closest(e.target,".e-selectall-container")||this.isScrollableArea(e.clientX,e.target,!0))if(this.parent.frozenColCount(n)){var a=this.parent.element.querySelector(".e-frozen-column");i=parseInt(a.style.left)>i?i:i+this.getScrollLeft()}else i+=this.getScrollLeft()}for(var s,l=0;;l++)if(s=r+=je(n,l,null,!0),e.isImage&&(s=Number(s.toFixed(2))),i<s||this.parent.scrollSettings.isFinite&&l===n.colCount-1)return e.isImage||(e.size=i),e.clientX=l,l},e.prototype.isScrollableArea=function(e,t,r){return!!t.classList.contains("e-table")&&(r?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)},e.prototype.addDPRValue=function(e){if(window.devicePixelRatio%1>0){var t=e*window.devicePixelRatio%1;return e+(t?(t>.5?1-t:-1*t)/window.devicePixelRatio:0)}return e},e.prototype.getRowIdxFromClientY=function(e){var r=0,n=this.parent.getActiveSheet(),i=0;if(e.isImage)i=Number(this.addDPRValue(e.clientY).toFixed(2));else{var o=document.getElementById(this.parent.element.id+"_sheet");i=e.clientY+this.parent.viewport.beforeFreezeHeight-(o.getBoundingClientRect().top+(n.showHeaders?31:0)),e.target&&t.closest(e.target,".e-header-panel")&&!this.isScrollableArea(e.clientY,e.target)||(i+=this.parent.getMainContent().parentElement.scrollTop)}for(var a,s=0;;s++)if(a=r+=Ue(n,s,!0),e.isImage&&(a=Number(a.toFixed(2))),i<a||this.parent.scrollSettings.isFinite&&s===n.rowCount-1)return e.isImage||(e.size=i),e.clientY=s,s},e.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),nt(this.parent,t,e,"e-formularef-indicator")}},e.prototype.selectRangeByIdx=function(e,r,n,i,o,a,s,l){var h=this;if(!(r&&r.target&&t.closest(r.target,"#"+this.parent.element.id+"_edit"))){var d={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(Oi,d);var p,u=!!this.parent.isEdit&&W(d.editedValue,!0)&&!d.endFormulaRef,f=r&&r.ctrlKey&&ut(r);f||(p=this.getSelectionElement(r,s));var g,v=this.parent.getActiveSheet(),y=c(v.topLeftCell),C=this.parent.element.querySelector(".e-formularef-indicator"),x={range:[].slice.call(e),isActiveCell:!1,skipChecking:a},b=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");this.isColSelected||this.isRowSelected||this.parent.notify(pn,x),e!==x.range&&(g=!0),e=x.range;var S=new Promise(function(e){e(void 0)}),w={range:m(e),cancel:!1};if(this.parent.trigger("beforeSelect",w),!w.cancel){if(u&&C&&C.parentElement.removeChild(C),this.parent.notify(ls,null),!E(e)&&!x.isActiveCell||f){if(f)if(void 0===s){var I=m(e);if(v.selectedRange.includes(I)){return(T=v.selectedRange.split(" ")).length>1?(T.splice(T.indexOf(I),1),I=T.join(" ")):I=v.activeCell+":"+v.activeCell,void this.selectRange({address:I})}p=this.getSelectionElement(r,s)}else p=this.getSelectionElement(r,s);if(u&&this.parent.isEdit)r&&r.target&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(Ea,{range:m(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{A=void 0;p&&(p.classList.remove("e-hide"),(v.frozenRows||v.frozenColumns)&&((r&&r.target||f)&&(A="e-cur-selection",ft(r)&&p.classList.contains("e-cur-selection")?p.classList.add("e-hide"):p.classList.add(A)),!f&&(this.isColSelected||this.isRowSelected)&&ut(r)&&(it(this.parent.getSelectAllContent(),null,"e-selection"),it(this.parent.getColumnHeaderContent(),null,"e-selection"),it(this.parent.getRowHeaderContent(),null,"e-selection"))));var R=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);g&&R&&(R.left={idx:0,size:0}),S=nt(this.parent,p,e,A,l,f,f&&!r.target)||S}}else{if(p&&(p.classList.contains("e-multi-range")||p.classList.add("e-hide"),v.frozenRows||v.frozenColumns)){var A=ft(r)?"e-cur-selection":"e-selection";it(this.parent.getSelectAllContent(),null,A,!0),it(this.parent.getColumnHeaderContent(),null,A,!0),it(this.parent.getRowHeaderContent(),null,A,!0)}v.frozenColumns||v.frozenRows||!p||nt(this.parent,p,e),u&&r&&r.target&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(Ea,{range:m(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e))}var k={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(Oi,k),v.frozenColumns&&e[1]>0&&e[1]===y[1]&&e[3]===v.colCount-1&&(e[1]=0),v.frozenRows&&e[0]>0&&e[0]===y[0]&&e[2]===v.rowCount-1&&(e[0]=0);var F=m(e);if(r&&r.ctrlKey&&(ft(r)||gt(r)))F=v.selectedRange.slice(0,v.selectedRange.lastIndexOf(" "))+" "+F;else if(s>-1){var T;(T=v.selectedRange.split(" "))[s]=F,F=T.join(" ")}if(u||this.isautoFillClicked)o||this.isautoFillClicked||ye(this.parent,F,v,f);else{var L=!1;v.selectedRange!==F&&(L=!0),ye(this.parent,F,v,f),L&&S.then(function(){h.parent.trigger("select",{range:h.parent.getActiveSheet().selectedRange})})}this.UpdateRowColSelected(e),this.highlightHdr(e,r&&r.ctrlKey),n||r&&("mousemove"===r.type||pt(r))||(u?k.sheetIndex===this.parent.getActiveSheet().id-1&&o?(i=!0,this.updateActiveCell(i?c(v.activeCell):e,o,l)):this.parent.isEdit||this.updateActiveCell(i?c(v.activeCell):e,o,l):this.updateActiveCell(i?c(v.activeCell):e,o,l)),t.isNullOrUndefined(r)&&(r={type:"mousedown"}),u?o||this.parent.notify(Wn,r):this.parent.notify(Wn,r),f||Bt(Ce(this.parent.getActiveSheet()))?this.parent.notify(cs,null):this.parent.notify(ss,{preventAnimation:l}),this.parent.showAggregate&&this.parent.notify(ma,{}),this.parent.notify(Fa,{}),b&&this.parent.notify(ja,{}),this.parent.notify(_a,{})}}},e.prototype.UpdateRowColSelected=function(e){var t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1},e.prototype.updateActiveCell=function(e,t,r){var n,i,o,a=this.parent.getActiveSheet(),s=c(a.topLeftCell);this.isColSelected?(n=s[0],i=e[1],this.isRowSelected&&(i=s[1])):(n=e[0],i=e[1],this.isRowSelected&&(i=s[1]));var l={range:[n,i].concat([n,i])};if(this.parent.notify(cn,l),e!==l.range&&(o=!0),e=l.range,a.activeCell!==g(e[0],e[1])||t){if(this.parent.setSheetPropertyOnMute(a,"activeCell",g(e[0],e[1])),a.isProtected){var h=this.parent.element.querySelector(".e-formula-bar"),d=ee(ke(e[0],e[1],a),ze(a,e[1]));d&&h&&!h.disabled?h.disabled=!0:!d&&h&&h.disabled&&(h.disabled=!1)}if(this.getActiveCell()){var p=this.getOffset(e[2],e[3]);o&&(p.left={idx:0,size:0}),nt(this.parent,this.getActiveCell(),e,"e-active-cell",r)}this.parent.notify(gr,null)}else nt(this.parent,this.getActiveCell(),e,"e-active-cell",r)},e.prototype.getOffset=function(e,t){var r={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(r.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(r.top=this.parent.scrollModule.offset.top)),r},e.prototype.getSelectionElement=function(e,r){var n=this.parent.getActiveSheet();if(e&&e.ctrlKey){if(gt(e)||ft(e)){if(n.frozenColumns||n.frozenRows){return(i=this.parent.getMainContent().querySelector(".e-cur-selection"))||(i=this.parent.element.querySelector(".e-multi-range"))&&i.cloneNode()}return this.parent.getMainContent().querySelector(".e-selection:last-child")}var i,o=this.parent.getMainContent().getElementsByClassName("e-selection")[0];return(i=o.cloneNode()).classList.add("e-multi-range"),n.frozenColumns||n.frozenRows?(n.selectedRange.includes(" ")||(o.classList.remove("e-hide"),nt(this.parent,o,w(c(n.selectedRange)),void 0,!1,!0)),!this.parent.getMainContent().querySelector(".e-multi-range")&&o.classList.contains("e-hide")?o:i):(o.classList.remove("e-hide"),this.parent.getMainContent().appendChild(i))}if(r>-1)return n.frozenRows||n.frozenColumns?this.parent.element.querySelector(".e-sheet").getElementsByClassName("e-selection")[r]:this.parent.getMainContent().getElementsByClassName("e-selection")[r];return[].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(function(e){t.remove(e)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0]},e.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},e.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},e.prototype.highlightHdr=function(e,r,n,i){var o=this;void 0===n&&(n=!0),void 0===i&&(i=!0);var a=this.parent.getActiveSheet();if(a.showHeaders){r||(t.removeClass(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),t.removeClass(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"));var s=this.parent.element.getElementsByClassName("e-select-all-cell")[0];s&&t.removeClass([s],["e-prev-highlight-right","e-prev-highlight-bottom"]);var l=[],h=[],d=w(e);this.isRowSelected&&(d[1]=re(a,d[1],!0,"columns")),this.isColSelected&&(d[0]=re(a,d[0],!0));var p,c,f=[0,0,0,0],g=[0,0,0,0],m=u(a.topLeftCell),v=function(e,t,r){var n,i;e&&d[p]<e?(i=o.parent.hiddenCount(m[p],d[p],t,a),f[p]=d[p]-i-m[p],n=d[c]<e?d[c]:e-1,f[c]=n-o.parent.hiddenCount(d[p],n,t,a)-i-m[p]+1,n=o.parent.viewport[r]+e,d[c]>=n&&(g[p]=0,g[p]-=o.parent.hiddenCount(n,n,t,a),g[c]=d[c]-o.parent.hiddenCount(n,d[c],t,a)-n+1)):(n=o.parent.viewport[r]+e,i=o.parent.hiddenCount(n,d[p],t,a),g[p]=d[p]-i-n,g[c]=d[c]-o.parent.hiddenCount(d[p],d[c],t,a)-i-n+1)},y=function(e,t,r){for(var n=[].slice.call(t.getElementsByClassName("e-header-cell")),i=e[p];i<e[c];i++)n[i]&&r.push(n[i])};if(n){if(p=0,c=2,v(this.parent.frozenRowCount(a),"rows","topIndex"),a.frozenRows){var C=this.parent.getSelectAllContent().querySelector("tbody");C&&y(f,C,l)}y(g,this.parent.getRowHeaderContent(),l)}if(i){if(p=1,c=3,v(this.parent.frozenColCount(a),"columns","leftIndex"),a.frozenColumns){var x=this.parent.getSelectAllContent().querySelector("thead");x&&y(f,x,h)}y(g,this.parent.getColumnHeaderContent(),h)}a.isProtected&&!a.protectSettings.selectCells?t.removeClass([].concat(l,h),"e-highlight"):t.addClass([].concat(l,h),"e-highlight"),l.length&&l[0].parentElement.previousElementSibling&&l[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),h.length&&h[0].previousElementSibling&&h[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(a.isProtected&&!a.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),s&&(0===d[0]&&s.classList.add("e-prev-highlight-bottom"),0===d[1]&&s.classList.add("e-prev-highlight-right"))}},e.prototype.protectHandler=function(){var e=c(this.parent.getActiveSheet().selectedRange),t=w(e),r=u(this.parent.getActiveSheet().activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectRangeByIdx(e,null,null,n)},e.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},e.prototype.processFormulaEditRange=function(e,t){var r,n=t,i=0,o=this.parseFormula(e),a=o.length,s=0,l=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var h=this.parent.getActiveSheet().id-1;i<a&&(r=o[i],!(this.invalidOperators.indexOf(r)>-1));){if(G(r.toUpperCase())){if(r=r.replace(/\$/g,""),i>0&&o[i-1].indexOf("!")===o[i-1].length-1){var d=o[i-1].split("!");n=fe(this.parent,d[0].substring(1,d[0].length-1))}":"===o[i+1]&&o[++i+1]&&G(o[i+1].toUpperCase())&&(r=r+":"+o[i+1],i++),h===n&&this.updateFormulaEditRange(r,s,l),n=t,s++}i++}},e.prototype.updateFormulaEditRange=function(e,t,r){var n=c(e);this.formulaRange[t]=e,this.dStartCell={rowIndex:n[0],colIndex:n[1]},this.dEndCell={rowIndex:n[2],colIndex:n[3]},this.focusBorder(this.dStartCell,this.dEndCell,r[t%6])},e.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},e.prototype.focusBorder=function(e,r,n,i){i=!t.isNullOrUndefined(i)&&i;var o=w([e.rowIndex,e.colIndex,r.rowIndex,r.colIndex]),a=this.parent.getActiveSheet();if(a.frozenRows||a.frozenColumns){var s=this.parent.createElement("div",{className:i?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return s.appendChild(this.parent.createElement("div",{className:"e-top"})),s.appendChild(this.parent.createElement("div",{className:"e-bottom"})),s.appendChild(this.parent.createElement("div",{className:"e-left"})),s.appendChild(this.parent.createElement("div",{className:"e-right"})),void nt(this.parent,s,o,"e-range-indicator")}var l=o[0],h=o[1],d=o[2],p=o[3];l&&this.getEleFromRange([l-1,h,l-1,p]).forEach(function(e){e&&(e.classList.add(n[1]),i||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([l,p,d,p]).forEach(function(e){e&&(e.classList.add(n[0]),i||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([d,h,d,p]).forEach(function(e){e&&(e.classList.add(n[1]),i||e.classList.add("e-formularef-selection"))}),h&&this.getEleFromRange([l,h-1,d,h-1]).forEach(function(e){e&&(e.classList.add(n[0]),i||e.classList.add("e-formularef-selection"))})},e.prototype.getEleFromRange=function(e){var t,r,n,i,o=e[0],a=e[1],s=e[2],l=e[3],h=[],d=[];if(o>s&&(n=o,o=s,s=n),a>l&&(n=a,a=l,l=n),this.parent.scrollSettings.enableVirtualization)for(t=o;t<=s;t++)if((r=t)>-1){var p=this.parent.getRow(r,null);p&&(i=p.getElementsByClassName("e-cell"),h=l===a?[i[l]]:this.getRowCells(i,a,l+1),this.merge(d,h))}return d},e.prototype.getRowCells=function(e,t,r){for(var n=[];t<r;t++)e[t]&&n.push(e[t]);return n},e.prototype.merge=function(e,t){e&&t&&Array.prototype.push.apply(e,t)},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows){[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(function(e){t.detach(e)})}else for(var r=this.parent.element.getElementsByClassName("e-formularef-selection"),n=0;n<r.length;n++)for(var i=r[n],o=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"],a=0;a<o.length;a++)i.classList.remove(o[a])},e.prototype.parseFormula=function(e){for(var t,r,n=0,i=[],o=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),a=o.length;n<a;)if(t=o[n]){if(1===t.length)i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t);else if(r=t[0],t.indexOf("!")>0){this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1));var s=t.indexOf("!")+1;i.push(t.substr(0,s)),i.push(t.substr(s))}else this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t);n++}else n++;return i},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e.charAt[0]);return t>=129&&t<=142},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""},e.prototype.markSpecialChar=function(e){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.getModuleName=function(){return"selection"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Cl=function(){function e(e){this.clientX=0,this.isKeyScroll=!0,this.parent=e,this.addEventListener(),this.initProps()}return e.prototype.onContentScroll=function(e){if(this.parent){var r,i,o=this.parent.getMainContent().parentElement,a=e.scrollLeft,s=e.scrollTop||o.scrollTop,l=a&&this.parent.enableRtl?this.initScrollValue-a:a;if(this.parent.allowAutoFill){var h=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn-popup"),d=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(h){t.getComponent(d,n.DropDownButton).toggle()}}if(!t.isNullOrUndefined(a)&&this.prevScroll.scrollLeft!==l){var p=l>this.prevScroll.scrollLeft;i=this.offset.left.size,this.offset.left=this.getColOffset(l,p,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=a,this.parent.getMainContent().scrollLeft=a,e.scrollLeft=a),r={cur:this.offset.left,prev:{idx:this.leftIndex,size:i},increase:p,preventScroll:e.preventScroll},this.updateTopLeftCell(p,!0),this.parent.notify(Vi,r),this.parent.scrollSettings.enableVirtualization||!p||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=r.prev.idx,this.prevScroll.scrollLeft=l}if(Math.round(this.prevScroll.scrollTop)!==Math.round(s)){e.skipRowVirualScroll&&(this.prevScroll.scrollTop=0,this.offset.top={idx:0,size:0});var c=s>this.prevScroll.scrollTop;i=this.offset.top.size,this.offset.top=this.getRowOffset(s,c),r={cur:this.offset.top,prev:{idx:this.topIndex,size:i},increase:c,preventScroll:e.preventScroll},this.updateTopLeftCell(c),e.preventScroll&&this.offset.top.idx<=this.parent.getThreshold("row")?this.offset.top={idx:0,size:0}:e.skipRowVirualScroll?r.prev.idx=r.cur.idx:this.parent.notify(_i,r),this.parent.scrollSettings.enableVirtualization||!c||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=r.prev.idx,this.prevScroll.scrollTop=s}var u={isEdit:!1};if(this.parent.notify(Ti,u),u.isEdit){this.parent.element.querySelector(".e-formula-bar").focus()}this.isKeyScroll=!0}},e.prototype.updateScrollValue=function(e){void 0!==e.scrollLeft&&(this.prevScroll.scrollLeft=e.scrollLeft+(this.prevScroll.scrollLeft-this.offset.left.size),this.offset.left.size=e.scrollLeft),void 0!==e.scrollTop&&(this.prevScroll.scrollTop=e.scrollTop+(this.prevScroll.scrollTop-this.offset.top.size),this.offset.top.size=e.scrollTop)},e.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},g(e.rowCount,0)+":"+g(e.rowCount+t-1,e.colCount-1)),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)},e.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},g(0,e.colCount)+":"+g(e.rowCount-1,e.colCount+t-1)),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)},e.prototype.updateTopLeftCell=function(e,t){var r=this.parent.getActiveSheet(),n=this.offset.top.idx,i=this.offset.left.idx;if(!e){var o=this.parent.frozenRowCount(r);n=re(r,n+o,!0)-o;var a=this.parent.frozenColCount(r);i=re(r,i+a,!0,"columns")-a}t?this.parent.updateTopLeftCell(null,i,"row"):this.parent.updateTopLeftCell(n,null,"col")},e.prototype.getRowOffset=function(e,t){var r=this.offset.top.size,n=this.parent.getActiveSheet(),i=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,o=this.parent.frozenRowCount(n),a=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);i<a;)if(t){if(r+=Ue(n,i-1+o,!0),Math.abs(Math.round(r)-e)<=1)return{idx:re(n,i+o,!0)-o,size:r};if(Math.round(r)>e)return{idx:i-1,size:r-Ue(n,i-1+o,!0)};i++}else{if((r-=Ue(n,i+o,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(r)-e)<=1)return{idx:i,size:r};if(Math.round(r)<e)return r+=Ue(n,i+o,!0),Math.round(r)>e?{idx:i,size:r-Ue(n,i+o,!0)<0?0:r-Ue(n,i+o,!0)}:{idx:re(n,i+1+o,!0)-o,size:r};i--}return{idx:this.offset.top.idx,size:this.offset.top.size}},e.prototype.getColOffset=function(e,t,r){for(var n=this.offset.left.size,i=this.parent.getActiveSheet(),o=t?this.offset.left.idx+1:this.offset.left.idx?this.offset.left.idx-1:0,a=this.parent.frozenColCount(i),s=this.parent.scrollSettings.isFinite?i.colCount:1/0;o<s;)if(t){if(n+=je(i,o-1+a,r,!0),Math.abs(Math.round(n)-e)<=1)return{idx:re(i,o+a,!0,"columns")-a,size:n};if(Math.round(n)>e)return{idx:o-1,size:n-je(i,o-1+a,r,!0)};o++}else{if((n-=je(i,o+a,r,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(n)-e)<=1)return{idx:o,size:n};if(Math.round(n)<e)return n+=je(i,o+a,r,!0),Math.round(n)>e?(n-=je(i,o+a,r,!0),{idx:o,size:n<0?0:n}):{idx:re(i,o+1+a,!0,"columns")-a,size:n};o--}return{idx:this.offset.left.idx,size:this.offset.left.size}},e.prototype.contentLoaded=function(e){if(!this.parent.scrollSettings.enableVirtualization){var t=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:t}),this.parent.getScrollElement().appendChild(t)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)},e.prototype.updateNonVirualScrollWidth=function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width)+"px"},e.prototype.onHeaderWheel=function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX},e.prototype.onContentWheel=function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)},e.prototype.scrollHandler=function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})},e.prototype.updateScroll=function(e){t.isNullOrUndefined(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left},e.prototype.setScrollEvent=function(e){void 0===e&&(e={set:!0}),e.set?(t.EventHandler.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),t.EventHandler.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),t.EventHandler.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),t.EventHandler.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),t.EventHandler.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),t.EventHandler.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)):(t.EventHandler.remove(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll),t.EventHandler.remove(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel),t.EventHandler.remove(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel),t.EventHandler.remove(this.parent.getMainContent(),"wheel",this.onContentWheel),t.EventHandler.remove(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel),t.EventHandler.remove(this.parent.getScrollElement(),"scroll",this.scrollHandler))},e.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},e.prototype.setPadding=function(){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var e=Qe();if(e>0){var t=this.parent.getColumnHeaderContent(),r=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};t.parentElement.style[r.margin]=e+"px",t.style[r.border]="1px"}},e.prototype.setClientX=function(e){if("mousedown"!==e.type&&"mouse"!==e.pointerType){var r={touchSelectionStarted:!1};if(this.parent.notify(ns,r),!r.touchSelectionStarted){this.clientX=this.getPointX(e);var n=document.getElementById(this.parent.element.id+"_sheet");t.EventHandler.add(n,t.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),t.EventHandler.add(n,t.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}},e.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX},e.prototype.onTouchScroll=function(e){if("mouse"!==e.pointerType){var t=this.getPointX(e),r=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(r>10||r<-10)&&n.scrollLeft+r>=0&&(e.preventDefault(),this.clientX=t,Ke(function(){n.scrollLeft+=r}))}},e.prototype.pointerUpHandler=function(){var e=document.getElementById(this.parent.element.id+"_sheet");t.EventHandler.remove(e,t.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll),t.EventHandler.remove(e,t.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler)},e.prototype.addEventListener=function(){this.parent.on(Li,this.contentLoaded,this),this.parent.on(xo,this.onContentScroll,this),this.parent.on(as,this.updateScroll,this),this.parent.on(bo,this.initProps,this),this.parent.on(Di,this.destroy,this),this.parent.on(Qo,this.setScrollEvent,this),this.parent.on(Ni,this.setClientX,this),this.parent.on(ms,this.updateScrollValue,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on(ji,this.updateNonVirualScrollWidth,this),this.parent.on(Co,this.updateNonVirualScrollWidth,this))},e.prototype.destroy=function(){this.removeEventListener();var e=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(e){var r=t.getComponent(e,n.DropDownButton);r&&r.destroy()}this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(Li,this.contentLoaded),this.parent.off(xo,this.onContentScroll),this.parent.off(as,this.updateScroll),this.parent.off(bo,this.initProps),this.parent.off(Di,this.destroy),this.parent.off(Qo,this.setScrollEvent),this.parent.off(Ni,this.setClientX),this.parent.off(ms,this.updateScrollValue),this.parent.scrollSettings.enableVirtualization||(this.parent.off(ji,this.updateNonVirualScrollWidth),this.parent.off(Co,this.updateNonVirualScrollWidth))},e}(),xl=function(){function e(e){this.scroll=[],this.parent=e,this.addEventListener()}return e.prototype.createVirtualElement=function(e){var r=this.parent.getActiveSheet(),n=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(n.querySelector(".e-table")),n.appendChild(this.content);var i,o=n.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),a=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var s=this.parent.viewport.bottomIndex;r.rowCount>s+1||r.usedRange.rowIndex>s?(!this.parent.scrollSettings.isFinite&&r.rowCount<=r.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(r,"rowCount",r.usedRange.rowIndex+1),this.setScrollCount(r.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"rowCount",s+1),this.scroll[this.parent.activeSheetIndex].rowCount=r.rowCount);var l=this.parent.frozenRowCount(r),h=u(r.topLeftCell);e.top&&(a=e.top,r.frozenRows&&(a+=Ve(r,h[0],l-1,!0)),l=u(r.paneTopLeftCell)[0]),a+=Ve(r,l,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),s=this.parent.viewport.rightIndex;var d=0,p=this.parent.frozenColCount(r);e.left?(d=e.left,p&&(d+=We(r,h[1],p-1,!0)),l=u(r.paneTopLeftCell)[1]):l=p,r.colCount>s+1||r.usedRange.colIndex>s?(!this.parent.scrollSettings.isFinite&&r.colCount<=r.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(r,"colCount",r.usedRange.colIndex+1),d+=We(r,l,s,!0),this.setScrollCount(r.colCount,"col"),i=d+We(r,s+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"colCount",s+1),d+=We(r,l,r.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=r.colCount,i=d),t.isNullOrUndefined(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),t.isNullOrUndefined(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(d=We(r,this.parent.viewport.leftIndex+p,s,!0)),t.isNullOrUndefined(this.translateX)&&(this.translateX=0),t.isNullOrUndefined(this.translateY)&&(this.translateY=0),n=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.rowHeader);var c=n.appendChild(o.cloneNode());this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",n=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.colHeader);var f=n.appendChild(o.cloneNode());this.colHeader.style.width=d+"px",c.style.height=a+"px",f.style.width=i+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)",this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=d+"px",o.style.height=a+"px",o.style.width=i+"px",this.parent.allowScrolling&&this.parent.getScrollElement().appendChild(f.cloneNode(!0))},e.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},e.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetIndex;this.scroll[r][t+"Count"]&&this.scroll[r][t+"Count"]===e||(this.scroll[r][t+"Count"]=e)},e.prototype.getRowAddress=function(e){var t=this.parent.getActiveSheet();return m([e[0],t.frozenColumns?u(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},e.prototype.getColAddress=function(e){var t=this.parent.getActiveSheet();return m([t.frozenRows?u(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},e.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,o=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(i<o){if(n[t+"Count"]===o)return;i=o}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",i)},e.prototype.onVerticalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),o=this.parent.getThreshold("row");if(i>Math.round(o/2)){var a=void 0,s=void 0,l=void 0,h=this.parent.getActiveSheet();if(t<=o&&!e.increase){if(this.translateY&&n>o){this.translateY=0;var d=this.parent.frozenColCount(h),p=this.parent.frozenRowCount(h);if(e.preventScroll)this.parent.viewport.topIndex=n-(o-p);else{var f=d?u(h.topLeftCell)[1]:this.parent.viewport.leftIndex,g=d?[p,this.parent.viewport.leftIndex+d]:[];if(i<this.parent.viewport.rowCount+o){a=re(h,p,!0),s=re(h,this.parent.viewport.topIndex+p-1,!1),this.parent.viewport.topIndex=a-p;var m=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(s-a+1-this.hiddenCount(a,s)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=re(h,m,!1),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:a,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getRowAddress([a,re(h,s,!1)]))}else{var v=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:f,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),d&&(this.parent.viewport.leftIndex=v),this.translate({refresh:"Row"})}Pt(this.parent.element),t=0}}this.updateScrollCount(o,"row")}if(n<o&&(i=Math.abs(t-o)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===re(h,h.rowCount-1,!1)){p=this.parent.frozenRowCount(h);var y=this.parent.viewport.topIndex+p+c(h.paneTopLeftCell)[0]-1;if(t+p>y)return void(e.prev.idx=t);i=y-(t+p)}if(t>o){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-o,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);p=this.parent.frozenRowCount(h);if(e.preventScroll)this.setThresholdHeight(r,o,p),this.translate({refresh:"Row"});else{f=void 0;var C=[];if((d=this.parent.frozenColCount(h))?(f=u(h.topLeftCell)[1],C.push(p),C.push(this.parent.viewport.leftIndex+d)):f=this.parent.viewport.leftIndex,i<this.parent.viewport.rowCount+o)if(e.increase){if(a=this.parent.viewport.bottomIndex+1,s=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),(s-=this.hiddenCount(l+p,this.parent.viewport.topIndex-1+p))<=this.parent.viewport.bottomIndex)return void(this.parent.viewport.topIndex=l);var x=this.parent.skipHidden(a,s,"rows",!1),b=this.checkLastIdx(x[1],"row");a=x[0],s=b.index,this.parent.viewport.topIndex=re(h,this.parent.viewport.topIndex-b.diff+p,!this.parent.scrollSettings.isFinite)-p,this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p,!!b.diff,l===re(h,p,!0)),this.parent.viewport.bottomIndex=s,this.parent.renderModule.refreshUI({colIndex:f,rowIndex:a,direction:"first",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([a,s]))}else{if((a=re(h,this.parent.viewport.topIndex+p,!1))<p&&(a=re(h,a=p,!0)),this.parent.viewport.topIndex=a-p,(s=re(h,l+p-1,!1))<p||s<a)return void(this.parent.viewport.topIndex=l);m=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(s-a+1-this.hiddenCount(a,s)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=re(h,m,!1),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:a,direction:"last",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([a,s]))}else l=this.parent.viewport.leftIndex,this.parent.viewport.topIndex=re(h,this.parent.viewport.topIndex+p,!1)-p,this.parent.viewport.topIndex<0&&(this.parent.viewport.topIndex=re(h,p,!0)-p),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:f,refresh:"Row",frozenIndexes:C,skipTranslate:!0}),d&&(this.parent.viewport.leftIndex=l),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p,this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===re(h,h.rowCount-1,!1)),this.translate({refresh:"Row"});this.updateScrollCount(t,"row",o),this.focusSheet()}}e.prev.idx=t}},e.prototype.skipHiddenLastIdx=function(e,t,r){void 0===r&&(r="rows");for(var n=this.parent.getActiveSheet(),i=0,o=e;o<=t;o++)n[r][o]&&n[r][o].hidden&&i++;return i&&(e=this.skipHiddenLastIdx(e-i,e-1,r)),e},e.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=0,i=this.parent.getActiveSheet(),o=e;o<=t;o++)i[r][o]&&i[r][o].hidden&&n++;return n},e.prototype.checkLastIdx=function(e,t){var r=0;if(this.parent.scrollSettings.isFinite){var n=this.parent.getActiveSheet(),i=n[t+"Count"]-1;e>i&&(r=e-i,e=re(n,i,!1))}return{index:e,diff:r}},e.prototype.onHorizontalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),o=this.parent.getThreshold("col");if(i>Math.round(o/2)){var a=void 0,s=void 0,l=void 0,h=this.parent.getActiveSheet();if(t<=o&&!e.increase){if(this.translateX&&n>o){this.translateX=0;var d=this.parent.frozenColCount(h),p=this.parent.frozenRowCount(h);if(e.preventScroll)this.parent.viewport.leftIndex=n-(o-d);else{var f=p?u(h.topLeftCell)[0]:this.parent.viewport.topIndex,g=p?[this.parent.viewport.topIndex+p,d]:[];if(i<this.parent.viewport.colCount+o){a=re(h,d,!0,"columns"),s=re(h,this.parent.viewport.leftIndex+d-1,!1,"columns"),this.parent.viewport.leftIndex=a-d;var m=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(s-a+1-this.hiddenCount(a,s,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=re(h,m,!1,"columns"),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:a,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getColAddress([a,re(h,s,!1,"columns")]))}else{var v=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:f,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),p&&(this.parent.viewport.topIndex=v),this.translate({refresh:"Column"})}Pt(this.parent.element),t=0}}this.updateScrollCount(o,"col")}if(n<o&&(i=Math.abs(t-o)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===re(h,h.colCount-1,!1,"columns")){d=this.parent.frozenColCount(h);var y=this.parent.viewport.leftIndex+d+c(h.paneTopLeftCell)[1]-1;if(y+=this.hiddenCount(this.parent.viewport.leftIndex+d,y),t+d>y)return void(e.prev.idx=t);i=y-(t+d)}if(t>o){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-o,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);d=this.parent.frozenColCount(h);if(e.preventScroll)this.setThresholdWidth(r,o,d),this.translate({refresh:"Column"});else{f=(p=this.parent.frozenRowCount(h))?u(h.topLeftCell)[0]:this.parent.viewport.topIndex;var C=[];if(p&&(C=[p+this.parent.viewport.topIndex,d]),i<this.parent.viewport.colCount+o)if(e.increase){if(a=this.parent.viewport.rightIndex+1,s=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),(s-=this.hiddenCount(l+d,this.parent.viewport.leftIndex-1+d,"columns"))<=this.parent.viewport.rightIndex)return void(this.parent.viewport.leftIndex=l);var x=this.parent.skipHidden(a,s,"columns",!1),b=this.checkLastIdx(x[1],"col");a=x[0],s=b.index,this.parent.viewport.leftIndex=re(h,this.parent.viewport.leftIndex-b.diff+d,!this.parent.scrollSettings.isFinite,"columns")-d,this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,d,!!b.diff,l===re(h,d,!0,"columns")),this.parent.viewport.rightIndex=s,this.parent.renderModule.refreshUI({rowIndex:f,colIndex:a,direction:"first",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([a,s]))}else{if((a=re(h,this.parent.viewport.leftIndex+d,!1,"columns"))<d&&(a=re(h,a=d,!0,"columns")),this.parent.viewport.leftIndex=a-d,(s=re(h,l+d-1,!1,"columns"))<d||s<a)return void(this.parent.viewport.leftIndex=l);m=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(s-a+1-this.hiddenCount(a,s,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=re(h,m,!1,"columns"),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,d),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:a,direction:"last",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([a,s]))}else l=this.parent.viewport.topIndex,this.parent.viewport.leftIndex=re(h,this.parent.viewport.leftIndex+d,!1,"columns")-d,this.parent.viewport.leftIndex<0&&(this.parent.viewport.leftIndex=re(h,d,!0,"columns")-d),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C,skipTranslate:!0}),p&&(this.parent.viewport.topIndex=l),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,d,this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===re(h,h.colCount-1,!1,"columns")),this.translate({refresh:"Column"});this.updateScrollCount(t,"col",o),this.focusSheet()}}e.prev.idx=t}},e.prototype.focusSheet=function(){document.activeElement.classList.contains("e-text-findNext-short")&&t.closest(document.activeElement,"#"+this.parent.element.id)||Pt(this.parent.element)},e.prototype.setThresholdHeight=function(e,t,r,n,i){var o=this.parent.getActiveSheet(),a=this.parent.viewport.topIndex+r,s=a+t-1;this.translateY=n||i||s<a?a<=r?0:Ve(o,r,a-1,!0):e-Ve(o,a,s,!0)},e.prototype.setThresholdWidth=function(e,t,r,n,i){var o=this.parent.getActiveSheet(),a=this.parent.viewport.leftIndex+r,s=a+t-1;this.translateX=n||i||s<a?a<=r?0:We(o,r,a-1,!0):e-We(o,a,s,!0)},e.prototype.translate=function(e){if(!e.skipTranslate&&this.content){var t=this.translateX||0;t=this.parent.enableRtl?-t:t,"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)"),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+t+"px, 0px)")}},e.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.parent.getActiveSheet(),r=We(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=r+"px",this.content.style.width=r+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var n=this.parent.element.querySelector(".e-scroller .e-virtualtrack");if(!n)return;var i=parseInt(n.style.width,10),o=r+this.translateX+this.parent.viewport.beforeFreezeWidth;if(o>i){var a=o-i;n.style.width=i+a+"px"}else{a=i-o;var s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i-a<parseInt(s.style.width,10)&&(n.style.width=s.style.width)}}}else if(!this.parent.scrollSettings.isFinite){s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];var l=parseInt(s.style.height,10),h=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(h>l){a=h-l;s.style.height=l+a+"px"}else{a=l-h;var d=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];l-a<parseInt(d.style.height,10)&&(s.style.height=d.style.height)}}},e.prototype.updateRowColCount=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var r=this.getVTrackHeight("height"),n=r;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?void 0===e.start?n+=Ve(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n+=Ve(t,e.start,e.end,!0):void 0===e.start?n-=Ve(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0):n-=Ve(t,e.start,e.end,!0),!e.isDelete&&n<r)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,n,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index!==this.scroll[this.parent.activeSheetIndex].colCount-1){var i=this.getVTrackHeight("width"),o=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].colCount?void 0===e.start?o+=We(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0):o+=We(t,e.start,e.end,!0):void 0===e.start?o-=We(t,e.index+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0):o-=We(t,e.start,e.end,!0),!e.isDelete&&o<i)return;this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,o,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},e.prototype.getVTrackHeight=function(e){var t=this.content.nextElementSibling.style[e];if(t.includes("e+")){var r=(t=t.split("px")[0]).split("e+");return Number(r[0])*Math.pow(10,Number(r[1]))}return parseFloat(t)},e.prototype.updateVTrackHeight=function(e){e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height"),(e.rowIdx<this.parent.viewport.topIndex||e.rowIdx>this.parent.viewport.bottomIndex)&&(this.translateY+=e.threshold,this.translate({refresh:"Row"}))},e.prototype.updateVTrackWidth=function(e){var t=this.parent.frozenColCount(this.parent.getActiveSheet());if(e.colIdx>=this.parent.viewport.leftIndex+t&&e.colIdx<=this.parent.viewport.rightIndex){var r=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];r.style.width=parseFloat(r.style.width)+e.threshold+"px";var n=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var i=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";var o=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];o.style.width=parseFloat(o.style.width)+e.threshold+"px"}else e.colIdx>=t&&e.colIdx<this.parent.viewport.leftIndex+t&&(this.parent.scrollModule.offset.left.size+=e.threshold,this.translateX+=e.threshold,this.translate({refresh:"Column"}))},e.prototype.updateVTrack=function(e,t,r){e.nextElementSibling.style[r]=t+"px",this.content.nextElementSibling.style[r]=t+"px","width"===r&&this.parent.allowScrolling&&(this.parent.getScrollElement().firstElementChild.style.width=t+"px")},e.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},e.prototype.updateScrollProps=function(e){var t=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach(function(){t.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})})},e.prototype.sliceScrollProps=function(e){t.isNullOrUndefined(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},e.prototype.updateTranslate=function(e){if(e.height){if(e.isRender)this.translateY-=e.height;else{var t=parseInt(this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0].style.height,10);e.isHide?(this.updateVTrack(this.rowHeader,t-e.height,"height"),this.setThresholdHeight(this.translateY,e.prevSize-1-this.parent.viewport.topIndex+1,this.parent.frozenRowCount(this.parent.getActiveSheet()))):(this.updateVTrack(this.rowHeader,t+e.height,"height"),this.translateY=this.translateY+e.size)}this.translate({refresh:"Row"})}e.width&&(this.translateX-=e.width,this.translate({refresh:"Column"}))},e.prototype.addEventListener=function(){this.parent.on(zi,this.createVirtualElement,this),this.parent.on(qi,this.translate,this),this.parent.on(ji,this.updateColumnWidth,this),this.parent.on(Ba,this.updateColumnWidth,this),this.parent.on(_i,this.onVerticalScroll,this),this.parent.on(Vi,this.onHorizontalScroll,this),this.parent.on(dr,this.updateRowColCount,this),this.parent.on(yo,this.updateVTrackHeight,this),this.parent.on(Co,this.updateVTrackWidth,this),this.parent.on(bo,this.deInitProps,this),this.parent.on(Cr,this.sliceScrollProps,this),this.parent.on(yr,this.updateScrollProps,this),this.parent.on(fs,this.updateTranslate,this),this.parent.on(Di,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},e.prototype.removeEventListener=function(){this.parent.off(zi,this.createVirtualElement),this.parent.off(qi,this.translate),this.parent.off(ji,this.updateColumnWidth),this.parent.off(Ba,this.updateColumnWidth),this.parent.off(_i,this.onVerticalScroll),this.parent.off(Vi,this.onHorizontalScroll),this.parent.off(dr,this.updateRowColCount),this.parent.off(yo,this.updateVTrackHeight),this.parent.off(Co,this.updateVTrackWidth),this.parent.off(Cr,this.sliceScrollProps),this.parent.off(yr,this.updateScrollProps),this.parent.off(fs,this.updateTranslate),this.parent.off(Di,this.destroy)},e}(),bl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Ui,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ui,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){var r=this,n=e.target;if(!(this.parent.isEdit||this.parent.serviceLocator.getService(ch).dialogInstance||n.id===this.parent.element.id+"_name_box"||n.id===this.parent.element.id+"_SearchBox"||n.classList.contains("e-ddl")&&n.classList.contains("e-input-focus")))if(e.altKey&&38===e.keyCode&&this.parent.element.lastElementChild.classList.contains("e-filter-popup"))this.parent.notify(Xo,{closePopup:!0});else if(!e.altKey||40!==e.keyCode||!t.closest(n,".e-dropdown-btn")&&!t.closest(n,".e-split-btn"))if(n.classList.contains("e-sheet-rename"))32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify(wo,e);else if(n.id===this.parent.element.id+"_File"&&Pt(this.parent.element),"None"!==this.parent.selectionSettings.mode){var i,o,a=this.parent.enableRtl,s=this.parent.getActiveSheet(),l=c(s.selectedRange),h=u(s.activeCell),d=this.parent.element.querySelector(".e-main-panel"),p=this.parent.getScrollElement();if([9,37,38,39,40,33,34].indexOf(e.keyCode)>-1&&e.preventDefault(),36===e.keyCode&&((e.ctrlKey||e.metaKey)&&e.shiftKey?(e.preventDefault(),this.parent.selectRange(v(h[1]+1)+(h[0]+1)+":A1"),d.scrollTop&&(d.scrollTop=0),p.scrollLeft&&(p.scrollLeft=0)):h[1]>=0&&(e.ctrlKey?(h[0]=0,h[1]=0):(e.preventDefault(),h[1]=0),i=!0)),(e.ctrlKey||e.metaKey)&&35===e.keyCode&&(e.preventDefault(),h[0]=s.usedRange.rowIndex,h[1]=s.usedRange.colIndex,o=i=!0),e.shiftKey&&32===e.keyCode&&(e.preventDefault(),l[1]=0,this.parent.selectRange(m([l[0],l[1],l[2],l[3]+s.colCount]))),(e.ctrlKey||e.metaKey)&&32===e.keyCode&&(l[0]=0,this.parent.selectRange(m([l[0],l[1],l[2]+s.rowCount,l[3]]))),(e.ctrlKey||e.metaKey)&&e.shiftKey){var f=c(s.selectedRange);if(40===e.keyCode){var g=this.getNextNonEmptyCell(f[2],f[3],"down");f[2]=g[0],f[3]=g[1],this.parent.selectRange(m(f)),this.scrollNavigation(g,null,!0)}else if(39===e.keyCode){g=this.getNextNonEmptyCell(f[2],f[3],"right");f[2]=g[0],f[3]=g[1],this.parent.selectRange(m(f)),this.scrollNavigation(g,null,!0)}else if(38===e.keyCode){g=this.getNextNonEmptyCell(f[2],f[3],"top");f[2]=g[0]-1,f[3]=g[1],-1===f[2]&&(f[2]=0),this.parent.selectRange(m(f)),this.scrollNavigation(g,null,!0)}else if(37===e.keyCode){g=this.getNextNonEmptyCell(f[2],f[3],"left");f[2]=g[0],f[3]=g[1]-1,-1===f[3]&&(f[3]=0),this.parent.selectRange(m(f)),this.scrollNavigation(g,null,!0)}}if(!e.ctrlKey&&!e.metaKey||e.shiftKey||(37===e.keyCode?(h[1]=this.getNextNonEmptyCell(h[0],h[1],"left")[1],i=o=!0):38===e.keyCode?(h[0]=this.getNextNonEmptyCell(h[0],h[1],"top")[0],i=o=!0):39===e.keyCode?(h[1]=this.getNextNonEmptyCell(h[0],h[1],"right")[1],i=o=!0):40===e.keyCode&&(h[0]=this.getNextNonEmptyCell(h[0],h[1],"down")[0],i=o=!0)),e.shiftKey&&(34===e.keyCode||33===e.keyCode)){var y=0;if(34===e.keyCode)y=d.getBoundingClientRect().height+d.scrollTop;else if((y=d.scrollTop-d.getBoundingClientRect().height)<0)return;var C=c(this.parent.getActiveSheet().selectedRange)[2],x=u(this.parent.getActiveSheet().paneTopLeftCell)[0],b=C-x;this.parent.scrollModule&&(this.parent.scrollModule.isKeyScroll=!1),d.scrollTop=y,Ke(function(){x=u(r.parent.getActiveSheet().paneTopLeftCell)[0],r.parent.selectRange(m([h[0],h[1],x+b,h[1]]))})}var S={e:e,isFilterCell:!1};if(e.shiftKey&&!e.ctrlKey?this.shiftSelection(e):e.altKey&&40===e.keyCode&&this.parent.notify(Xo,S),!e.shiftKey&&(!a&&37===e.keyCode||a&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(h[1]>0){if(s.isProtected&&!s.protectSettings.selectUnLockedCells||!s.isProtected)h[1]-=1;else{var w=this.getNextUnlockedCell(e.keyCode,h);h[1]=w[1],h[0]=w[0]}i=!0}else{var I=this.parent.getMainContent();0===h[1]&&I.scrollLeft&&!a&&(I.scrollLeft=0)}else if(e.shiftKey&&13===e.keyCode){if(!this.parent.element.querySelector(".e-find-toolbar"))if(h[0]>0){if(s.isProtected&&!s.protectSettings.selectUnLockedCells||!s.isProtected)h[0]-=1;else{w=this.getNextUnlockedCell(e.keyCode,h);h[1]=w[1],h[0]=w[0]}i=!0}else{I=this.parent.getMainContent().parentElement;0===h[0]&&I.scrollTop&&(I.scrollTop=0)}}else if(S.isFilterCell||e.shiftKey||38!==e.keyCode)if(!e.shiftKey&&!e.ctrlKey&&(!a&&39===e.keyCode||a&&37===e.keyCode)||9===e.keyCode){if((k=ke(h[0],h[1],s))&&k.colSpan>1&&(h[1]+=k.colSpan-1),h[1]<s.colCount-1){if(s.isProtected&&!s.protectSettings.selectUnLockedCells||!s.isProtected)h[1]+=1;else{w=this.getNextUnlockedCell(e.keyCode,h);h[1]=w[1],h[0]=w[0]}i=!0}}else if((S.isFilterCell||e.shiftKey||e.ctrlKey||40!==e.keyCode)&&13!==e.keyCode){if(!e.shiftKey&&(34===e.keyCode||33===e.keyCode)&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)){var E=this.parent.element.querySelector(".e-main-panel");y=0;if(34===e.keyCode)y=E.getBoundingClientRect().height+E.scrollTop;else if((y=E.scrollTop-E.getBoundingClientRect().height)<0)return;C=u(this.parent.getActiveSheet().activeCell)[0];var R=u(this.parent.getActiveSheet().paneTopLeftCell)[0],A=C-R;this.parent.scrollModule&&(this.parent.scrollModule.isKeyScroll=!1),E.scrollTop=y,Ke(function(){R=u(r.parent.getActiveSheet().paneTopLeftCell)[0],r.parent.notify(Wi,{range:[R+A,h[1]],preventAnimation:!0})})}}else{var k;if((k=ke(h[0],h[1],s))&&k.rowSpan>1&&(h[0]+=k.rowSpan-1),h[0]<s.rowCount-1){if(s.isProtected&&!s.protectSettings.selectUnLockedCells||!s.isProtected)h[0]+=1;else{w=this.getNextUnlockedCell(e.keyCode,h);h[1]=w[1],h[0]=w[0]}i=!0}}else if(h[0]>0){if(s.isProtected&&!s.protectSettings.selectUnLockedCells||!s.isProtected)h[0]-=1;else{var F=this.getNextUnlockedCell(e.keyCode,h);h[1]=F[1],h[0]=F[0]}i=!0}else{var T=this.parent.getMainContent().parentElement;0===h[0]&&T.scrollTop&&(T.scrollTop=0)}if(i&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)&&!t.closest(document.activeElement,".e-ribbon")){if(40===e.keyCode||38===e.keyCode||13===e.keyCode)for(;He(s,h[0]);)if((40===e.keyCode||!e.shiftKey&&13===e.keyCode)&&(h[0]=h[0]+1),(38===e.keyCode||e.shiftKey&&13===e.keyCode)&&(h[0]=h[0]-1,h[0]<0))return;if(37===e.keyCode||39===e.keyCode||9===e.keyCode)for(;Ge(s,h[1]);)if((39===e.keyCode||!e.shiftKey&&9===e.keyCode)&&(h[1]=h[1]+1),(37===e.keyCode||e.shiftKey&&9===e.keyCode)&&(h[1]=h[1]-1,h[1]<0))return;this.scrollNavigation(h,!1,o);var L=m(h),N=function(e){if(L!==s.selectedRange){r.parent.setSheetPropertyOnMute(s,"activeCell",L),r.parent.notify(Wi,{range:h,preventAnimation:e});var t=r.parent.getCell(h[0],h[1]);t&&Pt(t)}};if(this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){if(L===s.selectedRange)return;Ke(N.bind(this,!0))}else N()}}},e.prototype.getNextNonEmptyCell=function(e,r,n){var i,o=[e,r],a=this.parent.getActiveSheet();if("down"===n){i=!t.isUndefined(ke(e,r,a,null,!0).value)&&!t.isUndefined(ke(e+1,r,a,null,!0).value);for(var s=e;s<a.rowCount;s++){if(i){if(t.isUndefined(ke(s,r,a,null,!0).value))return[s-1,r]}else if(!t.isUndefined(ke(s+1,r,a,null,!0).value))return[s+1,r];if(s===a.rowCount-1)return[s,r]}}if("top"===n){i=!t.isUndefined(ke(e,r,a,null,!0).value)&&!t.isUndefined(ke(e-1,r,a,null,!0).value);for(s=e;s>=0;s--){if(i){if(t.isUndefined(ke(s,r,a,null,!0).value))return[s-1,r]}else if(!t.isUndefined(ke(s-1,r,a,null,!0).value))return[s,r];if(0===s)return[s,r]}}if("right"===n){i=!t.isUndefined(ke(e,r,a,null,!0).value)&&!t.isUndefined(ke(e,r+1,a,null,!0).value);for(s=r;s<a.colCount;s++){if(i){if(t.isUndefined(ke(e,s,a,null,!0).value))return[e,s-1]}else if(!t.isUndefined(ke(e,s+1,a,null,!0).value))return[e,s+1];if(s===a.colCount-1)return[e,s]}}if("left"===n){i=!t.isUndefined(ke(e,r,a,null,!0).value)&&!t.isUndefined(ke(e,r-1,a,null,!0).value);for(s=r;s>=0;s--){if(i){if(t.isUndefined(ke(e,s,a,null,!0).value))return[e,s-1]}else if(!t.isUndefined(ke(e,s-1,a,null,!0).value))return[e,s];if(0===s)return[e,s]}}return o},e.prototype.getNextUnlockedCell=function(e,t){var r,n=this.parent.getActiveSheet();if(39===e){var i=t[1]+1,o=t[0];t[1]===n.usedRange.colIndex&&(i=0,o+=1,t[0]===n.usedRange.rowIndex&&(o=0)),t[1]===n.usedRange.colIndex&&t[0]===n.usedRange.rowIndex&&(o=i=0);for(var a=o;a<=n.usedRange.rowIndex+1;a++){a>n.usedRange.rowIndex&&(a=0);for(var s=i;s<=n.usedRange.colIndex;s++){if(!Ht(this.parent,[a,s,a,s]))return r=[a,s];i=s}o=a,i===n.usedRange.colIndex&&(i=0,o===n.usedRange.rowIndex?o=0:o++)}}if(37===e){i=t[1]-1,o=t[0];0===t[1]&&(i=n.usedRange.colIndex,o-=1,0===t[0]&&(o=n.usedRange.rowIndex));for(a=o;a>=-1;a--){a<0&&(a=n.usedRange.rowIndex);for(s=i;s>=0;s--){if(!Ht(this.parent,[a,s,a,s]))return r=[a,s];i=s}o=a,0===i&&(i=n.usedRange.colIndex,0===o?o=n.usedRange.rowIndex:o--)}}if(40===e){i=t[1],o=t[0]+1;t[0]===n.usedRange.rowIndex&&(i+=1,o=0,t[1]===n.usedRange.colIndex&&(o=0)),t[1]===n.usedRange.colIndex&&t[0]===n.usedRange.rowIndex&&(o=i=0);for(a=i;a<=n.usedRange.colIndex+1;a++){a>n.usedRange.colIndex&&(a=0);for(s=o;s<=n.usedRange.rowIndex;s++){if(!Ht(this.parent,[s,a,s,a]))return r=[s,a];o=s}i=a,o===n.usedRange.rowIndex&&(i++,o=(n.usedRange.colIndex,0))}}if(38===e){i=t[1],o=t[0]-1;0===t[0]&&(i-=1,o=n.usedRange.rowIndex,0===t[1]&&(i=n.usedRange.colIndex));for(a=i;a>=-1;a--){a<0&&(a=n.usedRange.colIndex);for(s=o;s>=0;s--){if(!Ht(this.parent,[s,a,s,a]))return r=[s,a];o=s}i=a,0===o&&(o=n.usedRange.rowIndex,0===i?i=n.usedRange.colIndex:i--)}}return r},e.prototype.shiftSelection=function(e){var r=this.parent.getActiveSheet(),n=c(r.selectedRange),i=w(n),o=!0;if(38===e.keyCode){for(var a=i[1];a<=i[3];a++){var s=ke(n[2],a,this.parent.getActiveSheet());if(!t.isNullOrUndefined(s)&&s.rowSpan&&s.rowSpan<0){n[2]=n[2]-(Math.abs(s.rowSpan)+1),o=!1;break}}o&&(n[2]=n[2]-1),n[2]<0&&(n[2]=0)}if(40===e.keyCode){for(a=i[1];a<=i[3];a++){s=ke(n[2],a,this.parent.getActiveSheet());if(!t.isNullOrUndefined(s)&&s.rowSpan&&s.rowSpan>0){n[2]=n[2]+Math.abs(s.rowSpan),o=!1;break}}o&&(n[2]=n[2]+1),r.rowCount<=n[2]&&(n[2]=r.rowCount-1)}if(39===e.keyCode){for(a=i[0];a<=i[2];a++){s=ke(a,n[3],this.parent.getActiveSheet());if(!t.isNullOrUndefined(s)&&s.colSpan&&s.colSpan>0){n[3]=n[3]+Math.abs(s.colSpan),o=!1;break}}o&&(n[3]=n[3]+1),r.colCount<=n[3]&&(n[3]=r.colCount-1)}if(37===e.keyCode){for(a=i[0];a<=i[2];a++){s=ke(a,n[3],this.parent.getActiveSheet());if(!t.isNullOrUndefined(s)&&s.colSpan&&s.colSpan<0){n[3]=n[3]-(Math.abs(s.colSpan)+1),o=!1;break}}o&&(n[3]=n[3]-1),n[3]<0&&(n[3]=0)}if(e.shiftKey&&e.ctrlKey&&!this.parent.scrollSettings.enableVirtualization){var l=[r.usedRange.rowIndex,r.usedRange.colIndex];37===e.keyCode&&(n[3]<=l[1]?n[3]=0:n[3]=l[1]),38===e.keyCode&&(n[2]<=l[0]?n[2]=0:n[2]=l[0]),39===e.keyCode&&(n[3]<=l[1]?n[3]=l[1]:n[3]=this.parent.getActiveSheet().colCount),40===e.keyCode&&(n[2]<=l[0]?n[2]=l[0]:n[2]=this.parent.getActiveSheet().rowCount)}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){for(var h=u(r.activeCell);He(this.parent.getActiveSheet(),n[2]);)40===e.keyCode&&(n[2]=n[2]+1),38===e.keyCode&&(n[2]=n[2]-1);this.parent.selectRange(m(n)),this.scrollNavigation([K(r,n)?h[0]:n[2],X(r,n)?h[1]:n[3]],!1)}},e.prototype.scrollNavigation=function(e,t,r){if(this.parent.allowScrolling){var n=this.parent.enableRtl?-1:1,i=this.parent.getMainContent().parentElement,o=this.parent.getScrollElement(),a=this.parent.getActiveSheet(),s=w(c(a.selectedRange)),l=u(a.topLeftCell),h=this.parent.frozenRowCount(a),d=this.parent.frozenColCount(a),p=u(a.paneTopLeftCell),f=re(a,e[0]<h?l[0]:p[0],!0),g=e[1]<d?l[1]:p[1],m=this.parent.scrollModule.offset.top.size;if(i.scrollTop)if(h&&e[0]!==s[2]){if(e[0]===h)return void(i.scrollTop=0);e[0]===h-1&&(i.scrollTop=0)}else if(e[0]===re(a,0,!0))return void(i.scrollTop=0);if(o&&o.scrollLeft)if(d&&e[1]!==s[3]){if(e[1]===d)return void(o.scrollLeft=0);e[1]===d-1&&(o.scrollLeft=0)}else if(e[1]===re(a,0,!0,"columns"))return void(o.scrollLeft=0);this.getBottomIdx(f)<=e[0]||t?i.scrollTop=r?m+Ve(a,p[0],e[0],!0)-i.getBoundingClientRect().height:m+Ue(a,re(a,p[0],!0),!0):f>e[0]&&(r?i.scrollTop=m-Math.ceil(Ve(a,p[0],e[0],!0)+i.getBoundingClientRect().height):(i.scrollTop=m-Math.ceil(Ue(a,e[0],!0)),this.parent.scrollModule.isKeyScroll=!1));var v=this.getRightIdx(g);(v<=e[1]||t)&&o?o.scrollLeft+=r?We(a,p[1],e[1],!0)+o.getBoundingClientRect().width:je(a,v,null,!0)*n:g>e[1]&&o&&(r?o.scrollLeft-=We(a,p[1],e[1],!0)+o.getBoundingClientRect().width:(o.scrollLeft-=je(a,e[1],null,!0)*n,this.parent.scrollModule.isKeyScroll=!1))}},e.prototype.getBottomIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=(r.frozenRows?this.parent.viewport.height-this.parent.sheetModule.getColHeaderHeight(r,!0):this.parent.viewport.height)-17||20,i=e;;i++)if((t+=Ue(r,i,!0))>=n)return i},e.prototype.getRightIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=this.parent.getMainContent().parentElement.offsetWidth-this.parent.sheetModule.getRowHeaderWidth(r)-this.parent.sheetModule.getScrollSize(),i=e;;i++)if((t+=je(r,i,null,!0))>=n)return i},e.prototype.getModuleName=function(){return"keyboardNavigation"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Sl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Ui,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ui,this.keyDownHandler)},e.prototype.isTrgtNotInput=function(e){var r=e.target;return!(t.closest(r,".e-filter-popup")||t.closest(r,".e-find-dlg")||t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-sheet-tab")||t.closest(r,".e-name-box")||t.closest(r,".e-link-dialog"))},e.prototype.ribbonShortCuts=function(e){if(e.altKey&&!e.ctrlKey&&!e.shiftKey){var r=this.parent.ribbonModule.ribbon.tabObj;if(72==e.keyCode)e.preventDefault(),r.select(1);else if(78===e.keyCode)r.select(2);else if(65===e.keyCode)r.select(4);else if(87===e.keyCode)r.select(5);else if(77===e.keyCode)r.select(3);else if(70===e.keyCode)e.preventDefault(),t.select("#"+this.parent.element.id+"_File",this.parent.element).click();else if(18===e.keyCode){e.preventDefault();var n=u(this.parent.getActiveSheet().activeCell),i={sheetIdx:this.parent.activeSheetIndex};if(this.parent.notify(Ko,i),!(i.hasFilter&&i.filterRange&&i.filterRange[0]===n[0]&&i.filterRange[1]<=n[1]&&i.filterRange[3]>=n[1]||t.closest(document.activeElement,".e-dropdown-btn")||t.closest(document.activeElement,".e-split-btn")||t.closest(document.activeElement,".e-popup-open")))for(var o=0;o<=this.parent.ribbonModule.ribbon.items.length;o++)if(o===this.parent.ribbonModule.ribbon.selectedTab){var a=this.parent.element.querySelector(".e-toolbar-items").children[o+2].children[0];return a.setAttribute("tabindex","0"),void a.focus()}}}if((9===e.keyCode||e.shiftKey&&9===e.keyCode)&&t.closest(document.activeElement,".e-ribbon")||t.closest(document.activeElement,".e-chart")){var s=void 0,l=this.parent.ribbonModule.ribbon.selectedTab,h=this.parent.ribbonModule.ribbon.items,d=e.shiftKey?h[l].content.slice().reverse():h[l].content,p=void 0;if(t.closest(document.activeElement,".e-tab-header"))p=0;else{var c=t.closest(document.activeElement,".e-toolbar-item");if(c){var f=[].slice.call(c.parentElement.children);p=(e.shiftKey?f.reverse().indexOf(c):f.indexOf(c))+1}}for(o=p;o<=d.length;o++)if(o!==d.length){if((s=5===l&&""===d[o].id?d[o].type.toLowerCase():d[o].id).indexOf("separator")<0){s.includes("find")?s=s.replace("find","findbtn"):5!==l&&s.includes("chart")&&(s=s.replace("chart","chart-btn")),5===l&&(s.includes("chart_type")?s=s.replace("chart_type","chart-type-btn"):s.includes("add_chart_ element_chart")&&(s=s.replace("add_chart_ element_chart","_addchart")));var g=this.parent.element.querySelector("#"+s);if(!d[o].disabled)return g.classList.contains("e-colorpicker-wrapper")&&(g=g.querySelector(".e-split-btn")),void g.focus()}}else o=-1}},e.prototype.keyDownHandler=function(e){var r="None"===this.parent.selectionSettings.mode;if(this.ribbonShortCuts(e),(e.ctrlKey||e.metaKey)&&this.isTrgtNotInput(e)){if(t.closest(e.target,".e-find-dlg")||r||([79,83].indexOf(e.keyCode)>-1?e.preventDefault():65!==e.keyCode||this.parent.isEdit||e.preventDefault()),79===e.keyCode)t.select("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.notify(er,null);else if(67!==e.keyCode||r)if(75!==e.keyCode||r)90!==e.keyCode||r?89!==e.keyCode||r?82!==e.keyCode&&68!==e.keyCode||r||(e.preventDefault(),this.parent.notify(ps,{verticalFill:68===e.keyCode})):this.parent.isEdit||(e.preventDefault(),this.parent.notify(Po,{isUndo:!1})):this.parent.isEdit||(e.preventDefault(),this.parent.notify(Po,{isUndo:!0}));else{var n=u(this.parent.getActiveSheet().activeCell),i=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[n[0]],o=void 0;e.preventDefault(),t.isNullOrUndefined(i)||(o=i.cells[n[1]]),t.isNullOrUndefined(o)&&Fe(n[0],n[1],this.parent.getActiveSheet(),o,!1),o&&o.hyperlink?this.parent.notify(To,null):this.parent.notify(Fo,null)}else this.parent.notify(ro,{promise:Promise});var a=this.parent.sheets[this.parent.getActiveSheet().id-1],s=void 0;if(a){var l=u(a.activeCell),h=ke(l[0],l[1],a);s=a.isProtected&&ee(h,ze(a,l[1]))}if(70!==e.keyCode||r||(e.preventDefault(),this.parent.notify(Jt,null)),!(s&&a.isProtected&&86!==e.keyCode||70===e.keyCode||r)){if(71===e.keyCode)e.preventDefault(),this.parent.notify(ia,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(oa,null);else if(88===e.keyCode)this.parent.notify(to,{promise:Promise});else if(86===e.keyCode)this.parent.notify(no,{isAction:!0});else if(66===e.keyCode){e.preventDefault();d="bold"===(d=this.parent.getCellStyleValue(["fontWeight"],u(this.parent.getActiveSheet().activeCell)).fontWeight)?"normal":"bold",this.parent.notify(ar,{style:{fontWeight:d},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){e.preventDefault();var d;d="italic"===(d=this.parent.getCellStyleValue(["fontStyle"],u(this.parent.getActiveSheet().activeCell)).fontStyle)?"normal":"italic",this.parent.notify(ar,{style:{fontStyle:d},onActionUpdate:!0,refreshRibbon:!0})}else e.ctrlKey&&85===e.keyCode&&!e.shiftKey?(e.preventDefault(),this.parent.notify(lr,{style:{textDecoration:"underline"},refreshRibbon:!0})):e.ctrlKey&&53===e.keyCode&&!e.shiftKey&&(e.preventDefault(),this.parent.notify(lr,{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify(Vo,{})))}}if(27===e.keyCode&&this.parent.notify(io,null),(e.ctrlKey||e.metaKey)&&119===e.keyCode&&(e.preventDefault(),this.parent.ribbonModule.ribbon.ribbonExpandCollapse()),(e.ctrlKey||e.metaKey)&&!r){n=c(this.parent.getActiveSheet().selectedRange);if(57===e.keyCode)e.preventDefault(),this.parent.notify(gn,{startIndex:n[0],endIndex:n[2],hide:!e.shiftKey,isCol:!1,actionUpdate:!0});else if(48===e.keyCode)this.parent.notify(gn,{startIndex:n[1],endIndex:n[3],hide:!e.shiftKey,isCol:!0,actionUpdate:!0});else if(55===e.keyCode){e.preventDefault();this.parent.notify(ar,{style:{border:"1px solid #000000"},onActionUpdate:!0,borderType:"Outer"})}}if(e.shiftKey&&114===e.keyCode&&!r&&(e.preventDefault(),this.parent.notify(Cs,null)),(e.ctrlKey||e.metaKey)&&e.altKey&&78===e.keyCode&&!r&&(e.preventDefault(),this.parent.refresh(!0)),(e.ctrlKey||e.metaKey)&&e.shiftKey&&!r){var p=this.parent.getActiveSheet().selectedRange,f=void 0;192===e.keyCode?f=P("General"):52===e.keyCode?f="$#,##0.00;[Red]($#,##0.00)":53===e.keyCode?f="0%":54===e.keyCode?f=P("Scientific"):51===e.keyCode?f="dd-mmm-yy":50===e.keyCode?f="h:mm AM/PM":49===e.keyCode?f="#,###.00":85===e.keyCode?(e.preventDefault(),this.parent.notify(xs,null)):55===e.keyCode&&(e.preventDefault(),this.parent.notify(ar,{style:{border:""},onActionUpdate:!0})),f&&this.parent.notify(nr,{format:f,range:p})}e.shiftKey&&122==e.keyCode&&this.parent.notify(Vr,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),e.shiftKey&&e.altKey&&75===e.keyCode&&this.parent.element.querySelector(".e-sheets-list").click()},e.prototype.getModuleName=function(){return"keyboardShortcut"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),wl=function(){function e(e){this.checkHeight=!1,this.parent=e,this.addEventListener()}return e.prototype.applyCellFormat=function(e){if(e.checkHeight)return this.checkHeight||(this.checkHeight=!0),void this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,e.outsideViewport);var t=Object.keys(e.style),r=this.parent.getActiveSheet();if(!(e.lastCell&&Mt(r,e.rowIdx)<=20)||t.length){var n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(this.updateMergeBorder(e,r),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var i={};Object.keys(e.style).forEach(function(t){i[t]=e.style[t]}),void 0!==i.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,r),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r),delete i.border),void 0!==i.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r),delete i.borderTop),void 0!==i.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,r),delete i.borderLeft),Object.keys(i).length&&(void 0!==i.borderBottom&&this.setThickBorderHeight(i.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,i))}else{void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style);var o=ke(e.rowIdx,e.colIdx,r);if(o&&(o.rowSpan||o.colSpan)&&n.offsetHeight>0){(l=At(this.parent,o.style||this.parent.cellStyle))>n.offsetHeight&&Rt(this.parent,r,n.offsetHeight,e.rowIdx)}}var a=ke(e.rowIdx,e.colIdx,r,null,!0);if(r.rows[e.rowIdx]&&r.rows[e.rowIdx].customHeight){if(!a.wrap&&e.style.fontSize){var s=Ue(r,e.rowIdx,!0)-Lt(e.rowIdx,e.colIdx,r);s<At(this.parent,a.style)?n.style.lineHeight=s+"px":n.style.lineHeight&&(n.style.lineHeight="")}}else if(e.isHeightCheckNeeded)if(e.manualUpdate)this.checkHeight||(this.checkHeight=ne(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate),a.wrap&&(e.style.fontSize||e.style.fontFamily)&&(n.style.lineHeight=parseFloat(a.style&&a.style.fontSize||this.parent.cellStyle.fontSize)*kt(a.style&&a.style.fontFamily?a.style:this.parent.cellStyle)+"pt");else if(!a.wrap&&ne(e.style)&&Ot(r,e.rowIdx,e.colIdx,Dt(this.parent,e.rowIdx,e.colIdx,r,e.style)),e.lastCell){var l;(l=Mt(r,e.rowIdx))>20&&l>Ue(r,e.rowIdx)&&Rt(this.parent,r,l,e.rowIdx,e.row,e.hRow,this.parent.scrollSettings.isFinite)}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}},e.prototype.updateRowHeight=function(e,t,r,n,i){if(this.checkHeight){var o=this.parent.getActiveSheet(),a=ke(e,t,o,null,!0);if(!a.rowSpan){var s=0;s=Dt(this.parent,e,t,o,a.style||this.parent.cellStyle,a.wrap?Tt(this.parent.getDisplayText(a),Nt(o,e,t),a.style,this.parent.cellStyle):1);var l=a.value&&a.value.toString();if(l&&l.indexOf("\n")>-1){var h=void 0,d=l.split("\n"),p=0,c=d.length;for(h=0;h<c;h++){var u=Tt(d[h],Nt(o,e,t),a.style,this.parent.cellStyle);0===u&&(u=1),p+=u}s=Dt(this.parent,e,t,o,a.style||this.parent.cellStyle,p)}if(s<20&&(s=20),Ot(o,e,t,s),!i){var f=this.parent.getCell(e,t);f&&f.children[0]&&"e-cf-databar"===f.children[0].className&&(f.children[0].style.height="100%",f.children[0].firstElementChild.nextElementSibling.style.height="100%")}if(r){this.checkHeight=!1;var g=Mt(o,e),m=Ue(o,e);(n?g!==m:g>m)&&(i?(m=yt(m),_e(o,e,g),this.parent.setProperties({sheets:this.parent.sheets},!0),this.parent.notify(yo,{rowIdx:e,threshold:yt(g)-m})):Rt(this.parent,o,g,e,null,null,!0))}}}},e.prototype.updateMergeBorder=function(e,t){var r=ke(e.rowIdx,e.colIdx,t,null,!0),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(cn,n),r.rowSpan>1&&!e.style.borderBottom){var i=ke(n.range[2],n.range[1],t,null,!0);i.style&&i.style.borderBottom&&(e.style.borderBottom=i.style.borderBottom)}if(r.colSpan>1&&!e.style.borderRight){var o=ke(n.range[0],n.range[3],t,null,!0);o.style&&o.style.borderRight&&(e.style.borderRight=o.style.borderRight)}},e.prototype.setLeftBorder=function(e,t,r,n,i,o,a,s){if(!a||!a.includes("Column")){var l=this.parent.getCell(r,n-1,i);if(l){var h=ke(r,n-1,s,!1,!0);if(h.rowSpan&&1!==h.rowSpan||h.colSpan&&1!==h.colSpan){var d={range:[r,n-1,r,n-1]};if(this.parent.notify(cn,d),(h=ke(d.range[0],d.range[1],s,!1,!0)).style&&h.style.borderRight&&"none"!==h.style.borderRight)return;if((h=ke(d.range[0],d.range[3],s,null,!0)).style&&h.style.borderRight&&"none"!==h.style.borderRight)return;t.style.borderLeft=e}else o&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}},e.prototype.setTopBorder=function(e,t,r,n,i,o,a,s,l,h,d){if(!s||!s.includes("Row")){var p=this.parent.getCell(r-1,n,i);if(p){var c=ke(r-1,n,d,!1,!0);if(c.rowSpan&&1!==c.rowSpan||c.colSpan&&1!==c.colSpan){var u={range:[r-1,n,r-1,n]};if(this.parent.notify(cn,u),(c=ke(u.range[0],u.range[1],d,!1,!0)).style&&c.style.borderBottom&&"none"!==c.style.borderBottom)return;if((c=ke(u.range[2],u.range[1],d,null,!0)).style&&c.style.borderBottom&&"none"!==c.style.borderBottom)return;t.style.borderTop=e}else{if(He(d,r-1)){var f=[Number(p.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],f).bottomPriority)return}a&&""!==e&&d.topLeftCell.includes(""+(r+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,r-1,n,p,i,o,a,l,h),p.style.borderBottom="none"===e?p.style.borderBottom:e}}else t.style.borderTop=e}},e.prototype.setThickBorderHeight=function(e,t,r,n,i,o,a,s,l){var h=e?this.getBorderSize(e):1,d=this.parent.getActiveSheet();if(h>2&&(!d.rows[t]||!d.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,a);else{var p=Ue(d,t),c=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,r]),1,3));c>p&&(Rt(this.parent,d,c,t,i,o,!1),this.parent.notify(yo,{rowIdx:t,threshold:c-20}))}!a||!s&&this.checkHeight||!(h<3)||d.rows[t]&&d.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,a))},e.prototype.getBorderSize=function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)?parseInt(t,10):1},e.prototype.clearObj=function(e){var r,n,i,o=this,a=e.options,s=a.range?a.range.indexOf("!")>0?a.range.split("!")[1]:a.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,l=a.range&&a.range.indexOf("!")>0?fe(this.parent,a.range.split("!")[0]):this.parent.activeSheetIndex,h=w(c(s)),d=this.parent.sheets[l],p=h[0],u=h[2],f=this.parent.element.getElementsByClassName("e-ss-overlay-active"),g=f.length>0,v={range:s,type:a.type,requestType:"clear",sheetIndex:l},y=function(){e.isAction&&o.parent.notify(Zt,{action:"beforeClear",eventArgs:v})},C=function(){e.isAction&&(v={range:d.name+"!"+s,type:a.type,sheetIndex:l},i&&(v.cfClearActionArgs=i.cfClearActionArgs),o.parent.notify(Yo,{eventArgs:v,action:"clear"}))};if(g)f[0].classList.contains("e-datavisualization-chart")?"Clear Contents"!==a.type&&"Clear All"!==a.type||(y(),this.parent.notify(Ma,{id:f[0].id,sheetIdx:this.parent.activeSheetIndex+1}),C()):"Clear All"===a.type&&(y(),this.parent.notify(Oa,{id:f[0].id,sheetIdx:this.parent.activeSheetIndex+1}),C());else{if(y(),"Clear Formats"===a.type||"Clear All"===a.type)for(i={range:s,sheetIdx:l,isClear:!0},this.parent.notify(yn,i),e.cfClearActionArgs=i.cfClearActionArgs,"Clear All"===a.type&&(this.parent.notify(jr,{range:s,isRemoveValidation:!0}),0===p&&0===h[1]&&u>=d.usedRange.rowIndex&&h[3]>=d.usedRange.colIndex&&this.parent.setUsedRange(p,h[1],d,!1,!0));p<=u;p++)for(r=h[1],n=h[3];r<=n;r++){var x=ke(p,r,d),b=this.parent.getCell(p,r);x&&(x.formula&&this.parent.notify(Er,{cellRef:m([p,r,p,r])}),x.wrap&&this.parent.notify(Hr,{range:[p,r,p,r],wrap:!1,sheet:d}),x.hyperlink&&(b&&t.removeClass(b.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===a.type&&this.parent.removeHyperlink(d.name+"!"+m([p,r,p,r]))))}"Clear Hyperlinks"===a.type&&this.parent.removeHyperlink(d.name+"!"+s),this.parent.notify(Cn,{range:d.name+"!"+s,type:a.type}),this.parent.serviceLocator.getService("cell").refreshRange(c(s)),this.parent.notify(Cn,{range:d.name+"!"+s,type:a.type}),this.parent.serviceLocator.getService("cell").refreshRange(w(c(s))),this.parent.notify(Wr,{range:s,isclearFormat:!0}),e.isFromUpdateAction||this.parent.notify(eo,{address:s}),this.parent.notify(gr,null),C()}},e.prototype.addEventListener=function(){this.parent.on(hr,this.applyCellFormat,this),this.parent.on(xa,this.clearObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(hr,this.applyCellFormat),this.parent.off(xa,this.clearObj))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.checkHeight=null},e.prototype.getModuleName=function(){return"cellformat"},e}(),Il=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Li,this.wireEvents,this),this.parent.on(Ao,this.autoFit,this),this.parent.on($o,this.setAutoFitHandler,this)},e.prototype.autoFit=function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],r=e.startIndex;r<=e.endIndex;r++)this.trgtEle=e.isRow?this.parent.getRow(r,t):this.parent.getCell(null,r,t),this.setAutofit(r,!e.isRow)},e.prototype.wireEvents=function(){var e=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];r&&(t.EventHandler.add(r,"dblclick",this.dblClickHandler,this),t.EventHandler.add(e,"dblclick",this.dblClickHandler,this),t.EventHandler.add(r,"mousedown",this.mouseDownHandler,this),t.EventHandler.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,r))},e.prototype.wireResizeCursorEvent=function(e,r){t.EventHandler.add(e,"mousemove",this.setTarget,this),t.EventHandler.add(r,"mousemove",this.setTarget,this)},e.prototype.unWireResizeCursorEvent=function(){t.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget);var e=this.parent.element.getElementsByClassName("e-header-panel")[0];e&&t.EventHandler.remove(e,"mousemove",this.setTarget)},e.prototype.unwireEvents=function(){t.EventHandler.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),t.EventHandler.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),t.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),t.EventHandler.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Li,this.wireEvents),this.parent.off(Ao,this.autoFit),this.parent.off($o,this.setAutoFitHandler))},e.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],r=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeTooltip(null,!0,e),(t||r)&&(this.isMouseMoved=!0,t?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):r&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(r.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px"))},e.prototype.mouseDownHandler=function(e){if(t.closest(e.target,".e-header-cell")){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var r=this.trgtEle.offsetHeight,n=e.offsetY;(r>=10&&n<5||r-2<8&&n<Math.ceil((n-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var i=this.trgtEle,o=i.classList.contains("e-colresize")?"e-colresize-handler":i.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(i,o),this.unWireResizeCursorEvent(),t.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),t.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)}},e.prototype.mouseUpHandler=function(e){var r=this.parent.element.getElementsByClassName("e-resize-handle")[0];this.resizeOn(e),this.isMouseMoved=null;var n=document.querySelector(".e-header-tooltip");r&&(t.detach(r),this.updateCursor()),n&&n.remove(),t.EventHandler.remove(document,"mouseup",this.mouseUpHandler),t.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler);var i=this.parent.element.getElementsByClassName("e-header-panel")[0];i&&this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),i),this.parent.notify(ss,null),this.parent.notify(ls,null)},e.prototype.dblClickHandler=function(e){if(t.closest(e.target,".e-header-cell")){if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){var r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,n=je(this.parent.getActiveSheet(),r)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(r-1):this.setAutofit(r,!0,n)}else if(this.trgtEle.classList.contains("e-rowresize")){var i=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,o=Ue(this.parent.getActiveSheet(),i)+"px";this.setAutofit(i,!1,o)}this.parent.notify(ss,null)}},e.prototype.setTarget=function(e){if(t.closest(e.target,".e-header-cell")){var r=e.target,n=this.parent.getActiveSheet();if(n.isProtected&&(!n.protectSettings.formatColumns||!n.protectSettings.formatRows)){if(!n.protectSettings.formatRows&&!n.protectSettings.formatColumns)return;if(n.protectSettings.formatRows&&t.closest(r,".e-colhdr-table"))return;if(n.protectSettings.formatColumns&&t.closest(r,".e-rowhdr-table"))return}var i,o,a,s;if(t.closest(r,".e-header-row")){a=e.offsetX,o=r.offsetWidth,s="e-colresize";(l=this.getColPrevSibling(r))&&!l.classList.contains("e-select-all-cell")?i=l:Number(r.getAttribute("aria-colindex"))>1&&(i=r)}else if(t.closest(r,".e-row")){a=e.offsetY,o=r.offsetHeight,s="e-rowresize";var l;(l=this.getRowPrevSibling(r))?i=l.firstElementChild:Number(r.parentElement.getAttribute("aria-rowindex"))>1&&(i=r)}if(o-2<8&&a!==Math.ceil((o-2)/2))a<Math.ceil((o-2)/2)?(r.classList.add(s),i.classList.add(s)):a>Math.ceil((o-2)/2)&&r.classList.add(s);else if(o-5<a&&a<=o&&o>=10)r.classList.add(s);else if(a<5&&i&&o>=10)r.classList.add(s),i.classList.add(s);else for(var h=this.parent.element.getElementsByClassName(s),d=0;d<h.length;d++)h[d].classList.remove(s)}},e.prototype.getColPrevSibling=function(e){var r=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(r&&t.closest(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)},e.prototype.getRowPrevSibling=function(e){var r=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(r&&t.closest(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)},e.prototype.updateTarget=function(e,r){if(t.closest(r,".e-header-row")){if(r.offsetWidth<10&&e.offsetX<Math.ceil((r.offsetWidth-2)/2)||e.offsetX<5&&r.offsetWidth>=10&&r.classList.contains("e-colresize")){var n=this.parent.getActiveSheet(),i=Number(this.trgtEle.getAttribute("aria-colindex"))-2;(o=this.getColPrevSibling(r))&&!Ge(n,i)?this.trgtEle=o:i>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(r.offsetHeight<10&&e.offsetY<Math.ceil((r.offsetHeight-2)/2)||e.offsetY<5&&r.offsetHeight>=10&&r.classList.contains("e-rowresize")){var o;n=this.parent.getActiveSheet(),i=Number(r.parentElement.getAttribute("aria-rowindex"))-2;if((o=this.getRowPrevSibling(r))||He(n,i))if("dblclick"===e.type&&He(n,i)){var a=w(c(n.selectedRange)),s=void 0;s=i<=a[2]&&i>a[0]&&X(n,a)?{startIndex:a[0],endIndex:a[2],hide:!1,autoFit:!0}:{startIndex:i,endIndex:i,hide:!1,autoFit:!0},this.parent.notify(gn,s)}else He(n,i)||(this.trgtEle=o.getElementsByClassName("e-header-cell")[0])}},e.prototype.setAutoFitHandler=function(e){e.isCol&&Ge(this.parent.getActiveSheet(),e.idx)?this.showHiddenColumns(e.idx):this.setAutofit(e.idx,e.isCol)},e.prototype.setAutofit=function(e,t,r){var n=0,i=this.parent.getActiveSheet(),o=this.parent.getMainContent(),a=t?je(this.parent.getActiveSheet(),e)+"px":Ue(this.parent.getActiveSheet(),e)+"px",s=[],l=0,h=o.getElementsByClassName("e-content-table")[0],d=!1,p=0;if(t){for(var c=i.rows.length,u=0;u<c;u++)if(i.rows[u]&&i.rows[u].cells&&i.rows[u].cells[e]){ke(u,e,i).wrap&&(d=!0,p++);if((m=this.parent.createElement("td",{className:"e-cell"})).textContent=this.parent.getDisplayText(i.rows[u].cells[e]),i.rows[u].cells[e].style){(v=i.rows[u].cells[e].style).fontFamily&&(m.style.fontFamily=v.fontFamily),v.fontSize&&(m.style.fontSize=v.fontSize)}s[n]=m,n++}}else for(var f=i.rows[e]&&i.rows[e].cells?i.rows[e].cells.length:0,g=0;g<f;g++)if(i.rows[e]&&i.rows[e].cells[g]){ke(e,g,i).wrap&&(d=!0,p++);var m;if((m=this.parent.createElement("td")).textContent=this.parent.getDisplayText(i.rows[e].cells[g]),i.rows[e].cells[g].style){var v;(v=i.rows[e].cells[g].style).fontFamily&&(m.style.fontFamily=v.fontFamily),v.fontSize&&(m.style.fontSize=v.fontSize)}s[n]=m,n++}if(0===p){var y=wt(h,s,t,this.parent,r,d);t&&(y=this.getFloatingElementWidth(y,e));var C=0===y?parseInt(a,10):y,x=parseInt(a,10)>C?-(parseInt(a,10)-C):C-parseInt(a,10);if(t)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)ze(i,e).width=C>0?C:0,this.resizeStart(e,this.parent.getViewportIndex(e,!0),C+"px",t,!0,r),this.parent.notify(Co,{threshold:x,colIdx:e});else{var b,S=je(i,e);b=C>0?-(S-C):-S,this.parent.notify(Co,{threshold:b,colIdx:e}),ze(i,e).width=C>0?C:0}else if(!t)if(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex)C=C>20?C:20,l=Ue(i,e),x=C>0?-(l-C):-l,_e(i,e,C>0?C:0),Pe(i,e,{customHeight:!1}),this.resizeStart(e,this.parent.getViewportIndex(e),C+"px",t,!0,r),this.parent.notify(yo,{threshold:x,rowIdx:e});else{l=Ue(i,e);var w;w=C>0?-(l-C):-l,this.parent.notify(yo,{threshold:w,rowIdx:e}),_e(i,e,C>0?C:0)}}this.parent.selectRange(this.parent.getActiveSheet().selectedRange)},e.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});r.classList.add("e-resize-handle");var n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",r.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(r),this.resizeTooltip(e,!1),this.updateCursor()},e.prototype.resizeTooltip=function(e,t,r){if(t){var n=document.querySelector(".e-header-tooltip"),o=this.parent.element.getElementsByClassName("e-colresize-handler")[0],a=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(o){var s=r.clientX-Math.round(this.trgtEle.getBoundingClientRect().left);n&&(n.firstChild.textContent=s>0?"Width:("+s.toString()+" pixels)":"Width: 0.00")}else if(a){var l=r.clientY-Math.round(this.trgtEle.getBoundingClientRect().top);n&&(n.firstChild.textContent=l>0?"Height:("+l.toString()+" pixels)":"Height: 0.00")}}else{var h=e.classList.contains("e-colresize"),d=e.classList.contains("e-rowresize");if(h||d){var p=h?"e-colresize-handler":"e-rowresize-handler",c=new i.Tooltip({cssClass:"e-header-tooltip",showTipPointer:!1});h?c.content="Width:("+Math.round(e.getBoundingClientRect().width).toString()+" pixels)":d&&(c.content="Height:("+Math.round(e.getBoundingClientRect().height).toString()+" pixels)",c.offsetX=-(this.parent.getMainContent().parentElement.clientWidth/2-Math.round(e.getBoundingClientRect().width))),c.appendTo("."+p),c.open(),c.refresh()}}},e.prototype.setColWidth=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=yt(r)-n;if(o<0&&n<-o&&(o=-n),r>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,r),void this.parent.notify(Yo,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!1},action:"resize"});this.resizeStart(e,t,r+"px",!0,!1,n+"px"),qe(i,e,{width:r,customWidth:!0}),this.parent.notify(Co,{threshold:o,colIdx:e,checkWrapCell:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.showHideCopyIndicator(),this.parent.notify(Yo,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!0},action:"resize"}))},e.prototype.showHideCopyIndicator=function(){var e=this.parent.element.getElementsByClassName("e-copy-indicator")[0],r=!1;e&&(t.detach(e),this.parent.notify(cs,null),r=!0),r&&this.parent.notify(Li,{})},e.prototype.showHiddenColumns=function(e,t){var r,n,i,o=this,a=this.parent.getActiveSheet(),s=c(a.selectedRange);if(e>=s[1]&&e<=s[3]&&s[2]===a.rowCount-1&&u(a.activeCell)[0]===u(a.topLeftCell)[0]?(r=s[1],n=s[3],i=this.parent.getMainContent().querySelector("colgroup")):r=n=e,void 0!==t)for(var l=r;l<=n;l++)qe(a,l,{width:t,customWidth:!0}),l>=this.parent.viewport.leftIndex&&l<=this.parent.viewport.rightIndex&&!Ge(a,l)&&(i.children[this.parent.getViewportIndex(l,!0)].style.width=t+"px");this.trgtEle&&this.trgtEle.classList.remove("e-unhide-column");var h={startIndex:r,endIndex:n,hide:!1,isCol:!0,autoFit:!0};if(this.parent.notify(gn,h),this.showHideCopyIndicator(),void 0===t)if(h.autoFit)this.autoFit({isRow:!1,startIndex:r,endIndex:n});else{var d=function(){o.parent.off(Li,d),o.autoFit({isRow:!1,startIndex:r,endIndex:n})};this.parent.on(Li,d,this)}},e.prototype.setRowHeight=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=this.parent.frozenColCount(i),a=parseInt(this.parent.getRow(e,null,o).style.height,10),s=r,l=yt(parseInt(s,10))-a;l<0&&a<-l&&(l=-a),this.resizeStart(e,t,s,!1,!1,n),Pe(i,e,{height:parseInt(s,10)>0?parseInt(s,10):0,customHeight:!0}),this.parent.notify(yo,{threshold:l,rowIdx:e,isCustomHgt:!0})},e.prototype.resizeOn=function(e){var t,r,n=this,i=this.parent.getActiveSheet(),o=c(i.activeCell),a=ke(o[0],o[1],i);if(this.trgtEle.classList.contains("e-rowresize")){var s=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&He(i,s)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var l={startIndex:s,endIndex:s,hide:!1,skipAppend:!0};this.parent.notify(gn,l);var h=this.parent.getRowHeaderTable().tBodies[0],d=this.parent.getContentTable().tBodies[0];l.hdrRow.style.display="none",l.row.style.display="none",h.insertBefore(l.hdrRow,h.children[l.insertIdx]),d.insertBefore(l.row,d.children[l.insertIdx]),this.trgtEle=l.hdrRow.firstElementChild,l.hdrRow.nextElementSibling.classList.remove("e-hide-end"),l.mergeCollection.forEach(function(e){n.parent.notify(hn,e)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&He(i,s)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}r=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(r);var p=this.parent.frozenColCount(i),u=this.parent.getRow(r,null,p).style.height,f=e.clientY-this.event.clientY+parseInt(u,10);if(f<=0)return this.parent.hideRow(r),this.showHideCopyIndicator(),Pe(i,r,{height:0,customHeight:!0}),void this.parent.notify(Yo,{eventArgs:{index:r,height:"0px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"});if(this.setRowHeight(r,t,f+"px",u),"none"===this.trgtEle.parentElement.style.display){var g=this.parent.getActiveSheet(),m=w(c(g.selectedRange));if(r<=m[2]&&r>m[0]){f=Ue(g,r);for(var v=void 0,y=m[0];y<=m[2];y++)y!==r&&(u=Ue(g,y)+"px",Pe(g,y,{customHeight:!0,height:f}),He(g,y)?v||(v=y):(this.parent.getRow(y).style.height=f+"px",g.showHeaders&&(this.parent.getRow(y,this.parent.getRowHeaderTable()).style.height=f+"px")),this.parent.notify(Yo,{eventArgs:{index:y,height:f+"px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"}));this.parent.hideRow(m[0],r-1,!1),this.showHideCopyIndicator(),t+=Math.abs(r-v)}else 0===t||He(g,r-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(g.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var C=void 0;this.trgtEle.classList.contains("e-unhide-column")?(t-=1,C=0):C=je(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),e.clientX-this.event.clientX+C,C)}a&&a.format&&a.format.indexOf("*")>-1&&this.parent.notify(Vn,{cell:a,value:a.format[a.format.indexOf("*")+1].toString(),rowIdx:o[0],colIdx:o[1]})},e.prototype.resizeStart=function(e,t,r,n,i,o){bt(e,t,r,n,this.parent);var a,s,l=i?"resizeToFit":"resize";n?(a={index:e,width:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldWidth:o},s=o!==r):(a={index:e,height:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldHeight:o},s=o!==r),s&&this.parent.notify(Yo,{eventArgs:a,action:l})},e.prototype.updateCursor=function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},e.prototype.getFloatingElementWidth=function(e,t){var r=e,n={filterRange:[],hasFilter:!1};return this.parent.notify(Ko,n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(r=e+22),r},e.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"resize"},e}(),El=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshClients=function(e){It(e,this.parent)},e.prototype.addEventListener=function(){this.parent.on(Ro,this.refreshClients,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ro,this.refreshClients)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"collaborativeEditing"},e}(),Rl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.hideShow=function(e){var r=this,n=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=be(this.parent,n);if(e.startIndex>e.endIndex){var o=e.startIndex;e.startIndex=e.endIndex,e.endIndex=o}var a;if(e.actionUpdate){if(e.sheetIndex=n,a={eventArgs:e,action:"hideShow"},this.parent.notify(Zt,a),e.cancel)return;delete e.cancel}var s=function(t){e.isCol?(r.hideCol(e),t&&r.parent.sheetModule.colWidthChanged({colIdx:e.startIndex,isHideShow:!0})):(r.hideRow(e),t&&r.parent.sheetModule.rowHeightChanged({rowIdx:e.startIndex,isHideShow:!0}))},l=e.isCol?this.parent.frozenColCount(i):this.parent.frozenRowCount(i);if(l&&e.startIndex<l){var h=void 0;if(e.freezePane=!0,e.endIndex>=l&&(h=e.endIndex,e.endIndex=l-1),s(!0),delete e.freezePane,void 0!==h){var d=e.startIndex;e.endIndex=h,e.startIndex=l,s(),e.startIndex=d}}else s();e.actionUpdate&&(this.updateIndexOnlyForHiddenColumnsAndRows(e,i),this.parent.notify(Yo,a))},e.prototype.updateIndexOnlyForHiddenColumnsAndRows=function(e,t){for(var r=e.startIndex,n=e.endIndex,i=e.startIndex;i<=n;i++)if(0==(e.isCol?ze(t,i):Me(t,i)||{}).hidden){e.startIndex=i;break}for(var o=e.endIndex;o>=r;o--)if(0==(e.isCol?ze(t,o):Me(t,o)||{}).hidden){e.endIndex=o;break}},e.prototype.hideRow=function(e){var r,n,i,o,a,s,l=this,h=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,d=be(this.parent,h),p=0,f=Object.assign({},e),m=this.parent.scrollSettings.isFinite&&!f.freezePane;if(m){if(f.startIndex>=d.rowCount)return;f.endIndex>=d.rowCount&&(f.endIndex=d.rowCount-1),s=0}var v=this.parent.frozenRowCount(d);if(f.hide){for(var y,C=void 0,x=void 0,b=m&&f.endIndex===re(d,d.rowCount-1,!1),S=f.startIndex;S<=f.endIndex;S++)if(!He(d,S)&&(void 0===n&&(f.freezePane?(y=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(y=this.parent.getRowHeaderTable(),C=this.parent.getContentTable()),n=this.parent.getViewportIndex(S),p=0),a={hidden:!0},f.isFiltering&&(a.isFiltered=!0),Pe(d,S,a),h===this.parent.activeSheetIndex))if(m&&(s+=Ue(d,S,!0,!0)),this.refreshChart(S,"rows"),x=C&&C.rows[n]){if(!o)for(var w=0;w<=d.usedRange.colIndex;w++)if(((r=ke(S,w,d)||{}).colSpan||r.rowSpan)&&(f.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){o=!0;break}if(o)continue;if(y.rows[n]&&t.detach(y.rows[n]),t.detach(x),p++,(x=C.rows[n])&&S===f.endIndex){var I=void 0,E=(i=re(d,S+1,!0))!==re(d,0,!0)&&i===(this.parent.viewport.topIndex>=f.startIndex?f.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(w=this.parent.viewport.leftIndex;w<=this.parent.viewport.rightIndex;w++){""!==(K=this.parent.getCellStyleValue(["borderTop"],[i,w]).borderTop)&&(I=x.cells[w],this.parent.notify(hr,{onActionUpdate:!1,rowIdx:i,colIdx:w,style:{borderTop:K},row:x,pRow:x.previousElementSibling,first:E,cell:I}))}}}else S<=this.parent.viewport.bottomIndex?p++:p--;if(f.refreshUI)return;if(o&&(f.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return void(f.isFiltering?e.refreshUI=!0:(this.parent.selectRange(d.selectedRange),d.frozenRows||d.frozenColumns?(this.parent.renderModule.refreshSheet(!1,!1,!0),e.refreshUI=!0):this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})));if(!p)return;this.parent.selectRange(d.selectedRange);var R=function(){if(d.showHeaders){var e=f.freezePane?1:0;n===e?y.rows[e]&&y.rows[e].classList.add("e-hide-end"):(y&&y.rows[n-1]&&y.rows[n-1].classList.add("e-hide-start"),y&&y.rows[n]&&y.rows[n].classList.add("e-hide-end"))}};if(!f.freezePane&&this.parent.scrollSettings.enableVirtualization){var A=f.startIndex,k=f.startIndex;if(f.startIndex<u(d.paneTopLeftCell)[0]||p>this.parent.viewport.rowCount){if(f.isFiltering)return void(e.refreshUI=!0);this.parent.updateTopLeftCell(re(d,f.startIndex-1<v?v:f.startIndex-1,!0)-v,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0)}else{k=(A=this.parent.viewport.bottomIndex+1)+p-1;var F=this.parent.skipHidden(A,k,"rows",!1);if(A=F[0],k=F[1],m){if(A>=d.rowCount)return void(this.parent.viewport.topIndex+v===re(d,v,!0)?(R(),this.parent.notify(fs,{isHide:!0,height:s}),b&&(this.parent.viewport.bottomIndex=re(d,d.rowCount-1,!1))):this.parent.renderModule.refreshSheet(!1,!1,!0));if(k>=d.rowCount)return void this.parent.renderModule.refreshSheet(!1,!1,!0);this.parent.notify(fs,{isHide:!0,height:s})}this.parent.viewport.bottomIndex=k;var T=void 0,L=this.parent.frozenColCount(d),N=[];L?(N.push(v),N.push(this.parent.viewport.leftIndex+L),T=u(d.topLeftCell)[1]):T=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({colIndex:T,rowIndex:A,direction:"",refresh:"RowPart",frozenIndexes:N},g(A,T)+":"+g(k,this.parent.viewport.rightIndex))}}R()}else{var D=void 0,O=void 0,M=void 0,P=(x=void 0,void 0),H=void 0,B=(C=void 0,void 0),U=void 0,_=f.startIndex-1,V=[],z=f.freezePane,q="lastElementChild",j=0;if(m){var W=re(d,d.rowCount-1,!1);if(this.parent.viewport.bottomIndex===W)if(this.parent.viewport.topIndex+v===re(d,v,!0))z=!0;else{var G=c(d.paneTopLeftCell)[0];d.rowCount-1-G+1-this.parent.hiddenCount(G,d.rowCount-1)<this.parent.viewport.rowCount+Math.round(this.parent.getThreshold("row")/2)&&(q="firstElementChild")}}S=f.startIndex;for(var Y=f.endIndex;S<=Y;S++)if(He(d,S))if(void 0===P){if(a={hidden:!1},f.isFiltering&&(a.isFiltered=!1),!z&&S>this.parent.viewport.bottomIndex){if(Pe(d,S,a),void 0===U)return}else if(void 0===U&&(U=S),Pe(d,S,a),h===this.parent.activeSheetIndex){m&&(s+=Ue(d,S,!0,!0)),this.refreshChart(S,"rows"),void 0===n&&(D=document.createDocumentFragment(),O=document.createDocumentFragment(),H=this.parent.serviceLocator.getService("row"),f.freezePane?(B=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(B=this.parent.getRowHeaderTable(),C=this.parent.getContentTable(),S<this.parent.viewport.topIndex+v&&(this.parent.viewport.topIndex=S-v)),n=this.parent.getViewportIndex(S)),_++,M=H.refresh(S,null,null,!0,!0),D.appendChild(M),B&&B.rows.length&&!z&&t.detach(B.tBodies[0][q]),x=O.appendChild(H.refresh(S,x,M)),C&&C.rows.length&&!z&&(t.detach(C.tBodies[0][q]),"firstElementChild"===q&&(void 0!==n&&n-1>-1&&(n-=1),j+=Ue(d,this.parent.viewport.topIndex,!0),this.parent.viewport.topIndex=re(d,this.parent.viewport.topIndex+1,!0)));for(w=this.parent.viewport.leftIndex;w<=this.parent.viewport.rightIndex;w++)if(void 0!==(r=ke(S,w,d)||{}).rowSpan){var X={range:[S,w,S,w],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(cn,X),V.length&&X.range[1]===V[V.length-1].range[1]||V.push(X)}}}else Y=S;else{if(f.startIndex===f.endIndex)return;void 0===n?_++:P=S}if(void 0===n)return;if(!f.freezePane){if(f.isFiltering&&f.startIndex<u(d.paneTopLeftCell)[0]&&(e.refreshUI=!0,void 0===P||P===f.endIndex))return;this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+v+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),p=this.parent.hiddenCount(this.parent.viewport.topIndex+v,f.startIndex)+this.parent.hiddenCount(f.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=p,m&&this.parent.viewport.bottomIndex>=d.rowCount&&(this.parent.viewport.bottomIndex=re(d,d.rowCount-1,!1))}if(f.insertIdx=e.insertIdx=n,f.row=e.row=O.querySelector(".e-row"),f.mergeCollection=e.mergeCollection=V,d.showHeaders&&(e.hdrRow=f.hdrRow=D.querySelector(".e-row"),0!==n&&!He(d,_-1)&&B.rows[n-1]&&B.rows[n-1].classList.remove("e-hide-start"),0!==f.startIndex&&He(d,f.startIndex-1)&&f.hdrRow.classList.add("e-hide-end"),He(d,_+1)?D.lastElementChild.classList.add("e-hide-start"):B.rows[n]&&B.rows[n].classList.remove("e-hide-end")),x&&C&&C.rows[n]){i=re(d,_+1,!0);for(S=this.parent.viewport.leftIndex;S<=this.parent.viewport.rightIndex;S++){var K;if(""!==(K=this.parent.getCellStyleValue(["borderTop"],[i,S]).borderTop)){this.parent.notify(hr,{onActionUpdate:!1,rowIdx:i,colIdx:S,style:{borderTop:K},pRow:x,cell:C.rows[n].cells[S],first:""});var $=re(d,U-1,!1);$>-1?!C.rows[n-1]||this.parent.getCellStyleValue(["borderBottom"],[$,S]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[U,S]).borderTop||(C.rows[n-1].cells[S].style.borderBottom=""):C.rows[n].cells[S].style.borderTop=""}}}if(f.skipAppend)return;m&&this.parent.notify(fs,{height:s,size:j}),Math.abs(_-U)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet(!1,!1,!0):(B&&(B.tBodies[0].rows.length?B.tBodies[0].insertBefore(D,B.rows[n]):B.tBodies[0].appendChild(D)),C&&C.tBodies[0]&&(C.tBodies[0].rows.length?C.tBodies[0].insertBefore(O,C.rows[n]):C.tBodies[0].appendChild(O)),this.parent.selectRange(d.selectedRange),f.autoFit&&d.showHeaders&&this.parent.notify(Ao,{startIndex:f.startIndex,endIndex:f.endIndex,isRow:!0}),V.forEach(function(e){l.parent.notify(hn,e)}),void 0!==P&&P!==f.endIndex&&(f.startIndex=P,this.hideRow(f)))}},e.prototype.hideCol=function(e){for(var r,n=this,i=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,o=be(this.parent,i),a=[],s=[],l=u(o.paneTopLeftCell),h=this.parent.frozenColCount(o),d=this.parent.frozenRowCount(o),p=this.parent.viewport.leftIndex+h,c=e.startIndex;c<=e.endIndex;c++)(e.hide?!Ge(o,c):Ge(o,c))&&(qe(o,c,{hidden:e.hide}),this.refreshChart(c,"columns"),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&(c<p||c>this.parent.viewport.rightIndex)?c<p&&s.push(c):(a.push(c),e.hide&&c<=l[1]&&(r=!0)));if((s.length||a.length)&&i===this.parent.activeSheetIndex){var f,g,v=u(o.topLeftCell),y=function(){var t;return t=n.parent.scrollSettings.enableVirtualization?[d?v[0]:n.parent.viewport.topIndex,n.parent.viewport.bottomIndex]:[0,o.rowCount-1],e.freezePane?(f=n.parent.getRowHeaderTable(),g=n.parent.sheetModule.getSelectAllTable()):(f=n.parent.getContentTable(),g=n.parent.getColHeaderTable()),t};if(e.hide){if(!a.length)return;if((a.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane)&&this.removeCell(o,a,y(),f,g),!e.freezePane&&this.parent.scrollSettings.enableVirtualization){if(r)return this.parent.updateTopLeftCell(null,re(o,a[0]-1<h?h:a[0]-1,!0,"columns")-h,"row"),void this.parent.renderModule.refreshSheet(!1,!1,!0);var C=[],x=this.parent.viewport.topIndex,b=d?v[0]:x;if(d&&(C=[d+x,h]),this.parent.scrollSettings.isFinite){var S=re(o,o.colCount-1,!1,"columns"),w=this.parent.viewport.leftIndex+h,I=this.parent.viewport.rightIndex;if(I+a.length>=S){var E=re(o,w-(I+a.length-S),!1,"columns");return E>=h&&(this.parent.viewport.leftIndex=E,this.parent.viewport.leftIndex-=this.parent.hiddenCount(I,S)),this.parent.viewport.rightIndex=S,w!==this.parent.viewport.leftIndex+h||I!==this.parent.viewport.rightIndex?(this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C,rowIndex:b,skipUpdateOnFirst:this.parent.viewport.leftIndex+h===re(o,h,!0,"columns")}),d&&(this.parent.viewport.topIndex=x)):this.parent.notify(Ba,{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(o.selectedRange)}}if(a.length<=this.parent.getThreshold("col")){var R=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+a.length,"columns");this.parent.viewport.rightIndex=R[1],this.parent.renderModule.refreshUI({rowIndex:b,colIndex:R[0],direction:"",refresh:"ColumnPart",frozenIndexes:C},""+m([b,R[0],this.parent.viewport.bottomIndex,R[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+h===re(o,h,!0,"columns"),rowIndex:b,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C}),d&&(this.parent.viewport.topIndex=x)}this.parent.selectRange(o.selectedRange)}else{if(s.length&&this.parent.scrollSettings.enableVirtualization){s.sort(function(e,t){return e-t});var A=s[0]-1<h?h:s[0]-1;return this.parent.updateTopLeftCell(null,re(o,A,!0,"columns")-h,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0),void(e.autoFit&&(e.autoFit=!1))}if(a.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane)this.appendCell(o,a,y(),f,g,e.freezePane),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&this.parent.notify(ji,{refresh:"Column",prevRowColCnt:{rowCount:o.rowCount,colCount:o.colCount}});else{x=this.parent.viewport.topIndex,b=d?v[0]:x;this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+h===re(o,h,!0,"columns"),rowIndex:b,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:d?[d+x,h]:[]}),d&&(this.parent.viewport.topIndex=x),e.autoFit&&(e.autoFit=!1)}this.parent.selectRange(o.selectedRange)}}},e.prototype.removeCell=function(e,r,n,i,o){var a,s,l,h,d,p=this,c=n[0],u=n[1],f=0,g=r.length-1,m=this.parent.frozenRowCount(e),v=i.getElementsByTagName("colgroup")[0],y=this.parent.getViewportIndex(r[0],!0)+1,C=re(e,m-1,!1);for(e.showHeaders&&(l=o.getElementsByTagName("colgroup")[0],a=o.rows[0]);c<=u;)He(e,c)?c++:(s=m&&c<m?o.rows[f+1]:i.rows[f],r.forEach(function(n,i){if(0===f&&c>=m&&(e.showHeaders&&(t.detach(l.children[y]),t.detach(a.cells[y])),t.detach(v.children[y])),t.detach(s.cells[y]),0===i&&void 0!==(h=ke(c,n,e,!1,!0)).colSpan&&(void 0===h.rowSpan||h.colSpan>1)&&p.parent.notify(ca,{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g]}),i===g){d=re(e,n+1,!0,"columns");var o=p.parent.getCellStyleValue(["borderLeft"],[f,d]).borderLeft;""!==o&&p.parent.notify(hr,{onActionUpdate:!1,rowIdx:f,colIdx:d,style:{borderLeft:o},row:s,first:""}),void 0!==(h=ke(c,n,e)||{}).colSpan&&(void 0===h.rowSpan||h.colSpan>1)&&p.parent.notify(ca,{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g],isEnd:!0})}}),m&&c===C?(f=0,c=this.parent.viewport.topIndex+m):(f++,c++));y-1>-1&&e.showHeaders&&a.cells[y-1]&&a.cells[y-1].classList.add("e-hide-start"),e.showHeaders&&a.cells[y]&&a.cells[y].classList.add("e-hide-end")},e.prototype.appendCell=function(e,r,n,i,o,a){var s,l,h,d,p=this,c=n[0],u=n[1],f=0,m=r.length-1,v=this.parent.frozenRowCount(e),y=i.getElementsByTagName("colgroup")[0];e.showHeaders&&(h=o.getElementsByTagName("colgroup")[0],s=o.rows[0]);var C=this.parent.serviceLocator.getService("cell");r.sort(function(e,t){return e-t});for(var x,b,S,w,I=[],E=[],R=re(e,v-1,!1);c<=u;)He(e,c)?c++:(l=v&&c<v?o.rows[f+1]:i.rows[f],r.forEach(function(n,i){if(0===f&&(E[i]=p.parent.getViewportIndex(n,!0),e.showHeaders&&(b=s.cells[E[i]])&&(0===i&&r[i]&&!Ge(e,r[i]-1)&&b.previousSibling&&b.previousElementSibling.classList.remove("e-hide-start"),i===m&&b.classList.remove("e-hide-end")),c>=v&&(y.children[E[i]]?(y.insertBefore(p.parent.sheetModule.updateCol(e,n),y.children[E[i]]),e.showHeaders&&C.renderColHeader(n,s,b)):(y.appendChild(p.parent.sheetModule.updateCol(e,n)),e.showHeaders&&C.renderColHeader(n,s)),a||(t.detach(y.lastChild),e.showHeaders&&t.detach(s.lastChild)),e.showHeaders&&i===m&&(t.detach(h),o.insertBefore(y.cloneNode(!0),o.tHead)))),a||t.detach(l.lastChild),b=l.cells[E[i]],w={rowIdx:c,colIdx:n,cell:ke(c,n,e),row:l,address:g(c,n),lastCell:n===m,isHeightCheckNeeded:!0,first:n!==re(e,0,!0,"columns")&&n===p.parent.viewport.leftIndex?"Column":"",checkNextBorder:i===m?"Column":""},b&&(w.refChild=b),x=C.render(w),0===i&&x.previousSibling){""!==p.parent.getCellStyleValue(["borderLeft"],[f,re(e,r[r.length-1]+1,!0,"columns")]).borderLeft&&(d=re(e,r[0]-1,!1,"columns"))>-1&&!p.parent.getCellStyleValue(["borderRight"],[f,d]).borderRight&&!p.parent.getCellStyleValue(["borderLeft"],[f,r[0]]).borderLeft&&(x.previousSibling.style.borderRight="")}if(void 0!==(S=ke(f,n,e)||{}).colSpan&&(void 0===S.rowSpan||S.colSpan>1)){var u={range:[f,n,f,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};p.parent.notify(cn,u),I.length&&u.range[1]===I[I.length-1].range[1]||I.push(u)}}),v&&c===R?(c=this.parent.viewport.topIndex+v,f=0):(c++,f++));I.forEach(function(e){p.parent.notify(hn,e)}),this.parent.viewport.rightIndex=re(e,this.parent.viewport.rightIndex-r.length,!1,"columns")},e.prototype.refreshChart=function(e,t){this.parent.notify(En,{rIdx:e,showHide:t})},e.prototype.addEventListener=function(){this.parent.on(gn,this.hideShow,this),this.parent.on(Di,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(gn,this.hideShow),this.parent.off(Di,this.destroy)},e}(),Al=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Fo,this.initiateHyperlinkHandler,this),this.parent.on(To,this.editHyperlinkHandler,this),this.parent.on(Lo,this.openHyperlinkHandler,this),this.parent.on(Hi,this.hyperlinkClickHandler,this),this.parent.on(Do,this.createHyperlinkEle,this),this.parent.on(Bi,this.keyUpHandler,this),this.parent.on(Mn,this.removeHyperlink,this),this.parent.on(No,this.removeHyperlinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Fo,this.initiateHyperlinkHandler),this.parent.off(To,this.editHyperlinkHandler),this.parent.off(Lo,this.openHyperlinkHandler),this.parent.off(Hi,this.hyperlinkClickHandler),this.parent.off(Do,this.createHyperlinkEle),this.parent.off(Bi,this.keyUpHandler),this.parent.off(Mn,this.removeHyperlink),this.parent.off(No,this.removeHyperlinkHandler))},e.prototype.getModuleName=function(){return"spreadsheetHyperlink"},e.prototype.keyUpHandler=function(e){var r=e.target;if(t.closest(r,".e-document")){var n=document.querySelector(".e-hyp-text"),i=this.parent.element.querySelector(".e-hyperlink-alert-span"),o=(t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;n&&n.value&&(G(n.value.toUpperCase())?i&&(i.remove(),o.removeAttribute("disabled")):(this.showDialog(),o.setAttribute("disabled","true")))}if(r.classList.contains("e-text")&&t.closest(r,".e-cont")&&t.closest(r,".e-webpage")&&t.closest(r,".e-webpage").getElementsByClassName("e-cont")[1]===r.parentElement){o=(t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;if(""!==r.value)o.removeAttribute("disabled");else{!!t.closest(r,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||o.setAttribute("disabled","true")}}},e.prototype.initiateHyperlinkHandler=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.getActiveSheet();if(!r.isProtected||r.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n,i=this.parent.serviceLocator.getService(ch);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:t.getConstant("InsertLink"),beforeOpen:function(t){var r={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),i.dialogInstance.content=e.hyperlinkContent(),n=i.dialogInstance.content.querySelector(".e-text").value,i.dialogInstance.dataBind(),Pt(e.parent.element)},open:function(){setTimeout(function(){Pt(i.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},buttons:[{buttonModel:{content:t.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(n),i.hide()}}]})}}else this.parent.notify(la,null)},e.prototype.dlgClickHandler=function(e){var t,r,n=this.parent.getActiveSheet(),i=n.name+"!"+n.selectedRange,o=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(o)if((t=o.getElementsByClassName("e-cont")[0].querySelector(".e-text").value)===e&&(t=null),o.querySelector(".e-webpage")){var a={address:r=o.getElementsByClassName("e-cont")[1].querySelector(".e-text").value};this.parent.insertHyperlink(a,i,t,!1)}else{r=o.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var s=o.getElementsByClassName("e-cont")[2];if(s.getElementsByClassName("e-list-item")[0].querySelector(".e-active")){a={address:r=o.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+r.toUpperCase()};this.parent.insertHyperlink(a,i,t,!1)}else if(s.querySelector(".e-active"))for(var l=o.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,h=0;h<this.parent.definedNames.length;h++)if(this.parent.definedNames[h].name===l){a={address:this.parent.definedNames[h].name};this.parent.insertHyperlink(a,i,t,!1)}}},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)},e.prototype.editHyperlinkHandler=function(){var e,t=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.serviceLocator.getService(ch);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:r.getConstant("EditLink"),beforeOpen:function(r){var i={dialogName:"EditLinkDialog",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(r.cancel=!0),n.dialogInstance.content=t.hyperEditContent(),e=n.dialogInstance.content.querySelector(".e-text").value,n.dialogInstance.dataBind(),Pt(t.parent.element)},open:function(){setTimeout(function(){n.dialogInstance.element.querySelector(".e-webpage")?Pt(n.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):Pt(n.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:r.getConstant("Update"),isPrimary:!0},click:function(){t.dlgClickHandler(e),n.hide()}}]})},e.prototype.openHyperlinkHandler=function(){var e=u(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)},e.prototype.hlOpenHandler=function(e){var r=this;if(e.classList.contains("e-hyperlink")){var n=t.closest(e,".e-cell");if(!n)return;var i=["",""],o=void 0,a=!0,s=this.parent.getActiveSheet(),l=parseInt(n.getAttribute("aria-colindex"),10)-1,h=parseInt(n.parentElement.getAttribute("aria-rowindex"),10)-1,d=ke(h,l,s,!1,!0);d.style&&"#00e"===d.style.color&&(oe(this.parent,s,{rowIdx:h,colIdx:l,preventEvt:!0,cell:{style:{color:"#551a8b"}}}),n.style.color="#551a8b");var p=d.hyperlink,u=void 0,f={hyperlink:p,address:s.activeCell,target:"_blank",cancel:!1};if(this.parent.trigger(Nr,f),f.cancel)return;var g={hyperlink:p=f.hyperlink,address:s.activeCell};"string"==typeof p&&(u=p),"object"==typeof p&&(u=p.address);var v=u;if(-1===u.indexOf("http://")&&-1===u.indexOf("https://")&&-1===u.indexOf("ftp://")){if(!t.isNullOrUndefined(u)){if(this.parent.definedNames)for(var y=0;y<this.parent.definedNames.length;y++)if(this.parent.definedNames[y].name===u){u=(u=this.parent.definedNames[y].refersTo).slice(1);break}-1!==u.indexOf("!")?-1!==(i=u.split("!"))[0].indexOf(" ")&&(i[0]=i[0].slice(1,i[0].length-1)):(i[0]=this.parent.getActiveSheet().name,i[1]=u);var C;for(y=0;y<this.parent.sheets.length;y++)this.parent.sheets[y].name===i[0]&&(C=y);if(s=this.parent.sheets[C],-1!==i[1].indexOf(":")){var x=i[1].indexOf(":"),b=i[1].substr(0,x),S=i[1].substr(x+1,i[1].length);b=b.replace("$",""),(S=S.replace("$","")).match(/\D/g)&&!S.match(/[0-9]/g)&&b.match(/\D/g)&&!b.match(/[0-9]/g)?(b+="1",S+=s.rowCount,i[1]=b+":"+S):!S.match(/\D/g)&&S.match(/[0-9]/g)&&!b.match(/\D/g)&&b.match(/[0-9]/g)&&(o=[parseInt(b,10)-1,0,parseInt(S,10)-1,s.colCount-1],a=!1)}var w=void 0,I=this.parent.definedNames;if(!t.isNullOrUndefined(I))for(y=0;y<I.length;y++)if(I[y].name===v){w=!0;break}if(G(i[1])||w){if(o=a?c(i[1]):o,this.parent.scrollSettings.enableVirtualization&&(o[0]=o[0]>=this.parent.viewport.topIndex?o[0]-this.parent.viewport.topIndex:o[0],o[1]=o[1]>=this.parent.viewport.leftIndex?o[1]-this.parent.viewport.leftIndex:o[1]),!t.isNullOrUndefined(s)){var E=m(o);if(s===this.parent.getActiveSheet())Ke(function(){r.parent.goTo(E)});else{if(E.indexOf(":")>=0){var R=E.split(":");E=R[0]===R[1]?R[0]:E}Ke(function(){r.parent.goTo(r.parent.sheets[C].name+"!"+E)})}}}else this.showInvalidHyperlinkDialog()}}else this.isValidUrl(u)?window.open(u,f.target):this.showInvalidHyperlinkDialog();this.parent.trigger(Dr,g)}},e.prototype.isValidUrl=function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},e.prototype.showInvalidHyperlinkDialog=function(){var e=this.parent.serviceLocator.getService(ch),t=this.parent.serviceLocator.getService(ph);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)},e.prototype.hyperlinkClickHandler=function(e){var r=e.target;if(t.closest(r,".e-link-dialog")&&t.closest(r,".e-toolbar-item")){var n=(p=t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,i=p.querySelector(".e-document"),o=p.querySelector(".e-webpage"),a=o?o.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,s=i?i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:a;if(t.closest(r,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var l=i.querySelectorAll(".e-cont")[2].querySelector(".e-active");i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=a,t.closest(l,".e-list-item").classList.contains("e-level-2")&&n.hasAttribute("disabled")?n.removeAttribute("disabled"):t.closest(l,".e-list-item").classList.contains("e-level-1")&&!n.hasAttribute("disabled")&&n.setAttribute("disabled","true")}else{var h=!o.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;o.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=s,h&&!n.hasAttribute("disabled")?n.setAttribute("disabled","true"):!h&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")}}if(t.closest(r,".e-list-item")&&r.classList.contains("e-fullrow")){var d=this.parent.element.getElementsByClassName("e-link-dialog")[0];if(!d)return;var p,c=(d=d.getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0]).getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];n=(p=t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;t.closest(r,".e-list-item").classList.contains("e-level-2")?("defName"===t.closest(r,".e-list-item").getAttribute("data-uid")?c.classList.contains("e-disabled")||c.hasAttribute("readonly")||(c.setAttribute("readonly","true"),c.classList.add("e-disabled"),c.setAttribute("disabled","true")):"sheet"===t.closest(r,".e-list-item").getAttribute("data-uid")&&c.classList.contains("e-disabled")&&c.hasAttribute("readonly")&&(c.removeAttribute("readonly"),c.classList.remove("e-disabled"),c.removeAttribute("disabled")),n.hasAttribute("disabled")&&n.removeAttribute("disabled")):t.closest(r,".e-list-item").classList.contains("e-level-1")&&n.setAttribute("disabled","true")}else this.hlOpenHandler(r)},e.prototype.createHyperlinkEle=function(e){var r=e.cell;if(!t.isNullOrUndefined(r.hyperlink)){var n=e.td,i=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"}),o=void 0;if("string"==typeof r.hyperlink?(0===r.hyperlink.toLowerCase().indexOf("www.")&&(r.hyperlink="http://"+r.hyperlink),o=r.hyperlink):0===(o=r.hyperlink.address).toLowerCase().indexOf("www.")&&(r.hyperlink.address=o="http://"+o),0===o.indexOf("http://")||0===o.indexOf("https://")||0===o.indexOf("ftp://")?(i.setAttribute("href",o),i.setAttribute("target","_blank")):(o.includes("=")||o.includes("!"))&&i.setAttribute("ref",o),"Accounting"===H(r.format)?i.innerHTML=n.innerHTML:i.innerText=""!==n.innerText?n.innerText:o,n.textContent="",n.innerText="",n.appendChild(i),!e.style.color||!e.style.textDecoration){var a={};e.style.color||(e.style.color=a.color="#00e"),e.style.textDecoration||(e.style.textDecoration=a.textDecoration="underline"),oe(this.parent,this.parent.getActiveSheet(),{rowIdx:e.rowIdx,colIdx:e.colIdx,preventEvt:!0,cell:{style:a}})}}},e.prototype.hyperEditContent=function(){var e=!0,t=this.hyperlinkContent(),r=c(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[r[0]].cells[r[1]];this.parent.scrollSettings.enableVirtualization&&(r[0]=r[0]-this.parent.viewport.topIndex,r[1]=r[1]-this.parent.viewport.leftIndex);var i,o=this.parent.getDisplayText(n),a=n.hyperlink;"string"==typeof a?(i=a,o=o||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1)):"object"==typeof a&&(i=a.address,o=o||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1));for(var s=0,l=0,h=this.parent.definedNames,d=this.parent.sheets,p=0,u=h.length;p<u;p++)h[p].name===i&&s++;for(p=0,u=d.length;p<u;p++)i.includes(d[p].name)&&l++;0===s&&0===l&&(e=!0);var f=t.querySelector(".e-content");if(e){var g=f.querySelector(".e-webpage");if(g.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o),"string"==typeof a)g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a);else{g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a.address)}}else{var m=void 0,v=f.querySelector(".e-document");v.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o);var y=void 0;if(this.parent.definedNames)for(p=0;p<this.parent.definedNames.length;p++)if(this.parent.definedNames[p].name===i){m=!0;break}if(m){var C=v.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];C.setAttribute("readonly","true"),C.classList.add("e-disabled"),C.setAttribute("disabled","true");var x=v.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(p=0;p<x.getElementsByTagName("li").length;p++)x.getElementsByTagName("li")[p].innerText===i&&x.getElementsByTagName("li")[p].classList.add("e-active")}else{i&&-1!==i.indexOf("!")&&(y=i.split("!"));var b=y[0];v.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",y[1]);for(x=v.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],p=0;p<x.getElementsByTagName("li").length;p++)if(x.getElementsByTagName("li")[p].innerText===b){if(x.getElementsByTagName("li")[p].classList.contains("e-active"))break;x.getElementsByTagName("li")[p].classList.add("e-active")}else x.getElementsByTagName("li")[p].classList.contains("e-active")&&x.getElementsByTagName("li")[p].classList.remove("e-active")}}return t},e.prototype.hyperlinkContent=function(){var e,r,n=this.parent.serviceLocator.getService(ph),i=0,a=0,s=!0,l=!0,h=c(this.parent.getActiveSheet().activeCell),d=this.parent.getActiveSheet(),p=ke(h[0],h[1],d),u=!0;if(p){u=!!(p.value&&"string"==typeof p.value&&null!==p.value.match("[A-Za-z]+")||""===p.value||t.isNullOrUndefined(p.value));var f=p.hyperlink;if("string"==typeof f){-1===(g=f).indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")&&(r=f,s=!1)}else if("object"==typeof f){var g;-1===(g=f.address).indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")&&(r=f.address,s=!1)}if(r){for(var m=0,v=0,y=this.parent.definedNames,C=this.parent.sheets,x=0,b=C.length;x<b;x++)r.includes(C[x].name)&&v++;var S=0;for(b=y.length;S<b;S++)y[S].name===r&&m++;0===m&&0===v&&(s=!0)}if(a=s?0:1,this.parent.definedNames)for(var w=0;w<this.parent.definedNames.length;w++)if(this.parent.definedNames[w].name===r){e=!0,l=!1;break}}var I=this.parent.createElement("div",{className:"e-link-dialog"}),E=this.parent.createElement("div",{className:"e-webpage"}),R=this.parent.createElement("div",{className:"e-document"});new o.Tab({selectedItem:a,items:[{header:{text:n.getConstant("WebPage")},content:E},{header:{text:n.getConstant("ThisDocument")},content:R}]}).appendTo(I),s?I.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):I.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");var A=this.parent.createElement("div",{className:"e-cont"}),k=this.parent.createElement("div",{className:"e-cont"}),F=this.parent.createElement("div",{className:"e-header",innerHTML:n.getConstant("DisplayText")}),T=this.parent.createElement("div",{className:"e-header",innerHTML:n.getConstant("Url")}),L=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});u||(L.classList.add("e-disabled"),L.setAttribute("readonly","true"),L.setAttribute("disabled","true")),p&&t.isNullOrUndefined(p.hyperlink)&&L.setAttribute("value",this.parent.getDisplayText(p));var N=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});L.setAttribute("placeholder",n.getConstant("EnterTheTextToDisplay")),N.setAttribute("placeholder",n.getConstant("EnterTheUrl")),A.appendChild(L),A.insertBefore(F,L),k.appendChild(N),k.insertBefore(T,N),E.appendChild(k),E.insertBefore(A,k);for(var D=[],O=[],M=this.parent.sheets;i<this.parent.sheets.length;i++){var P=this.parent.sheets[i].name;"Visible"===this.parent.sheets[i].state&&(M[i]===this.parent.getActiveSheet()?D.push({nodeId:"sheet",nodeText:-1!==P.indexOf(" ")?"'"+P+"'":P,selected:!0}):D.push({nodeId:"sheet",nodeText:-1!==P.indexOf(" ")?"'"+P+"'":P}))}for(i=0;i<this.parent.definedNames.length;i++)O.push({nodeId:"defName",nodeText:this.parent.definedNames[i].name});var H=[{nodeId:"01",nodeText:n.getConstant("CellReference"),expanded:l,nodeChild:D},{nodeId:"02",nodeText:n.getConstant("DefinedNames"),expanded:e,nodeChild:O}],B=new o.TreeView({fields:{dataSource:H,id:"nodeId",text:"nodeText",child:"nodeChild"}}),U=this.parent.createElement("div",{className:"e-cont"}),_=this.parent.createElement("div",{className:"e-header",innerHTML:n.getConstant("CellReference")}),V=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});V.setAttribute("value","A1"),U.appendChild(V),U.insertBefore(_,V);var z=this.parent.createElement("div",{className:"e-cont"}),q=this.parent.createElement("div",{className:"e-header",innerHTML:n.getConstant("DisplayText")}),j=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});u||(j.classList.add("e-disabled"),j.setAttribute("readonly","true"),j.setAttribute("disabled","true")),p&&t.isNullOrUndefined(p.hyperlink)&&j.setAttribute("value",this.parent.getDisplayText(p)),j.setAttribute("placeholder",n.getConstant("EnterTheTextToDisplay")),z.appendChild(j),z.insertBefore(q,j);var W=this.parent.createElement("div",{className:"e-cont"}),G=this.parent.createElement("div",{className:"e-header",innerHTML:n.getConstant("Sheet")}),Y=this.parent.createElement("div",{className:"e-refcont"});return W.appendChild(Y),W.insertBefore(G,Y),R.appendChild(U),R.insertBefore(z,U),B.appendTo(Y),R.appendChild(W),I},e.prototype.removeHyperlink=function(e){var t=ke(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&("string"==typeof t.hyperlink?t.value=t.value?t.value:t.hyperlink:t.value=t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),t.validation&&t.validation.isHighlighted&&t.style.backgroundColor&&(t.style.color="#ff0000"),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify(In,null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refreshRange([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx])))},e.prototype.removeHyperlinkHandler=function(e){var t,r,n=e.range,i=this.parent.getActiveSheet();if(!e.preventEventTrigger){var o={address:-1===n.indexOf("!")?i.name+"!"+n:n,cancel:!1};if(this.parent.notify(Zt,{action:"removeHyperlink",eventArgs:o}),o.cancel)return}if(n&&-1!==n.indexOf("!")){t=n.split("!");for(var a=this.parent.sheets,s=0;s<a.length;s++)a[s].name===t[0]&&(r=s);i=this.parent.sheets[r],n=t[1]}for(var l,h,d=c(n||i.activeCell),p=d[0];p<=d[2];p++)for(var u=d[1];u<=d[3];u++)if(i&&i.rows[p]&&i.rows[p].cells[u]){if(h=[],l=this.parent.getCell(p,u))for(var f=0;f<l.classList.length;f++)h.push(l.classList[f]);this.parent.notify(Mn,{sheet:i,rowIdx:p,colIdx:u});for(f=0;f<h.length;f++)l.classList.contains(h[f])||l.classList.add(h[f])}e.preventEventTrigger||this.parent.notify(Yo,{action:"removeHyperlink",eventArgs:{address:-1===n.indexOf("!")?i.name+"!"+n:n}})},e}(),kl=function(){return(kl=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},Fl=function(){function e(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return e.prototype.setActionData=function(e){var t,r=this.parent.getActiveSheet(),n=[],i=[],o=e.args,a=o.eventArgs,s={};switch(o.action){case"format":t=c(o.eventArgs.range);break;case"clipboard":s=a.copiedInfo,t=c(C(a.pastedRange)),s&&s.isCut&&(i=this.getCellDetails(s.range,be(this.parent,ge(this.parent,s.sId)),"clipboard"));break;case"beforeSort":(t=c(o.eventArgs.range))[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[2]=r.usedRange.rowIndex,t[3]=r.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":case"cellSave":t=c(a.address);break;case"beforeWrap":case"beforeReplace":case"chartDesign":t=this.parent.getAddressInfo(a.address).indices;break;case"beforeClear":case"beforeInsertImage":t=c(a.range);break;case"deleteImage":t=c(a.address);break;case"beforeInsertChart":case"filter":t=c(a.range);break;case"autofill":t=c(a.fillRange);break;case"removeValidation":t=c(a.range);break;case"hyperlink":case"removeHyperlink":t=c(a.address)}"beforeSort"===o.action?(this.beforeActionData={cellDetails:a.cellDetails},this.beforeActionData.sortedCellDetails=a.sortedCellDetails):(n=this.getCellDetails(t,r,o.action),this.beforeActionData={cellDetails:n,cutCellDetails:i})},e.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},e.prototype.performUndoRedo=function(e){var r;r=e.isFromUpdateAction?e:e.isUndo?this.undoCollection.pop():this.redoCollection.pop(),this.isUndo=e.isUndo;var n;if(r){var i=void 0,o={};if(!e.isPublic){var a=r.eventArgs.beforeActionData;if(delete r.eventArgs.beforeActionData,i={action:r.action,eventArgs:{}},t.extend(i.eventArgs,r.eventArgs,null,!0),r.eventArgs.beforeActionData=a,i.eventArgs.cancel=!1,r.preventAction=i.preventAction=!0,e.isUndo?i.isUndo=!0:i.isRedo=!0,e.isFromUpdateAction||this.parent.notify(Zt,i),i.eventArgs.cancel)return void this.updateUndoRedoIcons();delete i.eventArgs.cancel}switch(r.action){case"cellSave":case"format":case"wrap":case"cellDelete":case"autofill":case"removeValidation":case"hyperlink":case"removeHyperlink":r=this.performOperation(r,e.preventEvt,e.preventReSelect,e.isPublic);break;case"sorting":this.undoForSorting(r,e.isUndo);break;case"clipboard":r=this.undoForClipboard(r,e.isUndo,i),n=!0;break;case"resize":case"resizeToFit":r=this.undoForResize(r);break;case"hideShow":It(r,this.parent,!e.isUndo);break;case"replace":r=this.performOperation(r);break;case"replaceAll":r.eventArgs.isAction=!1,e.isUndo&&(o.value=r.eventArgs.replaceValue,o.replaceValue=r.eventArgs.value),this.parent.notify($r,kl({},r.eventArgs,o));break;case"insert":case"filter":It(r,this.parent,!e.isUndo,null,i),n="filter"===r.action;break;case"delete":It(r,this.parent,!e.isUndo);break;case"validation":case"addHighlight":case"removeHighlight":It(r,this.parent,!e.isUndo);break;case"merge":r.eventArgs.merge=r.isFromUpdateAction?r.eventArgs.merge:!r.eventArgs.merge,It(r,this.parent,!1);break;case"clear":r=this.performOperation(r),e.isUndo&&r.eventArgs.cfClearActionArgs&&It({action:"clearCF",eventArgs:r.eventArgs.cfClearActionArgs},this.parent,!e.isUndo);break;case"conditionalFormat":It(r,this.parent,!e.isUndo,this.undoCollection);break;case"clearCF":It(r,this.parent,!e.isUndo);break;case"insertImage":case"deleteImage":case"imageRefresh":It(r,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":It(r,this.parent,!e.isUndo);break;case"chartDesign":r.eventArgs.isUndo=e.isUndo,this.parent.notify(Ya,r.eventArgs);break;case"addDefinedName":It(r,this.parent,!e.isUndo)}e.isFromUpdateAction||(e.isUndo?this.redoCollection.push(r):this.undoCollection.push(r),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons(),e.isPublic||n||this.parent.notify(Yo,t.extend({isUndoRedo:!0,isUndo:e.isUndo},r))),this.parent.notify(In,null)}},e.prototype.undoForSorting=function(e,r){var n=this,i=S(this.parent,e.eventArgs.range),o=c(e.eventArgs.range),a=function(e,r){if(i===n.parent.activeSheetIndex){var a=n.parent.getCell(o[0]-1,n.parent.sortCollection[e].columnIndex);a&&(a=t.select(".e-filter-icon",a))&&(r?a.classList.add("e-sort"+("Ascending"===n.parent.sortCollection[e].order?"asc":"desc")+"-filter"):a.classList.remove("e-sort"+("Ascending"===n.parent.sortCollection[e].order?"asc":"desc")+"-filter"))}};if(r){if(this.parent.notify(kr,{result:e.eventArgs.beforeActionData.cellDetails,range:o,sheet:be(this.parent,i),jsonData:e.eventArgs.beforeActionData.sortedCellDetails,isUndo:!0}),this.parent.notify(Fr,{range:e.eventArgs.range}),this.parent.sortCollection&&e.eventArgs.previousSort)for(var s=0;s<this.parent.sortCollection.length;s++)if(this.parent.sortCollection[s].sheetIndex===i){a(s,!1),this.parent.sortCollection.splice(s,1),e.eventArgs.previousSort.order?(this.parent.sortCollection.splice(s,0,e.eventArgs.previousSort),a(s,!0)):this.parent.sortCollection.length||(this.parent.sortCollection=void 0);break}}else if(It(e,this.parent,!0),e.eventArgs.previousSort){var l=void 0;if(this.parent.sortCollection){for(s=0;s<this.parent.sortCollection.length;s++)if(this.parent.sortCollection[s].sheetIndex===i){a(s,!1),l=s,this.parent.sortCollection.splice(s,1);break}}else this.parent.sortCollection=[],l=0;this.parent.sortCollection.splice(l,0,{sortRange:e.eventArgs.range.split("!")[1],sheetIndex:i,columnIndex:f(e.eventArgs.sortOptions.sortDescriptors.field),order:e.eventArgs.sortOptions.sortDescriptors.order}),a(l,!0)}},e.prototype.updateUndoRedoCollection=function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete","autofill","addDefinedName","removeValidation","removeHighlight","addHighlight","hyperlink","removeHyperlink","deleteImage","chartDesign","replaceAll"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var r=e.args.action;if(-1!==t.indexOf(r)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===r||"sorting"===r||"format"===r||"cellSave"===r||"wrap"===r||"replace"===r||"validation"===r||"clear"===r||"conditionalFormat"===r||"clearCF"===r||"insertImage"===r||"imageRefresh"===r||"insertChart"===r||"chartRefresh"===r||"filter"===r||"cellDelete"===r||"autofill"===r||"removeValidation"===r||"addDefinedName"===r||"hyperlink"===r||"removeHyperlink"===r||"deleteImage"===r||"chartDesign"===r){var i={beforeDetails:{cellDetails:[]}};this.parent.notify(Uo,i),n.beforeActionData=i.beforeDetails}if("clipboard"===r&&n.copiedInfo&&n.copiedInfo.isExternal){var o=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(o.indices,be(this.parent,o.sheetIndex),r)}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},e.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},e.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(ph);this.parent.notify(Qi,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify(Qi,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},e.prototype.undoForClipboard=function(e,t,r){var n,i=this,o=e.eventArgs,a=o.pastedRange.split("!"),s=c(a[1]),l=fe(this.parent,a[0]),h=be(this.parent,l),d=o.copiedInfo,p=o.beforeActionData,u=e.isFromUpdateAction,f=l===this.parent.activeSheetIndex;if(r&&(r.isUndoRedo=!0,r.eventArgs.beforeActionData=p),"imagePaste"===e.eventArgs.requestType){var g=o.copiedShapeInfo;t?(n=g.pictureElem,g.isCut?(this.parent.notify(Oa,{id:n.id,sheetIdx:o.pasteSheetIndex+1}),this.parent.notify(Da,{options:{src:n.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,imageId:n.id},range:g.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(Oa,{id:o.pastedPictureElement.id,sheetIdx:o.pasteSheetIndex+1})):g.isCut?(n=g.pictureElem,this.parent.notify(Oa,{id:n.id,sheetIdx:g.sId}),this.parent.notify(Da,{options:{src:n.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,imageId:n.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0})):(n=o.pastedPictureElement,this.parent.notify(Da,{options:{src:n.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:n.offsetHeight,width:n.offsetWidth,imageId:n.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(t){if(d.isCut){var m=p.cutCellDetails;this.updateCellDetails(m,be(this.parent,ge(this.parent,d.sId)),w(d.range),f,e),o.cfClearActionArgs&&It({action:"clearCF",eventArgs:o.cfClearActionArgs},this.parent,!1)}p&&this.updateCellDetails(p.cellDetails,h,s,f,e),o.cfActionArgs&&o.cfActionArgs.cfModel.forEach(function(e){It({eventArgs:{range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:o.cfActionArgs.sheetIdx,cancel:!0},action:"conditionalFormat"},i.parent,!1)}),Ot(h,s[0],s[1],Ue(h,s[0]));var v=Mt(h,s[0]);Rt(this.parent,h,v,s[0]),o.mergeCollection.forEach(function(e){e.merge=!e.merge,i.parent.notify(hn,e),e.merge=!e.merge}),r&&!u&&this.parent.notify(Yo,r)}else if(d.isExternal){var C=this.parent.getAddressInfo(o.pastedRange);this.updateCellDetails(d.cellDetails,be(this.parent,C.sheetIndex),C.indices,!0,e),r&&!u&&this.parent.notify(Yo,r)}else{var x=new Promise(function(e){e(void 0)});C=this.parent.getAddressInfo(o.copiedRange);this.parent.notify(o.copiedInfo.isCut?to:ro,{range:C.indices,sId:be(this.parent,C.sheetIndex).id,promise:x,invokeCopy:!0,isPublic:!0,isFromUpdateAction:u}),x.then(function(){i.parent.notify(no,{range:a?y(o.pastedRange):a,sIdx:a?fe(i.parent,me(o.pastedRange)):a,type:o.type,isAction:!1,isInternal:!0,isFromUpdateAction:u}),r&&!u&&i.parent.notify(Yo,r)})}f&&!u?(this.parent.notify(eo,{address:a[1]}),this.parent.notify(ss,{})):this.checkRefreshNeeded(l,u)}return e},e.prototype.undoForResize=function(e){var t=e.eventArgs;if(void 0===t.hide)if(t.isCol){var r=t.oldWidth;t.oldWidth=t.width,t.width=r}else{r=t.oldHeight;t.oldHeight=t.height,t.height=r}else t.hide=!t.hide;It(e,this.parent,!1);var n=this.parent.getActiveSheet(),i=c(n.activeCell),o=ke(i[0],i[1],n);if(o&&o.rowSpan){var a=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.height=a.offsetHeight+"px"}else if(o&&o.colSpan){a=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.width=a.offsetWidth+"px"}return e},e.prototype.performOperation=function(e,r,n,i){var o=e.eventArgs,a=[],s=w(c((a="autofill"===e.action?o.fillRange.split("!"):"cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action||"hyperlink"===e.action||"removeHyperlink"===e.action?o.address.split("!"):o.range.split("!"))[1])),l=s,h=fe(this.parent,a[0]),d=be(this.parent,h),p=o.beforeActionData,u=e.isFromUpdateAction,f=this.checkRefreshNeeded(h,u),v={cellIdx:[s[0],s[1]],isUnique:!1,uniqueRange:""};if(this.parent.notify(wr,v),this.isUndo){if(v.isUnique&&o.formula&&o.formula.indexOf("UNIQUE")>-1){if("#SPILL!"!==ke((x=c(v.uniqueRange))[0],x[1],this.parent.getActiveSheet()).value)for(var y=x[0];y<=x[2];y++)for(var C=x[1];C<=x[3];C++)y===x[0]&&C===x[1]&&(C+=1),this.parent.updateCell({value:""},m([y,C]))}if(this.updateCellDetails(p.cellDetails,d,s,f,e,r),v.isUnique&&"cellDelete"===e.action&&o.isSpill){for(var x,b=ke((x=c(v.uniqueRange))[0],x[1],this.parent.getActiveSheet()),S=x[0];S<=x[2];S++)for(y=x[1];y<=x[3];y++)for(C=s[0];C<=s[2];C++)for(var I=s[1];I<=s[3];I++)S===C&&y===I||this.parent.updateCell({value:""},g(S,y));b.value="#SPILL!",this.parent.updateCell(b,g(x[0],x[1]))}if(!o.isSpill&&""!==v.uniqueRange){var E=c(v.uniqueRange);for(y=E[0];y<=E[2];y++)for(C=E[1];C<=E[3];C++)y===E[0]&&C===E[1]&&(C+=1),this.parent.updateCell({value:""},m([y,C]));this.parent.notify(Ir,null)}}else{var R=e.eventArgs,A=c(d.activeCell),k=this.parent.getCellStyleValue(["textDecoration"],A).textDecoration;if(R&&R.style&&R.style.textDecoration){var F=R.style.textDecoration,T=F,L=void 0,N=!1;"underline"===k?T="underline"===F?"none":"underline line-through":"line-through"===k?T="line-through"===F?"none":"underline line-through":"underline line-through"===k&&(T="underline"===F?"line-through":"underline",N=!0),"none"===T&&(N=!0),R.style.textDecoration=T,e.eventArgs=R,this.parent.notify(ar,{style:{textDecoration:T},range:A,refreshRibbon:!0,onActionUpdate:!0});for(S=l[0];S<=l[2];S++)for(y=l[1];y<=l[3];y++)if(S!==A[0]||y!==A[1]){if(L={},"none"===(k=this.parent.getCellStyleValue(["textDecoration"],[S,y]).textDecoration)){if(N)continue;L.textDecoration=F}else if("underline"===k||"line-through"===k)if(N){if(F!==k)continue;L.textDecoration="none"}else L.textDecoration=F!==k?"underline line-through":F;else if("underline line-through"===k){if(!N)continue;L.textDecoration="underline"===F?"line-through":"underline"}this.parent.notify(ar,{style:{textDecoration:L.textDecoration},range:[S,y,S,y],refreshRibbon:!0,onActionUpdate:!0})}R.style.textDecoration=F,e.eventArgs=R}else{if(!t.isNullOrUndefined(o.oldValue)&&o.oldValue!==o.value&&v.isUnique){var D=c(v.uniqueRange);if("#SPILL!"!==ke(D[0],D[1],this.parent.getActiveSheet()).value)for(y=D[0];y<=D[2];y++)for(C=D[1];C<=D[3];C++)y===D[0]&&C===D[1]&&(this.parent.updateCell({value:"#SPILL!"},m([D[0],D[1]])),C+=1),this.parent.updateCell({value:""},m([y,C]))}if(It(e,this.parent,!0),v.isUnique&&"cellDelete"===e.action&&o.isSpill){var O=c(v.uniqueRange),M=!1;for(S=O[0];S<=O[1];S++)for(y=O[1];y<=O[3];y++)S===O[0]&&y===O[1]&&y++,ke(S,y,d)&&!t.isNullOrUndefined(ke(S,y,d).value)&&""!==ke(S,y,d).value&&(M=!0);if(!M){(b=ke(O[0],O[1],this.parent.getActiveSheet())).value="",this.parent.updateCell(b,g(O[0],O[1])),this.parent.notify(Ir,null)}}}}return"autofill"===e.action&&(a[1]=this.isUndo?e.eventArgs.dataRange:e.eventArgs.selectedRange),!f||n||u||this.parent.notify(eo,{address:a[1]}),this.parent.notify(ma,{}),e},e.prototype.getCellDetails=function(e,r,n){for(var i,o=[],a="cellDelete"===n,s=(e=w(e))[0];s<=e[2];s++)if(!a||!Be(r,s))for(var l=e[1];l<=e[3];l++)i=ke(s,l,r),o.push({rowIndex:s,colIndex:l,format:i?i.format:null,isLocked:i?i.isLocked:null,style:i&&i.style?Object.assign({},i.style):null,value:i?i.value:"",formula:i?i.formula:"",wrap:i&&i.wrap,rowSpan:i&&i.rowSpan,colSpan:i&&i.colSpan,hyperlink:i&&(t.isObject(i.hyperlink)?t.extend({},i.hyperlink):i.hyperlink),image:i&&i.image,chart:i&&i.chart&&JSON.parse(JSON.stringify(i.chart)),validation:i&&i.validation});return o},e.prototype.updateCellDetails=function(e,r,n,i,o,a){for(var s,l,h,d,p,c=this,u=e.length,f=o&&!a&&("cellSave"===o.action||"cellDelete"===o.action||"autofill"===o.action||"clipboard"===o.action),v=o&&!o.eventArgs.cfClearActionArgs&&r.conditionalFormats&&r.conditionalFormats.length&&[].slice.call(r.conditionalFormats),y=[],C=0;C<u;C++)(l=ke(e[C].rowIndex,e[C].colIndex,r,!1,!0)).style&&o&&("format"===o.action||"clipboard"===o.action)&&(!l.style.borderTop||e[C].style&&e[C].style.borderTop||this.parent.setBorder({borderTop:""},r.name+"!"+g(e[C].rowIndex,e[C].colIndex)),!l.style.borderLeft||e[C].style&&e[C].style.borderLeft||this.parent.setBorder({borderLeft:""},r.name+"!"+g(e[C].rowIndex,e[C].colIndex)),!l.style.fontSize||e[C].style&&e[C].style.fontSize||(l.style.fontSize="11pt",h=!0,this.parent.notify(hr,{style:{fontSize:"11pt"},rowIdx:e[C].rowIndex,colIdx:e[C].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})),!l.style.fontFamily||e[C].style&&e[C].style.fontFamily||(h=!0,l.style.fontFamily="Calibri",this.parent.notify(hr,{style:{fontFamily:"Calibri"},rowIdx:e[C].rowIndex,colIdx:e[C].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0}))),Fe(e[C].rowIndex,e[C].colIndex,r,{value:e[C].formula&&e[C].formula.toUpperCase().includes("UNIQUE")?null:e[C].value,format:e[C].format,isLocked:e[C].isLocked,style:e[C].style&&Object.assign({},e[C].style),formula:e[C].formula,wrap:e[C].wrap,rowSpan:e[C].rowSpan,colSpan:e[C].colSpan,hyperlink:e[C].hyperlink,validation:e[C]&&e[C].validation}),p={action:"updateCellValue",address:[e[C].rowIndex,e[C].colIndex,e[C].rowIndex,e[C].colIndex],value:e[C].formula?e[C].formula:e[C].value,sheetIndex:fe(this.parent,r.name)},this.parent.notify(cr,p),v&&!d&&(d=p.isFormulaDependent),(o&&"wrap"===o.action&&o.eventArgs.wrap||l.wrap&&!e[C].wrap)&&this.parent.notify(Hr,{range:[e[C].rowIndex,e[C].colIndex,e[C].rowIndex,e[C].colIndex],wrap:!1,sheet:r}),o&&e[C].hyperlink&&"clear"===o.action&&(o.eventArgs.range=r.name+"!"+m([e[C].rowIndex,e[C].colIndex,e[C].rowIndex,e[C].colIndex]),s=this.parent.getCell(e[C].rowIndex,e[C].colIndex),"Clear All"===o.eventArgs.type||"Clear Hyperlinks"===o.eventArgs.type?this.parent.addHyperlink(e[C].hyperlink,o.eventArgs.range,e[C].value):"Clear Formats"===o.eventArgs.type&&t.addClass(s.querySelectorAll(".e-hyperlink"),"e-hyperlink-style")),f&&e[C].value!==l.value&&this.parent.trigger("cellSave",{element:null,value:e[C].value,oldValue:l.value,formula:e[C].formula,cancel:!1,address:r.name+"!"+g(e[C].rowIndex,e[C].colIndex),displayText:this.parent.getDisplayText(e[C])}),v&&!d&&he(v,y,e[C].rowIndex,e[C].colIndex);i&&(this.parent.serviceLocator.getService("cell").refreshRange(n,!1,!1,!0),(y.length||d)&&this.parent.notify(vn,{cfModel:!d&&y,refreshAll:d,isAction:!0}),h&&Ke(function(){return c.parent.selectRange(r.selectedRange)}))},e.prototype.checkRefreshNeeded=function(e,t){var r=!0;return e!==this.parent.activeSheetIndex&&(t||(this.parent.activeSheetIndex=e,this.parent.dataBind()),r=!1),r},e.prototype.addEventListener=function(){this.parent.on(Po,this.performUndoRedo,this),this.parent.on(Ho,this.updateUndoRedoCollection,this),this.parent.on(Bo,this.setActionData,this),this.parent.on(Uo,this.getBeforeActionData,this),this.parent.on(_o,this.clearUndoRedoCollection,this),this.parent.on(ha,this.updateUndoRedoIcons,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Po,this.performUndoRedo),this.parent.off(Ho,this.updateUndoRedoCollection),this.parent.off(Bo,this.setActionData),this.parent.off(Uo,this.getBeforeActionData),this.parent.off(_o,this.clearUndoRedoCollection),this.parent.off(ha,this.updateUndoRedoIcons))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"undoredo"},e}(),Tl=function(){function e(e){this.parent=e,this.wrapCell=this.parent.createElement("span",{className:"e-wrap-content"}),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Zi,this.ribbonClickHandler,this),this.parent.on(Hr,this.wrapTextHandler,this),this.parent.on(yo,this.rowHeightChangedHandler,this),this.parent.on(Co,this.colWidthChanged,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Zi,this.ribbonClickHandler),this.parent.off(Hr,this.wrapTextHandler),this.parent.off(yo,this.rowHeightChangedHandler),this.parent.off(Co,this.colWidthChanged))},e.prototype.wrapTextHandler=function(e){if(e.initial||tt(this.parent,e.range,!0)){for(var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,l=void 0,h=void 0,d=e.range[0];d<=e.range[2];d++){o=0,s=(l=Me(e.sheet,d).customHeight)||e.isCustomHgt;for(var p=e.range[1];p<=e.range[3];p++)if(!((n=ke(d,p,e.sheet,null,!0)).rowSpan<0||n.colSpan<0)){var c=n.rowSpan>1||n.colSpan>1;if((r=e.initial?e.td:this.parent.getCell(d,p))?(e.wrap?(h=kt(n.style&&n.style.fontFamily?n.style:this.parent.cellStyle),r.classList.add(dh)):(r.classList.remove(dh),h=null),(s||c)&&this.updateWrapCell(d,p,e.sheet,r)):h=null,t.Browser.isIE&&r.classList.add("e-ie-wrap"),!s&&!c){i=Nt(e.sheet,d,p,n.colSpan>1?p+n.colSpan-1:p);if((x=this.parent.getDisplayText(n).toString()).indexOf("\n")<0){var u=this.parent.element.querySelector(".e-spreadsheet-edit");u&&u.textContent.indexOf("\n")>-1&&(x=u.textContent)}if(x)if(e.wrap){r&&r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap");var f=void 0,g=0,m=void 0;if(x.indexOf("\n")>-1){var v=x.split("\n"),y=v.length;for(m=0;m<y;m++)0===(f=Tt(v[m],i,n.style,this.parent.cellStyle))&&(f=1),g+=f;f=g}else f=Tt(x,i,n.style,this.parent.cellStyle);if(a=Dt(this.parent,d,p,e.sheet,n.style||this.parent.cellStyle,f,h),o=Math.max(o,a),n.rowSpan>1){var C=Ve(e.sheet,d,d+(n.rowSpan-1));if(C>=o)return;a=o=Ue(e.sheet,d)+(o-C)}Ot(e.sheet,d,p,a)}else x.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap"),a=Dt(this.parent,d,p,e.sheet,n.style||this.parent.cellStyle,1,h),Ot(e.sheet,d,p,a),o=Math.max(Mt(e.sheet,d),20);else e.wrap&&x||(Ot(e.sheet,d,p,20),o=Math.max(Mt(e.sheet,d),20));p===e.range[3]&&(e.wrap&&o>20&&Mt(e.sheet,d)<=o||(!e.wrap||!x)&&Mt(e.sheet,d)<Ue(e.sheet,d)&&Ue(e.sheet,d)>20)&&Rt(this.parent,e.sheet,o,d,e.row,e.hRow)}if(s&&!c){var x=this.parent.getDisplayText(n);e.wrap?r&&r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap"):x.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap")}e.wrap&&r?l?r.style.lineHeight&&(r.style.lineHeight=""):r.style.lineHeight=parseFloat(n.style&&n.style.fontSize||this.parent.cellStyle.fontSize)*h+"pt":r&&(r.style.lineHeight="")}}e.initial||this.parent.notify(ss,null)}},e.prototype.ribbonClickHandler=function(e){var r=t.closest(e.originalEvent.target,".e-btn");if(r&&r.id===this.parent.element.id+"_wrap"){var n=r.classList.contains("e-active"),i=x(this.parent.getActiveSheet()),o={address:i,wrap:n,cancel:!1};this.parent.notify(Zt,{action:"beforeWrap",eventArgs:o}),o.cancel||(Le(this.parent.getActiveSheet().selectedRange,n,this.parent),this.parent.notify(Yo,{action:"wrap",eventArgs:{address:i,wrap:n}}))}},e.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt)for(var t=this.parent.getActiveSheet(),r=void 0,n=this.parent.viewport.leftIndex,i=this.parent.viewport.rightIndex;n<=i;n++)ke(e.rowIdx,n,t,!1,!0).wrap&&(r=this.parent.getCell(e.rowIdx,n),this.updateWrapCell(e.rowIdx,n,t,r),r.style.lineHeight&&(r.style.lineHeight=""))},e.prototype.colWidthChanged=function(e){if(e.checkWrapCell)for(var t=this.parent.getActiveSheet(),r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex;r<=n;r++)ke(r,e.colIdx,t,!1,!0).wrap&&this.updateWrapCell(r,e.colIdx,t,this.parent.getCell(r,e.colIdx))},e.prototype.updateWrapCell=function(e,t,r,n){if(n&&!n.querySelector(".e-wrap-content")){for(var i=this.wrapCell.cloneNode(),o=n.querySelector(".e-filter-btn");n.childElementCount;)i.appendChild(n.firstElementChild);if(o&&(n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o)),!ke(e,t,r,!1,!0).hyperlink){var a=n.lastChild;a&&3===a.nodeType?(i.appendChild(document.createTextNode(a.textContent)),a.textContent=""):(i.appendChild(document.createTextNode(n.textContent)),n.textContent="")}n.appendChild(i)}},e.prototype.getModuleName=function(){return"wrapText"},e.prototype.destroy=function(){this.removeEventListener(),this.wrapCell=null,this.parent=null},e}(),Ll=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insert=function(e){var t=e.eventArgs;this.parent.notify(Dn,t);var r=be(this.parent,t.activeSheetIndex);switch(t.modelType){case"Sheet":this.parent.notify(Xi,{startIdx:t.index,endIdx:t.index+(t.model.length-1),preventUpdate:!t.isAction}),this.parent.renderModule.refreshSheet();break;case"Row":if(t.activeSheetIndex===this.parent.activeSheetIndex){var n=this.parent.frozenRowCount(r);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.bottomIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){var i=this.parent.frozenColCount(r);if(t.index>=this.parent.viewport.topIndex+n){var o=[],a=void 0;i?(a=u(r.topLeftCell)[1],o.push(n),o.push(this.parent.viewport.leftIndex+i)):a=this.parent.viewport.leftIndex;var s=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:a,refresh:"Row",frozenIndexes:o,skipUpdateOnFirst:this.parent.viewport.topIndex+n===re(r,n,!0)}),i&&(this.parent.viewport.leftIndex=s)}var l=u(r.paneTopLeftCell)[0];t.index<l&&(this.parent.notify(ms,{scrollTop:Ve(r,n,l-1,!0)}),this.parent.goTo(g(t.index,re(r,i,!0,"columns")))),this.parent.selectRange(r.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Row"}),this.parent.selectRange(r.selectedRange);else!this.parent.scrollSettings.isFinite||this.parent.viewport.topIndex+n!==re(r,0,!0)&&this.parent.viewport.bottomIndex!==re(r,r.rowCount-t.model.length-1,!1)||this.parent.renderModule.refreshSheet(!1,!1,!0)}break;case"Column":if(t.activeSheetIndex===this.parent.activeSheetIndex){i=this.parent.frozenColCount(r);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.rightIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){n=this.parent.frozenRowCount(r);if(t.index>=this.parent.viewport.leftIndex+i){o=[];n&&(o=[n+this.parent.viewport.topIndex,i]);var h=n?u(r.topLeftCell)[0]:this.parent.viewport.topIndex,d=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+i===re(r,i,!0,"columns"),rowIndex:h,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:o}),n&&(this.parent.viewport.topIndex=d)}var p=u(r.paneTopLeftCell)[1];t.index<p&&(this.parent.notify(ms,{scrollLeft:We(r,0,p-1,!0)}),this.parent.goTo(g(re(r,n,!0),t.index))),this.parent.selectRange(r.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(r.selectedRange);else!this.parent.scrollSettings.isFinite||this.parent.viewport.leftIndex+i!==re(r,0,!0,"columns")&&this.parent.viewport.rightIndex!==re(r,r.colCount-t.model.length-1,!1,"columns")||this.parent.renderModule.refreshSheet(!1,!1,!0)}}this.refreshImgElement(t.model.length,this.parent.activeSheetIndex,t.modelType,t.index),t.isAction?(delete t.isAction,this.parent.notify(Yo,e)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify(Xt,e))},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,o=this.parent.sheets[t],a=[0,0,o.usedRange.rowIndex,o.usedRange.colIndex],s=0;s<=a[2];s++)for(var l=a[1];l<=a[3];l++)(i=ke(s,l,o))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify(Ha,{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"insert"})},e.prototype.addEventListener=function(){this.parent.on(Ur,this.insert,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ur,this.insert)},e.prototype.getModuleName=function(){return"insert"},e}(),Nl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.delete=function(e){var t=e.eventArgs;if("Sheet"===t.modelType){var r=t.activeSheetIndex>=t.startIndex&&t.activeSheetIndex<=t.endIndex;r&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(t.startIndex<this.parent.sheets.length?t.startIndex:t.startIndex?t.startIndex-1:0)},!0),this.parent.notify(Fi,null),r&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else if(t.activeSheetIndex===this.parent.activeSheetIndex){var n=this.parent.getActiveSheet();if("Row"===t.modelType){if(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.bottomIndex)if(this.parent.scrollSettings.enableVirtualization){var i=this.parent.frozenRowCount(n);if(t.startIndex<u(n.paneTopLeftCell)[0])this.parent.updateTopLeftCell(re(n,t.startIndex-1<i?i:t.startIndex-1,!0)-i,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else{var o=[],a=this.parent.frozenColCount(n),s=void 0,l=this.parent.viewport.leftIndex;a?(o.push(i),o.push(l+a),s=u(n.topLeftCell)[1]):s=l,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:s,skipUpdateOnFirst:this.parent.viewport.topIndex+i===re(n,i,!0),frozenIndexes:o}),a&&(this.parent.viewport.leftIndex=l),this.parent.selectRange(n.selectedRange)}}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:this.parent.viewport.topIndex,colIndex:0}),this.parent.selectRange(n.selectedRange)}else{if(!1!==t.refreshSheet&&(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.rightIndex)){a=this.parent.frozenColCount(n);if(this.parent.scrollSettings.enableVirtualization)if(t.startIndex<u(n.paneTopLeftCell)[1])this.parent.updateTopLeftCell(null,re(n,t.startIndex-1<a?a:t.startIndex-1,!0,"columns")-a,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane||!0===t.refreshSheet)this.parent.renderModule.refreshSheet(!1,!1,!0);else{i=this.parent.frozenRowCount(n),o=[];var h=this.parent.viewport.topIndex,d=i?u(n.topLeftCell)[0]:h;i&&(o=[i+h,a]),this.parent.renderModule.refreshUI({rowIndex:d,refresh:"Column",colIndex:this.parent.viewport.leftIndex,insertDelete:!0,skipUpdateOnFirst:this.parent.viewport.leftIndex+a===re(n,a,!0,"columns"),frozenIndexes:o}),i&&(this.parent.viewport.topIndex=h),this.parent.selectRange(n.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:this.parent.viewport.leftIndex,insertDelete:!0}),this.parent.selectRange(n.selectedRange)}delete t.refreshSheet}}this.refreshImgElement(t.deletedModel.length,this.parent.activeSheetIndex,t.modelType,t.startIndex),t.isAction?(delete t.isAction,this.parent.notify(Yo,e)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify(Xt,e))},e.prototype.addEventListener=function(){this.parent.on(_r,this.delete,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(_r,this.delete)},e.prototype.getModuleName=function(){return"delete"},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,o=this.parent.sheets[t],a=[0,0,o.usedRange.rowIndex,o.usedRange.colIndex],s=0;s<=a[2];s++)for(var l=a[1];l<=a[3];l++)(i=ke(s,l,o))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify(Ha,{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"delete"})},e}(),Dl=function(){function e(e){this.data=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener();var e=t.select("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null},e.prototype.addEventListener=function(){t.EventHandler.add(this.parent.element,"dblclick",this.listOpen,this),this.parent.on(Jo,this.initiateDataValidationHandler,this),this.parent.on(ea,this.invalidDataHandler,this),this.parent.on(qr,this.checkDataValidation,this),this.parent.on(gr,this.listHandler,this),this.parent.on(Bi,this.keyUpHandler,this),this.parent.on(ga,this.removeValidationHandler,this),this.parent.on(Ln,this.InvalidElementHandler,this)},e.prototype.removeEventListener=function(){t.EventHandler.remove(this.parent.element,"dblclick",this.listOpen),this.parent.isDestroyed||(this.parent.off(Jo,this.initiateDataValidationHandler),this.parent.off(ea,this.invalidDataHandler),this.parent.off(qr,this.checkDataValidation),this.parent.off(gr,this.listHandler),this.parent.off(Bi,this.keyUpHandler),this.parent.off(ga,this.removeValidationHandler),this.parent.off(Ln,this.InvalidElementHandler))},e.prototype.removeValidationHandler=function(e){var t,r;if(e.range&&e.range.includes("!")){if(r=e.range,!(t=be(this.parent,fe(this.parent,r.split("!")[0]))))return}else r=(t=this.parent.getActiveSheet()).name+"!"+(e.range||this.getRange(t.selectedRange));var n={range:r,cancel:!1};if(e.isAction&&this.parent.notify(Zt,{eventArgs:n,action:"removeValidation"}),!n.cancel){var i=void 0,o=void 0,a=c(t.activeCell);if(t.name===this.parent.getActiveSheet().name){var s=w(c(r));a[0]>=s[0]&&a[1]>=s[1]&&a[0]<=s[2]&&a[1]<=s[3]&&(i=(o=ke(a[0],a[1],t,!1,!0)).validation&&"List"===o.validation.type)}if(this.parent.notify(jr,{range:r,isRemoveValidation:!0}),i&&!o.validation){var l=this.parent.getCell(a[0],a[1]);l&&l.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),l.removeChild(l.getElementsByClassName("e-validation-list")[0]))}e.isAction&&(delete n.cancel,this.parent.notify(Yo,{eventArgs:n,action:"removeValidation"}))}},e.prototype.keyUpHandler=function(e){var r=e.target,n=this.parent.element.querySelector(".e-datavalidation-dlg");if(t.closest(r,".e-values")&&n&&13!==e.keyCode){var i=n.querySelector(".e-values"),o=i.querySelector(".e-dlg-error"),a=n.querySelector(".e-footer-content").querySelector(".e-primary");a.hasAttribute("disabled")&&a.removeAttribute("disabled"),o&&i.removeChild(o)}},e.prototype.listOpen=function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.listObj.showPopup()},e.prototype.invalidDataHandler=function(e){var t={range:e.range||this.parent.dataValidationRange,cancel:!1};if(t.range){var r;!e.isPublic&&(r={eventArgs:t,action:e.isRemoveHighlight?"removeHighlight":"addHighlight"},this.parent.notify(Zt,r),t.cancel)||(e.isRemoveHighlight?this.parent.removeInvalidHighlight(t.range):this.parent.addInvalidHighlight(t.range),e.isPublic||this.parent.notify(Yo,r))}},e.prototype.listHandler=function(){var e=this;if(this.parent.allowDataValidation){var r=this.parent.getActiveSheet(),n=u(r.activeCell),i=ke(n[0],n[1],r),o=this.parent.getCell(n[0],n[1]);if(!o)return;document.getElementsByClassName("e-validation-list")[0]&&(t.remove(document.getElementsByClassName("e-validation-list")[0]),this.data=[]);var a=i&&i.validation||r.columns&&r.columns[n[1]]&&r.columns[n[1]].validation;if(a&&"List"===a.type){if(a.address&&!Z(a.address,n[0],n[1]))return;if(a.ignoreBlank=!!t.isNullOrUndefined(a.ignoreBlank)||a.ignoreBlank,a.inCellDropDown=!!t.isNullOrUndefined(a.inCellDropDown)||a.inCellDropDown,a.inCellDropDown){var s=this.parent.createElement("div",{className:"e-validation-list"}),h=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});s.appendChild(h),a.inCellDropDown||(s.style.display="none");var d=o.getElementsByClassName("e-wrap-content")[0]||o;d.insertBefore(s,d.firstChild);var p=this.updateDataSource(i,a);this.listObj=new l.DropDownList({index:this.setDropDownListIndex(p,i),dataSource:p,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:function(){return e.listValueChange(e.listObj.text)},open:function(n){if(n.popup.offsetX=4-(o.offsetWidth-20),n.popup.offsetY=-13,n.popup.element.style.width=o.offsetWidth-1+"px",t.Browser.isDevice&&e.parent.scrollModule){var i=e.parent.scrollModule.offset,a=e.parent.viewport;n.popup.offsetY+=a.topIndex?i.top.size-Ve(r,a.topIndex+1,i.top.idx,!0):0,n.popup.offsetX+=a.leftIndex?i.left.size-We(r,a.leftIndex+1,i.left.idx,!0):0,n.popup.refresh()}},close:function(){return Pt(e.parent.element)}}),this.listObj.appendTo("#"+this.parent.element.id+"listValid")}}i&&i.validation&&(i.validation=a)}},e.prototype.setDropDownListIndex=function(e,t){if(t&&t.value)for(var r=0,n=e.length;r<n;r++)if(e[r].text===t.value.toString())return r;return null},e.prototype.updateDataSource=function(e,t){var r=this;this.data=[];var n=0,i=this.parent.definedNames,o=t.value1,a=-1!==o.indexOf("=");if(i.length>0&&a)for(var s=o.split("=")[1],l=0,h=i.length;l<h;l++)if(i[l].name===s){for(var d=i[l].refersTo;d.includes("'");)d=d.replace("'","");o=d}if(a){var p=o.indexOf("!")>-1?be(this.parent,fe(this.parent,o.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),u=o.indexOf("!")>-1?o.split("!")[1]:o.split("=")[1],f=this.parent.getActiveSheet();if(p.name!==f.name){var g,m=c(f.selectedRange);p.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(g=!0)}),g&&(this.parent.showSpinner(),pe(this.parent,p.name+"!"+u).then(function(){if(r.parent.hideSpinner(),f.name===r.parent.getActiveSheet().name){var n=c(r.parent.getActiveSheet().selectedRange);n[0]===m[0]&&n[1]===m[1]&&(r.listObj.dataSource=r.updateDataSource(e,t),r.listObj.dataBind())}}))}var v=void 0,y=u.split(":");if(y[0].match(/[a-z]+$/gi)&&y[1].match(/[a-z]+$/gi)||y[0].match(/^[0-9]/g)&&y[1].match(/^[0-9]/g)){var C=this.parent.getIndexes(u);v=C.isCol?[0,C.startIdx,p.usedRange.rowIndex,C.startIdx]:[C.startIdx,0,C.startIdx,p.usedRange.colIndex]}else v=c(u);for(var x=v[0];x<=v[2];x++){p.rows[x]||Pe(p,x,{});for(var b=v[1];b<=v[3];b++){p.rows[x].cells||Fe(x,b,p,{}),n+=1,e=p.rows[x].cells[b];var S=this.parent.getDisplayText(e)||"";this.data.push({text:S,id:"list-"+n})}}}else{var w=o.split(",");for(l=0;l<w.length;l++)n+=1,this.data.push({text:w[l],id:"list-"+n})}return this.data},e.prototype.listValueChange=function(e){this.parent.notify(Pi,{action:"refreshFormulabar",value:e});var t=this.parent.getActiveSheet(),r=y(t.activeCell),n=Object.assign({},ke(r[0],r[1],t));t.isProtected&&ee(n,ze(t,r[1]))?this.parent.notify(la,null):(this.parent.isEdit&&this.parent.closeEdit(),oe(this.parent,t,{cell:{value:e},rowIdx:r[0],colIdx:r[1],valChange:!0,lastCell:!0,uiRefresh:!0,checkCF:!0}),this.parent.notify(Yo,{action:"cellSave",eventArgs:{value:e,oldValue:n.value,address:t.name+"!"+t.activeCell}}))},e.prototype.getRange=function(e){var t=c(e),r=this.parent.getActiveSheet(),n=r.rowCount,i=r.colCount;return t[2]===n-1&&0===t[0]?e=e.replace(/[0-9]/g,""):t[3]===i-1&&0===t[2]&&(e=e.replace(/\D/g,"")),e},e.prototype.initiateDataValidationHandler=function(e,r){var n,i,o,a,s,l=this,h=this.parent.serviceLocator.getService(ph),d=!0,p=!0,u=!0,f=this.parent.getActiveSheet(),g=f.selectedRange,m=w(c(g));g=this.getRange(g);var v=this.validateRange(m,f);if(!v.extendValidation&&!v.moreValidation||e){for(var y=m[0];y<=m[2];y++)if(f.rows[y])for(var C=m[1];C<=m[3];C++)f.rows[y].cells&&f.rows[y].cells[C]&&(s=f.rows[y].cells[C]).validation&&(u=!1,n=s.validation.type,i=s.validation.operator,o=s.validation.value1,a=s.validation.value2,d=t.isNullOrUndefined(s.validation.ignoreBlank)?d:s.validation.ignoreBlank,p=t.isNullOrUndefined(s.validation.inCellDropDown)?p:s.validation.inCellDropDown);if(u)for(var x=m[1];x<=m[3];x++){var b=ze(f,x);b&&b.validation&&(u=!1,n=b.validation.type,i=b.validation.operator,o=b.validation.value1,a=b.validation.value2,d=t.isNullOrUndefined(b.validation.ignoreBlank)?d:b.validation.ignoreBlank,p=t.isNullOrUndefined(b.validation.inCellDropDown)?p:b.validation.inCellDropDown)}if(!this.parent.element.querySelector(".e-datavalidation-dlg")){var S=this.parent.serviceLocator.getService(ch);S.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:h.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(e){var t={dialogName:"ValidationDialog",element:e.element,target:e.target,cancel:e.cancel};l.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),r&&(u=!0),S.dialogInstance.content=l.dataValidationContent(u,n,i,o,a,d,p,g),S.dialogInstance.dataBind(),Pt(l.parent.element)},buttons:[{buttonModel:{content:h.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){S.dialogInstance.content=l.dataValidationContent(!0,n,i,o,a,d,p,g),S.dialogInstance.dataBind(),Pt(l.parent.element)}},{buttonModel:{content:h.getConstant("APPLY"),isPrimary:!0},click:function(){l.dlgClickHandler(S)}}]}),S.dialogInstance.refresh()}}else v.moreValidation&&this.moreValidationDlg(),v.extendValidation&&this.extendValidationDlg()},e.prototype.dataValidationContent=function(e,t,r,n,i,o,h,d){var p=this,c=this.parent.serviceLocator.getService(ph),u=e?"0":n,f=e?"0":i,g=this.parent.createElement("div",{className:"e-validation-dlg"}),m=this.parent.createElement("div",{className:"e-cellrange"}),v=this.parent.createElement("div",{className:"e-allowdata"}),y=this.parent.createElement("div",{className:"e-values"}),C=this.parent.createElement("div",{className:"e-ignoreblank"});g.appendChild(m),g.appendChild(v),g.appendChild(y),g.appendChild(C);var x=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("CellRange")}),b=this.parent.createElement("input",{className:"e-input",attrs:{value:d,"aria-label":c.getConstant("CellRange")}});m.appendChild(x),m.appendChild(b);var S=this.parent.createElement("div",{className:"e-allow"}),w=this.parent.createElement("div",{className:"e-data"});v.appendChild(S),v.appendChild(w);var I=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Allow")});this.typeData=[{text:c.getConstant("WholeNumber"),id:"type-1"},{text:c.getConstant("Decimal"),id:"type-2"},{text:c.getConstant("Date"),id:"type-3"},{text:c.getConstant("Time"),id:"type-4"},{text:c.getConstant("TextLength"),id:"type-5"},{text:c.getConstant("List"),id:"type-6"}],this.operatorData=[{text:c.getConstant("Between"),id:"operator-1"},{text:c.getConstant("NotBetween"),id:"operator-2"},{text:c.getConstant("EqualTo"),id:"operator-3"},{text:c.getConstant("NotEqualTo"),id:"operator-4"},{text:c.getConstant("Greaterthan"),id:"operator-5"},{text:c.getConstant("Lessthan"),id:"operator-6"},{text:c.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:c.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var E=this.parent.createElement("input",{className:"e-select"}),R=0;if(!e)for(var A=0;A<this.typeData.length;A++)if(t===this.typeData[A].text.replace(" ","")){R=A;break}if(e||"List"!==t){var k=0,F=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Data")}),T=this.parent.createElement("input",{className:"e-select"});if(!e)for(A=0;A<this.operatorData.length;A++)if(r===this.FormattedValue(this.operatorData[A].text)){k=A;break}w.appendChild(F),w.appendChild(T),this.dataList=new l.DropDownList({dataSource:this.operatorData,index:k,popupHeight:"200px",change:function(){p.userInput(N,p.dataList)}}),this.dataList.appendTo(T)}else{var L=this.parent.createElement("input",{className:"e-checkbox"});w.appendChild(L);new s.CheckBox({label:c.getConstant("InCellDropDown"),checked:h}).appendTo(L)}S.appendChild(I),S.appendChild(E);var N=new l.DropDownList({dataSource:this.typeData,index:R,popupHeight:"200px",change:function(){p.userInput(N,p.dataList)}});if(N.appendTo(E),e||"List"!==N.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){var D=this.parent.createElement("div",{className:"e-minimum"}),O=this.parent.createElement("div",{className:"e-maximum"});y.appendChild(D),y.appendChild(O);var M=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Minimum")}),P=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Maximum")}),H=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:u,"aria-label":c.getConstant("Minimum")}}),B=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:f,"aria-label":c.getConstant("Maximum")}});D.appendChild(M),D.appendChild(H),O.appendChild(P),O.appendChild(B);new a.NumericTextBox({value:0}).appendTo("#minvalue");new a.NumericTextBox({value:0}).appendTo("#maxvalue")}else if(e||" List"!==t){U=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Value")}),_=this.parent.createElement("input",{className:"e-input",attrs:{value:u}});y.appendChild(U),y.appendChild(_)}else{var U=this.parent.createElement("span",{className:"e-header",innerHTML:c.getConstant("Sources")}),_=this.parent.createElement("input",{className:"e-input",attrs:{value:u}});y.appendChild(U),y.appendChild(_)}var V=o,z=this.parent.createElement("input",{className:"e-checkbox"});C.appendChild(z);return new s.CheckBox({label:c.getConstant("IgnoreBlank"),checked:V}).appendTo(z),g},e.prototype.validateRange=function(e,t){for(var r=!1,n=!1,i=[],o=[],a=[],s=[],l=e[0];l<=e[2];l++)if(t.rows[l])for(var h=e[1];h<=e[3];h++)if(t.rows[l].cells&&t.rows[l].cells[h]){(m=t.rows[l].cells[h]).validation&&(i.push(m.validation.type),o.push(m.validation.operator),a.push(m.validation.value1),s.push(m.validation.value2))}for(var d=e[1];d<=e[3];d++){(v=ze(t,d))&&v.validation&&(i.push(v.validation.type),o.push(v.validation.operator),a.push(v.validation.value1),s.push(v.validation.value2))}var p=[];for(d=0;d<i.length;d++)-1===p.indexOf(i[d])&&p.push(i[d]);if(p.length>1&&(r=!0),!r){p=[];for(var c=0;c<o.length;c++)-1===p.indexOf(o[c])&&p.push(o[c]);p.length>1&&(r=!0)}if(!r){p=[];for(c=0;c<a.length;c++)-1===p.indexOf(a[c])&&p.push(a[c]);p.length>1&&(r=!0)}if(!r){p=[];for(c=0;c<s.length;c++)-1===p.indexOf(s[c])&&p.push(s[c]);p.length>1&&(r=!0)}if(!r){for(var u=0,f=0,g=e[0];g<=e[2];g++)if(t.rows[g])for(h=e[1];h<=e[3];h++)if(t.rows[g].cells&&t.rows[g].cells[h]){var m;f++,(m=t.rows[g].cells[h]).validation&&u++}if(0===u)for(d=e[1];d<=e[3];d++){var v;(v=ze(t,d))&&v.validation&&u++}u>0&&f>1&&u!==f&&(n=!0)}return{moreValidation:r,extendValidation:n}},e.prototype.moreValidationDlg=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.serviceLocator.getService(ch),n=!1,i={width:350,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:t.getConstant("Spreadsheet"),beforeOpen:function(n){var i={dialogName:"MoreValidation",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(n.cancel=!0),r.dialogInstance.content=t.getConstant("MoreValidation"),r.dialogInstance.dataBind(),Pt(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0}}],close:function(){n?(e.initiateDataValidationHandler(!0),n=!1):r.hide()}};r.show(i)},e.prototype.extendValidationDlg=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.serviceLocator.getService(ch),n=!1,i=!1,o={width:550,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:t.getConstant("Spreadsheet"),beforeOpen:function(n){var i={dialogName:"ExtendValidation",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(n.cancel=!0),r.dialogInstance.content=t.getConstant("ExtendValidation"),r.dialogInstance.dataBind(),Pt(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Yes"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0}},{buttonModel:{content:t.getConstant("No"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0,i=!0}}],close:function(){n?(e.initiateDataValidationHandler(!0,i),n=!1):r.hide()}};r.show(o)},e.prototype.userInput=function(e,t){for(var r=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=r.querySelector(".e-allowdata"),i=r.querySelector(".e-values"),o=this.parent.serviceLocator.getService(ph),l=n.querySelector(".e-data");i.lastChild;)i.removeChild(i.lastChild);if("List"===e.value){for(;l.lastChild;)l.removeChild(l.lastChild);var h=this.parent.createElement("input",{className:"e-checkbox"});l.appendChild(h);new s.CheckBox({label:o.getConstant("InCellDropDown"),checked:!0}).appendTo(h)}else if(l.getElementsByClassName("e-checkbox-wrapper")[0]){for(;l.lastChild;)l.removeChild(l.lastChild);var d=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),p=this.parent.createElement("input",{className:"e-select"});l.appendChild(d),l.appendChild(p),t.appendTo(p)}if("List"===e.value||"Between"!==t.value&&"Not between"!==t.value){var c="List"===e.value?o.getConstant("Sources"):o.getConstant("Value"),u=this.parent.createElement("span",{className:"e-header",innerHTML:c}),f="List"===e.value?this.parent.createElement("input",{className:"e-input",attrs:{placeholder:"Enter value"}}):this.parent.createElement("input",{className:"e-input",attrs:{value:"0"}});i.appendChild(u),i.appendChild(f)}else{var g=this.parent.createElement("div",{className:"e-minimum"}),m=this.parent.createElement("div",{className:"e-maximum"});i.appendChild(g),i.appendChild(m);var v=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Minimum")}),y=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Maximum")}),C=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),x=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new a.NumericTextBox({value:0}).appendTo("min");new a.NumericTextBox({value:0}).appendTo("max"),g.appendChild(v),g.appendChild(C),m.appendChild(y),m.appendChild(x)}},e.prototype.dlgClickHandler=function(e){var t,r,n=this.parent.serviceLocator.getService(ph),i=this.parent.element.querySelector(".e-datavalidation-dlg"),o=i.querySelector(".e-footer-content"),a=i.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],s=a.getElementsByClassName("e-allowdata")[0],l=s.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],h=s.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],d=a.getElementsByClassName("e-values")[0],p=d.getElementsByTagName("input")[0].value,c=d.getElementsByTagName("input")[1]?d.getElementsByTagName("input")[1].value:"",f=a.querySelector(".e-ignoreblank .e-checkbox").checked,g=s.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!s.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,m=a.querySelector(".e-cellrange").getElementsByTagName("input")[0].value,v=l.value;h&&(r=h.value,r=this.FormattedValue(r)),v&&(v=v.replace(" ",""));var y=[],C=[];""!==p&&C.push(p),""!==c&&C.push(c);var x=!0;if("List"===v)if(-1!==p.indexOf("=")){if(-1!==p.indexOf(":")){var b=p.indexOf("!")>-1?p.split("!")[1]:p.split("=")[1],S=!(p.indexOf("!")>-1)||fe(this.parent,p.split("=")[1].split("!")[0])>-1;y=b.split(":");var w=!!b.match(/[a-z]/gi)&&y[0].replace(/[0-9]/g,"")===y[1].replace(/[0-9]/g,""),I=!!b.match(/\d/g)&&y[0].replace(/\D/g,"")===y[1].replace(/\D/g,"");(x=!!S&&(!!w||!!I))||(t=n.getConstant("DialogError"))}}else p.length>256&&(x=!1,t=n.getConstant("ListLengthError"));if(x){var E=this.parent.getActiveSheet(),R=v,A=this.isDialogValidator(C,R,r);if("Between"===r&&!isNaN(parseFloat(p))&&!isNaN(parseFloat(c))&&parseFloat(p)>parseFloat(c)&&(A.isValidate=!1,A.errorMsg=n.getConstant("MinMaxError")),t=A.errorMsg,x=A.isValidate){var k=u(E.activeCell),F=ke(k[0],k[1],E,!1,!0),T=F.validation&&"List"===F.validation.type,L={range:E.name+"!"+m,value1:p,value2:c,ignoreBlank:f,type:v,operator:r,inCellDropDown:g,cancel:!1};if(this.parent.notify(Zt,{eventArgs:L,action:"validation"}),!L.cancel){if(this.parent.notify(jr,{rules:{type:L.type,operator:L.operator,value1:L.value1,value2:c,ignoreBlank:L.ignoreBlank,inCellDropDown:L.inCellDropDown},range:L.range}),(F=ke(k[0],k[1],E,!1,!0)).validation){if(T){var N=this.parent.getCell(k[0],k[1]);N&&N.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),N.removeChild(N.getElementsByClassName("e-validation-list")[0]))}"List"===F.validation.type&&this.listHandler()}delete L.cancel,document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide()),this.parent.notify(Yo,{eventArgs:L,action:"validation"})}}}if(!x){var D=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:t});d.appendChild(D),o.querySelector(".e-primary").setAttribute("disabled","true")}},e.prototype.FormattedValue=function(e){switch(e){case"Between":e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo";break;default:e="Between"}return e},e.prototype.isDialogValidator=function(e,t,r){var n,i=this.parent.serviceLocator.getService(ph),o=0;if("List"===t?!(e.length>0):"Between"===r||"NotBetween"===r?2!==e.length:!(e.length>0))n={isValidate:!1,errorMsg:i.getConstant("EmptyError")};else{for(var a=0;a<e.length;a++){var s=W(e[a])?this.parent.computeExpression(e[a]).toString():e[a];if(!(n=this.formatValidation(s,t,!0)).isValidate)break;o+=1}n.isValidate=o===e.length}return{isValidate:n.isValidate,errorMsg:n.errorMsg}},e.prototype.isValidationHandler=function(e){var r=this.parent.serviceLocator.getService(ph);e.value=e.value?e.value:"";var n,i,o,a=e.value,s=this.parent.sheets[e.sheetIdx],l=ke(e.range[0],e.range[1],s),h=ze(s,e.range[1]);if(l&&l.validation?o=l.validation:Ye(h,e.range[0],e.range[1])&&(o=h.validation),o){var d=o.value1,p=o.value2;W(d)&&"List"!==o.type&&(d=this.parent.computeExpression(d).toString()),W(p)&&"List"!==o.type&&(p=this.parent.computeExpression(p).toString()),W(e.value)&&"List"!==o.type&&(e.value=this.parent.computeExpression(e.value).toString());var c=e.value,u=o.operator||"Between",f=o.type||"WholeNumber",g=!!t.isNullOrUndefined(o.ignoreBlank)||o.ignoreBlank,m=this.formatValidation(e.value,f);if(n=m.isValidate,i=m.errorMsg,n){if(n=!1,"Date"===f||"Time"===f){e.value=e.value.toString().slice(e.value.toString().indexOf(" ")+1,e.value.length);for(var v=0;v<3;v++){e.value=0===v?e.value:1===v?d:p;var y={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify(ur,y);var C=y.updatedVal;0===v&&""===C?c=e.value:0===v?c=C:1===v?d=C:p=C}}else if("TextLength"===o.type){y={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};this.parent.notify(ur,y);c=""!==(C=y.updatedVal)?C.toString().length.toString():e.value.toString().length.toString()}if("List"===f){if(-1!==d.indexOf("="))for(v=0;v<this.data.length;v++)e.value.toString()===this.data[v].text&&(n=!0);else{var x=d.split(",");for(v=0;v<x.length;v++)e.value.toString()===x[v]&&(n=!0)}!n&&g&&""===e.value.toString()&&(n=!0)}else switch("Decimal"===f||"Time"===f?(c=parseFloat(c.toString()),d=parseFloat(d.toString()),p=p?parseFloat(p.toString()):null):(c=parseInt(c.toString(),10),d=parseInt(d.toString(),10),p=p?parseInt(p.toString(),10):null),u){case"EqualTo":n=c===d||!(!g||""!==a);break;case"NotEqualTo":n=c!==d||!(!g||""!==a);break;case"Between":n=c>=d&&c<=p||!(!g||""!==a);break;case"NotBetween":n=!(c>=d&&c<=p);break;case"GreaterThan":n=c>d||!(!g||""!==a);break;case"LessThan":n=c<d||!(!g||""!==a);break;case"GreaterThanOrEqualTo":n=c>=d||!(!g||""!==a);break;case"LessThanOrEqualTo":n=c<=d||!(!g||""!==a)}}}if(i=r.getConstant("ValidationError"),n&&l&&l.validation&&l.validation.isHighlighted){var b=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);He(s,e.range[0])||this.parent.notify(hr,{style:b,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0,cell:e.td})}return{isValidate:n,errorMsg:i}},e.prototype.checkDataValidation=function(e){var t=ke(e.range[0],e.range[1],this.parent.getActiveSheet());e.td=e.td||this.parent.getCell(e.range[0],e.range[1]),e.sheetIdx=e.sheetIdx||this.parent.activeSheetIndex;var r={skip:!1,value:""};if(t&&t.validation){if(W(t.validation.value1)&&!G(t.validation.value1.substring(1,t.validation.value1.length))&&t.validation.value1.indexOf("(")>-1){var n=t.validation.value1;n=n.substring(n.indexOf("=")+1,n.indexOf("(")),r.value=n.toUpperCase(),this.parent.notify(Rr,r)}if(!r.skip&&W(t.validation.value2)&&!G(t.validation.value2.substring(1,t.validation.value2.length))&&t.validation.value1.indexOf("(")>-1){var i=t.validation.value2;i=i.substring(i.indexOf("=")+1,i.indexOf("(")),r.value=i.toUpperCase(),this.parent.notify(Rr,r)}}if(!r.skip){var o=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx,td:e.td});!o.isValidate&&e.isCell&&this.validationErrorHandler(o.errorMsg),e.isValid=o.isValidate}},e.prototype.formatValidation=function(e,t,r){var n,i=this.parent.element.getElementsByClassName("e-sheet-panel")[0],o=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),s=this.parent.createElement("input",{id:"e-validation",innerHTML:e});s.setAttribute("name","validation"),s.setAttribute("type","text"),s.setAttribute("value",e),o.appendChild(s),i.appendChild(o);var l;switch(t){case"Date":l={rules:{validation:{date:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"Decimal":l={rules:{validation:{number:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"WholeNumber":l={rules:{validation:{regex:/^-?\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}};break;case"TextLength":r&&(l={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}})}var h=new a.FormValidator("#formId",l).validate();return i.removeChild(i.getElementsByClassName("form-horizontal")[0]),{isValidate:h,errorMsg:n}},e.prototype.InvalidElementHandler=function(e){var t=e.rowIdx,r=e.colIdx,n=e.isRemoveHighlightedData;if(n){if(n){var i=this.parent.getCellStyleValue(["backgroundColor","color"],[t,r]);this.parent.notify(hr,{style:i,rowIdx:t,colIdx:r,cell:e.td})}}else this.parent.notify(hr,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:t,colIdx:r,cell:e.td})},e.prototype.validationErrorHandler=function(e){var t=this,r=document.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(ph);if(!this.parent.element.querySelector(".e-validationerror-dlg")){var i=this.parent.serviceLocator.getService(ch),o={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(n){var o={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(t.errorDlgHandler(i,"Cancel"),n.cancel=!0),r.focus(),i.dialogInstance.content=o.content,i.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(i,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(i,"Cancel")}}]};i.show(o,!1)}},e.prototype.errorDlgHandler=function(e,t){if("Retry"===t){var r=document.getElementsByClassName("e-spreadsheet-edit")[0];e.hide(),r.innerText&&(window.getSelection().selectAllChildren(r),this.listObj&&this.listObj.showPopup())}else{var n=u(this.parent.getActiveSheet().activeCell),i=ke(n[0],n[1],this.parent.getActiveSheet()),o=i?this.parent.getDisplayText(i):"";this.parent.notify(Oi,{action:"cancelEdit",value:o,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},e.prototype.getModuleName=function(){return"dataValidation"},e}(),Ol=function(){function e(e){this.password="",this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(ra,this.protect,this),this.parent.on(ta,this.protectSheetHandler,this),this.parent.on(la,this.editProtectedAlert,this),this.parent.on(Za,this.protectWorkbook,this),this.parent.on(Bi,this.KeyUpHandler,this),this.parent.on(Qa,this.unProtectWorkbook,this),this.parent.on(us,this.unProtectSheetPassword,this),this.parent.on(Ja,this.getPassWord,this),this.parent.on(rs,this.importProtectWorkbook,this),this.parent.on(es,this.protectWorkbookHandler,this),this.parent.on(ts,this.removeWorkbookProtection,this),this.parent.on(bs,this.toggleProtect,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ra,this.protect),this.parent.off(ta,this.protectSheetHandler),this.parent.off(la,this.editProtectedAlert),this.parent.off(Za,this.protectWorkbook),this.parent.off(Bi,this.KeyUpHandler),this.parent.off(Qa,this.unProtectWorkbook),this.parent.off(us,this.unProtectSheetPassword),this.parent.off(Ja,this.getPassWord),this.parent.off(rs,this.importProtectWorkbook),this.parent.off(es,this.protectWorkbookHandler),this.parent.off(ts,this.removeWorkbookProtection),this.parent.off(bs,this.toggleProtect))},e.prototype.protect=function(e){this.parent.notify(io,null),e.isActive?(this.parent.setSheetPropertyOnMute(be(this.parent,e.sheetIndex),"isProtected",!1),this.parent.notify(ko,{props:"Protect"}),this.parent.notify(ta,e),this.parent.notify(pa,null)):this.createDialogue()},e.prototype.createDialogue=function(){var e=this,r=this.parent.serviceLocator.getService(ph),n=[{text:r.getConstant("SelectCells"),id:"1"},{text:r.getConstant("SelectUnLockedCells"),id:"6"},{text:r.getConstant("FormatCells"),id:"2"},{text:r.getConstant("FormatRows"),id:"3"},{text:r.getConstant("FormatColumns"),id:"4"},{text:r.getConstant("InsertLinks"),id:"5"}];this.optionList=new h.ListView({width:"250px",dataSource:n,showCheckBox:!0,select:this.dialogOpen.bind(this)});var i=this.parent.createElement("div",{className:"e-sheet-password-dialog"}),o=this.parent.createElement("div",{className:"e-sheet-password-content"}),a=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("SheetPassword")}),l=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});l.setAttribute("placeholder",r.getConstant("EnterThePassword")),o.appendChild(l),o.insertBefore(a,l),i.appendChild(o);var d=this.parent.createElement("div",{className:"e-protect-content",innerHTML:r.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var p=new s.CheckBox({checked:!0,label:r.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),c=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),u=this.parent.createElement("div",{className:"e-header-content",innerHTML:r.getConstant("ProtectSheet")}),f=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:u.outerHTML,content:i.outerHTML+f.outerHTML+d.outerHTML+c.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(t){var r={dialogName:"ProtectSheetDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),Pt(e.parent.element)},open:function(){e.okBtnFocus()},beforeClose:function(){var r=document.getElementById(e.parent.element.id+"_protect_check");t.EventHandler.remove(r,"focus",e.okBtnFocus),t.EventHandler.remove(p.element,"click",e.checkBoxClickHandler),Pt(e.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}},{click:function(){return e.dialog.hide()},buttonModel:{content:r.getConstant("Cancel")}}]},!1),p.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"},{id:"6"}]),t.EventHandler.add(p.element,"click",this.checkBoxClickHandler,this)},e.prototype.okBtnFocus=function(){var e=this;document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",function(){e.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()})},e.prototype.checkBoxClickHandler=function(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())},e.prototype.dialogOpen=function(e){var t=this.parent.serviceLocator.getService(ph);e.text===t.getConstant("SelectCells")&&e.isChecked&&e.isInteracted&&this.optionList.checkItem({id:"6"}),e.text===t.getConstant("SelectUnLockedCells")&&!e.isChecked&&e.isInteracted&&this.optionList.uncheckItem({id:"1"}),this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()},e.prototype.selectOption=function(){var e=this.parent.getActiveSheet(),t=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input");0===t.value.length?(this.parent.setSheetPropertyOnMute(e,"isProtected",!0),this.parent.setSheetPropertyOnMute(e,"password",t.value),this.updateProtectSheet(t.value),this.dialog.hide(),e.protectSettings.selectCells||e.protectSettings.selectUnLockedCells?e.protectSettings.selectUnLockedCells&&Ht(this.parent,c(e.selectedRange))&&this.parent.notify(cs,null):this.parent.notify(cs,null)):this.reEnterSheetPassword()},e.prototype.selectSheetPassword=function(){var e=this.parent.serviceLocator.getService(ph),r=this.parent.getActiveSheet(),n=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input"),i=this.parent.element.querySelector(".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0].querySelector(".e-input"),o=this.parent.createElement("span",{className:"e-reenterpwd-alert-span"});if(n.value===i.value){this.parent.setSheetPropertyOnMute(r,"isProtected",!0),this.parent.setSheetPropertyOnMute(r,"password",n.value),this.updateProtectSheet(n.value),this.dialog.hide();var a=document.querySelector(".e-protect-dlg.e-dialog");t.getComponent(a,"dialog").destroy(),r.protectSettings.selectCells||r.protectSettings.selectUnLockedCells||this.parent.notify(cs,null)}else""===n.value?o.textContent=e.getConstant("PasswordAlertMsg"):""===i.value?o.textContent=e.getConstant("ConfirmPasswordAlertMsg"):n.value!==i.value&&(o.textContent=e.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-reenterpwd-dlg").querySelector(".e-reenterpwd-dialog").appendChild(o)},e.prototype.updateProtectSheet=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.optionList.getSelectedItems(),n={selectCells:r.text.indexOf(t.getConstant("SelectCells"))>-1,formatCells:r.text.indexOf(t.getConstant("FormatCells"))>-1,formatRows:r.text.indexOf(t.getConstant("FormatRows"))>-1,formatColumns:r.text.indexOf(t.getConstant("FormatColumns"))>-1,insertLink:r.text.indexOf(t.getConstant("InsertLinks"))>-1,selectUnLockedCells:r.text.indexOf(t.getConstant("SelectUnLockedCells"))>-1};this.parent.notify(on,{protectSettings:n,password:e,triggerEvent:!0}),this.parent.notify(pa,null),this.parent.notify(_o,null)},e.prototype.protectSheetHandler=function(e){var r=t.isNullOrUndefined(e&&e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=be(this.parent,r),i=this.parent.element.id,o=[i+"_undo",i+"_redo",i+"_cut",i+"_copy",i+"_paste",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_merge_cells",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],a=[i+"_cut",i+"_copy",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],s=[i+"_insert_function"],l=[i+"_hyperlink",i+"_",i+"_chart"],h=[i+"_image"],d=[i+"_find"],p=[i+"_datavalidation"],u=[i+"_chart"],f=document.getElementById(this.parent.element.id+"_sheet_panel");f&&(n.isProtected?n.protectSettings.selectCells?f.classList.remove("e-protected"):n.protectSettings.selectUnLockedCells&&!Ht(this.parent,c(n.selectedRange))?f.classList.remove("e-protected"):f.classList.add("e-protected"):f.classList.add("e-protected"),n.isProtected||f.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify(na,{disableHomeBtnId:o,enableHomeBtnId:a,enableFrmlaBtnId:s,enableInsertBtnId:l,findBtnId:d,dataValidationBtnId:p,imageBtnId:h,chartBtnId:u}),this.parent.notify(da,null),n.isProtected&&this.parent.notify(ko,{props:"Protect"}),e&&e.triggerEvent&&this.parent.notify(Yo,{action:"protectSheet",eventArgs:{sheetIndex:r,isProtected:n.isProtected,password:n.password,protectSettings:n.protectSettings.properties||n.protectSettings}})},e.prototype.editProtectedAlert=function(){var e=this,t=this.parent.serviceLocator.getService(ph);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(r){var n={dialogName:"EditAlertDialog",content:t.getConstant("EditAlert"),element:r.element,target:r.target,cancel:r.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(r.cancel=!0,Ke(function(){return e.dialog.destroyDialog()})),e.dialog.dialogInstance.content=n.content,Pt(e.parent.element)},close:function(){return Pt(e.parent.element)}})},e.prototype.protectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.serviceLocator.getService(ch);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:t.getConstant("ProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"ProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.passwordProtectContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(r)}}]})},e.prototype.passwordProtectContent=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("div",{className:"e-password-dialog"}),r=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),i=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Password")}),o=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ConfirmPassword")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",e.getConstant("EnterThePassword")),s.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),r.appendChild(a),r.insertBefore(i,a),n.appendChild(s),n.insertBefore(o,s),t.appendChild(n),t.insertBefore(r,n),t},e.prototype.KeyUpHandler=function(e){var r=e.target;if(r.classList.contains("e-text")&&t.closest(r,".e-password-content")&&t.closest(r,".e-password-dialog")&&t.closest(r,".e-password-dialog").getElementsByClassName("e-password-content")[1]===r.parentElement){var n=t.closest(r,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-unprotectpwd-content")&&t.closest(r,".e-unprotectpwd-dialog")&&t.closest(r,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===r.parentElement){var i=t.closest(r,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?i.removeAttribute("disabled"):i.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-reenterpwd-content")&&t.closest(r,".e-reenterpwd-dialog")&&t.closest(r,".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0]===r.parentElement){var o=t.closest(r,".e-reenterpwd-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-unprotectsheetpwd-content")&&t.closest(r,".e-unprotectsheetpwd-dialog")&&t.closest(r,".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0]===r.parentElement){var a=t.closest(r,".e-unprotectworksheet-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?a.removeAttribute("disabled"):a.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-importprotectpwd-content")&&t.closest(r,".e-importprotectpwd-dialog")&&t.closest(r,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===r.parentElement){a=t.closest(r,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?a.removeAttribute("disabled"):a.setAttribute("disabled","true")}},e.prototype.alertMessage=function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),r=this.parent.element.querySelector(".e-importprotectpwd-alert-span"),n=this.parent.element.querySelector(".e-reenterpwd-alert-span"),i=this.parent.element.querySelector(".e-unprotectsheetpwd-alert-span");e&&e.remove(),t&&t.remove(),r&&r.remove(),n&&n.remove(),i&&i.remove()},e.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),i=this.parent.createElement("span",{className:"e-pwd-alert-span"});r.value===n.value?(e.hide(),this.parent.notify(ko,{props:"Protectworkbook"}),this.protectWorkbookHandler({password:r.value}),this.parent.notify(Yo,{action:"protectWorkbook",eventArgs:{isProtected:!0,password:r.value}})):""===r.value?i.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?i.textContent=t.getConstant("ConfirmPasswordAlertMsg"):r.value!==n.value&&(i.textContent=t.getConstant("PasswordAlert")),e.dialogInstance&&this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)},e.prototype.protectWorkbookHandler=function(e){this.parent.password=e.password,this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify(ko,{props:"Protectworkbook"})},e.prototype.unProtectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.serviceLocator.getService(ch);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:t.getConstant("UnProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"UnProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.unProtectPasswordContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(r)}}]})},e.prototype.unProtectsheet=function(e){var t=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.serviceLocator.getService(ch);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworksheet-dlg",header:r.getConstant("UnProtectWorksheet"),beforeOpen:function(e){var r={dialogName:"UnProtectSheet",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),n.dialogInstance.content=t.unProtectSheetPasswordContent(),n.dialogInstance.dataBind(),t.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!this.parent.openModule.isImportedFile||-1!==this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)},click:function(){t.alertMessage(),t.unprotectSheetdlgOkClick(n,e)}}]})},e.prototype.reEnterSheetPassword=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.parent.serviceLocator.getService(ch);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-reenterpwd-dlg",header:t.getConstant("ConfirmPassword"),beforeOpen:function(t){var n={dialogName:"Re-enterPassword",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.reEnterSheetPasswordContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.selectSheetPassword()}}]})},e.prototype.unProtectPasswordContent=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.reEnterSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("div",{className:"e-reenterpwd-dialog"}),r=this.parent.createElement("div",{className:"e-reenterpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ReEnterPassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unProtectSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("div",{className:"e-unprotectsheetpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectsheetpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unprotectdlgOkClick=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===r.value)e.hide(),this.removeWorkbookProtection(),this.parent.notify(Yo,{action:"protectWorkbook",eventArgs:{isProtected:!1}});else{var n=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span",innerHTML:t.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)}},e.prototype.removeWorkbookProtection=function(){this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled"));var e=document.getElementById(this.parent.element.id+"_protectworkbook");e&&e.classList.remove("e-active"),this.parent.notify(ko,{props:"Protectworkbook"})},e.prototype.unprotectSheetdlgOkClick=function(e,t){var r=this.parent.serviceLocator.getService(ph),n=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0].querySelector(".e-input");if(t&&0===n.password.length){var o={sheetPassword:i.value,sheetIndex:this.parent.activeSheetIndex};this.parent.open(o)}else if(n.password===i.value)e.hide(),this.unProtectSheetPassword();else{var a=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:r.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(a)}},e.prototype.unProtectSheetPassword=function(){var e=this.parent.getActiveSheet(),t=this.parent.activeSheetIndex;this.parent.setSheetPropertyOnMute(e,"isProtected",!e.isProtected),this.parent.setSheetPropertyOnMute(e,"password","");var r=!e.isProtected;this.parent.notify(ra,{isActive:r,id:this.parent.element.id+"_protect",sheetIndex:t,triggerEvent:!0}),this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(t)&&this.parent.openModule.unProtectSheetIdx.push(t)},e.prototype.getPassWord=function(e){e.passWord=this.password},e.prototype.importProtectWorkbook=function(e){var t=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.serviceLocator.getService(ch);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:r.getConstant("UnProtectWorkbook"),beforeOpen:function(r){var i={dialogName:"ImportProtectWorkbook",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(r.cancel=!0),n.dialogInstance.content=t.importProtectPasswordContent(e),n.dialogInstance.dataBind(),t.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){t.alertMessage(),t.importOkClick(e)}}]})},e.prototype.importProtectPasswordContent=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),i=this.parent.createElement("span",{className:"e-header",innerHTML:'"'+e.file.name+'" '+t.getConstant("IsProtected")}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return o.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(i),n.appendChild(o),r.appendChild(n),r},e.prototype.importOkClick=function(e){var t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value;var r={file:e.file,password:t.value};this.parent.open(r)},e.prototype.toggleProtect=function(e){var t,r=this.parent.element.id,n=this.parent.getActiveSheet();this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)?this.unProtectsheet(!0):n.password&&n.password.length>0?this.unProtectsheet():(this.parent.setSheetPropertyOnMute(n,"isProtected",!n.isProtected),t=!n.isProtected,this.parent.notify(ra,{isActive:t,id:r+"_protect",sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0}))},e.prototype.getModuleName=function(){return"protectSheet"},e}(),Ml=function(){function e(e){this.shortValue="",this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(oa,this.renderFindDlg,this),this.parent.on(ia,this.renderGotoDlg,this),this.parent.on(Xr,this.gotoHandler,this),this.parent.on(aa,this.findHandler,this),this.parent.on(Zr,this.showDialog,this),this.parent.on(an,this.replaceAllDialog,this),this.parent.on(Qr,this.findKeyUp,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(oa,this.renderFindDlg),this.parent.off(ia,this.renderGotoDlg),this.parent.off(Xr,this.gotoHandler),this.parent.off(aa,this.findHandler),this.parent.off(Zr,this.showDialog),this.parent.off(an,this.replaceAllDialog),this.parent.off(Qr,this.findKeyUp))},e.prototype.renderFindDlg=function(){var e=this,r=this.parent.serviceLocator.getService(ch);if(this.parent.element.querySelector(".e-find-dlg"))r.hide();else{var n=this.parent.serviceLocator.getService(ph),i={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:n.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:function(t){var n={dialogName:"FindAndReplaceDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.findandreplaceContent(),r.dialogInstance.dataBind(),Pt(e.parent.element)},buttons:[{buttonModel:{content:n.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(t){e.dialogMessage(),e.findHandler({findOption:t&&13===t.keyCode?"next":"prev"})}},{buttonModel:{content:n.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findHandler({findOption:"next"})}},{buttonModel:{content:n.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler(Kr)}},{buttonModel:{content:n.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler($r)}}],open:function(){var r=e.parent.element.querySelector(".e-text-findNext");if(r.value){var n=e.parent.element.querySelector(".e-btn-findPrevious");t.getComponent(n,"btn").disabled=!1,t.getComponent(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}Ke(function(){Pt(r)})},close:function(){return r.hide()}};r.show(i)}},e.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},e.prototype.renderGotoDlg=function(){var e=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.serviceLocator.getService(ch);if(t.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var i={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:r.getConstant("GotoHeader"),beforeOpen:function(t){var r={dialogName:"GoToDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),n.dialogInstance.content=e.GotoContent(),n.dialogInstance.dataBind(),Pt(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()}}],close:function(){n.hide()},open:function(){e.textFocus()}};n.show(i,!1)}else n.hide()},e.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()})},e.prototype.findHandler=function(e){var r=this.parent.element.querySelector(".e-text-findNext");r||(r=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var n=r.value;if(""!==r.value){var i=this.parent.activeSheetIndex,o=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=void 0;if(o){a=t.getComponent(o,"checkbox").checked}else a=!1;var s=this.parent.element.querySelector(".e-findnreplace-checkmatch"),l=void 0;if(s){l=t.getComponent(s,"checkbox").checked}else l=!1;var h=this.parent.element.querySelector(".e-findnreplace-searchby"),d=void 0;if(h){d=t.getComponent(h,"dropdownlist").value.toString()}else d="By Row";var p=this.parent.element.querySelector(".e-findnreplace-searchwithin"),c=void 0;if(p){c=t.getComponent(p,"dropdownlist").value.toString()}else c="Sheet";var u={value:n,sheetIndex:i,findOpt:e.findOption,mode:c,isCSen:a,isEMatch:l,searchBy:d,isAction:!0};this.parent.find(u)}},e.prototype.replaceHandler=function(e){var t=this.parent.element.querySelector(".e-find-dlg").querySelector(".e-text-findNext").value,r=this.parent.element.querySelector(".e-text-replaceInp").value,n=this.parent.element.querySelector(".e-findnreplace-checkcase").checked,i=this.parent.element.querySelector(".e-findnreplace-checkmatch").checked,o=this.parent.element.querySelector(".e-search-within .e-ddl-hidden").value,a=this.parent.element.querySelector(".e-searchby .e-ddl-hidden").value;this.parent.notify(e,{value:t,mode:o,isCSen:n,isEMatch:i,searchBy:a,findOpt:"next",replaceValue:r,replaceBy:e,sheetIndex:this.parent.activeSheetIndex,isAction:!0})},e.prototype.gotoHandler=function(e){if(e)this.parent.goTo(e.address);else{var t=this.parent.element.querySelector(".e-text-goto").value,r=t.split("");if(""===t||isNaN(parseInt(r[1],10)))return void this.gotoAlert();var n=t.toString().toUpperCase();this.parent.goTo(n)}},e.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.serviceLocator.getService(ph),r=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+t.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(r)},e.prototype.findKeyUp=function(e){if(e.target.classList.contains("e-text-findNext")){var r=this.parent.element.querySelector(".e-text-findNext").value;if(t.isNullOrUndefined(r)||""===r)t.getComponent(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,t.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var n=this.parent.element.querySelector(".e-btn-findPrevious");t.getComponent(n,"btn").disabled=!1,t.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var i=this.parent.element.querySelector(".e-text-findNext").value,o=this.parent.element.querySelector(".e-text-replaceInp").value;t.isNullOrUndefined(i)||t.isNullOrUndefined(o)||""===i||""===o?(t.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,t.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):!1===this.parent.getActiveSheet().isProtected&&(t.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,t.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},e.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),r=this.parent.createElement("div",{className:"e-findCheck"}),n=this.parent.serviceLocator.getService(ph);e.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),o=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("FindWhat")}),h=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});i.appendChild(h),i.insertBefore(o,h),t.appendChild(i);var d=new a.TextBox({width:"70%"});d.createElement=this.parent.createElement,d.appendTo(h);var p=this.parent.createElement("div",{className:"e-cont"}),c=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("ReplaceWith")}),u=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});p.appendChild(u),p.insertBefore(c,u),t.appendChild(p);var f=new a.TextBox({width:"70%"});f.createElement=this.parent.createElement,f.appendTo(u);var g=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],m=new l.DropDownList({dataSource:g,cssClass:"e-search-within",fields:{value:"Id",text:"Within"},width:"50%",index:0}),v=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:n.getConstant("SearchBy")}}),y=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchWithin")});t.appendChild(y),t.appendChild(v),m.createElement=this.parent.createElement,m.appendTo(v);var C=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],x=new l.DropDownList({dataSource:C,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),b=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:n.getConstant("SearchBy")}}),S=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchBy")});t.appendChild(S),t.appendChild(b),x.createElement=this.parent.createElement,x.appendTo(b);var w=new s.CheckBox({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),I=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});r.appendChild(I),w.createElement=this.parent.createElement,w.appendTo(I);var E=new s.CheckBox({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),R=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return r.appendChild(R),E.createElement=this.parent.createElement,E.appendTo(R),t.appendChild(r),e},e.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-goto"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),i=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),o=new a.TextBox({placeholder:e.getConstant("EntercellAddress")}),s=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(s),n.insertBefore(i,s),r.appendChild(n),o.createElement=this.parent.createElement,o.appendTo(s),t},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"findAndReplace"},e}(),Pl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){var t=this;e.showDialog?this.parent.serviceLocator.getService(ch).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(ph).getConstant("PasteMergeAlert"),beforeOpen:function(e){var r={dialogName:"MergeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),Pt(t.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)},e.prototype.hideHandler=function(e){var t=this.parent.getActiveSheet(),r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(cn,r),r.range=r.range;var n=ke(r.range[0],r.range[1],t)||{},i="row"===e.model?r.range[0]:r.range[1],o=i+((n[e.model+"Span"]||1)-1);if(!(!e.isEnd&&(e.start===i||Ge(t,i))||e.isEnd&&e.start>i&&!Ge(t,i))&&n[e.model+"Span"]>1&&o>=e.start)if("row"===e.model?He(t,i):Ge(t,i)){if(e.end<o&&(o-e.end>1||n.rowSpan>1)){var a=this.parent.getCell(e.rowIdx,e.end+1);if(a&&(o-e.end>1&&(a.colSpan=o-e.end),a.style.display=""),n.rowSpan>1){var s=n.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(n.rowSpan-1));s>1&&(a.rowSpan=s)}}}else this.merge({rowIdx:r.range[0],colIdx:r.range[1]})},e.prototype.checkPrevMerge=function(e){var t,r,n,i=this.parent.getActiveSheet();e.isRow?e.rowIdx-1>-1&&He(i,e.rowIdx-1)&&(void 0===(t=ke(e.rowIdx-1,e.colIdx,i)||{}).rowSpan&&void 0===t.colSpan||!(void 0===t.colSpan||t.colSpan>1||e.colIdx-1>-1&&Ge(i,e.colIdx-1))||(r={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(cn,r),r.range=r.range,He(i,r.range[0])&&r.range[2]>=e.rowIdx&&(t=ke(r.range[0],r.range[1],i)||{}).rowSpan>1&&((n=r.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(r.range[2]-e.rowIdx)))>1&&(e.td.rowSpan=n,e.td.style.display=""),t.colSpan>1&&!(e.colIdx-1>-1&&Ge(i,e.colIdx-1))&&(n=t.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display="")))):e.colIdx-1>-1&&Ge(i,e.colIdx-1)&&(void 0===(t=ke(e.rowIdx,e.colIdx-1,i)||{}).colSpan&&void 0===t.rowSpan||!(void 0===t.rowSpan||t.rowSpan>1||e.rowIdx-1>-1&&He(i,e.rowIdx-1))||(r={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(cn,r),r.range=r.range,Ge(i,r.range[1])&&r.range[3]>=e.colIdx&&(t=ke(r.range[0],r.range[1],i)||{}).colSpan>1&&((n=r.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""),t.rowSpan>1&&!(e.rowIdx-1>-1&&He(i,e.rowIdx-1))&&(n=t.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(t.rowSpan-1)))>1&&(e.td.rowSpan=n,e.td.style.display=""))))},e.prototype.checkMerge=function(e){var t=this.parent.getActiveSheet(),r=ke(e.rowIdx,e.colIdx,t)||{};if(e.isRow){if(void 0===r.colSpan||Ge(t,e.colIdx-1)){if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify(cn,n),Ge(t,e.colIdx-1)&&!Ge(t,n.range[1])||e.isFreezePane&&n.range[0]<this.parent.frozenRowCount(t))return void(e.insideFreezePane=n.range[0]<this.parent.frozenRowCount(t));r=ke(n.range[0],n.range[1],t);(i=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,n.range[2]))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.rowSpan=i,e.td.style.display="")}}else if(void 0===r.rowSpan||He(t,e.rowIdx-1)){var n;if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify(cn,n),He(t,e.rowIdx-1)&&!He(t,n.range[0])||e.isFreezePane&&n.range[1]<this.parent.frozenColCount(t))return void(e.insideFreezePane=n.range[1]<this.parent.frozenColCount(t));r=ke(n.range[0],n.range[1],t);var i;(i=n.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,n.range[3],"columns"))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.colSpan=i,e.td.style.display="")}},e.prototype.addEventListener=function(){this.parent.on(dn,this.merge,this),this.parent.on(ca,this.hideHandler,this),this.parent.on(ua,this.checkPrevMerge,this),this.parent.on(fa,this.checkMerge,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(dn,this.merge),this.parent.off(ca,this.hideHandler),this.parent.off(ua,this.checkPrevMerge),this.parent.off(fa,this.checkMerge))},e.prototype.getModuleName=function(){return"merge"},e}(),Hl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener()},e.prototype.addEventListener=function(){this.parent.on(vn,this.applyCF,this),this.parent.on(Ca,this.renderCFDlg,this),this.parent.on(xn,this.clearCF,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(vn,this.applyCF),this.parent.off(Ca,this.renderCFDlg),this.parent.off(xn,this.clearCF))},e.prototype.clearCF=function(e){var r=this,n=this.parent.getActiveSheet();this.updateRange(n,e.indexes,this.parent.frozenRowCount(n),this.parent.frozenColCount(n),u(n.topLeftCell),function(e,n,i,o){t.removeClass([o],["e-redft","e-yellowft","e-greenft","e-redf","e-redt","e-iconset"]);var a,s;["backgroundColor","color"].forEach(function(t){o.style[t]&&(o.style[t]="",(a=i&&i.style&&i.style[t]||r.parent.commonCellStyle[t])&&((s={})[t]=a,r.parent.notify(hr,{style:s,rowIdx:e,colIdx:n,cell:o})))});var l;[".e-cf-databar",".e-iconsetspan"].forEach(function(e){(l=o.querySelector(e))&&(o.removeChild(l),o.textContent=r.parent.getDisplayText(i))})})},e.prototype.renderCFDlg=function(e){var t=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.serviceLocator.getService(ch);n.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:this.parent.element,beforeOpen:function(){n.dialogInstance.content=t.cfDlgContent(e.action),n.dialogInstance.dataBind(),Pt(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){t.dlgClickHandler(e.action),n.hide()}}]})},e.prototype.dlgClickHandler=function(e){var r,n="",i="",o=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),a=o.querySelector(".e-cfmain");if(a){(r=a.getElementsByTagName("input")[0])&&r.parentElement.classList.contains("e-cfmain")&&(n=a.getElementsByTagName("input")[0].value),i=a.getElementsByTagName("input")[1]?o.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:"";var s=t.getNumberDependable(this.parent.locale,"");n=n.split(s).join("").split(",").join(""),i=i.split(s).join("").split(",").join("")}var l={type:"Duplicate Values..."===e?r.value:this.getType(e),cFColor:this.getCFColor(o.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),range:this.parent.getActiveSheet().selectedRange};l.value=""!==n?n+(""!==i?","+i:""):i,this.parent.notify(mn,{cfModel:l,isAction:!0})},e.prototype.getType=function(e){var t,r=this.parent.serviceLocator.getService(ph);switch(e){case r.getConstant("GreaterThan")+"...":t="GreaterThan";break;case r.getConstant("LessThan")+"...":t="LessThan";break;case r.getConstant("Between")+"...":t="Between";break;case r.getConstant("CFEqualTo")+"...":t="EqualTo";break;case r.getConstant("TextThatContains")+"...":t="ContainsText";break;case r.getConstant("ADateOccuring")+"...":t="DateOccur";break;case r.getConstant("Top10Items")+"...":t="Top10Items";break;case r.getConstant("Bottom10Items")+"...":t="Bottom10Items";break;case r.getConstant("Top10")+" %...":t="Top10Percentage";break;case r.getConstant("Bottom10")+" %...":t="Bottom10Percentage";break;case r.getConstant("AboveAverage")+"...":t="AboveAverage";break;case r.getConstant("BelowAverage")+"...":t="BelowAverage"}return t},e.prototype.getCFColor=function(e){var t=this.parent.serviceLocator.getService(ph),r="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):r="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):r="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):r="GreenFT";break;case t.getConstant("RedFill"):r="RedF";break;case t.getConstant("RedText"):r="RedT"}return r},e.prototype.cfDlgContent=function(e){var t=this.getDlgText(e),r=this.parent.serviceLocator.getService(ph),n=this.parent.createElement("div",{className:"e-cf-dlg"}),i=this.parent.createElement("div",{className:"e-cfmain"}),o=this.parent.createElement("div",{className:"e-cfsub"}),s=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:t}),h=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text","aria-label":t}}),d=this.parent.createElement("input",{className:"e-select"}),p=this.parent.createElement("span",{className:"e-header",innerHTML:r.getConstant("With")}),c=this.parent.createElement("input",{className:"e-select"});n.appendChild(i),n.appendChild(o),i.appendChild(s);var u;if(e!==r.getConstant("DuplicateValues")+"..."){if(e!==r.getConstant("AboveAverage")+"..."&&e!==r.getConstant("BelowAverage")+"..."){i.appendChild(h),u=!0;var f=e===r.getConstant("Top10")+" %..."||e===r.getConstant("Bottom10")+" %...";if(e===r.getConstant("Top10Items")+"..."||e===r.getConstant("Bottom10Items")+"..."||f){h.maxLength=f?3:4;new a.NumericTextBox({value:10,min:1,max:f?100:1e3,format:"###"}).appendTo(h)}}}else{i.appendChild(d);var g=[{text:r.getConstant("Duplicate"),id:"duplicate"},{text:r.getConstant("Unique"),id:"unique"}];new l.DropDownList({dataSource:g,index:0,popupHeight:"200px"}).appendTo(d)}if(e===r.getConstant("Between")+"..."){var m=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:r.getConstant("And")}),v=this.parent.createElement("input",{className:"e-input e-between"});i.appendChild(m),i.appendChild(v),v.addEventListener("input",this.validateCFInput.bind(this))}u&&(this.validateCFInput({target:h}),h.addEventListener("input",this.validateCFInput.bind(this))),o.appendChild(p),o.appendChild(c);var y=[{text:r.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:r.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:r.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:r.getConstant("RedFill"),id:"redf"},{text:r.getConstant("RedText"),id:"redt"}];return new l.DropDownList({dataSource:y,index:0,popupHeight:"200px"}).appendTo(c),n},e.prototype.validateCFInput=function(e){var t=this.parent.serviceLocator.getService(ch),r=e.target.value,n=t.dialogInstance.element.getElementsByClassName("e-primary")[0];r&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(r=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!r.trim()},e.prototype.checkCellHandler=function(e,t,r){for(var n=r.range.trim().split(","),i=0;i<n.length;i++){var o=c(n[i].includes(":")?n[i]:n[i]+":"+n[i]);if(e>=o[0]&&e<=o[2]&&t>=o[1]&&t<=o[3])return!0}return!1},e.prototype.getDlgText=function(e){var t=this.parent.serviceLocator.getService(ph),r="";switch(e){case t.getConstant("GreaterThan")+"...":r=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":r=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":r=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":r=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":r=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":r=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":r=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":r=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":r=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":r=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":r=t.getConstant("FormatCellsBelow")}return r},e.prototype.updateResult=function(e,r,n,i,o,a,s,l){var h,d,p,u,f={},g={},m=e.range.split(","),v=[];n?u=function(){if(N(d)){var e=parseInt(d,10);e>=0?(void 0===v[0]||e>v[0])&&(v[0]=e):(void 0===v[1]||e<v[1])&&(v[1]=e)}}:i?u=function(){if(N(d)){var e=parseFloat(d);v.push(Number(e))}}:o?(v=[0,0],u=function(){N(d)&&(v[0]+=parseFloat(d),v[1]++)}):a?(p=0,u=function(){N(d)&&v.push(parseFloat(d))}):u=s?function(){if(N(d)){var e=parseInt(d,10);(void 0===v[0]||e<v[0])&&(v[0]=e),(void 0===v[1]||e>v[1])&&(v[1]=e)}}:function(){f[d]?g[d]||(g[d]=!0,v.push(d)):f[d]=!0};for(var y,C=0;C<m.length;C++)for(var x=(h=c(m[C]))[0];x<=h[2];x++)for(var b=h[1];b<=h[3];b++)y=ke(x,b,r,!1,!0),t.isNullOrUndefined(y.value)?y.formula&&(this.parent.notify("calculateFormula",{cell:y,rowIdx:x,colIdx:b,sheetIndex:this.parent.activeSheetIndex}),d=y.value.toString().toLowerCase(),u()):(d=y.value.toString().toLowerCase(),u()),p++;if(i||a){if(v=v.sort(function(e,t){return e-t}),e.type.includes("Bottom")||(v=v.reverse()),a){var S=parseFloat(l);e.type.includes("Percentage")&&(S=(S=Math.round(S/(100/p)))||1),v=v.slice(0,S)}}else o&&((v=[v[0]/v[1]])[0]||(v=[]));e.result=v},e.prototype.applyCF=function(e){var t=!e.cfModel,r=this.parent.getActiveSheet(),n=e.cfModel||r.conditionalFormats,i=[e.indexes],o=!1;if(e.refreshAll&&(i=[[this.parent.viewport.topIndex+this.parent.frozenRowCount(r),this.parent.viewport.leftIndex+this.parent.frozenColCount(r),this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]],r.frozenRows||r.frozenColumns)){var a=this.parent.frozenRowCount(r),s=this.parent.frozenColCount(r),l=u(r.topLeftCell);if(a&&s){i.push([l[0],l[1],a-1,s-1]);var h=u(r.paneTopLeftCell);i.push([h[0],l[1],this.parent.viewport.bottomIndex,s-1])}a&&i.push([l[0],this.parent.viewport.leftIndex+s,a-1,this.parent.viewport.rightIndex]),s&&i.push([this.parent.viewport.topIndex+a,l[1],this.parent.viewport.bottomIndex,s-1])}for(var d=n.length-1;d>=0;d--)(!t||(2===i[0].length?this.checkCellHandler(e.indexes[0],e.indexes[1],n[d]):de(i,n[d].range)))&&(o=this.updateCF(e,r,n[d],o))},e.prototype.updateCF=function(e,r,n,i){var o,a,s=this;if(n.value){var l=n.value.split(",").filter(function(e){return!!e.trim()});if(l.length>1)if(l[0].split("(").length>1){for(var h="",d=0;d<l.length;d++)(h+=l[d]+",").split("(").length===h.split(")").length&&void 0===o&&(o=h.substring(0,h.length-1),h="");a=h.substring(0,h.length-1)}else{o=l[0];for(d=1;d<l.length;d++)a+=d+1===l.length?l[d]:l[d]+","}else o=l[0]||n.value}n.type||(n.type="GreaterThan");var p;n.format&&n.format.style?(p=Te(n.format.style,!0),Object.keys(p).length||n.cFColor||(n.cFColor="RedFT")):(p={},n.cFColor||(n.cFColor="RedFT"));var f,m,v,y=n.type.includes("DataBar"),C=n.type.includes("ColorScale");e.isRender&&n.result||!("Duplicate"===n.type||"Unique"===n.type||y||C||(f=n.type.includes("Average"))||(m=n.type.includes("10")&&N(o))||(v=n.type.includes("Three")||n.type.includes("Four")||n.type.includes("Five")))||this.updateResult(n,r,y,C,f,m,v,o);var x=function(r,l,h,d){var c,u,f=h&&!t.isNullOrUndefined(h.value)?h.value.toString():"",m=!0;switch(n.type){case"GreaterThan":case"LessThan":c=s.isGreaterThanLessThan(n,f,o);break;case"Between":c=N(f)&&s.isBetWeen(n,f,o,a);break;case"EqualTo":c=N(f)&&s.isEqualTo(n,f,o);break;case"ContainsText":c=f&&s.isContainsText(f,o);break;case"DateOccur":u={value:o,cell:{},updatedVal:""},s.parent.notify(ur,u),c=f===u.updatedVal;break;case"Unique":c=-1===n.result.indexOf(f.toLowerCase());break;case"Duplicate":c=n.result.indexOf(f.toLowerCase())>-1;break;case"Top10Items":case"Bottom10Items":case"Top10Percentage":case"Bottom10Percentage":if(n.result){var v=parseFloat(f);L(f)&&(v=T(f)),c=n.result.indexOf(v)>-1}break;case"AboveAverage":c=n.result.length&&parseFloat(f)>n.result[0];break;case"BelowAverage":c=n.result.length&&parseFloat(f)<n.result[0];break;default:m=!1,y?s.applyDataBars(f,n,d,r):C?s.applyColorScale(f,n,d,h,r,l):s.applyIconSet(f,n,d)}if(e.isAction&&m&&(s.parent.trigger("beforeConditionalFormat",{conditionalFormat:n,cell:h,element:d,apply:c,address:g(r,l)}),!c&&e.isEdit&&!i)){var x;e.indexes[0]===r&&e.indexes[1]===l&&(i=!0),n.cFColor?d.className.includes("e-"+n.cFColor.toLowerCase())&&(d.classList.remove("e-"+n.cFColor.toLowerCase()),d.style.backgroundColor="",d.style.color="",((x=t.extend({},s.parent.commonCellStyle,h&&h.style)).backgroundColor||x.color)&&s.parent.notify(hr,{rowIdx:r,colIdx:l,cell:d,style:{backgroundColor:x.backgroundColor,color:x.color}})):(d.removeAttribute("style"),x=t.extend({},s.parent.commonCellStyle,h&&h.style),Object.keys(x).length&&s.parent.notify(hr,{style:x,rowIdx:r,colIdx:l,cell:d}))}c&&(e.isEdit&&e.indexes[0]===r&&e.indexes[1]===l&&(i=!0),t.removeClass([d],["e-redft","e-yellowft","e-greenft","e-redf","e-redt"]),n.cFColor&&(d.classList.add("e-"+n.cFColor.toLowerCase()),s.setCFStyle(p,n)),Object.assign(d.style,p))};if(e.ele)x(e.indexes[0],e.indexes[1],e.cell,e.ele);else for(var b=n.range.split(","),S=this.parent.frozenRowCount(r),w=this.parent.frozenColCount(r),I=u(r.topLeftCell),E=0;E<b.length;E++)this.updateRange(r,c(b[E]),S,w,I,x);return i},e.prototype.updateRange=function(e,t,r,n,i,o){t[0]=t[0]<r?t[0]<i[0]?i[0]:t[0]:t[0]<this.parent.viewport.topIndex+r?this.parent.viewport.topIndex+r:t[0],t[1]=t[1]<n?t[1]<i[1]?i[1]:t[1]:t[1]<this.parent.viewport.leftIndex+n?this.parent.viewport.leftIndex+n:t[1],t[2]=t[2]<r?t[2]<i[0]?i[0]-1:t[2]:t[2]>this.parent.viewport.bottomIndex?this.parent.viewport.bottomIndex:t[2],t[3]=t[3]<n?t[3]<i[1]?i[1]-1:t[3]:t[3]>this.parent.viewport.rightIndex?this.parent.viewport.rightIndex:t[3];for(var a,s=t[0];s<=t[2];s++)if(r&&s===r&&(s=this.parent.viewport.topIndex+r),!He(e,s))for(var l=t[1];l<=t[3];l++)n&&l===n&&(l=this.parent.viewport.leftIndex+n),Ge(e,l)||(a=this.parent.getCell(s,l))&&o(s,l,ke(s,l,e),a)},e.prototype.applyIconSet=function(e,t,r){if(r.classList.contains("e-iconset")){r.classList.remove("e-iconset");var n=r.querySelector(".e-iconsetspan");n&&r.removeChild(n)}var i=parseInt(e,10),o=t.result;if(!(isNaN(i)||void 0===o[0]&&void 0===o[1])){var a,s=o[0],l=o[1],h=this.getIconList(t.type).split(",");if(3===h.length){var d=s+.33*(l-s);a="e-"+(i>=s+.67*(l-s)?h[0].trim():i>=d?h[1].trim():h[2].trim())}else if(4===h.length){var p=s+.25*(l-s),c=s+.5*(l-s);a="e-"+(i>=(u=s+.75*(l-s))?h[0].trim():i>=c?h[1].trim():i>=p?h[2].trim():h[3].trim())}else if(5===h.length){p=s+.2*(l-s),c=s+.4*(l-s);var u=s+.6*(l-s);a="e-"+(i>=s+.8*(l-s)?h[0].trim():i>=u?h[1].trim():i>=c?h[2].trim():i>=p?h[3].trim():h[4].trim())}var f=this.parent.createElement("span",{className:"e-icon e-iconsetspan "+a});r.insertBefore(f,r.childNodes[0]),r.classList.add("e-iconset")}},e.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},e.prototype.applyColorScale=function(e,r,n,i,o,a){var s=parseFloat(e);if(isNaN(s)){if(n.style.backgroundColor){n.style.backgroundColor="";var l=t.extend({},this.parent.commonCellStyle,i&&i.style);l.backgroundColor&&this.parent.notify(hr,{style:{backgroundColor:l.backgroundColor},cell:n,rowIdx:o,colIdx:a})}}else{var h=r.result,d=h.indexOf(s),p=this.getColor(r.type);n.style.backgroundColor=0===d?p[0]:d===h.length-1?p[p.length-1]:3===h.length&&1===d?p[1]:this.getGradient(d,p[0],p[1],p[2],h.length)}},e.prototype.applyDataBars=function(e,t,r,n){var i,o=this.parent.getActiveSheet(),a=t.result,s=0,l=parseInt(e,10);if(void 0===a[0]&&void 0===a[1]||isNaN(l)){var h=r.getElementsByClassName("e-cf-databar")[0];h&&r.removeChild(h)}else{void 0!==a[0]&&void 0!==a[1]?(i=a[0]+Math.abs(a[1]),s=Math.abs(a[1]/i*100)):i=void 0!==a[0]?a[0]:a[1];var d=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),p=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),c=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),u=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),f=r.querySelector(".e-iconsetspan");f&&r.insertBefore(f,r.firstElementChild);var g=Ue(o,n,!0);d.style.height=g-1+"px";var m=t.type[0];"L"===m&&(m+="B"),void 0===a[1]?(c.style.width=Math.ceil(Math.abs(l/i*100))+"%",c.style.height=g-3+"px",c.style.backgroundColor=this.getColor(m)[0],c.style.left="0px"):void 0===a[0]?(c.style.width=Math.ceil(Math.abs(l/i*100))+"%",c.style.height=g-3+"px",c.style.backgroundColor=this.getColor("R")[0],c.style.left="0px"):l>=0?(p.style.width=s+"%",p.style.height=g-3+"px",p.style.backgroundColor="transparent",p.style.left="0px",c.style.width=Math.ceil(Math.abs(l/i*100))+"%",c.style.height=g-3+"px",c.style.backgroundColor=this.getColor(m)[0],c.style.left=s+"%"):(p.style.width=Math.ceil(Math.abs(l/i*100))+"%",p.style.height=g-3+"px",p.style.backgroundColor=this.getColor("R")[0],p.style.width===s+"%"?p.style.left="0px":p.style.right=100-s+"%"),u.style.fontSize=r.style.fontSize||"11pt",u.innerHTML=r.textContent,d.appendChild(p),d.appendChild(c),d.appendChild(u),r.textContent="",r.appendChild(d)}},e.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),r=[],n=0;n<t.length;n++)switch(t[n]){case"G":r.push("#63be7b");break;case"Y":r.push("#ffeb84");break;case"R":r.push("#f8696b");break;case"W":r.push("#ffffff");break;case"B":r.push("#5a8ac6");break;case"O":r.push("#ffb628");break;case"LB":r.push("#008aef");break;case"P":r.push("#d6007b")}return r},e.prototype.getGradient=function(e,r,n,i,o){if(t.isNullOrUndefined(i))return this.getLinear(r,n,e/o);var a=o/2;return e>=a?this.getLinear(n,i,Math.abs((e-a)/a)):this.getLinear(r,n,e/a)},e.prototype.getLinear=function(e,t,r){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],r)+this.byteLinear(e[3]+e[4],t[3]+t[4],r)+this.byteLinear(e[5]+e[6],t[5]+t[6],r)},e.prototype.byteLinear=function(e,t,r){var n=parseInt(e,16)*(1-r)+parseInt(t,16)*r|0;return Math.abs(n).toString(16)},e.prototype.isGreaterThanLessThan=function(e,t,r){if(N(t)){if(N(r)){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g);return"GreaterThan"===e.type?parseFloat(t)>parseFloat(r.replace(n,"")):parseFloat(t)<parseFloat(r.replace(n,""))}var i={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};return this.parent.notify(ur,i),i.isDate||i.isTime?(e.value=i.updatedVal.toString(),"GreaterThan"===e.type?t>i.updatedVal:t<i.updatedVal):"GreaterThan"===e.type?t.toLowerCase()>r.toLowerCase():t.toLowerCase()<r.toLowerCase()}return""===t&&Number(r)>0&&"LessThan"===e.type},e.prototype.isBetWeen=function(e,t,r,n){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g);if(r=r.replace(i,""),n=n.replace(i,""),N(r))return parseFloat(t)>=parseFloat(r)&&parseFloat(t)<=parseFloat(n);if(r&&n){var o={value:r,cell:{},updatedVal:""},a={value:n,cell:{},updatedVal:""};return this.parent.notify(ur,o),this.parent.notify(ur,a),(o.isDate||o.isTime)&&(a.isDate||a.isTime)?(e.value=o.updatedVal+","+a.updatedVal,t>=o.updatedVal&&t<=a.updatedVal):t.toLowerCase()>=r.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return!1},e.prototype.isEqualTo=function(e,t,r){if(N(r)){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g);return parseFloat(t)===parseFloat(r.replace(n,""))}var i={value:r,cell:{},updatedVal:""};return this.parent.notify(ur,i),i.isTime||i.isDate?(e.value=i.updatedVal,t===i.updatedVal):t.toLowerCase()===r.toLowerCase()},e.prototype.isContainsText=function(e,t){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g);return N(t.replace(r,""))?(t=t.replace(r,""),L(e)&&(e=T(e).toString()),e.indexOf(t)>-1):L(t)?(L(e)&&(e=T(e).toString()),e.indexOf(T(t).toString())>-1):e.toLowerCase().indexOf(t.toLowerCase())>-1},e.prototype.setCFStyle=function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},e.prototype.getModuleName=function(){return"conditionalFormatting"},e}(),Bl=function(){function e(e){this.fillOptionIndex=0,this.parent=e,this.addEventListener()}return e.prototype.getfillItems=function(){var e=this.parent.serviceLocator.getService(ph);return[{text:e.getConstant("CopyCells")},{text:e.getConstant("FillSeries")},{text:e.getConstant("FillFormattingOnly")},{text:e.getConstant("FillWithoutFormatting")}]},e.prototype.createAutoFillElement=function(){if(this.parent.allowAutoFill){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-autofill"});e.lastElementChild&&e.lastElementChild.classList.contains("e-ss-overlay")?e.insertBefore(t,e.getElementsByClassName("e-ss-overlay")[0]):e.appendChild(t),this.autoFillElement=t,this.getautofillDDB({id:this.parent.element.id+"_autofilloptionbtn",appendElem:e})}},e.prototype.getautofillDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e.id,className:"e-filloption",attrs:{type:"button"}});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"})),this.autoFillDropDown=new n.DropDownButton({cssClass:"e-dragfill-ddb",iconCss:"e-icons e-dragfill-icon",items:this.getfillItems(),createPopupOnClick:!0,select:function(e){t.autoFillOptionClick({type:t.getFillType(e.item.text)})},beforeOpen:function(){return t.autoFillClick()}}),this.autoFillDropDown.createElement=this.parent.createElement,this.autoFillDropDown.appendTo(r),e.appendElem.appendChild(r),this.autoFillDropDown},e.prototype.getFillType=function(e){var t=this.parent.serviceLocator.getService(ph);return e===t.getConstant("CopyCells")?"CopyCells":e===t.getConstant("FillSeries")?"FillSeries":e===t.getConstant("FillFormattingOnly")?"FillFormattingOnly":"FillWithoutFormatting"},e.prototype.autoFillClick=function(){var e=this.parent.serviceLocator.getService(ph),t={fillType:"FillSeries",disableItems:[""]};this.parent.notify(Un,t),this.autoFillDropDown.setProperties({items:this.getfillItems()},!0),this.autoFillDropDown.removeItems(t.disableItems),this.refreshAutoFillOption(e.getConstant(t.fillType))},e.prototype.getFillRange=function(e,t,r,n){switch(n){case"Up":return[r.rowIndex,e.colIndex,e.rowIndex-1,t.colIndex];case"Right":return[e.rowIndex,t.colIndex+1,t.rowIndex,r.colIndex];case"Down":return[t.rowIndex+1,e.colIndex,r.rowIndex,t.colIndex];case"Left":return[e.rowIndex,r.colIndex,t.rowIndex,e.colIndex-1]}},e.prototype.autoFillOptionClick=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.getActiveSheet(),n=w(c(this.parent.selectionModule.dAutoFillCell)),i=c(r.selectedRange),o=n[0],a=n[1],s=n[2],l=n[3],h=this.getDirection({rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]}),d=[o,a,s,l],p=this.getFillRange({rowIndex:o,colIndex:a},{rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]},h);this.refreshAutoFillOption(t.getConstant(e.type)),this.parent.notify(Po,{isUndo:!0,isPublic:!0,preventEvt:"FillWithoutFormatting"===e.type,preventReSelect:!0});var u={dataRange:r.name+"!"+m(d),fillRange:r.name+"!"+m(p),direction:h,fillType:e.type,isFillOptClick:!0};this.isVerticalFill="Down"===u.direction||"Up"===u.direction,this.parent.notify(Hn,u),this.positionAutoFillElement({isautofill:!0});var f={dataRange:u.dataRange,fillRange:u.fillRange,fillType:u.fillType,direction:u.direction,selectedRange:r.name+"!"+m(i)};this.parent.notify(Yo,{eventArgs:f,action:"autofill"}),this.parent.notify(ma,{}),this.autoFillClick()},e.prototype.refreshAutoFillOption=function(e){for(var t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].iconCss="";for(t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].text===e&&(this.autoFillDropDown.items[t].iconCss="e-icons e-selected-icon");["Copy Cells","Fill Series","Fill Formatting Only","Fill Without Formatting"].indexOf(e)<0&&(this.autoFillDropDown.items[this.fillOptionIndex].iconCss=""),this.autoFillDropDown.dataBind()},e.prototype.positionAutoFillElement=function(e){var r,n,i,o=0,a=0,s=this.parent.getActiveSheet(),l=w(c(s.selectedRange)),h=-5,d=-5,p=6,u=6,f=0===l[1]&&l[3]===s.colCount-1,g=0===l[0]&&l[2]===s.rowCount-1,m=l[2],v=l[3],y=this.parent.getCell(m,v);if(Ge(s,l[3])||He(s,l[2])||y&&y.classList.contains("e-formularef-selection")||s.isProtected&&s.protectSettings.selectUnLockedCells&&Ht(this.parent,l))this.hideAutoFillElement();else if(s.isProtected&&(s.protectSettings.selectCells||s.protectSettings.selectUnLockedCells)||!s.isProtected)if(f?(h=-5,d=-1,p=6,u=2,m=l[2],v=l[1]):g&&(d=-5,h=0,p=1,u=6,m=l[0],v=l[3]),s.frozenColumns||s.frozenRows){if(g||f?(nt(this.parent,this.autoFillElement,l,"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&nt(this.parent,this.autoFillDropDown.element,l,"e-filloption")):(nt(this.parent,this.autoFillElement,[m,v,m,v],"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&nt(this.parent,this.autoFillDropDown.element,[m,v,m,v],"e-filloption")),this.autoFillElement){this.autoFillCell={rowIndex:m,colIndex:v};var C=this.parent.element.querySelectorAll(".e-autofill")[0];if(C){var x=C.getBoundingClientRect();this.autoFillElementPosition={left:x.left,top:x.top}}}}else if(i=rt(s,[m,v,m,v],this.parent.frozenRowCount(s),this.parent.frozenColCount(s),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth),r=Ve(s,m,m,!0),n=We(s,v,v,!0),g||(o+=r),f||(a+=n),o+=Math.round(i.top)+h,a+=Math.round(i.left)+d,this.autoFillElement){t.removeClass([this.autoFillElement],"e-hide"),this.autoFillElement.style.top=o+"px",this.autoFillElement.style.left=a+"px",this.autoFillCell={rowIndex:m,colIndex:v};x=this.autoFillElement.getBoundingClientRect();this.autoFillElementPosition={left:x.left,top:x.top},this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&(t.removeClass([this.autoFillDropDown.element],"e-hide"),this.autoFillDropDown.element.style.top=o+p+"px",this.autoFillDropDown.element.style.left=a+u+"px")}},e.prototype.hideAutoFillElement=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-autofill")).forEach(function(r){e&&t.addClass([r],"e-hide")})},e.prototype.hideAutoFillOptions=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-filloption")).forEach(function(r){e&&t.addClass([r],"e-hide")})},e.prototype.selectAutoFillRange=function(e){var t={clientY:vt(e.e),target:e.e.target},r={clientX:mt(e.e),target:e.e.target},n=this.parent.getActiveSheet();this.parent.notify(La,t),this.parent.notify(Na,r);var i,o=this.getAutoFillRange({rowIndex:t.clientY,colIndex:r.clientX});return i=o&&o.fillRange?[o.startCell.rowIndex,o.startCell.colIndex,o.endCell.rowIndex,o.endCell.colIndex]:c(n.selectedRange),e.indexes=i,i},e.prototype.getAutoFillRange=function(e){var t=this.parent.getActiveSheet(),r=this.autoFillCell,n=w(c(t.selectedRange)),i=n[0],o=n[1],a=n[2],s=n[3],l=Q(n,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],!0),h={rowIndex:i,colIndex:o},d={rowIndex:n[0],colIndex:n[1]},p={rowIndex:n[2],colIndex:n[3]},u={rowIndex:a,colIndex:s},f=this.modifyRangeForMerge(e.rowIndex,e.colIndex,r.rowIndex,r.colIndex,n);return e.rowIndex<r.rowIndex?i-e.rowIndex>e.colIndex-s&&i-e.rowIndex>o-e.colIndex?l?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:s}}:{startCell:u,endCell:{rowIndex:f.rowIndex,colIndex:o},fillRange:[f.rowIndex,o,i-1,s],direction:"Up"}:e.colIndex>r.colIndex?{startCell:h,endCell:{rowIndex:a,colIndex:e.colIndex},fillRange:[i,s+1,a,e.colIndex],direction:"Right"}:e.colIndex<r.colIndex?l?{startCell:h,endCell:u}:{startCell:u,endCell:{rowIndex:i,colIndex:e.colIndex},fillRange:[i,e.colIndex,a,o-1],direction:"Left"}:{startCell:d,endCell:p}:e.colIndex>r.colIndex?e.rowIndex-a>e.colIndex-s?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[a+1,o,e.rowIndex,s],direction:"Down"}:{startCell:h,endCell:{rowIndex:a,colIndex:f.colIndex},fillRange:[i,s+1,a,f.colIndex],direction:"Right"}:e.colIndex<r.colIndex?e.rowIndex-a>s-e.colIndex||e.rowIndex-i>s-e.colIndex&&e.rowIndex!==a?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[a+1,o,e.rowIndex,s],direction:"Down"}:l?{startCell:h,endCell:u}:{startCell:u,endCell:{rowIndex:i,colIndex:f.colIndex},fillRange:[i,f.colIndex,a,o-1],direction:"Left"}:e.rowIndex>r.rowIndex?{startCell:h,endCell:{rowIndex:f.rowIndex,colIndex:s},fillRange:[a+1,o,f.rowIndex,s],direction:"Down"}:(e.rowIndex===r.rowIndex&&(e.colIndex,r.colIndex),{startCell:d,endCell:p})},e.prototype.modifyRangeForMerge=function(e,t,r,n,i){var o={rowIndex:e,colIndex:t};if(this.isMergedRange(i)){var a=i[2]-i[0]+1,s=i[3]-i[1]+1,l=void 0;e<r?(l=(i[2]-e+1)%a)&&e-(a-l)>=0&&(o.rowIndex=e-(a-l)):t>n?(l=(t-i[1]+1)%s)&&(o.colIndex=t+(s-l)):t<n?(l=(i[3]-t+1)%s)&&t-(s-l)>=0&&(o.colIndex=t-(s-l)):e>r&&(l=(e-i[0]+1)%a)&&(o.rowIndex=e+(a-l))}return o},e.prototype.performAutoFill=function(e){if(e.event.clientX>this.autoFillElementPosition.left&&e.event.clientX<this.autoFillElementPosition.left+10&&e.event.clientY>this.autoFillElementPosition.top&&e.event.clientY<this.autoFillElementPosition.top+10)this.positionAutoFillElement({isautofill:!1});else{var t={clientY:vt(e.event),target:e.event.target},r={clientX:mt(e.event),target:e.event.target},n=this.parent.getActiveSheet();this.parent.notify(La,t),this.parent.notify(Na,r);var i=this.getAutoFillRange({rowIndex:t.clientY,colIndex:r.clientX});if(i&&i.fillRange){var o={dataRange:n.name+"!"+e.dAutoFillCell,fillRange:n.name+"!"+m(i.fillRange),direction:i.direction,fillType:this.parent.autoFillSettings.fillType,cancel:!1};if(this.parent.notify(Zt,{eventArgs:o,action:"autofill"}),o.cancel)return;var a=Ht(this.parent,i.fillRange);if(n.isProtected&&a)return void this.parent.notify(la,null);this.performAutoFillAction(o,i,a),this.isMergedRange(c(o.dataRange))&&this.parent.renderModule.refreshSheet(),this.positionAutoFillElement({isautofill:!this.isMergedRange(c(o.fillRange))})}}},e.prototype.refreshCell=function(e){this.parent.serviceLocator.getService("cell").refreshRange([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])},e.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},e.prototype.fillRange=function(e){var t={dataRange:"",fillRange:"",direction:"Down",fillType:"CopyCells"},r=this.parent.getActiveSheet(),n=w(c(r.selectedRange)),i=n[0],o=n[1],a=n[2],s=n[3],l=this.getDirection({rowIndex:i,colIndex:o},{rowIndex:a,colIndex:s},e.verticalFill),h=e.verticalFill?"Down"===l:"Right"===l;if(this.isRange(n)&&h)e.verticalFill?(t.dataRange=r.name+"!"+m([i,o,i,s]),t.fillRange=r.name+"!"+m([i+1,o,a,s])):(t.dataRange=r.name+"!"+m([i,o,a,o]),t.fillRange=r.name+"!"+m([i,o+1,a,s]));else{if(e.verticalFill){if(!i)return;t.dataRange=r.name+"!"+m([i-1,o,i-1,s])}else{if(!o)return;t.dataRange=r.name+"!"+m([i,o-1,a,o-1])}t.fillRange=r.name+"!"+m(n)}t.direction=e.verticalFill?"Down":"Right",t.fillType="CopyCells",r.isProtected||this.performAutoFillAction(t)},e.prototype.getDirection=function(e,r,n){if(n=t.isNullOrUndefined(n)?this.isVerticalFill:n){if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down";if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left"}else{if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left";if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down"}return null},e.prototype.performAutoFillAction=function(e,t,r){var n=this,i=this.parent.getActiveSheet(),o=this.parent.serviceLocator.getService(ph);if(this.isMergedRange(c(e.fillRange))){var a=this.parent.serviceLocator.getService(ch);a.show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:o.getConstant("AutoFillMergeAlertMsg"),buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(ph).getConstant("Ok"),isPrimary:!0},click:function(){a.hide(),n.parent.selectRange(e.dataRange)}}],close:function(){a.hide(),n.parent.selectRange(e.dataRange)}},!1)}else{this.isVerticalFill="Down"===e.direction||"Up"===e.direction,this.parent.notify(Hn,{dataRange:e.dataRange,fillRange:e.fillRange,direction:e.direction,fillType:e.fillType,isLockedCell:r});var s=t?m([t.startCell.rowIndex,t.startCell.colIndex,t.endCell.rowIndex,t.endCell.colIndex]):i.selectedRange;ye(this.parent,s,i);var l={dataRange:e.dataRange,fillRange:e.fillRange,fillType:e.fillType,direction:e.direction,selectedRange:s};this.parent.notify(Yo,{eventArgs:l,action:"autofill"}),this.parent.notify(ma,{})}},e.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],o=e.range[1],a=e.range[2],s=e.range[3],l=o;i<=a;)if(He(n,i))i++;else{for(o=l;o<=s;)Ge(n,o)?o++:(t=ke(i,o,n),r.push(t),o++);i++}return r},e.prototype.isMergedRange=function(e){var t=0,r=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex});for(t=0;t<r.length;t++)if(r[t]&&(r[t].rowSpan||r[t].colSpan))return!0;return!1},e.prototype.addEventListener=function(){this.parent.on(Li,this.createAutoFillElement,this),this.parent.on(ss,this.positionAutoFillElement,this),this.parent.on(ls,this.hideAutoFillOptions,this),this.parent.on(cs,this.hideAutoFillElement,this),this.parent.on(hs,this.performAutoFill,this),this.parent.on(ps,this.fillRange,this),this.parent.on(ds,this.selectAutoFillRange,this),this.parent.on(Bn,this.refreshCell,this),this.parent.on(_n,this.getautofillDDB,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Li,this.createAutoFillElement),this.parent.off(ss,this.positionAutoFillElement),this.parent.off(ls,this.hideAutoFillOptions),this.parent.off(cs,this.hideAutoFillElement),this.parent.off(hs,this.performAutoFill),this.parent.off(ps,this.fillRange),this.parent.off(ds,this.selectAutoFillRange),this.parent.off(Bn,this.refreshCell),this.parent.off(_n,this.getautofillDDB))},e.prototype.destroy=function(){this.removeEventListener(),this.autoFillElement=null,this.autoFillElementPosition=null,this.autoFillCell=null,this.autoFillDropDown=null,this.isVerticalFill=null,this.fillOptionIndex=null,this.parent=null},e.prototype.getModuleName=function(){return"autofill"},e}(),Ul=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_l=function(){return(_l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},Vl=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},zl=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ul(r,e),Vl([t.Property("")],r.prototype,"text",void 0),Vl([t.Property("")],r.prototype,"iconCss",void 0),Vl([t.Property("left")],r.prototype,"iconPosition",void 0),r}(t.ChildProperty),ql=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ul(r,e),Vl([t.Complex({},zl)],r.prototype,"header",void 0),Vl([t.Collection([],o.Item)],r.prototype,"content",void 0),Vl([t.Property("")],r.prototype,"cssClass",void 0),Vl([t.Property(!1)],r.prototype,"disabled",void 0),r}(t.ChildProperty),jl=function(e){function r(t,r){return e.call(this,t)||this}return Ul(r,e),r.prototype.preRender=function(){},r.prototype.render=function(){this.element.id||(this.element.id=t.getUniqueID("ribbon")),this.renderRibbon()},r.prototype.destroy=function(){var r=this.element.querySelector(".e-drop-icon");if(r&&r.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var n=document.getElementById(this.element.id+"_menu");n&&t.getComponent(n,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,e.prototype.destroy.call(this)},r.prototype.getTabItems=function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(function(r){t.push({header:r.header,content:e.toolbarObj.element})}),t},r.prototype.initMenu=function(e){var r=this,n=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(n);var i=new o.Menu({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(t){t.parentItem.text===e[0].text&&(i.showItemOnClick=!1),r.trigger("beforeOpen",t)},select:function(e){r.trigger("fileMenuItemSelect",e)},beforeClose:function(n){"mouseover"!==n.event.type||t.closest(n.event.target,".e-menu-popup")?(r.trigger("beforeClose",n),n.parentItem&&n.parentItem.text!==e[0].text||requestAnimationFrame(function(){return i.setProperties({showItemOnClick:!0},!0)})):n.cancel=!0},beforeItemRender:function(e){r.trigger("beforeFileMenuItemRender",e)}});return i.createElement=this.createElement,i.appendTo(n),n.parentElement},r.prototype.renderRibbon=function(){var e=this,r=this.createElement("div"),n=this.createElement("div");this.toolbarObj=new o.Toolbar({items:this.items[this.selectedTab].content,clicked:function(t){return e.trigger("clicked",t)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(n),this.tabObj=new o.Tab({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(r){if(e.menuItems.length&&0===r.selectingIndex)r.cancel=!0;else{if(r.selectingIndex===e.getIndex(e.selectedTab))return;e.updateToolbar(e.getIndex(r.selectingIndex,!0)),e.toolbarObj.dataBind(),e.element.classList.contains("e-collapsed")&&t.EventHandler.remove(r.selectedItem,"click",e.ribbonExpandCollapse);var n=void 0;e.menuItems.length?((n=_l({},r)).selectingIndex-=1,n.selectedIndex-=1):n=r,e.trigger("selecting",n)}},selected:function(t){t.selectedIndex!==e.getIndex(e.selectedTab)&&(e.setProperties({selectedTab:e.getIndex(t.selectedIndex,!0)},!0),e.element.classList.contains("e-collapsed")&&(e.element.classList.remove("e-collapsed"),e.trigger("expandCollapse",{element:e.toolbarObj.element,expanded:!0})))},created:function(){e.toolbarObj.refreshOverflow()}}),this.element.appendChild(r),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(r);var i=this.createElement("span",{className:"e-drop-icon e-icons"});i.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(i)},r.prototype.ribbonExpandCollapse=function(e){var r,n={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(r=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),r.classList.add("e-active"),t.EventHandler.remove(r,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",n)):(r=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),n.expanded=!1,r.classList.remove("e-active"),t.EventHandler.add(r,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",n))},r.prototype.getIndex=function(e,t){return this.menuItems.length?t?e-1:e+1:e},r.prototype.updateToolbar=function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()},r.prototype.enableMenuItems=function(e,r,n){void 0===r&&(r=!0),this.menuItems.length&&t.getComponent(document.getElementById(this.element.id+"_menu"),"menu").enableItems(e,r,n)},r.prototype.hideMenuItems=function(e,r,n){if(void 0===r&&(r=!0),this.menuItems.length){var i=t.getComponent(document.getElementById(this.element.id+"_menu"),"menu");r?i.hideItems(e,n):i.showItems(e,n)}},r.prototype.addMenuItems=function(e,r,n,i){if(void 0===n&&(n=!0),this.menuItems.length){var o=t.getComponent(document.getElementById(this.element.id+"_menu"),"menu");n?o.insertAfter(e.reverse(),r,i):o.insertBefore(e,r,i)}},r.prototype.hideTabs=function(e,t){var r=this;void 0===t&&(t=!0);var n,i,o,a;if(t||(a=this.isAllHidden()),e.forEach(function(e){(n=r.getTabIndex(e,-1))>-1&&(t?r.items[n].cssClass.includes(" e-hide")||(r.items[n].cssClass=r.items[n].cssClass+" e-hide",r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),o=!0):r.items[n].cssClass.includes(" e-hide")&&(r.items[n].cssClass=r.items[n].cssClass.replace(" e-hide",""),r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),o=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(a=this.isAllHidden())&&(i=!1),!t&&a&&(i=!i),o&&a&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),i)for(var s=0;s<this.items.length;s++)if(!this.items[s].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(s),this.tabObj.dataBind();break}},r.prototype.isAllHidden=function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e},r.prototype.enableTabs=function(e,t){var r=this;void 0===t&&(t=!0),e.forEach(function(e){var n=r.getTabIndex(e,-1);n>-1&&(r.items[n].disabled=!t,n=r.getIndex(n),r.tabObj.enableTab(n,t))}),this.setProperties({items:this.items},!0)},r.prototype.addTabs=function(e,t){var r=this,n=this.getTabIndex(t);e.forEach(function(e){e=new ql(r.items[0],"items",e,!0),r.items.splice(n,0,e),r.tabObj.addTab([{header:e.header,content:r.toolbarObj.element}],r.getIndex(n)),n++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},r.prototype.getTabIndex=function(e,t){if(void 0===t&&(t=this.items.length),e)for(var r=0;r<this.items.length;r++)if(this.items[r].header.text===e){t=r;break}return t},r.prototype.addToolbarItems=function(e,r,n){var i=this,a=this.getTabIndex(e);t.isNullOrUndefined(n)&&(n=this.items[a].content.length),r.forEach(function(e){e=new o.Item(i.items[a].content[0],"content",e,!0),i.items[a].content.splice(n,0,e),n++}),this.setProperties({items:this.items},!0),a===this.selectedTab&&r.length&&this.updateToolbar(a)},r.prototype.enableItems=function(e,t,r){if(void 0===r&&(r=!0),t){var n=this.getTabIndex(e,-1);if(n<0)return;for(var i=0;i<t.length;i++){if("string"==typeof t[i])for(var o=0;o<this.items[n].content.length;o++)if(this.items[n].content[o].id===t[i]){t[i]=o;break}if("string"==typeof t[i]){if(t.length-1>i)continue;return}this.items[n].content[t[i]].disabled=!r,this.setProperties({items:this.items},!0),n===this.selectedTab&&this.toolbarObj.enableItems(t[i],r)}}else this.toolbarObj.disable(!r)},r.prototype.hideToolbarItems=function(e,t,r){var n=this;void 0===r&&(r=!0);for(var i,o=0;o<this.items.length;o++)if(this.items[o].header.text===e){i=o,t.forEach(function(e){n.items[i].content[e]&&(r?n.items[i].content[e].cssClass.includes(" e-hide")||(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass+" e-hide"):n.items[i].content[e].cssClass.includes(" e-hide")&&(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==i&&i===this.selectedTab&&this.updateToolbar(i)},r.prototype.getModuleName=function(){return"ribbon"},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){switch(n[r]){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}}},Vl([t.Property("")],r.prototype,"cssClass",void 0),Vl([t.Property(!0)],r.prototype,"menuType",void 0),Vl([t.Collection([],o.MenuItem)],r.prototype,"menuItems",void 0),Vl([t.Property(0)],r.prototype,"selectedTab",void 0),Vl([t.Collection([],ql)],r.prototype,"items",void 0),Vl([t.Event()],r.prototype,"selecting",void 0),Vl([t.Event()],r.prototype,"fileMenuItemSelect",void 0),Vl([t.Event()],r.prototype,"beforeFileMenuItemRender",void 0),Vl([t.Event()],r.prototype,"beforeOpen",void 0),Vl([t.Event()],r.prototype,"beforeClose",void 0),Vl([t.Event()],r.prototype,"selectFormat",void 0),Vl([t.Event()],r.prototype,"clicked",void 0),Vl([t.Event()],r.prototype,"created",void 0),Vl([t.Event()],r.prototype,"expandCollapse",void 0),r=Vl([t.NotifyPropertyChanges],r)}(t.Component),Wl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){var e=this,r=this.parent.element.id,n=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new a.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:fh,enableOpacity:!1,beforeClose:function(){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(e.fontColorPicker,t)},change:function(t){var r={style:{color:e.fontColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(ar,r),r.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.color,e.fontColorPicker.element,"TextColor")},created:function(){return e.updateSelectedColor("#000000",e.fontColorPicker.element,"TextColor",!0)}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.fontColorPicker.appendTo(n),n.parentElement.id=r+"_font_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),n=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new a.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:gh,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(t){return e.beforeModeSwitch(e.filColorPicker,t)},change:function(t){var r={style:{backgroundColor:e.filColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(ar,r),r.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.backgroundColor,e.filColorPicker.element,"FillColor")},created:function(){return e.updateSelectedColor("#ffff00",e.filColorPicker.element,"FillColor",!0)}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.filColorPicker.appendTo(n),n.parentElement.id=r+"_fill_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},e.prototype.updateSelectedColor=function(e,t,r,n){var i=this.parent.serviceLocator.getService(ph).getConstant(r);n&&t.parentElement.querySelector(".e-dropdown-btn").setAttribute("aria-label",i);var o=t.parentElement.querySelector(".e-split-colorpicker");o.setAttribute("aria-label",i+" "+e),o.firstElementChild.style.borderBottomColor=e},e.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(ph).getConstant("MoreColors")},e.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0),Pt(e.element.parentElement.querySelector(".e-split-colorpicker"))},e.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(ph);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},e.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},e.prototype.addEventListener=function(){this.parent.on(vo,this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on(Di,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off(vo,this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on(Di,this.destroy,this)},e}(),Gl=function(){function e(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.preTabIdx=1,this.parent=e,this.addEventListener(),new Wl(e)}return e.prototype.getModuleName=function(){return"ribbon"},e.prototype.ribbonOperation=function(e){e&&e.onPropertyChange?this.onPropertyChanged(e.prop):this.initialize()},e.prototype.initialize=function(e){if(this.parent.notify(vo,{}),this.parent.isMobileView())this.createMobileView();else{var t=e&&(this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel"));this.createRibbon(t)}},e.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(ph),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:t+"_File",items:[{text:e.getConstant("New"),id:t+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:t+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:t+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:t+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:t+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:t+"_Csv",iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:t+"_Pdf",iconCss:"e-pdf e-icons"}]}]}]},e.prototype.getRibbonItems=function(){var e=this,r=this.parent.element.id,n=this.parent.serviceLocator.getService(ph),i=[{header:{text:n.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:n.getConstant("Undo")+" (Ctrl+Z)",htmlAttributes:{"aria-label":n.getConstant("Undo")},id:r+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:n.getConstant("Redo")+" (Ctrl+Y)",htmlAttributes:{"aria-label":n.getConstant("Redo")},id:r+"_redo",disabled:!0},{type:"Separator",id:r+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:n.getConstant("Cut")+" (Ctrl+X)",htmlAttributes:{"aria-label":n.getConstant("Cut")},id:r+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:n.getConstant("Copy")+" (Ctrl+C)",htmlAttributes:{"aria-label":n.getConstant("Copy")},id:r+"_copy"},{tooltipText:n.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(r),htmlAttributes:{"aria-label":n.getConstant("Paste")},id:r+"_paste",disabled:!0},{type:"Separator",id:r+"_separator_2"},{template:this.getNumFormatDDB(r),tooltipText:n.getConstant("NumberFormat"),id:r+"_number_format"},{type:"Separator",id:r+"_separator_3"},{template:this.getFontNameDDB(r),tooltipText:n.getConstant("Font"),id:r+"_font_name"},{type:"Separator",id:r+"_separator_4"},{template:this.getFontSizeDDB(r),tooltipText:n.getConstant("FontSize"),id:r+"_font_size"},{type:"Separator",id:r+"_separator_5"},{template:this.getBtn(r,"bold",n.getConstant("Bold")),tooltipText:n.getConstant("Bold")+" (Ctrl+B)",id:r+"_bold"},{template:this.getBtn(r,"italic",n.getConstant("Italic")),tooltipText:n.getConstant("Italic")+" (Ctrl+I)",id:r+"_italic"},{template:this.getBtn(r,"line-through",n.getConstant("Strikethrough")),tooltipText:n.getConstant("Strikethrough")+" (Ctrl+5)",id:r+"_line-through"},{template:this.getBtn(r,"underline",n.getConstant("Underline")),tooltipText:n.getConstant("Underline")+" (Ctrl+U)",id:r+"_underline"},{template:document.getElementById(r+"_font_color_picker"),tooltipText:n.getConstant("TextColor"),id:r+"_font_color_picker"},{type:"Separator",id:r+"_separator_6"},{template:document.getElementById(r+"_fill_color_picker"),tooltipText:n.getConstant("FillColor"),id:r+"_fill_color_picker"},{template:this.getBordersDBB(r),tooltipText:n.getConstant("Borders"),id:r+"_borders"},{template:this.getMergeSplitBtn(r),tooltipText:n.getConstant("MergeCells"),htmlAttributes:{"aria-label":n.getConstant("MergeCells")},id:r+"_merge_cells",disabled:!0},{type:"Separator",id:r+"_separator_7"},{template:this.getTextAlignDDB(r),tooltipText:n.getConstant("HorizontalAlignment"),id:r+"_text_align"},{template:this.getVerticalAlignDDB(r),tooltipText:n.getConstant("VerticalAlignment"),id:r+"_vertical_align"},{template:this.getBtn(r,"wrap",n.getConstant("WrapText"),!1),tooltipText:""+n.getConstant("WrapText"),id:r+"_wrap"}]},{header:{text:n.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:n.getConstant("Link"),id:r+"_hyperlink",tooltipText:n.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:n.getConstant("Image"),id:r+"_image",tooltipText:n.getConstant("Image"),click:function(){t.select("#"+r+"_imageUpload",e.parent.element).click()}}]},{header:{text:n.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:n.getConstant("InsertFunction"),text:n.getConstant("InsertFunction"),id:r+"_insert_function"}]},{header:{text:n.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:n.getConstant("ProtectSheet"),id:r+"_protect",tooltipText:n.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:n.getConstant("ProtectWorkbook"),id:r+"_protectworkbook",tooltipText:n.getConstant("ProtectWorkbook")},{type:"Separator",id:r+"_separator_8"},{template:this.datavalidationDDB(r),tooltipText:n.getConstant("DataValidation"),id:r+"_datavalidation"}]},{header:{text:n.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:r+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:r+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:r+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:r+"_separator_13"},{prefixIcon:"e-freeze-pane",text:n.getConstant("FreezePanes"),id:r+"_freezepanes",tooltipText:n.getConstant("FreezePanes"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-row",text:n.getConstant("FreezeRows"),id:r+"_freezerows",tooltipText:n.getConstant("FreezeRows"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-column",text:n.getConstant("FreezeColumns"),id:r+"_freezecolumns",tooltipText:n.getConstant("FreezeColumns"),disabled:!this.parent.allowFreezePane}]}];return this.parent.allowConditionalFormat&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_10"},{template:this.getCFDBB(r),tooltipText:n.getConstant("ConditionalFormatting"),id:r+"_conditionalformatting"}),this.parent.allowChart&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Insert")}).content.push({type:"Separator",id:r+"_separator_11"},{template:this.getChartDDB(r,!0),text:n.getConstant("Chart"),tooltipText:n.getConstant("Chart"),id:r+"_chart"}),this.parent.allowCellFormatting&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_12"},{template:this.getClearDDB(r),tooltipText:n.getConstant("Clear"),id:r+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({template:this.getSortFilterDDB(r),tooltipText:n.getConstant("SortAndFilter"),id:r+"_sorting"}),this.parent.allowFindAndReplace&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({template:this.getFindBtn(r),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:n.getConstant("FindReplaceTooltip"),id:r+"_find"}),i},e.prototype.getPasteBtn=function(e){var t=this,r=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste",attrs:{type:"button"}})),i=this.parent.serviceLocator.getService(ph);return this.pasteSplitBtn=new n.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:i.getConstant("All"),id:"All"},{text:i.getConstant("Values"),id:"Values"},{text:i.getConstant("Formats"),id:"Formats"}],createPopupOnClick:!0,select:function(e){t.pasteSplitBtn.element.setAttribute("aria-label",i.getConstant("Paste")+" "+e.item.text),t.parent.notify(no,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){r.setAttribute("aria-label",i.getConstant("Paste")),t.parent.notify(no,{isAction:!0,isInternal:!0})},beforeOpen:function(e){e.element.setAttribute("aria-label",i.getConstant("Paste"))}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(r),r.parentElement},e.prototype.getHyperlinkDlg=function(){var e,r=c(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[r[0]];t.isNullOrUndefined(n)||(e=n.cells[r[1]]),t.isNullOrUndefined(e)&&Fe(r[0],r[1],this.parent.getActiveSheet(),e,!1),e&&e.hyperlink?this.parent.notify(To,null):this.parent.notify(Fo,null)},e.prototype.passwordProtectDlg=function(){this.parent.password.length>0?this.parent.notify(Qa,null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify(Za,null)},e.prototype.getLocaleText=function(e){var t=this.parent.serviceLocator.getService(ph);return this.parent.getActiveSheet()["show"+e]?t.getConstant("Hide"+e):t.getConstant("Show"+e)},e.prototype.getLocaleProtectText=function(e,t){var r,n=this.parent.serviceLocator.getService(ph);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Protect"+e)),r},e.prototype.getLocaleProtectWorkbook=function(e,t){var r,n=this.parent.serviceLocator.getService(ph);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant(e)),r},e.prototype.insertDesignChart=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=this.ribbon.items.length-1,n=t.getConstant("ChartDesign");if(this.parent.allowChart&&this.ribbon.items[r]&&this.ribbon.items[r].header.text!==n){this.preTabIdx=this.ribbon.selectedTab;var i=this.parent.element.id,o=[{header:{text:n},content:[{template:this.getAddChartEleDBB(i),tooltipText:t.getConstant("AddChartElement"),id:i+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:t.getConstant("SwitchRowColumn"),tooltipText:t.getConstant("SwitchRowColumn"),id:i+"switch_row_column_chart",click:function(){e.parent.notify(Wa,{switchRowColumn:!0,triggerEvent:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(i),tooltipText:t.getConstant("ChartTheme"),id:i+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(i,!1),tooltipText:t.getConstant("ChartType"),id:i+"_chart_type"}]}];this.addRibbonTabs({items:o}),this.ribbon.tabObj.select(this.ribbon.items.length)}},e.prototype.removeDesignChart=function(){var e=this.parent.serviceLocator.getService(ph),t=this.ribbon.items.length-1;this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)},e.prototype.createRibbon=function(e){var t=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});this.ribbon=new jl({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e?this.parent.element.insertBefore(t,e):this.parent.element.appendChild(t),this.ribbon.appendTo(t)},e.prototype.tabSelecting=function(e){if(e.selectingIndex!==this.ribbon.selectedTab){if(this.parent.allowChart){var t=this.parent.serviceLocator.getService(ph);if(this.ribbon.items[e.selectingIndex]&&this.ribbon.items[e.selectingIndex].header.text===t.getConstant("Insert")&&this.createChartDdb(document.getElementById(this.parent.element.id+"_chart-btn"),!0),this.ribbon.items[e.selectedIndex]&&this.ribbon.items[e.selectedIndex].header.text===t.getConstant("Insert"))for(var r=this.ribbon.items[e.selectedIndex].content,n=r.length-1;n>=0;n--)if(r[n].id===this.parent.element.id+"_chart"){var i=r[n].template;i&&i.classList.contains("e-dropdown-btn")&&this.destroyComponent(i,"dropdown-btn");break}}this.refreshRibbonContent(e.selectingIndex),this.parent.notify(Ji,{activeTab:e.selectingIndex})}},e.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(ph);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")},e.prototype.getChartThemeDDB=function(e){var r=this,i=this.parent.serviceLocator.getService(ph),o=this.parent.createElement("button",{id:e+"_chart_theme",attrs:{type:"button"}});o.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"}));var a="Material",s=this.parent.element.querySelector(".e-ss-overlay-active");if(s){var l=void 0;(l=s.querySelector(".e-chart"))?a=t.getComponent(l,"chart").theme:(l=s.querySelector(".e-accumulationchart"))&&(a=t.getComponent(l,"accumulationchart").theme)}var h=new n.DropDownButton({items:this.getChartThemeDdbItems(a),content:i.getConstant("Material"),createPopupOnClick:!0,select:function(e){r.parent.notify(Wn,{type:"mousedown"}),e.element&&e.element.querySelector(".e-selected-icon")||(h.content=e.item.text,h.dataBind(),r.parent.notify(Wa,{chartTheme:e.item.id,triggerEvent:!0}),h.setProperties({items:r.getChartThemeDdbItems(e.item.id)},!0))},close:function(){return r.parent.element.focus()},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(e){r.tBarDdbBeforeOpen(e.element,e.items,r.parent.serviceLocator.getService(ph).getConstant("Chart"))}});return h.createElement=this.parent.createElement,h.appendTo(o),o},e.prototype.getNumFormatDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_number_format",attrs:{type:"button"}});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new n.DropDownButton({items:this.getNumFormatDdbItems(e),createPopupOnClick:!0,select:function(e){return t.numDDBSelect(e)},open:function(e){return t.numDDBOpen(e)},beforeItemRender:function(e){return t.previewNumFormat(e)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(ph).getConstant("NumberFormat"))}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(r),r},e.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new n.DropDownButton({cssClass:"e-font-size-ddb",content:"11",createPopupOnClick:!0,items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(ph).getConstant("FontSize")),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var r={style:{fontSize:e.item.text+"pt"},onActionUpdate:!0};t.parent.notify(ar,r),r.cancel||(t.fontSizeDdb.content=r.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind()),t.fontSizeDdb.element.setAttribute("aria-label",e.item.text)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size",attrs:{type:"button"}})),this.fontSizeDdb.element},e.prototype.getChartDDB=function(e,t){var r,n=this.parent.serviceLocator.getService(ph);return t?(r=this.parent.createElement("button",{id:e+"_chart-btn",attrs:{type:"button"}})).appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:n.getConstant("Chart")})):((r=this.parent.createElement("button",{id:e+"_chart-type-btn",attrs:{type:"button"}})).appendChild(this.parent.createElement("span",{id:e+"_chart_type",innerHTML:n.getConstant("ChartType")})),this.createChartDdb(r,!1)),r},e.prototype.createChartDdb=function(e,r){var i,o=this,a=this.parent.serviceLocator.getService(ph),s=r?"e-chart-menu":"e-chart-type-menu",l=this.parent.createElement("ul",{id:this.parent.element.id+(r?"_chart_menu":"_chart_type_menu")}),h=new n.DropDownButton({iconCss:"e-icons "+(r?"e-chart-icon":"e-chart-type-icon"),cssClass:r?"e-chart-ddb":"e-chart-type-ddb",target:l,createPopupOnClick:!0,beforeOpen:function(e){i=o.createChartMenu(l,s,a,h),o.tBarDdbBeforeOpen(e.element,i.items,o.parent.serviceLocator.getService(ph).getConstant("Chart"))},open:function(){return Pt(l)},beforeClose:function(e){e.event&&t.closest(e.event.target,"."+s)?e.cancel=!0:i.destroy()}});h.createElement=this.parent.createElement,h.appendTo(e)},e.prototype.createChartMenu=function(e,t,r,n){var i=this,a=new o.Menu({cssClass:t,items:[{iconCss:"e-icons e-column",text:r.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:r.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:r.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:r.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:r.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:r.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===r.getConstant("Column")?(e.element.firstChild.appendChild(s),e.element.parentElement.classList.add("e-column-chart")):e.parentItem.text===r.getConstant("Bar")?(e.element.firstChild.appendChild(v),e.element.parentElement.classList.add("e-bar-chart")):e.parentItem.text===r.getConstant("Area")?(e.element.firstChild.appendChild(A),e.element.parentElement.classList.add("e-area-chart")):e.parentItem.text===r.getConstant("Line")?(e.element.firstChild.appendChild(D),e.element.parentElement.classList.add("e-line-chart")):e.parentItem.text===r.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(U),e.element.parentElement.classList.add("e-pie-doughnut-chart")):e.parentItem.text===r.getConstant("Radar")?(e.element.firstChild.appendChild(j),e.element.parentElement.classList.add("e-radar-chart")):e.parentItem.text===r.getConstant("Scatter")&&(e.element.firstChild.appendChild(K),e.element.parentElement.classList.add("e-scatter-chart"))},select:function(e){return i.chartSelected(e,n)}}),s=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),l=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:r.getConstant("Column")}),h=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),d=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});s.appendChild(l),s.appendChild(h);var p=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),c=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),u=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),f=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),g=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),m=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});p.title=r.getConstant("ClusteredColumn"),c.title=r.getConstant("StackedColumn"),u.title=r.getConstant("StackedColumn100"),m.title=r.getConstant("OrangeDataBar"),g.title=r.getConstant("LightblueDataBar"),f.title=r.getConstant("PurpleDataBar"),h.appendChild(p),h.appendChild(c),h.appendChild(u),d.appendChild(f),d.appendChild(g),d.appendChild(m);var v=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),y=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:r.getConstant("Bar")}),C=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),x=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});v.appendChild(y),v.appendChild(C);var b=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),S=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),w=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),I=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),E=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),R=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});b.title=r.getConstant("ClusteredBar"),S.title=r.getConstant("StackedBar"),w.title=r.getConstant("StackedBar100"),R.title=r.getConstant("OrangeDataBar"),E.title=r.getConstant("LightblueDataBar"),I.title=r.getConstant("PurpleDataBar"),C.appendChild(b),C.appendChild(S),C.appendChild(w),x.appendChild(I),x.appendChild(E),x.appendChild(R);var A=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),k=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:r.getConstant("Area")}),F=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});A.appendChild(k),A.appendChild(F);var T=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),L=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),N=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});T.title=r.getConstant("Area"),L.title=r.getConstant("StackedArea"),N.title=r.getConstant("StackedArea100"),F.appendChild(T),F.appendChild(L),F.appendChild(N);var D=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),O=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:r.getConstant("Line")}),M=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});D.appendChild(O),D.appendChild(M);var P=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),H=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),B=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});P.title=r.getConstant("Line"),H.title=r.getConstant("StackedLine"),B.title=r.getConstant("StackedLine100"),M.appendChild(P),M.appendChild(H),M.appendChild(B);var U=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),_=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:r.getConstant("Pie")}),V=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});U.appendChild(_),U.appendChild(V);var z=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),q=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});z.title=r.getConstant("Pie"),q.title=r.getConstant("Doughnut"),V.appendChild(z),V.appendChild(q);var j=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),W=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),G=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});j.appendChild(W),j.appendChild(G);var Y=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),X=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});Y.title=r.getConstant("BlueDataBar"),X.title=r.getConstant("GreenDataBar"),G.appendChild(Y),G.appendChild(X);var K=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),$=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:r.getConstant("Scatter")}),Z=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});K.appendChild($),K.appendChild(Z);var Q=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});return Q.title=r.getConstant("Scatter"),Z.appendChild(Q),a.createElement=this.parent.createElement,a.appendTo(e),e.classList.add("e-ul"),a},e.prototype.getAddChartEleDBB=function(e){var r,i=this,o=this.parent.serviceLocator.getService(ph),a=this.parent.createElement("ul",{id:e+"_add_chart_menu"});this.addChartDdb=new n.DropDownButton({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:a,createPopupOnClick:!0,close:function(){return Pt(i.parent.element)},beforeOpen:function(e){r=i.createAddChartMenu(a,o),i.tBarDdbBeforeOpen(e.element,r.items)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-addchart-menu")?e.cancel=!0:r.destroy()}}),this.addChartDdb.createElement=this.parent.createElement;var s=this.parent.createElement("button",{id:e+"_addchart",attrs:{type:"button"}});return s.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:o.getConstant("AddChartElement")})),this.addChartDdb.appendTo(s),this.addChartDdb.element},e.prototype.createAddChartMenu=function(e,t){var r=new o.Menu({cssClass:"e-addchart-menu",title:t.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:t.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:t.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:t.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:t.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:t.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",text:t.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:t.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:t.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:t.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:t.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:t.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:t.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:t.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:t.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:t.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:t.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:t.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:t.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:t.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:t.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:t.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:t.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this)});return r.createElement=this.parent.createElement,r.appendTo(e),e.classList.add("e-ul"),r},e.prototype.getCFDBB=function(e){var r,i=this,o=this.parent.createElement("ul",{id:e+"_cf_menu"});return this.cfDdb=new n.DropDownButton({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:o,createPopupOnClick:!0,close:function(){return Pt(i.parent.element)},beforeOpen:function(e){r=i.createCFMenu(o),i.tBarDdbBeforeOpen(e.element,r.items,i.parent.serviceLocator.getService(ph).getConstant("ConditionalFormatting"))},open:function(){return Pt(o)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-cf-menu")?e.cancel=!0:r.destroy()}}),this.cfDdb.createElement=this.parent.createElement,this.cfDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting",attrs:{type:"button"}})),this.cfDdb.element},e.prototype.createCFMenu=function(e){var t=this,r=this.parent.serviceLocator.getService(ph),n=function(e,n,i){e.forEach(function(e){i.appendChild(t.parent.createElement("span",{id:e+n,className:"e-"+e.toLowerCase()+" e-cf-icon",attrs:{title:r.getConstant(e+n)}}))})},i=new o.Menu({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:r.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan_dlg",text:r.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan_dlg",text:r.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between_dlg",text:r.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto_dlg",text:r.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textcontains_dlg",text:r.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring_dlg",text:r.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues_dlg",text:r.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:r.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items_dlg",text:r.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10_dlg",text:r.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items_dlg",text:r.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10_dlg",text:r.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage_dlg",text:r.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage_dlg",text:r.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:r.getConstant("DataBars"),items:[{id:"db_icons1"},{id:"db_icons2"}]},{iconCss:"e-icons e-colorscales",text:r.getConstant("ColorScales"),items:[{id:"cs_icons1"},{id:"cs_icons2"},{id:"cs_icons3"}]},{iconCss:"e-icons e-iconsets",text:r.getConstant("IconSets"),items:[{id:"is_icons"}]},{iconCss:"e-icons e-clearrules",text:r.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:r.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:r.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(e){"e-icons e-databars"===e.parentItem.iconCss?(e.element.parentElement.classList.add("e-databars"),n(["Blue","Green","Red"],"DataBar",e.element.firstChild),n(["Orange","LightBlue","Purple"],"DataBar",e.element.lastChild)):"e-icons e-colorscales"===e.parentItem.iconCss?(e.element.parentElement.classList.add("e-colorscales"),n(["GYR","RYG","GWR","RWG"],"ColorScale",e.element.firstChild),n(["BWR","RWB","WR","RW"],"ColorScale",e.element.querySelector("#cs_icons2")),n(["GW","WG","GY","YG"],"ColorScale",e.element.lastChild)):"e-icons e-iconsets"===e.parentItem.iconCss&&(e.element.parentElement.classList.add("e-iconsets"),e.element.firstChild.appendChild(a))},select:this.cfSelected.bind(this)});i.createElement=this.parent.createElement;var a=this.parent.createElement("div",{id:"is",className:"e-is"}),s=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),l=this.parent.createElement("div",{id:"is2",className:"e-is2"}),h=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),d=this.parent.createElement("div",{id:"is4",className:"e-is4"}),p=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),c=this.parent.createElement("div",{id:"is6",className:"e-is6"}),u=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),f=this.parent.createElement("div",{id:"is8",className:"e-is8"});s.title=r.getConstant("GYColorScale"),l.title=r.getConstant("YGColorScale"),h.title=r.getConstant("GYColorScale"),d.title=r.getConstant("YGColorScale"),p.title=r.getConstant("GYColorScale"),c.title=r.getConstant("YGColorScale"),u.title=r.getConstant("GYColorScale"),f.title=r.getConstant("YGColorScale"),a.appendChild(s),a.appendChild(l),a.appendChild(h),a.appendChild(d),a.appendChild(p),a.appendChild(c),a.appendChild(u),a.appendChild(f);var g=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),m=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),v=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),y=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),C=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),x=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),b=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});g.title=r.getConstant("ThreeArrowsColor"),m.title=r.getConstant("ThreeArrowsGray"),v.title=r.getConstant("ThreeTriangles"),y.title=r.getConstant("FourArrowsColor"),C.title=r.getConstant("FourArrowsGray"),x.title=r.getConstant("FiveArrowsColor"),b.title=r.getConstant("FiveArrowsGray"),l.appendChild(g),l.appendChild(m),l.appendChild(v),l.appendChild(y),l.appendChild(C),l.appendChild(x),l.appendChild(b);var S=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),w=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),I=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),E=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),R=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});S.title=r.getConstant("ThreeTrafficLights1"),w.title=r.getConstant("ThreeTrafficLights2"),I.title=r.getConstant("ThreeSigns"),E.title=r.getConstant("FourTrafficLights"),R.title=r.getConstant("RedToBlack"),d.appendChild(S),d.appendChild(w),d.appendChild(I),d.appendChild(E),d.appendChild(R);var A=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),k=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),F=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});A.title=r.getConstant("ThreeSymbols1"),k.title=r.getConstant("ThreeSymbols2"),F.title=r.getConstant("ThreeFlags"),c.appendChild(A),c.appendChild(k),c.appendChild(F);var T=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),L=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),N=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),D=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),O=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});return T.title=r.getConstant("ThreeStars"),L.title=r.getConstant("FourRatings"),N.title=r.getConstant("FiveQuarters"),D.title=r.getConstant("FiveRatings"),O.title=r.getConstant("FiveBoxes"),f.appendChild(T),f.appendChild(L),f.appendChild(N),f.appendChild(D),f.appendChild(O),g.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),g.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),g.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),v.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),v.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),v.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),y.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),y.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),y.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),y.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),x.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),x.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),x.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),x.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),x.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),b.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),b.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),b.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),b.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),b.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),S.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),S.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),S.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),w.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),w.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),w.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),I.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),I.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),I.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),E.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),E.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),E.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),E.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),R.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),R.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),R.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),R.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),A.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),A.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),A.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),k.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),k.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),k.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),F.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),F.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),F.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),T.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),T.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),T.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),L.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),L.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),L.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),L.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),N.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),N.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),N.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),N.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),N.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),D.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),D.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),D.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),D.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),D.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),O.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),O.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),O.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),O.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),O.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan")),i.createElement=this.parent.createElement,i.appendTo(e),e.classList.add("e-ul"),i},e.prototype.createElement=function(e,t){return this.parent.createElement(e,{className:t})},e.prototype.getBordersDBB=function(e){var r=this,i=this.parent.createElement("ul",{id:e+"_borders_menu"});this.cPickerEle=this.parent.createElement("input",{id:e+"_cell_border_color",attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new a.ColorPicker({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:function(e){var t=r.border.split(" ");t[2]=e.currentValue.hex,r.border=t.join(" ")}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle);var o;return this.bordersDdb=new n.DropDownButton({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:i,createPopupOnClick:!0,beforeOpen:function(e){o=r.createBorderMenu(i),r.tBarDdbBeforeOpen(e.element,o.items,r.parent.serviceLocator.getService(ph).getConstant("Borders"),1)},open:function(){return Pt(i)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-borders-menu")?e.cancel=!0:o.destroy()},close:function(){return Pt(r.bordersDdb.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders",attrs:{type:"button"}})),this.bordersDdb.element},e.prototype.createBorderMenu=function(e){var r=this,n=this.parent.serviceLocator.getService(ph),i=this.parent.element.id,a=new o.Menu({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:n.getConstant("TopBorders"),id:i+"_border_topborders"},{iconCss:"e-icons e-left-borders",text:n.getConstant("LeftBorders"),id:i+"_border_leftborders"},{iconCss:"e-icons e-right-borders",text:n.getConstant("RightBorders"),id:i+"_border_rightborders"},{iconCss:"e-icons e-bottom-borders",text:n.getConstant("BottomBorders"),id:i+"_border_bottomborders"},{iconCss:"e-icons e-all-borders",text:n.getConstant("AllBorders"),id:i+"_border_allborders"},{iconCss:"e-icons e-horizontal-borders",text:n.getConstant("HorizontalBorders"),id:i+"_border_horizontalborders"},{iconCss:"e-icons e-vertical-borders",text:n.getConstant("VerticalBorders"),id:i+"_border_verticalborders"},{iconCss:"e-icons e-outside-borders",text:n.getConstant("OutsideBorders"),id:i+"_border_outsideborders"},{iconCss:"e-icons e-inside-borders",text:n.getConstant("InsideBorders"),id:i+"_border_insideborders"},{iconCss:"e-icons e-no-borders",text:n.getConstant("NoBorders"),id:i+"_border_noborders"},{separator:!0},{text:n.getConstant("BorderColor"),items:[{id:i+"_border_colors"}],id:i+"_border_bordercolor"},{text:n.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:i+"_1px"},{id:i+"_2px"},{id:i+"_3px"},{id:i+"_dashed"},{id:i+"_dotted"},{id:i+"_double"}]}],orientation:"Vertical",beforeOpen:function(e){if(e.parentItem.id===i+"_border_bordercolor"){r.colorPicker.refresh();var t=r.colorPicker.element.parentElement;e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color")}else e.element.classList.add("e-border-style")},beforeClose:function(e){if(e.parentItem.id===i+"_border_bordercolor")if(!t.closest(e.event.target,".e-border-colorpicker")||t.closest(e.event.target,".e-apply")||t.closest(e.event.target,".e-cancel")){r.colorPicker=t.getComponent(r.cPickerEle,"colorpicker"),"Picker"===r.colorPicker.mode&&(r.colorPicker.mode="Palette",r.colorPicker.dataBind());var n=r.colorPicker.element.parentElement;n.style.display="",r.parent.element.appendChild(n)}else e.cancel=!0},onOpen:function(e){e.parentItem.id===i+"_border_bordercolor"&&(e.element.parentElement.style.overflow="visible")},select:function(e){r.borderSelected(e,a)}});return a.createElement=this.parent.createElement,a.appendTo(e),e.classList.add("e-ul"),a},e.prototype.chartSelected=function(e,r){var n=!t.isNullOrUndefined(t.closest(e.element,".e-chart-menu")),i=e.element.id;if("column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)){!e.item||e.item.items&&e.item.items.length||r.toggle();var o=e.event.target.id;this.parent.notify(Va,{action:i,id:o,isChart:n})}},e.prototype.addChartEleSelected=function(e){var t=e.element.id;this.parent.notify(Wa,{addChartEle:t,triggerEvent:!0}),!e.item||e.item.items&&e.item.items.length||this.addChartDdb.toggle()},e.prototype.cfSelected=function(e){var t=this.parent.getActiveSheet();if(e.item.id.includes("_dlg"))this.parent.notify(Ca,{action:e.item.text});else if(e.item.id.includes("icons")){var r=e.event.target;this.parent.notify(mn,{cfModel:{type:r.id||r.parentElement.id,range:t.selectedRange},isAction:!0})}else"cf_cr_cells"===e.item.id?this.parent.notify(yn,{range:t.selectedRange,isAction:!0}):"cf_cr_sheet"===e.item.id&&(this.parent.conditionalFormat=null,this.parent.notify(yn,{isAction:!0}));!e.item||e.item.items&&e.item.items.length||this.cfDdb.toggle()},e.prototype.borderSelected=function(e,t){this.bordersDdb.element.setAttribute("aria-label",e.item.text);var r=this.parent.element.id;if(!e.item.items.length&&e.item.id!==r+"_border_colors"){if(!e.item.text){var n=this.border.split(" "),i="solid"===n[1]?r+"_"+n[0]:r+"_"+n[1];if(i===e.item.id)return;return e.item.id===r+"_1px"||e.item.id===r+"_2px"||e.item.id===r+"_3px"?(n[0]=e.item.id.split(r+"_")[1],n[1]="solid"):(n[1]=e.item.id.split(r+"_")[1],n[0]="double"===n[1]?"3px":"1px"),this.border=n.join(" "),t.items[12].items.forEach(function(t){t.id===i&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")}),void t.setProperties({items:t.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.id){case r+"_border_topborders":this.parent.notify(ar,{style:{borderTop:this.border},onActionUpdate:!0});break;case r+"_border_leftborders":this.parent.notify(ar,{style:{borderLeft:this.border},onActionUpdate:!0});break;case r+"_border_rightborders":this.parent.notify(ar,{style:{borderRight:this.border},onActionUpdate:!0});break;case r+"_border_bottomborders":this.parent.notify(ar,{style:{borderBottom:this.border},onActionUpdate:!0});break;case r+"_border_allborders":this.parent.notify(ar,{style:{border:this.border},onActionUpdate:!0});break;case r+"_border_horizontalborders":this.parent.notify(ar,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case r+"_border_verticalborders":this.parent.notify(ar,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case r+"_border_outsideborders":this.parent.notify(ar,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case r+"_border_insideborders":this.parent.notify(ar,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case r+"_border_noborders":this.parent.notify(ar,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},e.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name",attrs:{type:"button"}});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new n.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),createPopupOnClick:!0,select:function(e){var n={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(ar,n),r.setAttribute("aria-label",e.item.text),n.cancel||t.refreshFontNameSelection(n.style.fontFamily)},beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(ph).getConstant("Font"))}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},e.prototype.getBtn=function(e,t,r,n){void 0===n&&(n=!0);var i=new s.Button({iconCss:"e-icons e-"+t+"-icon",cssClass:"e-flat",isToggle:!0});return i.createElement=this.parent.createElement,i.appendTo(this.parent.createElement("button",{id:e+"_"+t,attrs:{"aria-label":r,type:"button"}})),n&&i.element.addEventListener("click",this.toggleBtnClicked.bind(this)),i.element},e.prototype.datavalidationDDB=function(e){var t,r=this,i=this.parent.serviceLocator.getService(ph);return this.datavalidationDdb=new n.DropDownButton({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",content:i.getConstant("DataValidation"),items:[{text:i.getConstant("DataValidation")},{text:i.getConstant("HighlightInvalidData")},{text:i.getConstant("ClearHighlight")},{text:i.getConstant("ClearValidation")}],createPopupOnClick:!0,beforeOpen:function(e){r.refreshSelected(r.datavalidationDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",i.getConstant("DataValidation"))},select:function(e){switch(e.item.text){case i.getConstant("DataValidation"):r.parent.notify(Jo,null);break;case i.getConstant("HighlightInvalidData"):r.parent.notify(ea,{isRemoveHighlight:!1});break;case i.getConstant("ClearHighlight"):r.parent.notify(ea,{isRemoveHighlight:!0});break;case i.getConstant("ClearValidation"):r.parent.notify(ga,{isAction:!0});break;default:t=e.item.text===i.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(Eo,{sortOptions:{sortDescriptors:{order:t}}})}r.datavalidationDdb.element.setAttribute("aria-label",e.item.text)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation",attrs:{type:"button"}})),this.datavalidationDdb.element},e.prototype.getTextAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(ph);return this.textAlignDdb=new n.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment"))},select:function(e){var n={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(ar,n),n.cancel||(t.textAlignDdb.iconCss="e-icons e-"+n.style.textAlign+"-icon",t.textAlignDdb.dataBind()),t.textAlignDdb.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align",attrs:{type:"button"}})),this.textAlignDdb.element},e.prototype.getVerticalAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(ph);return this.verticalAlignDdb=new n.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("VerticalAlignment"))},select:function(e){var n={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(ar,n),n.cancel||(t.verticalAlignDdb.iconCss="e-icons e-"+n.style.verticalAlign+"-icon",t.verticalAlignDdb.dataBind()),t.verticalAlignDdb.element.setAttribute("aria-label",r.getConstant("VerticalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align",attrs:{type:"button"}})),this.verticalAlignDdb.element},e.prototype.getMergeSplitBtn=function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge",attrs:{type:"button"}}));var r=this.parent.serviceLocator.getService(ph);return this.mergeSplitBtn=new n.SplitButton({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",createPopupOnClick:!0,items:[{text:r.getConstant("MergeAll"),id:e+"_merge_all"},{text:r.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:r.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:r.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),click:function(e){e.element.setAttribute("aria-label",r.getConstant("MergeCells")),e.element.classList.contains("e-active")?(t.toggleActiveState(!1),t.unMerge()):(t.toggleActiveState(!0),t.merge(t.parent.element.id+"_merge_all"))},created:function(){t.mergeSplitBtn.element.title=r.getConstant("MergeCells"),t.mergeSplitBtn.element.nextElementSibling.title=r.getConstant("SelectMergeType")},beforeOpen:function(e){return e.element.setAttribute("aria-label",r.getConstant("MergeCells"))}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},e.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id),this.mergeSplitBtn.element.setAttribute("aria-label",e.item.text)},e.prototype.unMerge=function(e){this.parent.showSpinner();var t=this.parent.getActiveSheet().selectedRange;this.parent.notify(hn,{merge:!1,range:e?e.range||t:t,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()},e.prototype.merge=function(e){for(var t,r,n=this,i=this.parent.getActiveSheet(),o=c(i.selectedRange),a=o[0];a<=o[2];a++)for(var s=o[1];s<=o[3];s++)a===o[0]&&s===o[1]&&e.includes("merge_all")||a===o[0]&&e.includes("merge_vertically")||s===o[1]&&e.includes("_merge_horizontally")||((t=ke(a,s,i)||{}).value||t.formula)&&(r=!0);if(r){var l=this.parent.serviceLocator.getService(ch);l.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-merge-alert-dlg",content:this.parent.serviceLocator.getService(ph).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(ph).getConstant("Ok"),isPrimary:!0},click:function(){l.hide(),n.performMerge(e)}}]})}else this.performMerge(e)},e.prototype.performMerge=function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case t+"_merge_all":this.parent.notify(hn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case t+"_merge_horizontally":this.parent.notify(hn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case t+"_merge_vertically":this.parent.notify(hn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},e.prototype.getSortFilterDDB=function(e){var t,r=this,i=this.parent.serviceLocator.getService(ph);return this.sortingDdb=new n.DropDownButton({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:i.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:i.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:i.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:i.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:i.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:i.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],createPopupOnClick:!0,beforeItemRender:function(t){var n={isFiltered:!1,isClearAll:!0};r.parent.notify(Go,n),r.parent.allowSorting||t.item.text!==i.getConstant("SortAscending")&&t.item.text!==i.getConstant("SortDescending")&&t.item.text!==i.getConstant("CustomSort")+"..."||t.element.classList.add("e-disabled"),r.parent.allowFiltering||t.item.text!==i.getConstant("Filter")||t.element.classList.add("e-disabled"),t.item.id!==e+"_clearfilter"&&t.item.id!==e+"_reapplyfilter"||(n.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled"))},beforeOpen:function(e){r.refreshSelected(r.sortingDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.parent.serviceLocator.getService(ph).getConstant("SortAndFilter"))},select:function(e){switch(e.item.text){case i.getConstant("Filter"):r.parent.notify(Vo,{});break;case i.getConstant("ClearAllFilter"):r.parent.notify(Wo,{isAction:!0});break;case i.getConstant("ReapplyFilter"):r.parent.notify(qo,null);break;case i.getConstant("CustomSort")+"...":r.parent.notify(Io,null);break;default:t=e.item.text===i.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(Eo,{sortOptions:{sortDescriptors:{order:t}}})}r.sortingDdb.element.setAttribute("aria-label",e.item.text)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting",attrs:{type:"button"}})),this.sortingDdb.element},e.prototype.getFindBtn=function(e){var t=this.parent.createElement("button",{id:e+"_findbtn",attrs:{type:"button","aria-label":this.parent.serviceLocator.getService(ph).getConstant("FindReplaceTooltip")}});return this.findDdb=new s.Button({cssClass:"e-spreadsheet-find-ddb e-flat",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(t),t.onclick=this.findToolDlg.bind(this),this.findDdb.element},e.prototype.findToolDlg=function(e){var r=this,n=function(n){var i=e&&e.target?t.closest(e.target,"#"+r.parent.element.id+"_findbtn"):t.select("#"+r.parent.element.id+"_findbtn",r.ribbon.element);i&&(n?i.classList.add("e-disabled"):i.classList.remove("e-disabled"),i.disabled=n)};n(!0);var a=this.parent.element.getElementsByClassName("e-findtool-dlg")[0];if(a)this.findDialog.hide();else{var s,l=this.parent.createElement("div",{className:"e-input-group"}),h=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text"}});this.findValue&&(h.value=this.findValue);var d=this.parent.serviceLocator.getService(ph);h.setAttribute("placeholder",d.getConstant("FindValue"));var p,c=this.parent.createElement("span",{className:"e-input-group-icon"}),u=this.parent.getActiveSheet(),f=u.usedRange.rowIndex*u.usedRange.colIndex>100;h.onkeyup=function(e){var t=function(){if(h){var t=h.value;if(13===e.keyCode)h.value&&"0 of 0"!==c.textContent&&(r.parent.notify(aa,{findOption:e.shiftKey?"prev":"next"}),r.updateCount(c,e.shiftKey));else{var n=void 0;if(""===t)c.textContent="0 of 0",n=!1;else{var i={value:t,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(tn,i),c.textContent=i.findCount,n="0 of 0"!==i.findCount}s.enableItems(1,n),s.enableItems(2,n)}}};f?(p&&clearTimeout(p),p=setTimeout(t,500)):t()},l.appendChild(h),l.appendChild(c);var g=[{type:"Input",template:l},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}];s=new o.Toolbar({clicked:function(e){"e-findRib-next"===e.item.cssClass?(r.parent.notify(aa,{findOption:"next"}),r.updateCount(c)):"e-findRib-prev"===e.item.cssClass?(r.parent.notify(aa,{findOption:"prev"}),r.updateCount(c,!0)):"e-findRib-more"===e.item.cssClass&&(r.findDialog.animationSettings.effect="None",r.findDialog.setProperties({animationSettings:r.findDialog.animationSettings},!0),r.parent.notify(oa,null),r.findDialog.hide())},width:"auto",height:"auto",items:g,cssClass:"e-find-toolObj"});var m=this.parent.createElement("div",{className:"e-find-toolbar"});s.createElement=this.parent.createElement,s.appendTo(m),a=this.parent.createElement("div",{className:"e-dlg-div"}),this.findDialog=new i.Dialog({cssClass:"e-findtool-dlg",content:m,visible:!1,enableRtl:this.parent.enableRtl,target:this.parent.element.getElementsByClassName("e-sheet")[0],open:function(){if(t.EventHandler.add(document,"click",r.closeDialog,r),r.findValue){var e={value:r.findValue,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(tn,e),c.textContent=e.findCount}else c.textContent="0 of 0";n(!1),s.element.addEventListener("focus",function(){var e=document.querySelector(".e-text-findNext-short");e.focus(),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)})},beforeClose:function(){r.findValue=h.value||null,s.destroy(),t.EventHandler.remove(document,"click",r.closeDialog)},close:function(){r.findDialog.destroy(),r.findDialog=null,t.detach(a),Pt(r.parent.element),n(!1)},created:function(){a.style.width=r.parent.getMainContent().offsetWidth+"px",a.style.visibility="hidden",a.style.display="block",r.findDialog.width=2*parseInt(getComputedStyle(a).borderLeftWidth,10)+a.querySelector(".e-toolbar-items").getBoundingClientRect().width+"px",a.style.display="",a.style.width="",a.style.visibility="",a.style.top=r.parent.getColumnHeaderContent().parentElement.offsetHeight+1+"px",a.style.left="",a.style[r.parent.enableRtl?"left":"right"]=r.parent.sheetModule.getScrollSize()+"px",r.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(a)}},e.prototype.updateCount=function(e,t){var r,n=e.textContent.split(" ");t?(r=Number(n[0])-1)<1&&(r=Number(n[2])):(r=Number(n[0])+1)>Number(n[2])&&(r=1),n[0]=r.toString(),e.textContent=n.join(" ")},e.prototype.closeDialog=function(e){!t.closest(e.target,".e-findRib-close")&&t.closest(e.target,".e-spreadsheet")||!this.findDialog||this.findToolDlg()},e.prototype.getClearDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(ph);return this.clearDdb=new n.DropDownButton({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:r.getConstant("ClearAll"),id:e+"_Clear All"},{text:r.getConstant("ClearFormats"),id:e+"_Clear Formats"},{text:r.getConstant("ClearContents"),id:e+"_Clear Contents"},{text:r.getConstant("ClearHyperlinks"),id:e+"_Clear Hyperlinks"}],createPopupOnClick:!0,beforeOpen:function(e){e.element.setAttribute("aria-label",t.parent.serviceLocator.getService(ph).getConstant("Clear"))},select:function(r){t.parent.notify(xa,{options:{type:r.item.id.replace(e+"_","")},isAction:!0}),t.clearDdb.element.setAttribute("aria-label",r.item.text)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear",attrs:{type:"button"}})),this.clearDdb.element},e.prototype.ribbonCreated=function(){var e=this.parent.serviceLocator.getService(ph).getConstant("CollapseToolbar");t.attributes(this.ribbon.element.querySelector(".e-drop-icon"),{role:"button",tabindex:"-1",title:e,"aria-label":e})},e.prototype.alignItemRender=function(e){e.element.title=this.parent.serviceLocator.getService(ph).getConstant("Align"+this.getAlignText(e))},e.prototype.getAlignText=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];return t[0].toUpperCase()+t.slice(1,t.length)},e.prototype.toggleBtnClicked=function(e){var r,n,i,o,a,s=t.closest(e.target,".e-btn"),l=this.parent.element.id,h=s.id,d=ar;switch(h){case l+"_bold":n={fontWeight:"normal"},i={fontWeight:"bold"},a="fontWeight";break;case l+"_italic":n={fontStyle:"normal"},i={fontStyle:"italic"},a="fontStyle";break;case l+"_line-through":d=lr,i=n={textDecoration:"line-through"},a="textDecoration";break;case l+"_underline":d=lr,i=n={textDecoration:"underline"},a="textDecoration"}s.classList.contains("e-active")?(r=i[a],o={style:i,onActionUpdate:!0},this.parent.notify(d,o),o.cancel&&s.classList.remove("e-active")):(r=n[a],o={style:n,onActionUpdate:!0},this.parent.notify(d,o),o.cancel&&s.classList.add("e-active")),o.cancel||r===o.style[a]||this.refreshToggleBtn(u(this.parent.getActiveSheet().activeCell))},e.prototype.getCellStyleValue=function(e,t){var r=ke(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[e];return r&&r.style&&r.style[e]&&(n=r.style[e]),n},e.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][n]===e[r]){t.children[i].classList.add("e-selected");break}},e.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(ph);e.expanded?(t.title=r.getConstant("CollapseToolbar"),t.setAttribute("aria-label",r.getConstant("ExpandToolbar"))):(t.title=r.getConstant("ExpandToolbar"),t.setAttribute("aria-label",r.getConstant("CollapseToolbar"))),this.parent.setPanelSize()},e.prototype.getChartThemeDdbItems=function(e){var t=this.parent.serviceLocator.getService(ph),r=[];return["Material","Fabric","Bootstrap","HighContrastLight","MaterialDark","FabricDark","HighContrast","BootstrapDark","Bootstrap4","Bootstrap5Dark","Bootstrap5","TailwindDark","Tailwind","FluentDark","Fluent"].forEach(function(n){r.push({id:n,text:t.getConstant(n),iconCss:n===e?"e-icons e-selected-icon":""})}),r},e.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(ph);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")},{id:e+"_Custom",text:t.getConstant("Custom")}]},e.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Comic Sans MS"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},e.prototype.numDDBSelect=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.getActiveSheet(),n=u(r.activeCell),i=ke(n[0],n[1],r),o=e.item.id.split(this.parent.element.id+"_")[1],a={format:P(o),range:r.selectedRange,cancel:!1,requestType:"NumberFormat"};e.item.text===t.getConstant("Custom")&&i&&(a.format=i.format);var s={range:r.name+"!"+a.range,format:a.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",a),this.parent.notify(Zt,{eventArgs:a,action:"format"}),a.cancel||(this.parent.notify(nr,a),this.parent.notify(Wn,{type:"mousedown"}),e.item.text===t.getConstant("Custom")?this.renderCustomFormatDialog():(this.refreshNumFormatSelection(e.item.text),this.refreshTextAlign(r,ke(n[0],n[1],r,!1,!0),o,n),this.parent.notify(Yo,{eventArgs:s,action:"format"})),this.numFormatDDB.element.setAttribute("aria-label",o))},e.prototype.renderCustomFormatDialog=function(){var e=this,t=this.parent.serviceLocator.getService(ph),r=u(this.parent.getActiveSheet().activeCell),n=ke(r[0],r[1],this.parent.getActiveSheet()),i=this.parent.createElement("div"),o=this.parent.createElement("div",{className:"e-custom-dialog"}),a=this.parent.createElement("button",{className:"e-btn",innerHTML:t.getConstant("APPLY"),attrs:{type:"button"}}),s=this.parent.createElement("div",{className:"e-custom-sample",innerHTML:t.getConstant("CustomFormatSample")+":"}),l=this.parent.createElement("input",{className:"e-input e-dialog-input",attrs:{type:"text",name:"input",placeholder:t.getConstant("CustomFormat"),spellcheck:"false"}}),d=this.parent.createElement("div",{className:"e-custom-listview"}),p=this.parent.serviceLocator.getService(ch),c=new h.ListView({dataSource:[{text:"General"},{text:"0"},{text:"0.00"},{text:"#,##0"},{text:"#,##0.00"},{text:"#,##0_);(#,##0)"},{text:"#,##0_);[Red](#,##0)"},{text:"#,##0.00_);(#,##0.00)"},{text:"#,##0.00_);[Red](#,##0.00)"},{text:"$#,##0_);($#,##0)"},{text:"$#,##0_);[Red]($#,##0)"},{text:"$#,##0.00_);($#,##0.00)"},{text:"$#,##0.00_);[Red]($#,##0.00)"},{text:"0%"},{text:"0.00%"},{text:"0.00E+00"},{text:"##0.0E+0"},{text:"# ?/?"},{text:"# ??/??"},{text:"dd-MM-yy"},{text:"dd-MMM-yy"},{text:"dd-MMM"},{text:"MMM-yy"},{text:"h:mm AM/PM"},{text:"h:mm:ss AM/PM"},{text:"h:mm"},{text:"h:mm:ss"},{text:"dd-MM-yy h:mm"},{text:"mm:ss"},{text:"mm:ss.0"},{text:"@"},{text:"[h]:mm:ss"},{text:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)'},{text:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)'},{text:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'},{text:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'}],select:function(e){l.value=e.text}});o.appendChild(l),o.appendChild(a),o.appendChild(s),o.appendChild(d),c.appendTo(d),a.addEventListener("click",function(){var r=l.value,n={range:e.parent.getActiveSheet().name+"!"+e.parent.getActiveSheet().selectedRange,format:r,requestType:"NumberFormat"};e.parent.numberFormat(r,n.range),e.refreshNumFormatSelection(t.getConstant("Custom")),c.destroy(),p.hide(),e.parent.notify(Yo,{eventArgs:n,action:"format"})}),p.show({header:t.getConstant("CustomFormat"),cssClass:"e-custom-format-dlg",height:this.parent.cssClass.indexOf("e-bigger")>-1?502:480,width:440,isModal:!0,showCloseIcon:!0,content:o,footerTemplate:i});var f={text:n.format};c.selectItem(f)},e.prototype.tBarDdbBeforeOpen=function(e,t,r,n){void 0===n&&(n=0);var i=this.parent.viewport.height,o=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-n)+2*parseInt(getComputedStyle(e).paddingTop,10);if(n){var a=getComputedStyle(e.querySelector(".e-separator"));o+=n*(parseInt(a.borderBottomWidth,10)+2*parseInt(a.marginTop,10))}o>i?(e.style.height=i+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY=""),e.setAttribute("aria-label",r)},e.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},e.prototype.previewNumFormat=function(e){if("Custom"!==e.item.text){var t=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="";var r=this.parent.getActiveSheet(),n=u(r.activeCell),i=ke(n[0],n[1],r),o={type:e.item.text,formattedText:"",value:i&&(i.value||0===i.value)?i.value:"",format:P(e.item.id.split(this.parent.element.id+"_")[1]),sheetIndex:this.parent.activeSheetIndex,onLoad:!0};this.parent.notify(ir,o);var a=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:o.formattedText.toString()});t.appendChild(a),e.element.appendChild(t)}},e.prototype.refreshRibbonContent=function(e){if(this.ribbon){t.isNullOrUndefined(e)&&(e=this.ribbon.selectedTab);var r=this.parent.serviceLocator.getService(ph),n=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case r.getConstant("Home"):this.refreshHomeTabContent(u(n.activeCell));break;case r.getConstant("Insert"):case r.getConstant("Formulas"):break;case r.getConstant("Data"):this.refreshDataTabContent(e);break;case r.getConstant("View"):this.refreshViewTabContent(e)}}},e.prototype.refreshHomeTabContent=function(e){t.isNullOrUndefined(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=t.getComponent(document.getElementById(this.parent.element.id+"_number_format"),n.DropDownButton));var r=this.parent.getActiveSheet(),i=u(this.parent.getActiveSheet().activeCell),o=this.parent.serviceLocator.getService(ph),a=ke(i[0],i[1],this.parent.getActiveSheet())||{},s=H(a.format?a.format:"General");if(this.numFormatDDB&&(r.isProtected&&!r.protectSettings.formatCells?(s="General",this.refreshNumFormatSelection(s)):(a.format&&"General"===s&&(s="Custom"),this.refreshNumFormatSelection(o.getConstant(s)))),this.fontNameDdb&&(r.isProtected&&!r.protectSettings.formatCells?this.refreshFontNameSelection("Calibri"):this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",e))),this.fontSizeDdb){var l=this.getCellStyleValue("fontSize",e);r.isProtected&&!r.protectSettings.formatCells?this.fontSizeDdb.content="11":(l=l.includes("pt")?l.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=l,this.fontSizeDdb.dataBind())}if(this.refreshTextAlign(r,a,s,e),this.verticalAlignDdb){l="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon";r.isProtected&&!r.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":l!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=l,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!r.isProtected&&(a.rowSpan>1||a.colSpan>1))this.enableToolbarItems([{tab:o.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var h=c(r.selectedRange);this.enableToolbarItems([{tab:o.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:h[0]!==h[2]||h[1]!==h[3]}]),this.toggleActiveState(!1)}},e.prototype.refreshTextAlign=function(e,t,r,n){if(this.textAlignDdb){var i=this.getCellStyleValue("textAlign",n);if(e.isProtected&&!e.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0!==t.value&&"left"===i&&("Accounting"===r||N(t.value)&&"Text"!==r)&&(i="right");var o="e-icons e-"+i.toLowerCase()+"-icon";o!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=o,this.textAlignDdb.dataBind())}}},e.prototype.toggleActiveState=function(e){var t=this.parent.serviceLocator.getService(ph);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))},e.prototype.refreshToggleBtn=function(e){var t,r,n,i=this,o=this.parent.getActiveSheet(),a=this.parent.element.id,s=ke(e[0],e[1],o),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach(function(h,d){(t=document.getElementById(a+"_"+h))&&(o.isProtected&&!o.protectSettings.formatCells?t.classList.remove("e-active"):"wrap"===h?n=s&&s.wrap:(r=i.getCellStyleValue(l[d],e).toLowerCase(),n=r.indexOf(h)>-1),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))})},e.prototype.refreshFontNameSelection=function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.element.setAttribute("aria-label",e)},e.prototype.refreshNumFormatSelection=function(e){for(var t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0),this.numFormatDDB.element.setAttribute("aria-label",e)},e.prototype.fileMenuItemSelect=function(e){var r=this,n=t.extend({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",n);var i,o=this.parent.element.id;if(!n.cancel)switch(e.item.id){case o+"_Open":t.select("#"+o+"_fileUpload",this.parent.element).click();break;case o+"_Xlsx":case o+"_Xls":case o+"_Csv":case o+"_Pdf":this.parent.notify(er,e);break;case o+"_New":(i=this.parent.serviceLocator.getService(ch)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(ph).getConstant("DestroyAlert"),beforeOpen:function(e){var t={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Pt(r.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(ph).getConstant("Ok"),isPrimary:!0},click:function(){i.hide(),r.parent.refresh(!0)}}]})}},e.prototype.toolbarClicked=function(e){if("spreadsheet_find"!==e.item.id){var t=this.parent.element.id,r=this.parent.getActiveSheet(),n=void 0,i=void 0,o=void 0,a=void 0;switch(e.item.id){case t+"_headers":if(n={isShow:!r.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Yo,{eventArgs:n,action:"headers"}),n.cancel)return;this.parent.setSheetPropertyOnMute(r,"showHeaders",!r.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab});break;case t+"_gridlines":if(i={isShow:!r.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Yo,{eventArgs:i,action:"gridLines"}),i.cancel)return;this.parent.setSheetPropertyOnMute(r,"showGridLines",!r.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab});break;case t+"_protect":this.parent.notify(bs,{});break;case t+"_undo":this.parent.notify(Po,{isUndo:!0});break;case t+"_redo":this.parent.notify(Po,{isUndo:!1});break;case t+"_freezepanes":o=u(r.topLeftCell),a=r.frozenRows||r.frozenColumns?o:u(r.activeCell),this.parent.notify(is,{row:a[0]-o[0],column:a[1]-o[1],triggerEvent:!0});break;case t+"_freezerows":this.parent.notify(is,{row:r.frozenRows?0:u(r.activeCell)[0]-u(r.topLeftCell)[0],column:r.frozenColumns,triggerEvent:!0});break;case t+"_freezecolumns":this.parent.notify(is,{row:r.frozenRows,column:r.frozenColumns?0:u(r.activeCell)[1]-u(r.topLeftCell)[1],triggerEvent:!0});break;case t+"_protectworkbook":this.parent.password.length>0?this.parent.notify(Qa,null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify(Za,null)}this.parent.notify(Zi,e)}},e.prototype.toggleRibbonItems=function(e){var r="",n=this.parent.serviceLocator.getService(ph).getConstant("View"),i=this.parent.serviceLocator.getService(ph).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if(t.isNullOrUndefined(e.activeTab))for(var o=0,a=this.ribbon.items.length;o<a;o++)if(this.ribbon.items[o].header.text===n){e.activeTab=o;break}var s=this.getLocaleText(e.props);"GridLines"===e.props&&this.parent.serviceLocator.getService("sheet").toggleGridlines();var l=this.parent.element.id+"_"+e.props.toLowerCase(),h=this.ribbon.items[e.activeTab].content.length;for(o=void 0;o<h;o++)"Separator"!==this.ribbon.items[e.activeTab].content[o].type&&this.ribbon.items[e.activeTab].content[o].id===l&&(this.ribbon.items[e.activeTab].content[o].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&"Protect"!==e.props&&this.updateToggleText(e.props.toLowerCase(),s)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if(t.isNullOrUndefined(e.activeTab)){o=0;for(var d=this.ribbon.items.length;o<d;o++)if(this.ribbon.items[o].header.text===i){e.activeTab=o;break}}if((l=this.parent.element.id+"_"+e.props.toLowerCase())===this.parent.element.id+"_protect"){var p=this.ribbon.items[this.ribbon.selectedTab].content.length,c=void 0;for(c=0;c<p&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protect";c++);r=this.getLocaleProtectText("Sheet",!0)}else if(l===this.parent.element.id+"_protectworkbook"){var u=this.ribbon.items[this.ribbon.selectedTab].content.length;c=void 0;for(c=0;c<u&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protectworkbook";c++);this.parent.isProtected||this.parent.password.length>0?r=this.getLocaleProtectWorkbook("UnProtectWorkbook"):this.parent.isProtected||(r=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(h=this.ribbon.items[e.activeTab].content.length,o=void 0;o<h;o++)"Separator"!==this.ribbon.items[e.activeTab].content[o].type&&this.ribbon.items[e.activeTab].content[o].id===l&&(this.ribbon.items[e.activeTab].content[o].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(e.props.toLowerCase(),r)}},e.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},e.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},e.prototype.addRibbonTabs=function(e){this.ribbon.addTabs(e.items,e.insertBefore);t.select(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(t.selectAll(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},e.prototype.updateToggleText=function(e,r){var n=t.select("#"+this.parent.element.id+"_"+e+" .e-tbar-btn-text",this.ribbon.element);"protect"===e||"protectworkbook"===e?n.parentElement.setAttribute("aria-label",r):n.parentElement.setAttribute("aria-label",n.textContent),Ke(function(){n&&(n.textContent=r)}),"headers"===e&&this.findDialog&&(this.findDialog.position.Y=this.parent.getActiveSheet().showHeaders?31:0,this.findDialog.dataBind())},e.prototype.refreshViewTabContent=function(e){for(var t=this.parent.element.id,r=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(ph),i=0;i<this.ribbon.items[e].content.length;i++)"Separator"!==this.ribbon.items[e].content[i].type&&(this.ribbon.items[e].content[i].id===t+"_headers"&&this.updateViewTabContent(e,"Headers",i),this.ribbon.items[e].content[i].id===t+"_gridlines"&&this.updateViewTabContent(e,"GridLines",i),this.ribbon.items[e].content[i].id===t+"_freezepanes"&&(r.frozenRows||r.frozenColumns?this.ribbon.items[e].content[i].text===n.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",i,e))),this.ribbon.items[e].content[i].id===t+"_freezerows"&&(r.frozenRows?this.ribbon.items[e].content[i].text===n.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",i,e))),this.ribbon.items[e].content[i].id===t+"_freezecolumns"&&(r.frozenColumns?this.ribbon.items[e].content[i].text===n.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",i,e))))},e.prototype.updateViewTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(ph);n["show"+t]?this.ribbon.items[e].content[r].text===i.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,r,e)):this.ribbon.items[e].content[r].text===i.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,r,e))},e.prototype.updateRibbonItemText=function(e,t,r,n){var i=this.parent.serviceLocator.getService(ph).getConstant(e+t);return this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),i},e.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}this.ribbon.items[e].content[n].id===r+"_protectworkbook"&&this.updateDataTabContent(e,"Workbook",n)}},e.prototype.updateDataTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(ph);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[r].text===i.getConstant("Protect"+t)&&(this.ribbon.items[e].content[r].cssClass="e-active",this.updateProtectBtn("Unprotect",t,r,e)):this.updateProtectBtn("Protect",t,r,e);else if("Workbook"===t){var o=this.parent.serviceLocator.getService(ph);this.parent.isProtected?this.ribbon.items[e].content[r].text===o.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("UnProtect",t,r,e)):this.ribbon.items[e].content[r].text===o.getConstant("UnProtect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,r,e))}},e.prototype.updateProtectBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(ph).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",i)},e.prototype.updateProtectWorkbookBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(ph).getConstant(e);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",i)},e.prototype.addToolbarItems=function(e){var t=this.parent.serviceLocator.getService(ph);this.ribbon.addToolbarItems(t.getConstant(e.tab),e.items,e.index)},e.prototype.enableToolbarItems=function(e){var t=this;e.forEach(function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable)})},e.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");r.appendChild(n);var i=new o.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(r){switch(r.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new o.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});i.createElement=this.parent.createElement,i.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},e.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),a=this.parent.createElement("button",{attrs:{type:"button"}});t.appendChild(r),t.appendChild(a),t.style.display="block",this.parent.element.appendChild(t);var s=new n.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],createPopupOnClick:!0,select:function(t){t.item.text!==s.content&&(l.element.style.display="none",s.content=t.item.text,s.dataBind(),l.items=e.ribbon.items[s.items.indexOf(t.item)+1].content,l.width="calc(100% - "+a.getBoundingClientRect().width+"px)",l.element.style.display="",l.dataBind(),l.items[0].text=t.item.text,l.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),n=i.calculatePosition(s.element,"right","bottom");t.style.left=n.left-r.width+"px",t.style.top=n.top-r.height+"px";for(var o=0;o<s.items.length;o++)if(s.content===s.items[o].text){e.element.children[o].classList.add("e-selected");break}},close:function(){return Pt(e.parent.element)}});s.createElement=this.parent.createElement,s.appendTo(a);var l=new o.Toolbar({width:"calc(100% - "+a.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});l.createElement=this.parent.createElement,l.appendTo(r),t.style.display=""},e.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(ph),i=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",t.appendChild(r.parent.createElement("span",{className:"e-extension",innerHTML:i[n]})),e.appendChild(t)}),this.parent.trigger("fileMenuBeforeOpen",e),e.element.setAttribute("aria-label",this.parent.serviceLocator.getService(ph).getConstant("File"))},e.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},e.prototype.fileMenuBeforeClose=function(e){this.parent.trigger("fileMenuBeforeClose",e)},e.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},e.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},e.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},e.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(ph);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.parent.allowCellFormatting?this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,14),enable:!1}]),this.parent.allowWrap||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(14,15),enable:!1}]),this.parent.allowNumberFormatting||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,3),enable:!1}]),this.parent.notify(ha,null)):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),t.isProtected&&t.protectSettings.insertLink||!t.isProtected?!this.parent.allowHyperlink||t.isProtected&&t.protectSettings.insertLink?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId.slice(0,1),enable:!1}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),t.isProtected&&t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells||!t.isProtected?this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!1}]);var n,i=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<i&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:this.parent.allowImage}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:this.parent.allowDataValidation}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:this.parent.allowChart}]))},e.prototype.updateMergeItem=function(e){if("mousemove"===e.type||"pointermove"===e.type||"touchmove"===e.type||e.shiftKey&&("mousedown"===e.type||"touchend"===e.type)){var t=c(this.parent.getActiveSheet().selectedRange);t[1]===t[3]&&t[0]===t[2]||this.parent.getActiveSheet().isProtected||!this.parent.allowMerge||(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(ph).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!1))}},e.prototype.onPropertyChanged=function(e){var t=this.parent.serviceLocator.getService(ph),r=this.parent.element.id;switch(e){case"allowFreezePane":this.ribbon.enableItems(t.getConstant("View"),[r+"_freezepanes",r+"_freezerows",r+"_freezecolumns"],this.parent.allowFreezePane);break;case"showRibbon":this.parent.showRibbon?this.initialize(!0):this.ribbon&&this.destroy()}},e.prototype.addEventListener=function(){this.parent.on(Ri,this.ribbonOperation,this),this.parent.on(Qi,this.enableToolbarItems,this),this.parent.on(gr,this.refreshRibbonContent,this),this.parent.on(ko,this.toggleRibbonItems,this),this.parent.on(lo,this.enableFileMenuItems,this),this.parent.on(co,this.hideRibbonTabs,this),this.parent.on(fo,this.addRibbonTabs,this),this.parent.on(go,this.addToolbarItems,this),this.parent.on(ho,this.hideFileMenuItems,this),this.parent.on(po,this.addFileMenuItems,this),this.parent.on(mo,this.hideToolbarItems,this),this.parent.on(uo,this.enableRibbonTabs,this),this.parent.on(na,this.protectSheetHandler,this),this.parent.on(Wn,this.updateMergeItem,this),this.parent.on(In,this.refreshRibbonContent,this),this.parent.on(qa,this.insertDesignChart,this),this.parent.on(ja,this.removeDesignChart,this),this.parent.on(Jt,this.findToolDlg,this),this.parent.on($n,this.unMerge,this)},e.prototype.destroy=function(){var e=this.parent.element,r=this.ribbon.element,n=this.cPickerEle,i=e.id;["bold","italic","line-through","underline"].forEach(function(r){xt(t.select("#"+i+"_"+r,e),s.Button)}),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.destroyComponent(i+"_borders_menu","menu"),this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.destroyComponent(i+"_chart_menu","menu"),this.destroyComponent(i+"_chart_type_menu","menu"),this.destroyComponent(i+"_chart-btn","dropdown-btn"),this.destroyComponent(i+"_chart-type-btn","dropdown-btn"),this.destroyComponent(i+"_cf_menu","menu"),this.cfDdb.destroy(),this.cfDdb=null,this.detachPopupElement(i),this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),r&&t.detach(r),this.ribbon=null,n&&t.detach(n),this.cPickerEle=null,this.findDialog&&this.findDialog.hide(),this.datavalidationDdb.destroy(),this.datavalidationDdb=null,this.removeEventListener()},e.prototype.destroyComponent=function(e,r){var n="string"==typeof e?document.getElementById(e):e;if(n){if("menu"!==r||n.childElementCount){var i=t.getComponent(n,r);if(i&&(i.destroy(),"dropdown-btn"===r)){var o=document.getElementById(n.id+"-popup");o&&t.detach(o)}}"menu"===r&&t.detach(n)}},e.prototype.detachPopupElement=function(e){["_conditionalformatting","_chart-type-btn","_chart-btn","_borders"].forEach(function(r){var n=document.getElementById(""+e+r+"-popup");n&&t.detach(n)})},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ri,this.ribbonOperation),this.parent.off(Qi,this.enableToolbarItems),this.parent.off(gr,this.refreshRibbonContent),this.parent.off(ko,this.toggleRibbonItems),this.parent.off(lo,this.enableFileMenuItems),this.parent.off(co,this.hideRibbonTabs),this.parent.off(fo,this.addRibbonTabs),this.parent.off(go,this.addToolbarItems),this.parent.off(ho,this.hideFileMenuItems),this.parent.off(po,this.addFileMenuItems),this.parent.off(mo,this.hideToolbarItems),this.parent.off(uo,this.enableRibbonTabs),this.parent.off(na,this.protectSheetHandler),this.parent.off(Wn,this.updateMergeItem),this.parent.off(In,this.refreshRibbonContent),this.parent.off(qa,this.insertDesignChart),this.parent.off(ja,this.removeDesignChart),this.parent.on(Jt,this.findToolDlg,this),this.parent.off($n,this.unMerge))},e}(),Yl=function(){function e(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formulaBar"},e.prototype.createFormulaBar=function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var r=this.parent.serviceLocator.getService(ph),n=this.parent.element.id,i=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var o=this.parent.createElement("input",{id:n+"_name_box",attrs:{type:"text"}});i.appendChild(o),this.comboBoxInstance=new l.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(o),this.comboBoxInstance.element.parentElement.title=r.getConstant("NameBox")}i.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:r.getConstant("InsertFunction"),type:"button"}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=t.rippleEffect(i,{selector:".e-insert-function"}),i.appendChild(this.parent.createElement("div",{className:"e-separator"}));var a=i.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:n+"_formula_input",attrs:{title:r.getConstant("FormulaBar"),spellcheck:"false"}}));if(a.rows=1,this.parent.isMobileView())a.placeholder=r.getConstant("MobileFormulaBarPlaceHolder"),t.EventHandler.add(a,"focus",this.textAreaFocusIn,this),t.EventHandler.add(a,"blur",this.textAreaFocusOut,this);else{var s=r.getConstant("ExpandFormulaBar");i.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:s,role:"button",tabindex:"-1","aria-label":s}}))}e&&e.uiUpdate?this.parent.element.insertBefore(i,document.getElementById(n+"_sheet_panel")):this.parent.element.appendChild(i)}else this.destroy()},e.prototype.textAreaFocusIn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit",attrs:{type:"button"}});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)},e.prototype.textAreaFocusOut=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),t.detach(e.querySelector(".e-formula-submit"))},e.prototype.keyDownHandler=function(e){var t=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if((W(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&16===e.keyCode)return;t.classList.contains("e-formula-bar")&&this.parent.notify(Oi,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,r),r.editedValue!==t.value&&16!==e.keyCode&&this.parent.notify(Oi,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},e.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()},e.prototype.nameBoxBlur=function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())},e.prototype.nameBoxSelect=function(e){if(e.isInteracted){var t=e.itemData.refersTo.substr(1),r=fe(this.parent,me(t));if(void 0===r)return;var n=C(t),i=be(this.parent,r);if(-1!==n.indexOf(":")){var o=n.indexOf(":"),a=n.substr(0,o),s=n.substr(o+1,n.length);a=a.replace("$",""),(s=s.replace("$","")).match(/\D/g)&&!s.match(/[0-9]/g)&&a.match(/\D/g)&&!a.match(/[0-9]/g)?n=(a+="1")+":"+(s+=i.rowCount):!s.match(/\D/g)&&s.match(/[0-9]/g)&&!a.match(/\D/g)&&a.match(/[0-9]/g)&&(n=(a=g(parseInt(a,10)-1,0))+":"+(s=g(parseInt(s,10)-1,i.colCount-1)))}r===this.parent.activeSheetIndex?(this.parent.selectRange(n),Pt(this.parent.element)):(ye(this.parent,n,i),this.parent.activeSheetIndex=r)}},e.prototype.formulaBarUpdateHandler=function(e){var r,n=this,i=this.parent.getActiveSheet().selectedRange.split(":"),o={action:"getElement",element:null};this.parent.notify(Oi,o);var a=this.parent.element.querySelector(".e-formula-bar"),s=new t.Internationalization;if("mousemove"===e.type||"pointermove"===e.type){var l=c(i[0]),h=c(i[1]);r=Math.abs(l[0]-h[0])+1+"R x "+(Math.abs(l[1]-h[1])+1)+"C",this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify(Ia,null):o.element&&(a.value=o.element.textContent))}else{r=i[0];this.parent.getData(Ee(this.parent)+"!"+r).then(function(i){if(n.parent){var l,h="";i.forEach(function(i){var d=i&&i.format?H(i.format):"General";if(i){if(!t.isNullOrUndefined(i.value))if("Invalid Date"===(l=F(Number(i.value))).toString()||"ShortDate"!==d&&"LongDate"!==d)"Invalid Date"!==l.toString()&&"Time"===d?(Number(i.value)>=1&&(h=s.formatDate(l,{type:"dateTime",skeleton:"yMd"})+" "),h+=s.formatDate(l,{type:"dateTime",skeleton:"hms"})):h=i.value;else if((h=s.formatDate(l,{type:"date",skeleton:"yMd"}))&&h.indexOf("/")>-1||h.indexOf("-")>0){var p=h.split(/-|\//),u=i?i.format:"";("dd-MM-yyyy"===u||"dd/MM/yyyy"===u)&&Number(p[0])<=12&&Number(p[1])<=31&&(h=p[1]+"/"+p[0]+"/"+p[2])}i.formula&&(h=i.formula)}var f={action:"getCurrentEditValue",editedValue:""};n.parent.notify(Oi,f);var g=f.editedValue&&0===f.editedValue.toString().indexOf("=")||W(f.editedValue),m=document.getElementById(n.parent.element.id+"_formula_input"),v=c(r),y=n.parent.getCell(v[0],v[1]);if(!i||i.formula||!y||"Time"===d&&h)m.value=h;else if(void 0===i.value||n.isDateTimeType(i.format)&&i.value&&"Invalid Date"!==F(Number(i.value)).toString()||t.isNullOrUndefined(i.format)){var C=n.isDateTimeType(i.format);if(C){var x=new t.Internationalization,b="date"===C?"M/d/yyyy":"h:mm:ss a";"dd-MM-yyyy"!==i.format&&"dd/MM/yyyy"!==i.format||(b=i.format),m.value=x.formatDate(F(parseFloat(i.value)),{type:C,format:b})}else i.validation&&"List"===i.validation.type?m.value=(y.lastElementChild||y).textContent:m.value=y.textContent}else m.value=i.value;t.isNullOrUndefined(h)||g||n.parent.notify(Oi,{action:"refreshEditor",value:m.value,refreshEditorElem:!0}),n.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?n.parent.notify(Ia,null):o.element&&(a.value=o.element.textContent))})}})}this.updateComboBoxValue(r)},e.prototype.isDateTimeType=function(e){var t;return[":","hh","h","mm:ss","h:mm:ss"].forEach(function(r){e&&e.indexOf(r)>-1&&(t="time")}),t||(["/","-d","-m","-y","dd","mm","yy"].forEach(function(r){e&&e.indexOf(r)>-1&&(t="date")}),t)},e.prototype.UpdateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},e.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:Ee(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify(Mi,r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},e.prototype.disabletextarea=function(){var e=this.getFormulaBar();this.parent.getActiveSheet().isProtected?e.disabled=!0:e.disabled=!1},e.prototype.formulaBarScrollEdit=function(){var e=c(this.parent.getActiveSheet().selectedRange),t=u(this.parent.getActiveSheet().topLeftCell);e[0]<t[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(Oi,{action:"startEdit",refreshCurPos:!1})},e.prototype.formulaBarClickHandler=function(e){var r=e.target,n=this.parent.getActiveSheet(),i=n.isProtected,o=u(n.activeCell),a=ee(ke(o[0],o[1],n),ze(n,o[1]));if(r.classList.contains("e-drop-icon")&&t.closest(r,".e-formula-bar-panel"))this.toggleFormulaBar(r);else if(r.classList.contains("e-formula-bar"))this.parent.isEdit||i&&(!i||a)?i&&a&&this.parent.notify(la,null):this.formulaBarScrollEdit();else if(r.parentElement&&r.parentElement.classList.contains("e-name-box"))if(r.classList.contains("e-ddl-icon")){var s={action:"getNames",names:[]};this.parent.notify(Mi,s),this.comboBoxInstance.dataSource=s.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!t.isNullOrUndefined(r.offsetParent)&&(r.offsetParent.classList.contains("e-insert-function")||r.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.offsetParent.id||this.parent.element.id+"_insert_function"===r.id||r.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.parentElement.id)){if(i)return void this.parent.notify(la,null);this.renderInsertDlg()}},e.prototype.renderInsertDlg=function(){var e=this,r=this.parent.serviceLocator.getService(ph),n=!this.parent.isEdit,i={action:"getCurrentEditValue",editedValue:""};if(!n){var o={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify(Mi,o),n=o.isFormulaEdit,this.parent.notify(Oi,i)}if(n||""===i.editedValue){""===i.editedValue&&this.parent.notify(Oi,{action:"refreshEditor",value:"="});var a=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),s=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:r.getConstant("PickACategory")}),d=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),p=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),c=this.parent.createElement("div",{className:"e-description-content",innerHTML:r.getConstant("Description")}),u=this.parent.createElement("div",{className:"e-header-content",innerHTML:r.getConstant("InsertFunction")}),f={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(pr,f),this.categoryCollection=f.categoryCollection,this.categoryList=new l.DropDownList({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var g={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,g),this.formulaCollection=g.formulaCollection,this.formulaList=new h.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService(ch),this.parent.element.querySelector(".e-spreadsheet-function-dlg")||(this.dialog.show({header:u.outerHTML,content:s.outerHTML+d.outerHTML+p.outerHTML+c.outerHTML+a.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(t){var r={dialogName:"InsertFunctionDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),Pt(e.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),t.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this))}},e.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(ph);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar"),e.setAttribute("aria-label",r.getConstant("CollapseFormulaBar"))):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar"),e.setAttribute("aria-label",r.getConstant("ExpandFormulaBar"))),this.parent.setPanelSize()},e.prototype.toggleFormulaBarBtn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel .e-drop-icon");this.toggleFormulaBar(e)},e.prototype.dialogOpen=function(){var e=this;Ke(function(){var t=e.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary"),r=e.parent.serviceLocator.getService(ph);t.setAttribute("aria-label",r.getConstant("InsertFunction")+" "+r.getConstant("Ok")),Pt(t)})},e.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,e),"="===e.editedValue.toString().trim()&&this.parent.notify(Oi,{action:"refreshEditor",value:""})},e.prototype.dialogBeforeClose=function(){t.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")},e.prototype.selectFormula=function(e,t){var r=t.formulaList.getSelectedItems().text,n=be(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(Oi,{action:"refreshEditor",value:r+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Oi,{action:"startEdit",value:"="+r+"(",address:n.activeCell}),this.parent.notify(Pi,{action:"refreshFormulabar",value:"="+r+"("})),e.hide()},e.prototype.listSelected=function(){this.updateFormulaDescription()},e.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},e.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(pr,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(pr,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},e.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},e.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e,isCustom:!1};this.parent.notify(pr,t);var r=this.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary");r.hasAttribute("aria-label")&&r.removeAttribute("aria-label"),Pt(r);var n=document.getElementById(this.parent.element.id+"_description_content");e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,n.textContent=t.isCustom?t.description:this.parent.serviceLocator.getService(ph).getConstant(e)},e.prototype.formulaClickHandler=function(e){var t=e.target,r=be(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(Oi,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Oi,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify(Pi,{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},e.prototype.addEventListener=function(){this.parent.on(Ai,this.createFormulaBar,this),this.parent.on(Hi,this.formulaBarClickHandler,this),this.parent.on(Ui,this.keyDownHandler,this),this.parent.on(Cs,this.renderInsertDlg,this),this.parent.on(xs,this.toggleFormulaBarBtn,this),this.parent.on(Bi,this.keyUpHandler,this),this.parent.on(Wn,this.formulaBarUpdateHandler,this),this.parent.on(Gi,this.UpdateValueAfterMouseUp,this),this.parent.on(Pi,this.editOperationHandler,this),this.parent.on(da,this.disabletextarea,this),this.parent.on(Ti,this.isFormulaBarEdit,this)},e.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&t.detach(e)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ai,this.createFormulaBar),this.parent.off(Hi,this.formulaBarClickHandler),this.parent.off(Cs,this.renderInsertDlg),this.parent.off(xs,this.toggleFormulaBarBtn),this.parent.off(Ui,this.keyDownHandler),this.parent.off(Bi,this.keyUpHandler),this.parent.off(Wn,this.formulaBarUpdateHandler),this.parent.off(Gi,this.UpdateValueAfterMouseUp),this.parent.off(Pi,this.editOperationHandler),this.parent.off(da,this.disabletextarea),this.parent.off(Ti,this.isFormulaBarEdit))},e.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=t.isUndefined(e.value)?"":e.value;break;case"getElement":e.element=this.getFormulaBar()}},e.prototype.isFormulaBarEdit=function(e){this.parent.isEdit&&this.isGoto?e.isEdit=!0:e.isEdit=!1},e.prototype.getFormulaBar=function(){return t.select("#"+this.parent.element.id+"_formula_input",this.parent.element)},e}(),Xl=function(){function e(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formula"},e.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Mi,this.performFormulaOperation,this),this.parent.on(Bi,this.keyUpHandler,this),this.parent.on(Ui,this.keyDownHandler,this),this.parent.on(Hi,this.formulaClick,this),this.parent.on(Zo,this.refreshFormulaDatasource,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Mi,this.performFormulaOperation),this.parent.off(Bi,this.keyUpHandler),this.parent.off(Ui,this.keyDownHandler),this.parent.off(Hi,this.formulaClick),this.parent.off(Zo,this.refreshFormulaDatasource))},e.prototype.performFormulaOperation=function(e){var t,r,n=this,i=e.action,o=this.parent.serviceLocator.getService(ph);switch(i){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=Ee(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":t=this.parent.serviceLocator.getService(ch),r=o.getConstant("CircularReference"),t.dialogInstance&&t.dialogInstance.visible&&t.dialogInstance.content===r||t.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:o.getConstant("CircularReference"),beforeOpen:function(e){var t={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}}),e.argValue="0"}},e.prototype.renderAutoComplete=function(){if(!t.select("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var r={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,r);var n={dataSource:r.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new l.AutoComplete(n,e),this.autocompleteInstance.createElement=this.parent.createElement}},e.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(e,t){setTimeout(function(){e()},100)}).then(function(){t.triggerKeyDownEvent(mh.DOWN)})},e.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},e.prototype.onSelect=function(e){var r="="+e.itemData.value+"(";if(this.isSubFormula){var n=this.getEditingValue(),i=n.lastIndexOf(this.getArgumentSeparator());i>-1?r=n.slice(0,i+1):(i=n.lastIndexOf("("))>-1&&(r=n.slice(0,i+1)),r+=e.itemData.value+"("}if(this.parent.notify(Oi,{action:"refreshEditor",value:r,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var o=t.select("#"+this.parent.element.id+"_ac_popup");o&&t.detach(o),this.isPopupOpened=!1}},e.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},e.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,e),this.autocompleteInstance.dataSource=e.formulaCollection},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=W(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==mh.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},e.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case mh.UP:case mh.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case mh.TAB:e.preventDefault(),this.triggerKeyDownEvent(mh.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case mh.ENTER:this.addDefinedName({name:r.value}),Pt(this.parent.element);break;case mh.ESC:Pt(this.parent.element)}}},e.prototype.formulaClick=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},e.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;this.isNavigationKey(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(mh.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},e.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=t.select("#"+this.parent.element.id+"_ac_popup");e&&t.detach(e),this.isPopupOpened=!1}},e.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},e.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},e.prototype.getRelateToElem=function(){var e={action:"getElement"};return this.isFormulaBar?this.parent.notify(Pi,e):this.parent.notify(Oi,e),e.element},e.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(Oi,e),e.editedValue},e.prototype.isNavigationKey=function(e){return e===mh.UP||e===mh.DOWN||e===mh.LEFT||e===mh.RIGHT},e.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},e.prototype.getArgumentSeparator=function(){var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(pr,e),e.argumentSeparator},e.prototype.getNames=function(e){return this.parent.definedNames.filter(function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e})},e.prototype.getNameFromRange=function(e){var t=e.slice(0,e.indexOf(":")),r=e.slice(e.indexOf("!")+1).split(":"),n=r.length>1&&r[0]===r[1],i=this.parent.definedNames.filter(function(r){return!(!n||r.refersTo!=="="+t)||r.refersTo==="="+e});return i&&i[0]},e.prototype.addDefinedName=function(e){var r=this,n=e.name,i=!1;if(n&&G(n.toUpperCase()))return this.parent.goTo(n),i;if(!e.refersTo){var o=be(this.parent,this.parent.activeSheetIndex),a=Ee(this.parent);a=-1!==a.indexOf(" ")?"'"+a+"'":a;var s=o.selectedRange;if(!t.isNullOrUndefined(s)){var l=s.indexOf(":"),h=s.substr(0,l),d=s.substr(l+1,s.length);parseInt(d.replace(/\D/g,""),10)===o.rowCount&&1===parseInt(h.replace(/\D/g,""),10)?(d=d.replace(/[0-9]/g,""),s="$"+(h=h.replace(/[0-9]/g,""))+":$"+d):u(d)[1]===o.colCount-1&&0===u(h)[1]?(d=d.replace(/\D/g,""),s="$"+(h=h.replace(/\D/g,""))+":$"+d):s=h===d?h:s}e.refersTo=a+"!"+s,e.scope="Workbook"}if(n.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(n)){var p={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(pr,p),i=p.isAdded,p.isAdded||this.parent.serviceLocator.getService(ch).show({content:this.parent.serviceLocator.getService(ph).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(ch).show({content:this.parent.serviceLocator.getService(ph).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}});return i},e}(),Kl=function(){function e(e){this.aggregateContent="",this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"sheetTabs"},e.prototype.createSheetTabs=function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var r=this.parent.serviceLocator.getService(ph),i=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),a=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:r.getConstant("AddSheet"),type:"button"}});a.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),a.addEventListener("click",this.addSheetTab.bind(this)),a.disabled=!this.parent.allowInsert,i.appendChild(a),this.addBtnRipple=t.rippleEffect(i,{selector:".e-add-sheet-tab"});var s=this.parent.createElement("button",{attrs:{title:r.getConstant("ListAllSheets"),type:"button"}});i.appendChild(s),this.parent.element.appendChild(i);var l=this.getSheetTabItems();this.dropDownInstance=new n.DropDownButton({iconCss:"e-icons",items:l.ddbItems,createPopupOnClick:!0,beforeItemRender:function(t){var r=e.parent.sheets[e.dropDownInstance.items.indexOf(t.item)];"Hidden"===r.state?t.element.classList.add("e-hide"):"VeryHidden"===r.state&&(t.element.style.display="none")},select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element,r.getConstant("ListAllSheets"))},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return e.focusTab(e.tabInstance.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(s);var h,d=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new o.Tab({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:l.tabItems,scrollStep:250,selecting:function(t){if(t.selectingIndex!==t.selectedIndex)if(h)h=!1;else{var r={currentSheetIndex:t.selectingIndex,previousSheetIndex:t.selectedIndex,cancel:!1};e.parent.notify(Zt,{eventArgs:r,action:"gotoSheet"}),h=r.cancel}},selected:function(t){e.goToSheet(t,h,!0)},created:function(){var r=e.tabInstance.element.querySelector(".e-toolbar-items");r.classList.add("e-sheet-tabs-items"),t.EventHandler.add(r,"dblclick",e.renameSheetTab,e)}}),i.appendChild(d),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(d),t.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var p,c=l.tabItems.length,u=0;u<c;u++){var f={action:"addSheet",sheetName:"Sheet"+(p=be(this.parent,u)).id,sheetId:p.id,visibleName:p.name};this.parent.notify(pr,f)}this.parent.notify(pr,{action:"initiateDefinedNames"}),this.parent.notify(ta,null)}else this.destroy()},e.prototype.goToSheet=function(e,t,r){if(e.selectedIndex!==e.previousIndex){if(t)return this.tabInstance.selectedItem=e.previousIndex,this.tabInstance.dataBind(),void Pt(this.parent.element);if(this.parent.notify(ja,{}),this.parent.isEdit){var n=window.getSelection(),i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Oi,i);var o=!!i.editedValue&&W(i.editedValue,!0);!o&&n&&n.focusNode&&n.focusNode.classList&&n.focusNode.classList.contains("e-formula-bar-panel")&&(o=W(this.parent.element.querySelector(".e-formula-bar").value,!0)),o||this.parent.endEdit()}this.parent.activeSheetIndex=e.selectedIndex,this.parent.dataBind(),this.updateDropDownItems(e.selectedIndex,e.previousIndex);var a={action:"registerGridInCalc",sheetID:(e.selectedIndex+1).toString()};this.parent.notify(pr,a),r&&this.parent.notify(Yo,{eventArgs:{previousSheetIndex:e.previousIndex,currentSheetIndex:e.selectedIndex},action:"gotoSheet"})}},e.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},e.prototype.beforeOpenHandler=function(e,t,r){var n=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>n&&(t.style.height=n+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden",r&&t.setAttribute("aria-label",r)},e.prototype.openHandler=function(e,t,r){var n,o=t.parentElement;if(-1===i.isCollide(o).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:o.getBoundingClientRect().height;var a=i.calculatePosition(e.element,r,"top");"right"===r&&(a.left-=o.getBoundingClientRect().width),o.style.left=a.left+"px",o.style.top=a.top-n+"px"}o.style.visibility="",Pt(t)},e.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach(function(i,o){e=Ee(t.parent,o).replace(/</g,"&lt;").replace(/>/g,"&gt;"),r.push({header:{text:e},visible:"Visible"===i.state}),n.push({text:e,iconCss:o===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:r,ddbItems:n}},e.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},e.prototype.addSheetTab=function(){this.parent.notify(Vr,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1})},e.prototype.insertSheetTab=function(e){this.parent.notify(ja,{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var r=this.parent.sheets[t].name.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.dropDownInstance.items.splice(t,0,{text:r}),this.tabInstance.addTab([{header:{text:r},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx,preventDataBind:!0})},e.prototype.updateSheetTab=function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.showSheet({sheetIndex:e.idx,triggerEvent:!0})}this.tabInstance.selectedItem=e.idx,e.preventDataBind||this.tabInstance.dataBind(),this.parent.notify(ta,null)},e.prototype.showSheet=function(e){this.parent.setSheetPropertyOnMute(this.parent.sheets[e.sheetIndex],"state","Visible"),this.tabInstance.hideTab(e.sheetIndex,!1),e.triggerEvent&&this.parent.notify(Yo,{action:"showSheet",eventArgs:{sheetIndex:e.sheetIndex}})},e.prototype.switchSheetTab=function(e){var r=t.closest(e.event.target,".e-toolbar-item");if(r){for(var n=r.querySelector(".e-tab-text").textContent,i=[],o=this.parent.element.id+"_cmenu",a=0,s=this.parent.sheets.length;a<s;a++)if(this.parent.sheets[a].name===n){this.parent.activeSheetIndex!==a&&this.updateSheetTab({idx:a});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&i.push(o+"_hide_sheet",o+"_delete_sheet"),this.parent.allowInsert&&!this.parent.isProtected||i.push(o+"_insert_sheet"),!this.parent.allowDelete&&i.indexOf(o+"_delete_sheet")>-1&&i.push(o+"_delete_sheet")),(this.parent.password.length>0||this.parent.isProtected)&&(i.indexOf(o+"_insert_sheet")>-1&&i.push(o+"_insert_sheet"),i.indexOf(o+"_delete_sheet")>-1&&i.push(o+"_delete_sheet"),i.push(o+"_duplicate",o+"_rename",o+"_hide_sheet",o+"_delete_sheet",o+"_insert_sheet",o+"_move_left",o+"_move_right")),this.parent.enableContextMenuItems(i,!1,!0)}},e.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach(function(t){"Visible"!==t.state&&--e}),e},e.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var r=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,n={eventArgs:{name:r,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",n),n.cancel||this.parent.isProtected)return;var i=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:r,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(i),t.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),t.EventHandler.add(i,"input",this.updateWidth,this),i.focus(),i.setSelectionRange(0,r.length),t.EventHandler.remove(t.closest(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},e.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},e.prototype.renameInputFocusOut=function(e){var r=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!r.classList.contains("e-sheet-rename")&&!t.closest(r,".e-dlg-container")){if(r=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(r),void this.focusTab(this.tabInstance.element);var n=r.value,i=this.parent.serviceLocator.getService(ph);if(n){var o=this.tabInstance.selectedItem;if(n.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(r,i.getConstant("SheetRenameInvalidAlert"));else{if(this.parent.sheets[o].name!==n)for(var a=0,s=this.parent.sheets.length;a<s;a++)if(a!==this.parent.activeSheetIndex&&this.parent.sheets[a].name.toLowerCase()===n.toLowerCase())return void this.showRenameDialog(r,i.getConstant("SheetRenameAlreadyExistsAlert"));var l=this.removeRenameInput(r);this.parent.sheets[o].name!==n&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[o],"name",n),this.updateSheetName({value:n,idx:o,items:l})),"keydown"===e.type?this.focusTab(l):t.closest(e.target,".e-spreadsheet")&&Pt(this.parent.element)}}else this.showRenameDialog(r,i.getConstant("SheetRenameEmptyAlert"));this.parent.notify(Yo,{eventArgs:{index:this.parent.getActiveSheet().id,value:n},action:"renameSheet"})}},e.prototype.focusTab=function(e){Pt(t.select(".e-toolbar-item.e-active .e-tab-wrap",e))},e.prototype.updateSheetName=function(e){var t=this.tabInstance.items[e.idx].header.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");if(this.tabInstance.items[e.idx].header.text=r,this.dropDownInstance.items[e.idx].text=r,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.items.children[e.idx+1].querySelector(".e-tab-text").textContent="",e.items.children[e.idx+1].querySelector(".e-tab-text").appendChild(document.createTextNode(e.value)),e.value.indexOf("  ")>-1?this.tabInstance.setProperties({items:this.tabInstance.items},!0):this.tabInstance.dataBind(),this.parent.notify(pr,{action:"renameUpdation",value:e.value,pName:t}),this.parent.allowChart){var n;this.parent.chartColl.forEach(function(r){r.range.includes("!")&&(n=r.range.split("!"))[0].toLowerCase()===t.toLowerCase()&&(n[0]=e.value,r.range=n.join("!"))})}},e.prototype.hideSheet=function(e){var t={action:"hideSheet",eventArgs:{sheetIndex:e.sheetIndex,cancel:!1}};e.triggerEvent&&(this.parent.notify(Zt,t),t.eventArgs.cancel)||(this.parent.setSheetPropertyOnMute(be(this.parent,e.sheetIndex),"state","Hidden"),this.tabInstance.hideTab(e.sheetIndex),e.triggerEvent&&(delete t.eventArgs.cancel,this.parent.notify(Yo,t)))},e.prototype.removeRenameInput=function(e){var r=e.parentElement.querySelector(".e-tab-text"),n=t.closest(e,".e-toolbar-items");return t.EventHandler.add(n,"dblclick",this.renameSheetTab,this),t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),t.EventHandler.remove(e,"input",this.updateWidth),t.remove(e),r.style.display="",n},e.prototype.showRenameDialog=function(e,t){var r=this;this.parent.serviceLocator.getService(ch).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(n){var i={dialogName:"SheetRenameDialog",element:n.element,target:n.target,cancel:n.cancel};r.parent.trigger("dialogBeforeOpen",i),i.cancel&&(n.cancel=!0),n.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",t+" "+r.parent.serviceLocator.getService(ph).getConstant("Ok")),e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})},e.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},e.prototype.removeSheetTab=function(e){var r=this;if(!e.count||e.count!==this.parent.sheets.length){var n=this.parent.serviceLocator.getService(ph);if(this.skipHiddenSheets()>1){var i=e.sheetName?be(this.parent,fe(this.parent,e.sheetName)):this.parent.getActiveSheet(),o=t.isNullOrUndefined(e.index)?fe(this.parent,i.name):e.index,a={index:o,sheetCount:this.parent.sheets.length,sheetName:i.name};if(!(!i.rows||!i.rows.length)&&(1!==i.rows.length||!(!i.rows[0].cells||!i.rows[0].cells.length))){var s=this.parent.serviceLocator.getService(ch);e.clicked?this.forceDelete(o):s.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-delete-sheet-dlg",content:n.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),e.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",n.getConstant("DeleteSheetAlert")+" "+n.getConstant("Ok"));var i=r.tabInstance.element.querySelector(".e-toolbar-item.e-active");Pt((i.nextElementSibling||i.previousElementSibling).querySelector(".e-tab-wrap"))},buttons:[{buttonModel:{content:n.getConstant("Ok"),isPrimary:!0},click:function(){s.hide(),r.forceDelete(o),r.parent.notify(_o,null),e&&!e.isAction&&(a.sheetCount=r.parent.sheets.length,r.parent.notify(Yo,{eventArgs:a,action:"removeSheet"}))}}]})}else this.parent.notify(pr,{action:"deleteSheetTab",sheetId:be(this.parent,o).id}),this.destroySheet(o),this.parent.notify(_o,null),e&&!e.isAction&&(a.sheetCount=this.parent.sheets.length,this.parent.notify(Yo,{eventArgs:a,action:"removeSheet"}))}else this.parent.serviceLocator.getService(ch).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:n.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}},e.prototype.forceDelete=function(e){this.parent.notify(ja,{}),this.parent.notify(pr,{action:"deleteSheetTab",sheetId:be(this.parent,e).id}),this.destroySheet(e)},e.prototype.destroySheet=function(e){var r=t.isNullOrUndefined(e)?this.parent.activeSheetIndex:e;this.parent.removeSheet(r),this.parent.notify(Cr,{sheetIndex:r}),this.dropDownInstance.items.splice(r,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(r);var n=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=n,this.parent.setProperties({activeSheetIndex:n},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=n,this.tabInstance.dataBind(),this.updateDropDownItems(n),this.parent.notify(ta,null)},e.prototype.showAggregate=function(){var e=this;if(!E(c(this.parent.getActiveSheet().selectedRange))){var t={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify(xr,t),t.Count>1){this.aggregateContent=t.countOnly?"Count":this.selaggregateCnt,t.countOnly&&(this.aggregateContent="Count",delete t.Sum,delete t.Avg,delete t.Min,delete t.Max);var r=t.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete t.countOnly;var i=this.aggregateContent,o=i+": "+t[i];if(this.aggregateDropDown)this.updateAggregateContent(o,t);else{var a=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate",attrs:{type:"button"}});document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(a),this.aggregateDropDown=new n.DropDownButton({content:o,items:this.getAggregateItems(t),createPopupOnClick:!0,select:function(r){e.parent.notify(xr,t),e.updateAggregateContent(r.item.text,{Count:t.Count,Sum:t.Sum,Avg:t.Avg,Min:t.Min,Max:t.Max},!0)},beforeOpen:function(t){return e.beforeOpenHandler(e.aggregateDropDown,t.element)},open:function(t){return e.openHandler(e.aggregateDropDown,t.element,"right")},close:function(){return Pt(e.parent.element)},cssClass:r}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(a)}}else this.removeAggregate()}},e.prototype.getAggregateItems=function(e){var t,r,n=this,i=[];return Object.keys(e).forEach(function(o){e[o]!==xr&&(t=o+": "+e[o],r=o===n.aggregateContent?"e-selected-icon e-icons":"",i.push({text:t,iconCss:r}))}),i},e.prototype.updateAggregateContent=function(e,t,r){this.aggregateContent=e.split(": ")[0],r&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},e.prototype.removeAggregate=function(){t.isNullOrUndefined(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),t.remove(this.aggregateDropDown.element),this.aggregateDropDown=null)},e.prototype.addEventListener=function(){this.parent.on(ki,this.createSheetTabs,this),this.parent.on(Fi,this.refreshSheetTab,this),this.parent.on(Xi,this.insertSheetTab,this),this.parent.on(Ki,this.removeSheetTab,this),this.parent.on($i,this.renameSheetTab,this),this.parent.on(Yi,this.switchSheetTab,this),this.parent.on(So,this.updateSheetTab,this),this.parent.on(wo,this.renameInputFocusOut,this),this.parent.on(gr,this.removeAggregate,this),this.parent.on(_i,this.focusRenameInput,this),this.parent.on(Vi,this.focusRenameInput,this),this.parent.on(Oo,this.updateSheetName,this),this.parent.on(Mo,this.hideSheet,this),this.parent.on(ma,this.showAggregate,this),this.parent.on(va,this.goToSheet,this),this.parent.on(ya,this.showSheet,this)},e.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&t.remove(e),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ki,this.createSheetTabs),this.parent.off(Fi,this.refreshSheetTab),this.parent.off(Xi,this.insertSheetTab),this.parent.off(Ki,this.removeSheetTab),this.parent.off($i,this.renameSheetTab),this.parent.off(Yi,this.switchSheetTab),this.parent.off(So,this.updateSheetTab),this.parent.off(wo,this.renameInputFocusOut),this.parent.off(gr,this.removeAggregate),this.parent.off(_i,this.focusRenameInput),this.parent.off(Vi,this.focusRenameInput),this.parent.off(Oo,this.updateSheetName),this.parent.off(Mo,this.hideSheet),this.parent.off(ma,this.showAggregate),this.parent.off(va,this.goToSheet),this.parent.off(ya,this.showSheet))},e}(),$l=function(){function e(e){this.isImportedFile=!1,this.unProtectSheetIdx=[],this.parent=e,this.addEventListener(),this.renderFileUpload()}return e.prototype.addEventListener=function(){this.parent.on(mr,this.openSuccess,this),this.parent.on(vr,this.openFailed,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(mr,this.openSuccess),this.parent.off(vr,this.openFailed))},e.prototype.renderFileUpload=function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm, .xlsb",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"},e.prototype.fileSelect=function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var r={file:t};this.parent.open(r),document.getElementById(this.parent.element.id+"_fileUpload").value=""}},e.prototype.openSuccess=function(e){var t=this,r=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded"],n=function(r){t.parent.serviceLocator.getService(ch).hide(!0);var n=new File([],e.guid,{type:r.toLowerCase()});t.parent.open({file:n,guid:e.guid,password:e.eventArgs.password,orginalFile:e.eventArgs.file})};if(r.indexOf(e.data)>-1){var i=this.parent.serviceLocator.getService(ph);if(r[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify(rs,e.eventArgs);else if(r[3]===e.data){var o=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span",innerHTML:i.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(o)}else if(r[4]===e.data){o=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:i.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(o)}else{if(r[5]!==e.data){this.parent.serviceLocator.getService(ch).hide(!0);var a=e.data.includes("LimitExceeded");return this.parent.serviceLocator.getService(ch).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",buttons:a?[{click:n.bind(this,e.data+"Open"),buttonModel:{content:i.getConstant("Ok"),isPrimary:!0}},{click:n.bind(this,e.data+"Cancel"),buttonModel:{content:i.getConstant("Cancel")}}]:[],beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}},!!a||null),void this.parent.hideSpinner()}this.parent.isOpen=!1,this.parent.notify(us,null);this.parent.serviceLocator.getService(ch).hide(),this.parent.hideSpinner()}}else{this.parent.serviceLocator.getService(ch).hide(),this.parent.showSpinner()}this.parent.element&&r[5]!==e.data&&(e.isOpenFromJson||(this.parent.trigger("openComplete",{response:e}),this.parent.notify(Yo,{response:e,action:"import"})),this.parent.notify(Er,{cellRef:null,isOpen:!0}),this.parent.renderModule.refreshSheet(e.isOpenFromJson),this.parent.notify(Fi,null),this.isImportedFile=!0,this.unProtectSheetIdx=[],this.parent.hideSpinner())},e.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"open"},e}(),Zl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on($t,this.initiateSave,this),this.parent.on(rr,this.saveCompleted,this),this.parent.on(Tn,this.showErrorDialog,this),this.parent.on(er,this.exportDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off($t,this.initiateSave),this.parent.off(rr,this.saveCompleted),this.parent.off(Tn,this.showErrorDialog),this.parent.off(er,this.exportDialog))},e.prototype.getModuleName=function(){return"save"},e.prototype.initiateSave=function(){this.parent.showSpinner()},e.prototype.saveCompleted=function(){this.parent.hideSpinner()},e.prototype.showErrorDialog=function(e){var t=this;this.parent.serviceLocator.getService(ch).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return Pt(t.parent.element)}})},e.prototype.exportDialog=function(e){var r=this,n=this.parent.serviceLocator.getService(ph),i=this.parent.serviceLocator.getService(ch),o=e?e.item.id.split(this.parent.element.id+"_")[1]:"xlsx";if(t.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var a={isModal:!0,showCloseIcon:!0,cssClass:"e-open-dlg",allowDragging:!1,header:n.getConstant("SaveAs"),beforeOpen:function(e){var t={dialogName:n.getConstant("SaveAs"),element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),i.dialogInstance.content=r.OpenContent(o),i.dialogInstance.dataBind(),r.parent.element.querySelector(".e-text-open").setSelectionRange(0,r.parent.element.querySelector(".e-text-open").value.length),Pt(r.parent.element)},buttons:[{buttonModel:{content:n.getConstant("Save"),isPrimary:!0,cssClass:"e-btn-open-ok"},click:function(){var n=r.parent.element.querySelector(".e-text-open").value;if(r.checkValidName(n)){i.hide();var o=e?e.item.id.split(r.parent.element.id+"_")[1]:"Xlsx";r.parent.save({saveType:o,fileName:n})}else{var a=r.parent.element.querySelector(".e-btn-open-ok");t.getComponent(a,"btn").disabled=!0;var s=r.parent.serviceLocator.getService(ph),l=0===n.length?s.getConstant("EmptyFileName"):n.length>218?s.getConstant("LargeName"):s.getConstant("FileNameError"),h=r.parent.createElement("span",{className:"e-file-alert-span",innerHTML:l});r.parent.element.querySelector(".e-file-alert-span")&&r.parent.element.querySelector(".e-file-alert-span").remove(),r.parent.element.querySelector(".e-open-dlg").querySelector(".e-dlg-content").appendChild(h)}}}],close:function(){i.hide()}};i.show(a)}else i.hide()},e.prototype.checkValidName=function(e){var t=!0;return(e.match(new RegExp('.*[\\[\\]\\*\\\\/\\?\\:\\<\\>\\|\\"].*'))||e.length<1||e.length>218)&&(t=!1),t},e.prototype.OpenContent=function(e){var r=this,n=this.parent.serviceLocator.getService(ph),i=this.parent.createElement("div",{className:"e-open-dialog"}),o=this.parent.createElement("div",{className:"e-open-head"}),a=this.parent.createElement("div",{className:"e-input-group"});i.appendChild(o),i.appendChild(a);var s=n.getConstant("FileName"),l=this.parent.element.id+"_filename",h=this.parent.createElement("p",{className:"e-header",id:l,innerHTML:s,attrs:{"aria-label":n.getConstant("SaveAs")+" "+s}}),d=this.parent.createElement("input",{className:"e-input e-text-open",attrs:{type:"Text","aria-labelledby":l}}),p=this.parent.createElement("span",{className:"e-input-group-icon"});return d.onkeyup=function(e){if(r.parent.element.querySelector(".e-file-alert-span")&&13!==e.keyCode){var n=r.parent.element.querySelector(".e-btn-open-ok");t.getComponent(n,"btn").disabled=!1,r.parent.element.querySelector(".e-file-alert-span").remove()}},o.appendChild(h),p.textContent="."+e.toLowerCase(),a.appendChild(d),d.setAttribute("value","Sample"),a.appendChild(p),i},e}(),Ql=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.initContextMenu(),this.addEventListener()},e.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new o.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this),beforeItemRender:function(e){e.element.setAttribute("aria-label",e.item.text)}},e),e.setAttribute("role","menu")},e.prototype.beforeCloseHandler=function(e){this.parent.trigger("contextMenuBeforeClose",e)},e.prototype.selectHandler=function(e){var r=t.extend({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",r);var n,i=this.parent.element.id+"_cmenu";if(!r.cancel){var o=void 0;switch(e.item.id){case i+"_cut":this.parent.notify(to,{invokeCopy:!0,promise:Promise});break;case i+"_copy":this.parent.notify(ro,{invokeCopy:!0,promise:Promise});break;case i+"_paste":this.parent.notify(no,{isAction:!0,isInternal:!0});break;case i+"_pastevalues":this.parent.notify(no,{type:"Values",isAction:!0,isInternal:!0});break;case i+"_pasteformats":this.parent.notify(no,{type:"Formats",isAction:!0,isInternal:!0});break;case i+"_rename":this.parent.notify($i,{});break;case i+"_delete_sheet":this.parent.notify(Ki,{});break;case i+"_insert_sheet":this.parent.notify(Vr,{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex});break;case i+"_hide_sheet":this.parent.notify(Mo,{sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0});break;case i+"_duplicate":Ae(this.parent,void 0,!0);break;case i+"_move_right":Re(this.parent,this.parent.activeSheetIndex+1,null,!0);break;case i+"_move_left":Re(this.parent,this.parent.activeSheetIndex-1,null,!0);break;case i+"_ascending":this.parent.notify(Eo,{sortOptions:{sortDescriptors:{order:"Ascending"}}});break;case i+"_descending":this.parent.notify(Eo,{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case i+"_customsort":this.parent.notify(Io,null);break;case i+"_filtercellvalue":this.parent.notify(jo,null);break;case i+"_clearfilter":n=v(u(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify(Wo,{field:n});break;case i+"_reapplyfilter":this.parent.notify(qo,null);break;case i+"_hide_row":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(gn,{startIndex:o[0],endIndex:o[2],hide:!0,isCol:!1,actionUpdate:!0}),Pt(this.parent.element);break;case i+"_unhide_row":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(gn,{startIndex:o[0],endIndex:o[2],hide:!1,isCol:!1,actionUpdate:!0}),Pt(this.parent.element);break;case i+"_hide_column":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(gn,{startIndex:o[1],endIndex:o[3],hide:!0,isCol:!0,actionUpdate:!0}),Pt(this.parent.element);break;case i+"_unhide_column":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(gn,{startIndex:o[1],endIndex:o[3],hide:!1,isCol:!0,actionUpdate:!0}),Pt(this.parent.element);break;case i+"_insert_row_above":case i+"_delete_row":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(i.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:o[0],end:o[2],modelType:"Row",isAction:!0,insertType:"above"}),Pt(this.parent.element);break;case i+"_insert_row_below":o=w(c(this.parent.getActiveSheet().selectedRange)),this.parent.notify(Vr,{model:this.parent.getActiveSheet(),start:o[2]+1,end:o[2]+1+(o[2]-o[0]),modelType:"Row",isAction:!0,insertType:"below"}),Pt(this.parent.element);break;case i+"_insert_column_before":case i+"_delete_column":o=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(i.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:o[1],end:o[3],modelType:"Column",isAction:!0,insertType:"before"});break;case i+"_insert_column_after":o=w(c(this.parent.getActiveSheet().selectedRange)),this.parent.notify(Vr,{model:this.parent.getActiveSheet(),start:o[3]+1,end:o[3]+1+(o[3]-o[1]),modelType:"Column",isAction:!0,insertType:"after"});break;case i+"_hyperlink":this.parent.notify(Fo,null);break;case i+"_editHyperlink":this.parent.notify(To,null);break;case i+"_openHyperlink":this.parent.notify(Lo,null);break;case i+"_removeHyperlink":this.parent.notify(No,{range:this.parent.getActiveSheet().selectedRange});break;case i+"_protect":this.parent.notify(bs,{})}}},e.prototype.getInsertModel=function(e,t){for(var r=[],n=e;n<=t;n++)n===e?r.push({index:n}):r.push({});return r},e.prototype.beforeOpenHandler=function(e){var r,n=e.event.target,i=this.getTarget(n);if(e.element.classList.contains("e-contextmenu")){var o=this.parent.getActiveSheet();if(e.event.target&&(n.classList.contains("e-rowresize")||n.classList.contains("e-colresize"))){var a=c(o.selectedRange);if(!(n.classList.contains("e-rowresize")?0===a[1]&&a[3]===o.colCount-1:0===a[0]&&a[2]===o.rowCount-1))return void(e.cancel=!0);r=(n.classList.contains("e-rowresize")?this.parent.hiddenCount(a[0],a[2])!==Math.abs(a[2]-a[0])+1:this.parent.hiddenCount(a[1],a[3],"columns")!==Math.abs(a[3]-a[1])+1)?this.getDataSource(i):this.getDataSource(i,n)}else{if("Content"===i){var s=0===(a=c(o.selectedRange))[1]&&a[3]===o.colCount-1,l=0===a[0]&&a[2]===o.rowCount-1;i=s&&l?"SelectAll":s?"RowHeader":l?"ColumnHeader":"Content"}r=this.getDataSource(i)}this.contextMenuInstance.items=r,this.contextMenuInstance.dataBind()}else r=e.items;if("None"===this.parent.selectionSettings.mode&&"Content"===i&&this.parent.enableContextMenuItems(["Filter"],!1,!1),"ColumnHeader"===i||"RowHeader"===i){if(e.element&&e.element.childElementCount>0){var h="ColumnHeader"===i?e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_row"),d="ColumnHeader"===i?e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&h.classList.contains("e-disabled")?h.classList.remove("e-disabled"):this.parent.allowInsert&&!this.parent.element.querySelector(".e-selectall.e-highlight")||h.classList.contains("e-disabled")||h.classList.add("e-disabled"),this.parent.allowDelete&&d.classList.contains("e-disabled")?d.classList.remove("e-disabled"):this.parent.allowDelete||d.classList.contains("e-disabled")||d.classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&("ColumnHeader"===i&&this.parent.enableContextMenuItems(["Insert Column","Delete Column","Hide Column"],!1,!1),"RowHeader"===i&&this.parent.enableContextMenuItems(["Insert Row","Delete Row","Hide Row"],!1,!1))}}else if("Footer"===i){var p=fe(this.parent,n.textContent);0===p&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),p===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(Yi,t.extend(e,{target:i,items:r}))},e.prototype.getTarget=function(e){return t.closest(e,".e-sheet-content")?"Content":t.closest(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":t.closest(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":t.closest(e,".e-sheet-tabs-items")?"Footer":t.closest(e,".e-selectall-container")?e.classList.contains("e-header-cell")?t.closest(e,".e-header-row")?"ColumnHeader":"RowHeader":t.closest(e,".e-select-all-cell")?"SelectAll":"Content":""},e.prototype.getDataSource=function(e,t){var r=this.parent.serviceLocator.getService(ph),n=[],i=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,r,i),n.push({separator:!0}),this.setFilterItems(n,i),this.setSortItems(n,i),n.push({separator:!0}),this.setHyperLink(n,i);else if("RowHeader"===e){this.setClipboardData(n,r,i);var o=c(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(n,r,"Row",i,[o[0],o[2]],["Above","Below"]),t&&!t.classList.contains("e-rowresize")&&t.parentElement&&t.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Row",i,[o[0],o[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,r,i);o=c(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(n,r,"Column",i,[o[1],o[3]],["Before","After"]),t&&t.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Column",i,[o[1],o[3]])}else"SelectAll"===e?(this.setClipboardData(n,r,i),this.setFilterItems(n,i),this.setSortItems(n,i)):"Footer"===e&&(n.push({text:r.getConstant("Insert"),id:i+"_insert_sheet"}),n.push({text:r.getConstant("Delete"),iconCss:"e-icons e-delete",id:i+"_delete_sheet"}),n.push({text:r.getConstant("DuplicateSheet"),id:i+"_duplicate"}),n.push({text:r.getConstant("Rename"),id:i+"_rename"}),n.push({text:r.getConstant("Hide"),id:i+"_hide_sheet"}),this.setProtectSheetItems(n,i),n.push({text:r.getConstant("MoveRight"),id:i+"_move_right"}),n.push({text:r.getConstant("MoveLeft"),id:i+"_move_left"}));return n},e.prototype.setProtectSheetItems=function(e,t){var r=this.parent.serviceLocator.getService(ph);this.parent.getActiveSheet().isProtected?e.push({text:r.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:r.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})},e.prototype.setFilterItems=function(e,t){if(this.parent.allowFiltering){var r=this.parent.serviceLocator.getService(ph),n={clearFilterText:null,isFiltered:!1};this.parent.notify(Go,n),e.push({text:r.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:r.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}},e.prototype.setSortItems=function(e,t){var r=this.parent.serviceLocator.getService(ph);this.parent.allowSorting&&e.push({text:r.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})},e.prototype.setHyperLink=function(e,t){var r=this.parent.getActiveSheet();if(this.parent.allowHyperlink){var n=this.parent.serviceLocator.getService(ph);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||r.isProtected&&!r.protectSettings.insertLink?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:t+"_hyperlink"}):e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:t+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:t+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:t+"_removeHyperlink"})}},e.prototype.setClipboardData=function(e,t,r){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:r+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:r+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:r+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:r+"_pastespecial",items:[{text:t.getConstant("Values"),id:r+"_pastevalues"},{text:t.getConstant("Formats"),id:r+"_pasteformats"}]}))},e.prototype.setInsertDeleteItems=function(e,t,r,n,i,o){e.push({separator:!0}),["Insert","Delete"].forEach(function(a){i[0]===i[1]?e.push({text:t.getConstant(""+a+r),id:n+"_"+a.toLowerCase()+"_"+r.toLowerCase()}):e.push({text:t.getConstant(""+a+r+"s"),id:n+"_"+a.toLowerCase()+"_"+r.toLowerCase()}),"Insert"===a&&(e[e.length-1].items=[],o.forEach(function(r){e[e.length-1].items.push({text:t.getConstant(r),id:e[e.length-1].id+"_"+r.toLowerCase()})}))})},e.prototype.setHideShowItems=function(e,t,r,n,i){if(i[0]===i[1])e.push({text:t.getConstant("Hide"+r),id:n+"_hide_"+r.toLowerCase()});else{var o=i[0];i[0]=i[0]>i[1]?i[1]:i[0],i[1]=i[1]>o?i[1]:o,e.push({text:t.getConstant("Hide"+r+"s"),id:n+"_hide_"+r.toLowerCase()})}this.parent.hiddenCount(i[0],i[1],r.toLowerCase()+"s")&&e.push({text:t.getConstant("UnHide"+r+"s"),id:n+"_unhide_"+r.toLowerCase()})},e.prototype.addEventListener=function(){this.parent.on(oo,this.addItemsHandler,this),this.parent.on(ao,this.removeItemsHandler,this),this.parent.on(so,this.enableItemsHandler,this)},e.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},e.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},e.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(oo,this.addItemsHandler),this.parent.off(ao,this.removeItemsHandler),this.parent.off(so,this.enableItemsHandler))},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&t.detach(e),this.parent=null},e}(),Jl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){var r=this.parent.getCell(e.rowIndex,e.colIndex);t.isNullOrUndefined(r)||this.parent.refreshNode(r,e)},e.prototype.getTextSpace=function(e){e.width=Ft(e.char,e.cell.style,this.parent.cellStyle)},e.prototype.rowFillHandler=function(e){var t,r,n=e.td?e.td:this.parent.getCell(e.rowIdx,e.colIdx);if(n){e.formatText&&(n.innerHTML=e.formatText.toString()),e.secText&&((r=this.parent.createElement("span")).classList.add("e-fill-sec"),r.innerHTML=e.secText.toString()),n.children.length?t=n.querySelector(".e-fill"):((t=this.parent.createElement("span")).style.flexGrow="1",t.classList.add("e-fill"),n.appendChild(t),r&&n.appendChild(r)),t.innerHTML="";var i=Ft(e.value.toString(),e.cell.style,this.parent.cellStyle),o=Math.round(t.offsetWidth/i);e.formatText=e.value.repeat(o),t.innerHTML=e.formatText}},e.prototype.addEventListener=function(){this.parent.on(or,this.refreshCellElement,this),this.parent.on(Vn,this.rowFillHandler,this),this.parent.on(zn,this.getTextSpace,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(or,this.refreshCellElement),this.parent.off(Vn,this.rowFillHandler),this.parent.off(zn,this.getTextSpace))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),eh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Eo,this.applySortHandler,this),this.parent.on(Fr,this.sortCompleteHandler,this),this.parent.on(Io,this.initiateCustomSortHandler,this),this.parent.on(Qt,this.sortImport,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Eo,this.applySortHandler),this.parent.off(Fr,this.sortCompleteHandler),this.parent.off(Io,this.initiateCustomSortHandler),this.parent.off(Qt,this.sortImport))},e.prototype.getModuleName=function(){return"sort"},e.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=w(y(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)},e.prototype.sortImport=function(e){for(var t,r=this.parent.sortCollection,n=this.parent.getActiveSheet().usedRange.rowIndex-1,i=e?e.sheetIdx:this.parent.activeSheetIndex,o=0;o<r.length;o++)if(r[o].sheetIndex===i)for(var a=0;a<n;a++)if((t=this.parent.getCell(a,r[o].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===r[o].order||"OnTop"===r[o].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))},e.prototype.sortRangeAlertHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(ch),n=this.parent.serviceLocator.getService(ph);r.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(i){var o={dialogName:e.error===n.getConstant("MultiRangeSortError")?"MultiRangeSortDialog":"SortRangeDialog",content:e.error,element:i.element,target:i.target,cancel:i.cancel};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(i.cancel=!0),r.dialogInstance.content=o.content}}),this.parent.hideSpinner()},e.prototype.initiateCustomSortHandler=function(){var e=this,r=this.parent.serviceLocator.getService(ph),n=this.parent.getActiveSheet();if(this.isValidSortRange()&&0!=n.rows.length)if(Bt(n.selectedRange))this.sortRangeAlertHandler({error:r.getConstant("MultiRangeSortError")});else{var i,o=this.parent.serviceLocator.getService(ch);o.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:r.getConstant("CustomSort"),beforeOpen:function(t){var r={dialogName:"CustomSortDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),o.dialogInstance.content=e.customSortContent(),o.dialogInstance.dataBind(),Pt(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){var r=o.dialogInstance.content,n=t.getComponent(r.getElementsByClassName("e-list-sort e-listview e-lib")[0],"listview").dataSource;e.clearError();var a=r.getElementsByClassName("e-sort-error")[0];a.style.display="block",e.validateError(n,r,a)||(i={sortDescriptors:n,containsHeader:r.getElementsByClassName("e-sort-checkheader")[0].checked,caseSensitive:r.getElementsByClassName("e-sort-checkcase")[0].checked},o.hide())}}],close:function(){i&&Ke(function(){return e.applySortHandler({sortOptions:i})})}})}else this.sortRangeAlertHandler({error:r.getConstant("SortOutOfRangeError")})},e.prototype.validateError=function(e,r,n){var i=this.parent.serviceLocator.getService(ph);if(e.some(function(e){return""===e.field.toString()}))return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=!t.getComponent(e,"dropdownlist").value;return r&&e.parentElement.classList.add("e-error"),r}),n.innerText=i.getConstant("SortEmptyFieldError"),!0;var o=new Set,a="",s="";if(e.some(function(e){return a=e.field.toString(),o.size===o.add(e.field).size})){var l=0;return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=t.getComponent(e,"dropdownlist");return r.value===a&&(e.parentElement.classList.add("e-error"),s=r.text,l++),2===l}),n.innerHTML="<strong>"+s+"</strong>"+i.getConstant("SortDuplicateFieldError"),!0}return!1},e.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),r=this.getFields(),n=t.getUniqueID("customSort"),i=this.getCustomListview(n);this.setHeaderTab(e,i,r);var o=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(o);var a=this.parent.createElement("div",{className:"e-list-sort",styles:""});o.appendChild(a),i.createElement=this.parent.createElement,i.appendTo(a),a.removeAttribute("tabindex"),this.renderListItem(n,i,!0,r);var s=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(s),e},e.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=w(y(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var r={filterRange:[],hasFilter:!1};this.parent.notify(Ko,r),r.hasFilter&&r.filterRange&&(t[0]=r.filterRange[0])}var n,i,o=[];for(t[1];t[1]<=t[3];t[1]++){var a=ke(t[0],t[1],e);if(i="Column "+v(t[1]+1),a&&a.value){if(n=a.value,a.format){var s={formattedText:n,value:n,format:a.format,onLoad:!0};this.parent.notify(ir,s),n=s.formattedText}}else n=i;o.push({text:n,value:i})}return o},e.prototype.setHeaderTab=function(e,r,n){var i=this,o=this.parent.serviceLocator.getService(ph),a=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(a);var l=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:o.getConstant("AddColumn"),attrs:{type:"button"}}),h=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");h.insertBefore(l,h.firstElementChild),l.addEventListener("click",function(){if(r){var e=t.getUniqueID("customSort");r.addItem([{id:e,text:o.getConstant("ThenBy"),field:"",order:"ascending"}]),i.renderListItem(e,r,d.checked,n,!0)}});var d=new s.CheckBox({label:o.getConstant("ContainsHeader"),checked:!0,change:function(r){var i=r.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(e){var r=t.getComponent(e,"dropdownlist");r.dataSource=null,r.dataSource=n,r.fields=i,r.dataBind()})},cssClass:"e-sort-headercheckbox"}),p=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});a.appendChild(p),d.createElement=this.parent.createElement,d.appendTo(p);var c=new s.CheckBox({label:o.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),u=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});a.appendChild(u),c.createElement=this.parent.createElement,c.appendTo(u)},e.prototype.getCustomListview=function(e){var r=[{id:e,text:this.parent.serviceLocator.getService(ph).getConstant("SortBy"),field:"",order:"ascending"}];t.enableRipple(!1);return new h.ListView({dataSource:r,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})},e.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&t.removeItem(e)})},e.prototype.renderListItem=function(e,t,r,n,i){var o=this,a=this.parent.serviceLocator.getService(ph),h=t.element.querySelector("li[data-uid="+e+"]"),d=r?{text:"text",value:"value"}:{text:"value"},p=h.getElementsByClassName("e-sort-field")[0],c=new l.DropDownList({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:d,placeholder:a.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,function(t){return t.id===e&&(t.field=r.value.toString().replace("Column ","")),t.id===e}),o.clearError())}});c.createElement=this.parent.createElement,c.appendTo(p),i||(c.index=0);var u=h.getElementsByClassName("e-sort-order")[0],f="ascending"===u.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),g=new s.RadioButton({label:a.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:f,cssClass:"e-sort-radiobutton",change:function(r){o.setRadioBtnValue(t,e,r.value)}}),m=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});u.appendChild(m),g.createElement=this.parent.createElement,g.appendTo(m);var v=new s.RadioButton({label:a.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!f,cssClass:"e-sort-radiobutton",change:function(r){o.setRadioBtnValue(t,e,r.value)}}),y=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});u.appendChild(y),v.createElement=this.parent.createElement,v.appendTo(y),this.deleteHandler(h,t)},e.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,function(e){return e.id===t&&(e.order=r),e.id===t})},e.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(e){e.classList.remove("e-error")}))},e.prototype.applySortHandler=function(e){var t=this,r=this.parent.getActiveSheet(),n=e&&e.range||r.selectedRange,i=w(y(n)),o=e&&e.sortOptions||{sortDescriptors:{}},a=i[0]===i[2],s={filterRange:[],hasFilter:!1,sheetIdx:this.parent.activeSheetIndex};this.parent.notify(Ko,s),s.hasFilter&&(a?$(s.filterRange,i[0],i[1]):s.filterRange[0]===i[0]&&(this.parent.element.querySelector(".e-selectall.e-highlight")||i[1]>=s.filterRange[1]&&i[1]<=s.filterRange[3]||i[3]>=s.filterRange[1]&&i[3]<=s.filterRange[3]))&&(i[0]=s.filterRange[0],i[1]=s.filterRange[1],i[2]=r.usedRange.rowIndex,i[3]=r.usedRange.colIndex,o.containsHeader=!0,a=!1);var l={range:n=m(i),sortOptions:o,cancel:!1};if(this.parent.trigger("beforeSort",l),!l.cancel){this.parent.notify(Zt,{eventArgs:l,action:"beforeSort"}),this.parent.showSpinner();var h=new Promise(function(e,t){e(void 0)}),d={args:{range:l.range,sortOptions:l.sortOptions,checkForHeader:a&&n!==l.range},promise:h,previousSort:e&&e.previousSort};this.parent.notify(Ar,d),d.promise.then(function(e){return t.sortCompleteHandler(e),t.parent.trigger(Fr,e),t.parent.notify(Yo,{eventArgs:e,action:"sorting"}),Promise.resolve(e)}).catch(function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.sortCompleteHandler=function(e){var t,r,n=this.parent.activeSheetIndex;if(e.range.includes("!")){var i=e.range.split("!");n=fe(this.parent,i[0]),t=be(this.parent,n),r=c(i[1])}else t=this.parent.getActiveSheet(),r=c(e.range);for(var o=r[0];o<=r[2];o++)for(var a=r[1];a<=r[3];a++)this.parent.notify(pr,{action:"refreshCalculate",rowIndex:o,colIndex:a});this.parent.serviceLocator.getService("cell").refreshRange(r,!0,!0),n===this.parent.activeSheetIndex&&t.conditionalFormats&&t.conditionalFormats.length&&this.parent.notify(vn,{indexes:r}),this.parent.hideSpinner()},e}(),th=function(){function e(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.filterBtn=e.createElement("div",{className:"e-filter-btn e-control e-btn e-lib e-filter-iconbtn e-icon-btn"}),this.filterBtn.appendChild(e.createElement("span",{className:"e-btn-icon e-icons e-filter-icon"})),this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.filterBtn=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Pr,this.filterRangeAlertHandler,this),this.parent.on(Vo,this.initiateFilterUIHandler,this),this.parent.on(Ni,this.filterMouseDownHandler,this),this.parent.on(zo,this.renderFilterCellHandler,this),this.parent.on(d.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler,this),this.parent.on(d.filterCmenuSelect,this.closeDialog,this),this.parent.on(qo,this.reapplyFilterHandler,this),this.parent.on(jo,this.filterByCellValueHandler,this),this.parent.on(Wo,this.clearFilterHandler,this),this.parent.on(Go,this.getFilteredColumnHandler,this),this.parent.on(Yi,this.cMenuBeforeOpenHandler,this),this.parent.on(d.filterCboxValue,this.filterCboxValueHandler,this),this.parent.on(Ko,this.getFilterRangeHandler,this),this.parent.on(Xo,this.filterCellKeyDownHandler,this),this.parent.on(tr,this.getFilteredCollection,this),this.parent.on(Li,this.updateFilter,this),this.parent.on(Nn,this.updateFilter,this),this.parent.on(Dn,this.beforeInsertHandler,this),this.parent.on(On,this.beforeDeleteHandler,this),this.parent.on(Cr,this.deleteSheetHandler,this),this.parent.on(Cn,this.clearHandler,this),this.parent.on(d.filterDialogCreated,this.filterDialogCreatedHandler,this),this.parent.on(d.filterDialogClose,this.removeFilterClass,this),this.parent.on(Kn,this.duplicateSheetFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Pr,this.filterRangeAlertHandler),this.parent.off(Vo,this.initiateFilterUIHandler),this.parent.off(Ni,this.filterMouseDownHandler),this.parent.off(zo,this.renderFilterCellHandler),this.parent.off(d.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler),this.parent.off(d.filterCmenuSelect,this.closeDialog),this.parent.off(qo,this.reapplyFilterHandler),this.parent.off(jo,this.filterByCellValueHandler),this.parent.off(Wo,this.clearFilterHandler),this.parent.off(Go,this.getFilteredColumnHandler),this.parent.off(Yi,this.cMenuBeforeOpenHandler),this.parent.on(d.filterCboxValue,this.filterCboxValueHandler),this.parent.off(Ko,this.getFilterRangeHandler),this.parent.off(Xo,this.filterCellKeyDownHandler),this.parent.off(tr,this.getFilteredCollection),this.parent.off(Li,this.updateFilter),this.parent.off(Nn,this.updateFilter),this.parent.off(Dn,this.beforeInsertHandler),this.parent.off(On,this.beforeDeleteHandler),this.parent.off(Cr,this.deleteSheetHandler),this.parent.off(Cn,this.clearHandler),this.parent.off(d.filterDialogCreated,this.filterDialogCreatedHandler),this.parent.off(d.filterDialogClose,this.removeFilterClass),this.parent.off(Kn,this.duplicateSheetFilterHandler))},e.prototype.getModuleName=function(){return"filter"},e.prototype.isInValidFilterRange=function(e,t){var r=w(y(t||e.selectedRange));return r[0]>e.usedRange.rowIndex||r[1]>e.usedRange.colIndex},e.prototype.filterRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(ch).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var r={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()},e.prototype.beforeFilterMenuOpenHandler=function(e){var t=this.parent.serviceLocator.getService(ph);e.element.classList.add("e-spreadsheet-contextmenu");var r=e.element.querySelector("ul");this.addMenuItem(r,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(r,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(r)},e.prototype.addMenuItem=function(e,t,r,n){var i=this.parent.createElement("li",{className:r+" e-menu-item"});i.innerHTML=t,i.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),i.firstChild),e.insertBefore(i,e.firstChild)},e.prototype.initiateFilterUIHandler=function(e){var t=this,n=e?e.predicates:null,i=e.sIdx;i||0===i||(i=this.parent.activeSheetIndex);var o;e.promise&&(o=new r.Deferred,e.promise=o.promise);var a=function(){o&&o.resolve()},s=e.isInternal||e.isCut;if(this.filterRange.size>0&&this.filterRange.has(i)&&!this.parent.isOpen&&!n)return this.removeFilter(i,s,!1),void a();var l=be(this.parent,i);if(this.isInValidFilterRange(l,e.range)){var h=this.parent.serviceLocator.getService(ph);return this.filterRangeAlertHandler({error:h.getConstant("FilterOutOfRangeError")}),void a()}var d,p,u=e.range||l.selectedRange;if(!s){if(d={range:u,sheetIndex:i,cancel:!1},e.predicates?(d.predicates=e.predicates,d.previousPredicates=this.filterCollection.get(i)&&[].slice.call(this.filterCollection.get(i))):d.filterOptions={predicates:e.predicates},d.useFilterRange=!1,p={action:"filter",eventArgs:d},this.parent.notify(Zt,p),d.cancel)return void a();delete d.cancel,e.useFilterRange=d.useFilterRange}if(e.range||!s&&u!==d.range)s||(u=d.range);else{var g=c(u);g[0]===g[2]&&g[1]===g[3]&&(u=m(g=ae(g[0],g[1],l)),s||(d.range=u))}if(n){if(n.length){var v=this.filterRange.get(i);v&&(e.useFilterRange=v.useFilterRange),this.processRange(l,i,u,!0,e.useFilterRange);var y=this.filterRange.get(i).range.slice();y[0]=y[0]+1,e.useFilterRange||(y[2]=l.usedRange.rowIndex),y[1]=y[3]=f(n[0].field);var C=l.name+"!"+this.getPredicateRange(y,n.slice(1,n.length)),x=m(y);return void pe(this.parent,C,!0,!0,null,!0,null,null,!1,x).then(function(i){t.filterSuccessHandler(new r.DataManager(i),{action:"filtering",filterCollection:n,field:n[0].field,sIdx:e.sIdx,isInternal:s,prevPredicates:d&&d.previousPredicates}),a()})}this.clearFilterHandler({sheetIndex:i}),a()}else this.processRange(l,i,u,!1,e.useFilterRange),a();s||this.parent.notify(Yo,p)},e.prototype.processRange=function(e,t,r,n,i){var o=w(y(r||e.selectedRange));o[0]===o[2]&&o[1]===o[3]?(o[0]=0,o[1]=0,o[2]=e.usedRange.rowIndex,o[3]=e.usedRange.colIndex):o[3]>e.usedRange.colIndex&&(o[3]=e.usedRange.colIndex),this.filterRange.set(t,{useFilterRange:i,range:o}),this.filterCollection.set(t,[]),n||this.refreshFilterRange(o,!1,t)},e.prototype.removeFilter=function(e,t,r){var n,i=this.filterRange.get(e).range.slice(),o=m(i);if(!t){if(n={action:"filter",eventArgs:{range:o,sheetIndex:e,cancel:!1}},this.parent.notify(Zt,n),n.eventArgs.cancel)return;delete n.eventArgs.cancel}if((this.filterCollection.get(e).length||r)&&this.clearFilterHandler({preventRefresh:r,sheetIndex:e}),this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(i,!0,e),this.parent.filterCollection)for(var a=0,s=void 0,l=0,h=this.parent.filterCollection.length;l<h;l++)(s=this.parent.filterCollection[a]).sheetIndex===e&&s.filterRange===o?this.parent.filterCollection.splice(a,1):a++;t||this.parent.notify(Yo,n)},e.prototype.filterByCellValueHandler=function(){var e=this,t=this.parent.activeSheetIndex,n=this.parent.getActiveSheet();if(this.isInValidFilterRange(n)){var i=this.parent.serviceLocator.getService(ph);this.filterRangeAlertHandler({error:i.getConstant("FilterOutOfRangeError")})}else{var o=c(n.activeCell);this.isFilterRange(t,o[0],o[1])||this.processRange(n,t);var a=this.filterRange.get(t).range.slice();a[0]=a[0]+1,a[2]=n.usedRange.rowIndex,a[1]=a[3]=o[1];var s=v(o[1]+1),l=ke(o[0],o[1],n),h=ce(this.parent,l,o[0],o[1]);!N(h)||l.format&&"@"===l.format||(h=parseFloat(h));var d=[{field:s,operator:"equal",type:this.getColumnType(n,o[1],o).type,matchCase:!1,value:h}],p=n.name+"!"+this.getPredicateRange(a,this.filterCollection.get(t)),u=m(a);pe(this.parent,p,!0,!0,null,!0,null,null,!1,u).then(function(t){e.filterSuccessHandler(new r.DataManager(t),{action:"filtering",filterCollection:d,field:s,isFilterByValue:!0})})}},e.prototype.renderFilterCellHandler=function(e){var r=t.isNullOrUndefined(e.sIdx)?this.parent.activeSheetIndex:e.sIdx;if(r===this.parent.activeSheetIndex&&this.isFilterCell(r,e.rowIndex,e.colIndex)){if(!e.td)return;var n=e.td.querySelector(".e-filter-icon");n?n.className="e-btn-icon e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,r):((n=this.filterBtn.cloneNode(!0)).firstElementChild.className+=this.getFilterSortClassName(e.colIndex,r),e.td.insertBefore(n,e.td.firstChild))}},e.prototype.getFilterSortClassName=function(e,t){for(var r=v(e+1),n="",i=this.filterCollection.get(t),o=this.parent.sortCollection,a=0;a<i.length;a++)if(i[a].field===r){n=" e-filtered";break}if(o)for(a=0;a<o.length;a++)if(o[a].sheetIndex===t&&o[a].columnIndex===e){n+="Ascending"===o[a].order?" e-sortasc-filter":" e-sortdesc-filter";break}return n},e.prototype.refreshFilterRange=function(e,t,r){var n=r;n||0===n||(n=this.parent.activeSheetIndex),e||this.filterRange.get(n)||(e=[0,0,0,0]);for(var i=e||this.filterRange.get(n).range.slice(),o=i[1];o<=i[3];o++){var a=this.parent.getCell(i[0],o);if(t){if(a&&a.hasChildNodes()){var s=a.querySelector(".e-filter-btn");s&&s.parentElement.removeChild(s)}}else this.renderFilterCellHandler({td:a,rowIndex:i[0],colIndex:o,sIdx:n})}this.parent.sortCollection&&this.parent.notify(Qt,null)},e.prototype.isFilterCell=function(e,t,r){var n=this.filterRange.get(e)&&this.filterRange.get(e).range;return n&&n[0]===t&&n[1]<=r&&n[3]>=r},e.prototype.isFilterRange=function(e,t,r){var n=this.filterRange.get(e)&&this.filterRange.get(e).range;return n&&n[0]<=t&&n[2]>=t&&n[1]<=r&&n[3]>=r},e.prototype.getFilteredColumnHandler=function(e){var r=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=this.parent.serviceLocator.getService(ph);if(e.clearFilterText=n.getConstant("ClearFilter"),this.filterRange.has(r)){var i=this.filterCollection.get(r);if(e.isClearAll)return void(e.isFiltered=i&&i.length>0);var o=this.filterRange.get(r).range.slice(),a=be(this.parent,r),s=u(a.activeCell);if(this.isFilterRange(r,s[0],s[1])){e.field=v(s[1]+1);var l=ke(o[0],s[1],a),h=this.parent.getDisplayText(l);e.clearFilterText=n.getConstant("ClearFilterFrom")+'"'+(h?h.toString():"Column "+e.field)+'"',i.some(function(t){return e.isFiltered=t.field===e.field,e.isFiltered})}}},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var r={isFiltered:!1};this.getFilteredColumnHandler(r),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!r.isFiltered,!0)}},e.prototype.closeDialog=function(){var e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){var r=t.getComponent(e,"dialog");t.EventHandler.remove(e,st(),this.filterMouseDownHandler),r&&r.hide(),this.parent.notify(d.filterDialogClose,null)}},e.prototype.removeFilterClass=function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")},e.prototype.isPopupOpened=function(){var e=document.getElementsByClassName("e-filter-popup")[0];return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display},e.prototype.filterCellKeyDownHandler=function(e){var t=u(this.parent.getActiveSheet().activeCell);if(this.isFilterCell(this.parent.activeSheetIndex,t[0],t[1]))if(e.closePopup)this.closeDialog();else if(e.isFilterCell=!0,!this.isPopupOpened()){var r=this.parent.getCell(t[0],t[1]);r&&this.openDialog(r)}},e.prototype.filterMouseDownHandler=function(e){if(!(t.Browser.isDevice&&"mousedown"===e.type||this.parent.getActiveSheet().isProtected)){var r=e.target;if(r.classList.contains("e-filter-icon")||r.classList.contains("e-filter-btn"))this.isPopupOpened()&&this.closeDialog(),this.openDialog(d.parentsUntil(r,"e-cell"));else if(this.isPopupOpened()){var n=r.offsetParent;r.classList.contains("e-searchinput")||r.classList.contains("e-searchclear")||!n||n.classList.contains("e-filter-popup")||n.classList.contains("e-text-content")||n.classList.contains("e-checkboxtree")||n.classList.contains("e-checkbox-wrapper")?this.selectSortItemHandler(r):this.closeDialog()}}},e.prototype.initTreeView=function(e,n){var i,a,s,l,h,p,c,u,f=this,g=[],m=[],v={},y=[],C=[],x=[],b=[],S=["January","February","March","April","May","June","July","August","September","October","November","December"],w=!1,I=this.parent.getActiveSheet(),E=function(e){v[p]=!0,Be(I,Number(e.__rowIndex)-1)?w=!0:g.push(p),m.push(p)};e.dataSource.forEach(function(t){"object"==typeof(l=t[e.column.field])&&Date.parse(l.toString())?(i=l.getFullYear().toString(),v[i]||((u={__rowIndex:i,hasChild:!0})[e.column.field]=i,y.push(u),v[i]=!0),c=l.getMonth(),v[h=i+" "+(a=S[c])]||((u={__rowIndex:h,pId:i,hasChild:!0,month:c})[e.column.field]=a,C.push(u),v[h]=!0),s=l.getDate(),p=h+" "+s.toString(),v[p]||((u={__rowIndex:p,pId:h})[e.column.field]=s,x.push(u),E(t))):(t[e.column.field]||0===t[e.column.field]?(p="text "+t[e.column.field].toString().toLowerCase(),i=t[e.column.field]):(p="blanks",i=f.parent.serviceLocator.getService(ph).getConstant("Blanks")),v[p]||((u={__rowIndex:p})[e.column.field]=i,b.push(u),E(t)))}),y=new r.DataManager(y).executeLocal((new r.Query).sortBy(e.column.field,"decending")),C=new r.DataManager(C).executeLocal((new r.Query).sortBy("month","ascending")),x=new r.DataManager(x).executeLocal((new r.Query).sortBy(e.column.field,"ascending")),x=y.concat(C.concat(x)),b.length&&(b=new r.DataManager(b).executeLocal((new r.Query).sortBy(e.column.field,"ascending")),x=x.concat(b));var R=function(e){var t=[e.node];if(e.event.target.classList.contains("e-fullrow")||"Enter"==e.event.key){"true"==D.getNode(e.node).isChecked?D.uncheckAll(t):D.checkAll(t)}},A=function(){t.removeClass([T],["e-check","e-stop","e-uncheck"]),e.btnObj.element.disabled&&(e.btnObj.element.disabled=!1),w?D.checkedNodes.length?T.classList.add("e-stop"):(T.classList.add("e-uncheck"),e.btnObj.element.disabled=!0):T.classList.add("e-check"),L.indeterminate=w,L.checked=!w},k={};k[e.column.field]=this.parent.serviceLocator.getService(ph).getConstant("SelectAll");var F=d.createCboxWithWrap(d.getUid("cbox"),n.createCheckbox(k[e.column.field],!1,k),"e-ftrchk");F.classList.add("e-spreadsheet-ftrchk");var T=F.querySelector(".e-frame");T.classList.add("e-selectall"),F.addEventListener("click",function(){L.indeterminate=!1,T.classList.contains("e-check")?(D.uncheckAll(),T.classList.add("e-uncheck"),L.checked=!1):(D.checkAll(),T.classList.add("e-check"),L.checked=!0)}.bind(this)),e.element.appendChild(F);var L=F.querySelector(".e-chk-hidden"),N=this.parent.createElement("div"),D=new o.TreeView({fields:{dataSource:x,id:"__rowIndex",parentID:"pId",text:e.column.field,hasChildren:"hasChild"},enableRtl:this.parent.enableRtl,showCheckBox:!0,cssClass:"e-checkboxtree",checkedNodes:g,nodeClicked:R.bind(this),keyPress:R.bind(this),nodeChecked:function(e){"indeterminate"!==e.action&&(w=D.checkedNodes.length!==D.fields.dataSource.length,A())}});D.createElement=this.parent.createElement,D.appendTo(N),e.element.appendChild(N),g=D.checkedNodes,A();e.btnObj.element.addEventListener("click",function(){D.checkedNodes.length===x.length?f.filterSuccessHandler(new r.DataManager(e.dataSource),{action:"clear-filter",field:e.column.field}):f.generatePredicate(D.checkedNodes,b.length?"string":e.type,e.column.field,n,m,D.checkedNodes.length>x.length/2)}.bind(this));var O=this.refreshCheckbox.bind(this,x,D,g),M=function(){f.parent.off(ys,O),f.parent.off(d.filterDialogClose,M)};this.parent.on(d.filterDialogClose,M,this),this.parent.on(ys,O,this)},e.prototype.generatePredicate=function(e,t,r,n,i,o){var a,s,l,h,d,p=[],c={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},u=function(){"blanks"===s[0]?p.push(Object.assign({value:"",type:t},a)):"text"===s[0]&&(s.splice(0,1),h=s.join(" "),isNaN(Number(h))?d="string":(h=Number(h),d="number"),p.push(Object.assign({value:h,type:d},a)))},f=function(){(l=new Date(Number(s[0]),c[s[1]],Number(s[2]))).getDate()?p.push(Object.assign({value:l,type:t},a)):u()};if(o){a={field:r,ignoreAccent:!1,matchCase:!1,predicate:"and",operator:"notequal"};for(var g=0,m=i.length;g<m;g++)-1===e.indexOf(i[g])&&(s=i[g].split(" "),f())}else{a={field:r,ignoreAccent:!1,matchCase:!1,predicate:"or",operator:"equal"};for(g=0,m=e.length;g<m;g++)3===(s=e[g].split(" ")).length?f():u()}n.initiateFilter(p)},e.prototype.refreshCheckbox=function(e,n,i,o){var a;if("keyup"===o.event.type)a=o.event.target.value;else if(o.event.target.classList.contains("e-search-icon"))return;var s,l=function(){if(s.length&&!n.fields.dataSource.length){var e=n.element.parentElement;e.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.remove("e-hide"),t.detach(e.getElementsByClassName("e-checkfltrnmdiv")[0])}n.fields.dataSource=s,n.dataBind()};if(a){s=new r.DataManager(e).executeLocal((new r.Query).where(new r.Predicate(n.fields.text,"contains",a,!0)));var h={},d=[],p=void 0,c=void 0,u=void 0,f=void 0;if(isNaN(Number(a))){for(var g=0;g<s.length;g++)s[g].hasChild&&(d.push(new r.Predicate("pId","equal",s[g].__rowIndex,!1)),h[p=s[g].pId]||(d.push(new r.Predicate("__rowIndex","equal",p,!1)),h[p]=!0));c=s,f=1}else{var m=void 0,v={};u=[];for(g=0;g<s.length;g++)(p=s[g].pId)?(m=p.split(" ")[0],h[p]||(d.push(new r.Predicate("__rowIndex","equal",p,!1)),h[p]=!0,u.push(m),u.push(p)),v[m]||(h[m]||(d.push(new r.Predicate("__rowIndex","equal",m,!1)),h[m]=!0),d.push(new r.Predicate("__rowIndex","equal",s[g].__rowIndex,!1)))):v[p=s[g].__rowIndex]||(d.push(new r.Predicate("__rowIndex","contains",p,!1)),v[p]=!0);c=[]}if(s.length){d.length&&(s=c.concat(new r.DataManager(e).executeLocal((new r.Query).where(r.Predicate.or(d))))),l(),n.checkAll();var y=n.animation.expand.duration;n.animation.expand.duration=0,n.expandAll(u,f),n.animation.expand.duration=y}else if(n.fields.dataSource.length){l();var C=n.element.parentElement;C.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.add("e-hide");var x=this.parent.createElement("div",{className:"e-checkfltrnmdiv"});x.appendChild(this.parent.createElement("span",{innerHTML:this.parent.serviceLocator.getService(ph).getConstant("NoResult")})),C.appendChild(x)}}else s=e,l(),n.checkedNodes=i,n.dataBind()},e.prototype.openDialog=function(e){var n=this,i=parseInt(e.getAttribute("aria-colindex"),10),o=v(i);this.parent.showSpinner();var a=this.parent.activeSheetIndex,s=this.filterRange.get(a),l=s.range.slice(),h=this.parent.getActiveSheet(),p=ke(l[0],i-1,h),c=this.parent.getDisplayText(p);l[0]=l[0]+1,s.useFilterRange||(l[2]=h.usedRange.rowIndex);var u,f=[l[0],i-1,l[2],i-1],g=this.getPredicateRange(f,this.filterCollection.get(a),i-1),y=g.otherColPredicate,C=h.name+"!"+g.address,x=m(f),b=this.getColumnType(h,i-1,l),S=b.type,w=S.includes("date")||b.isDateAvail;w&&!g.filteredCol&&(u=[]),pe(this.parent,C,!0,!0,null,!0,null,null,!1,x,null,u).then(function(s){var p;if(n.parent.element.style.position="relative",n.parent.element.classList.add("e-filter-open"),w){if(u||!y.length)p=new r.DataManager(u||s);else{var f=new r.DataManager(s).executeLocal((new r.Query).where(r.Predicate.and(n.getPredicates(y))));p=new r.DataManager(f)}var g=function(e){n.parent.off(vs,g),e.isCheckboxFilterTemplate=!0,n.initTreeView(e,C)};n.parent.on(vs,g,n)}else s.some(function(e,t){return e&&(p=new r.DataManager(s.slice(t))),!!e});var m=e.querySelector(".e-filter-btn"),v={type:S,field:o,format:"date"===S?n.getDateFormatFromColumn(h,i,l):null,displayName:c||"Column "+o,dataSource:p,height:n.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:n.filterCollection.get(a),column:{field:o,filter:{}},handler:n.filterSuccessHandler.bind(n,new r.DataManager(s)),target:m,position:{X:0,Y:0},localeObj:n.parent.serviceLocator.getService(ph)},C=new d.ExcelFilterBase(n.parent,n.getLocalizedCustomOperators());C.openDialog(v);var x=document.querySelector(".e-filter-popup");if(x&&x.id.includes(n.parent.element.id)){t.EventHandler.add(x,st(),n.filterMouseDownHandler,n);var b=n.parent.element.getBoundingClientRect(),I=m.getBoundingClientRect(),E=x.getBoundingClientRect(),R=I.right-b.left-E.width;R<0&&(R=I.left-b.left),x.style.left=R+"px",x.style.top="0px",x.style.visibility="hidden",x.classList.contains("e-hide")&&x.classList.remove("e-hide");var A=I.bottom-b.top;E.height-(b.bottom-I.bottom)>0&&(A-=E.height-(b.bottom-I.bottom))<0&&(A=0),x.style.top=A+"px",x.style.visibility=""}n.parent.hideSpinner()})},e.prototype.getPredicateRange=function(e,t,r){var n,i=m(e),o=[];if(t&&t.length){var a,s;t.forEach(function(t){t.field&&(a=""+t.field+(e[0]+1)+":"+t.field+(e[2]+1),s=f(t.field),i.includes(a)||(i+=","+a,s<e[1]&&(e[1]=s),s>e[3]&&(e[3]=s)),void 0!==r&&(s===r?n=!0:o.push(t)))})}else n=!0;return void 0===r?i:{address:i,filteredCol:n,otherColPredicate:o}},e.prototype.filterDialogCreatedHandler=function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")},e.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var r=u(t+e.data.dataObj.__rowIndex),n=ke(r[0],r[1],this.parent.getActiveSheet());n&&n.format&&(e.value=this.parent.getDisplayText(n))}}},e.prototype.selectSortItemHandler=function(e){var t=this.parent.serviceLocator.getService(ph),r=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if("Ascending"===r?e.setAttribute("aria-label",t.getConstant("SortAscending")):e.setAttribute("aria-label",t.getConstant("SortDescending")),r){var n=this.parent.getActiveSheet(),i=this.parent.activeSheetIndex,o=this.filterRange.get(i),a=o.range.slice();a[0]=a[0]+1,o.useFilterRange||(a[2]=n.usedRange.rowIndex),this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var s,l=0;l<this.parent.sortCollection.length;l++)this.parent.sortCollection[l]&&this.parent.sortCollection[l].sheetIndex===i&&(s=this.parent.sortCollection[l],this.parent.sortCollection.splice(l,1));this.parent.sortCollection.push({sortRange:m(a),columnIndex:y(n.activeCell)[1],order:r,sheetIndex:i}),s||(s={order:""}),this.parent.notify(Eo,{sortOptions:{sortDescriptors:{order:r},containsHeader:!1},previousSort:s,range:m(a)}),this.refreshFilterRange(),this.closeDialog()}},e.prototype.filterSuccessHandler=function(e,t){var r=t.sIdx;r||0===r||(r=this.parent.activeSheetIndex);var n=t.prevPredicates||[].slice.call(this.filterCollection.get(r));t.isFilterByValue&&!n.length&&(n=void 0);var i=this.filterCollection.get(r);if(this.updatePredicate(i,t.field),"clear-filter"!==t.action||i.length!==n.length){if("filtering"===t.action&&(i=i.concat(t.filterCollection)).length)for(var o=0;o<i.length;o++)t.field=i[o].field;this.filterCollection.set(r,i);var a={datasource:e,predicates:this.getPredicates(this.filterCollection.get(r))},s=this.filterRange.get(r);s.useFilterRange||(s.range[2]=be(this.parent,r).usedRange.rowIndex),this.applyFilter(a,m(s.range),r,n,!1,t.isInternal)}},e.prototype.updatePredicate=function(e,t){for(var n=new r.DataManager(e),i=new r.Query,o=n.executeLocal(i.where("field","equal",t)),a=0;a<o.length;a++){for(var s=-1,l=0;l<e.length;l++)if(e[l].field===o[a].field){s=l;break}-1!==s&&e.splice(s,1)}},e.prototype.applyFilter=function(e,t,r,n,i,o){var a=this,s={range:t,predicates:[].slice.call(this.filterCollection.get(r)),previousPredicates:n,sheetIndex:r,cancel:!1};if(o||(this.parent.notify(Zt,{action:"filter",eventArgs:s}),!s.cancel)){t.indexOf("!")<0&&(t=this.parent.sheets[r].name+"!"+t),this.parent.showSpinner();var l={args:{range:t,filterOptions:e},promise:new Promise(function(e,t){e(void 0)}),refresh:i};this.parent.notify(Mr,l),l.promise.then(function(e){return a.refreshFilterRange(),a.parent.notify(tr,null),a.parent.hideSpinner(),o||(delete s.cancel,a.parent.notify(Yo,{action:"filter",eventArgs:s})),Promise.resolve(e)}).catch(function(e){return a.filterRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.getPredicates=function(e){for(var t=[],r=d.CheckBoxFilterBase.getPredicate(e),n=0,i=Object.keys(r);n<i.length;n++){var o=i[n];t.push(r[o])}return t},e.prototype.getColumnType=function(e,t,r){for(var n=0,i=0,o=0,a=r[0];a<=r[2];a++){var s=ke(a,t,e);if(s)if(s.format){switch(H(s.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":n++;break;case"shortdate":case"longdate":o++;break;case"time":n++;break;default:Oe(s)?o++:N(s.value)?n++:i++}}else"string"==typeof s.value||void 0===s.value||null===s.value?i++:n++;else i++}return{type:n>i&&n>o&&n>0?"number":i>=n&&i>=o&&i>=0?"string":o>n&&o>i&&o>0?"date":"datetime",isDateAvail:!!o}},e.prototype.getDateFormatFromColumn=function(e,t,r){for(var n,i=r[0];i<=r[2];i++){var o=ke(i,t-1,e);if(o&&o.format){var a=H(o.format);n="ShortDate"===a?o.format.split("m").join("M"):"LongDate"===a?"EEEE, MMMM d, y":o.format;break}}return n},e.prototype.clearFilterHandler=function(e){var t=e&&void 0!==e.sheetIndex?e.sheetIndex:this.parent.activeSheetIndex;if(e&&e.field){var r=[].slice.call(this.filterCollection.get(t));r&&r.length&&(this.updatePredicate(r,e.field),this.initiateFilterUIHandler({predicates:r,range:m(this.filterRange.get(t).range),sIdx:t}))}else{var n=e&&e.isAction,i={isFiltered:!1,isClearAll:!0,sheetIndex:t};if(this.getFilteredColumnHandler(i),i.isFiltered||e&&e.preventRefresh){var o=void 0,a=be(this.parent,t),s=this.filterRange.get(t),l=s.range;if(n&&(o={range:m(l),predicates:[],previousPredicates:this.filterCollection.get(t),sheetIndex:t,cancel:!1},this.parent.notify(Zt,{action:"filter",eventArgs:o}),o.cancel))return;this.filterCollection.set(t,[]);for(var h=this.parent.filterCollection,d=0,p=h&&h.length;d<p;d++)if(h[d].sheetIndex===t){h.splice(d,1);break}var c=s.useFilterRange?l[2]:a.usedRange.rowIndex;if(this.parent.scrollSettings.enableVirtualization&&c-l[0]+1>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")){for(d=0;d<=c;d++)Pe(a,d,{hidden:!1,isFiltered:!1});e&&e.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}else{this.refreshFilterRange(null,null,t);var u={startIndex:l[0],hide:!1,isFiltering:!0,refreshUI:!1,endIndex:s.useFilterRange?l[2]:a.usedRange.rowIndex,sheetIndex:t};this.parent.notify(gn,u),!u.refreshUI||e&&e.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}n&&(delete o.cancel,this.parent.notify(Yo,{action:"filter",eventArgs:o}))}}},e.prototype.reapplyFilterHandler=function(e,t){var n=this,i=this.parent.activeSheetIndex;if(this.filterRange.has(i)){var o=this.filterCollection.get(i);if(o&&o.length){var a=be(this.parent,i),s=this.filterRange.get(this.parent.activeSheetIndex),l=s.range.slice();l[0]=l[0]+1,s.useFilterRange||(l[2]=a.usedRange.rowIndex),l[1]=l[3]=f(o[0].field);var h=a.name+"!"+this.getPredicateRange(l,o.slice(1,o.length));pe(this.parent,h,!0,!0,null,!0,null,null,!1,m(l)).then(function(a){var l=n.getPredicates(n.filterCollection.get(i));n.applyFilter({predicates:l,datasource:new r.DataManager(a)},m(s.range),i,[].slice.call(o),t,e)})}}},e.prototype.getFilterRangeHandler=function(e){var t=e.sheetIdx;this.filterRange&&this.filterRange.has(t)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(t).range):(e.hasFilter=!1,e.filterRange=null)},e.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(ph),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},e.prototype.getFilteredCollection=function(){for(var e,r=this.parent.sheets.length,n=[],i=0;i<r;i++){var o={sheetIdx:i,filterRange:void 0,hasFilter:void 0};if(this.getFilterRangeHandler(o),o.hasFilter){for(var a=[],s=[],l=[],h=[],d=[],p=this.filterCollection.get(o.sheetIdx),c=0;c<p.length;c++)if(p[c].field&&p[c].operator){var f=u(p[c].field+"1")[1];a.push(f),s.push(p[c].operator),l.push(t.isNullOrUndefined(p[c].value)?"":p[c].value),h.push(p[c].type),d.push(p[c].predicate)}var g=m(o.filterRange);e={sheetIndex:o.sheetIdx,filterRange:g,hasFilter:o.hasFilter,column:a,criteria:s,value:l,dataType:h,predicates:d},n.push(e)}}e&&(this.parent.filterCollection=n)},e.prototype.updateFilter=function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var t=0;t<this.parent.filterCollection.length;t++){var r=this.parent.filterCollection[t],n=r.sheetIndex;0!==t||this.parent.isOpen||e.isOpen||(n=0);var i=[];if(r.column)for(var o=0;o<r.column.length;o++){var a={field:g(0,r.column[o]).charAt(0),operator:this.getFilterOperator(r.criteria[o]),value:"string"==typeof r.value[o]?r.value[o].split("*").join(""):r.value[o],predicate:r.predicates&&r.predicates[o],type:r.dataType&&r.dataType[o]};i.push(a)}for(var s=0;s<i.length-1;s++)i[s].field===i[s+1].field&&(i[s].predicate||(i[s].predicate="or"),i[s+1].predicate||(i[s+1].predicate="or"));this.parent.notify(Vo,{predicates:i.length?i:void 0,range:r.filterRange,sIdx:n,isInternal:!0})}this.parent.sortCollection&&this.parent.notify(Qt,null)}},e.prototype.getFilterOperator=function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal"}return e},e.prototype.beforeInsertHandler=function(e){if("Column"===e.modelType){var r=t.isUndefined(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(r)){var n=this.filterRange.get(r).range;(this.isFilterCell(r,n[0],e.index)||e.index<n[1])&&(n[3]+=e.model.length,e.index<=n[1]&&(n[1]+=e.model.length),this.filterCollection.get(r).forEach(function(t){var r=f(t.field);e.index<=r&&(t.field=v(r+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){t.sheetIndex===r&&e.index<=t.columnIndex&&(t.columnIndex+=e.model.length)}),this.getFilteredCollection())}}else if("Sheet"===e.modelType){for(var i=!1,o=0,a=Array.from(this.filterRange.keys()).sort().reverse();o<a.length;o++){var s=a[o];e.index<=s&&(i=!0,this.filterRange.set(s+e.model.length,this.filterRange.get(s)),this.filterRange.delete(s),this.filterCollection.set(s+e.model.length,this.filterCollection.get(s)),this.filterCollection.delete(s))}this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){e.index<=t.sheetIndex&&(t.sheetIndex+=e.model.length)}),i&&this.getFilteredCollection()}},e.prototype.beforeDeleteHandler=function(e){if("Column"===e.modelType){var t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var r=!0,n=this.filterRange.get(t).range;if(e.start>=n[1]&&e.end<=n[3]?n[3]-=e.end-e.start+1:e.start<n[1]&&e.end<n[1]?(n[1]-=e.end-e.start+1,n[3]-=e.end-e.start+1):e.start<n[1]&&e.end>n[1]&&e.end<n[3]?(n[1]=e.start,n[3]-=e.end-e.start+1):r=!1,r){for(var i=this.filterCollection.get(t),o=void 0,a=i.length-1;a>=0;a--){var s=f(i[a].field);e.end<s?i[a].field=v(s-(e.end-e.start+1)+1):e.start<=s&&e.end>=s&&(o=!0,i.splice(a,1))}var l=this.parent.sortCollection;if(l)for(a=0;a<l.length;a++)if(l[a].sheetIndex===t){if(e.end<l[a].columnIndex){l[a].columnIndex=l[a].columnIndex-(e.end-e.start+1);break}if(e.start<=l[a].columnIndex&&e.end>=l[a].columnIndex){l.splice(a,1);break}}n.some(function(e){return e<0})?(this.removeFilter(t,!0,!0),e.refreshSheet=!0):o&&(i&&i.length?(this.reapplyFilterHandler(!0,!0),e.refreshSheet=!1):(this.clearFilterHandler({preventRefresh:!0}),e.refreshSheet=!0)),this.getFilteredCollection()}}}},e.prototype.deleteSheetHandler=function(e){if(t.isUndefined(e.sheetIndex))this.filterRange.get(this.parent.activeSheetIndex)&&(this.filterRange.delete(this.parent.activeSheetIndex),this.filterCollection.delete(this.parent.activeSheetIndex));else{for(var r=void 0,n=0,i=Array.from(this.filterRange.keys()).sort().reverse();n<i.length;n++){var o=i[n];r=!0,e.sheetIndex===o?(this.filterRange.delete(o),this.filterCollection.delete(o)):e.sheetIndex<o?(this.filterRange.set(o-1,this.filterRange.get(o)),this.filterRange.delete(o),this.filterCollection.set(o-1,this.filterCollection.get(o)),this.filterCollection.delete(o)):r=!1}var a=this.parent.sortCollection;if(a)for(var s=a.length-1;s>=0;s--)e.sheetIndex===a[s].sheetIndex?a.splice(s,1):e.sheetIndex<a[s].sheetIndex&&(a[s].sheetIndex-=1);r&&this.getFilteredCollection()}},e.prototype.clearHandler=function(e){var t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){var r=this.filterRange.get(t.sheetIndex).range.slice();$(t.indices,r[0],r[1])&&$(t.indices,r[0],r[3])&&this.removeFilter(t.sheetIndex)}},e.prototype.duplicateSheetFilterHandler=function(e){this.filterCollection.has(e.sheetIndex)&&this.filterCollection.set(e.newSheetIndex,this.filterCollection.get(e.sheetIndex)),this.filterRange.has(e.sheetIndex)&&this.filterRange.set(e.newSheetIndex,this.filterRange.get(e.sheetIndex))},e}(),rh=function(){function e(e){this.pictureCount=1,this.parent=e,this.addEventListener(),this.renderImageUpload()}return e.prototype.addEventListener=function(){this.parent.on(ka,this.insertImage,this),this.parent.on(Fa,this.refreshImgElem,this),this.parent.on(Ta,this.refreshImgCellObj,this),this.parent.on(Da,this.createImageElement,this),this.parent.on(Oa,this.deleteImage,this),this.parent.on(Ha,this.refreshInsDelImagePosition,this)},e.prototype.renderImageUpload=function(){this.parent.element.appendChild(this.parent.createElement("input",{id:this.parent.element.id+"_imageUpload",styles:"display: none;",attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}})).onchange=this.imageSelect.bind(this)},e.prototype.imageSelect=function(e){var t=e.target.files[0];t&&(t.type.includes("image")?this.insertImage({file:t}):this.parent.serviceLocator.getService(ch).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),e.target.value="")},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ka,this.insertImage),this.parent.off(Ta,this.refreshImgCellObj),this.parent.off(Da,this.createImageElement),this.parent.off(Oa,this.deleteImage),this.parent.off(Ha,this.refreshInsDelImagePosition))},e.prototype.insertImage=function(e,t){var r=this;this.binaryStringVal(e).then(function(e){return r.createImageElement({options:{src:e},range:t,isPublic:!0})})},e.prototype.binaryStringVal=function(e){return new Promise(function(t,r){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}})},e.prototype.createImageElement=function(e){var r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=e.range&&e.range.indexOf("!")>0?fe(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=this.parent.serviceLocator.getService(uh),o=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,a=c(r),s=t.isUndefined(n)?this.parent.getActiveSheet():this.parent.sheets[n];if(!document.getElementById(o)){var l={requestType:"beforeInsertImage",range:s.name+"!"+r,imageData:e.options.src,sheetIndex:n};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:l,action:"beforeInsertImage"}),!l.cancel){var h=i.insertOverlayElement(o,r,n);h.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(h.style.height=e.options.height+"px",h.style.width=e.options.width+"px",h.style.top=e.options.top+"px",h.style.left=e.options.left+"px"),(s.frozenRows||s.frozenColumns)&&i.adjustFreezePaneSize(e.options,h,r),e.options.imageId||this.pictureCount++;var d={src:e.options.src,id:o,height:parseFloat(h.style.height.replace("px","")),width:parseFloat(h.style.width.replace("px","")),top:s.frozenRows||s.frozenColumns?a[0]?Ve(s,0,a[0]-1):0:parseFloat(h.style.top.replace("px","")),left:s.frozenRows||s.frozenColumns?a[1]?We(s,0,a[1]-1):0:parseFloat(h.style.left.replace("px",""))};this.parent.setUsedRange(a[0],a[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify(bn,{options:[d],range:s.name+"!"+r});var p=ke(a[0],a[1],s);p.image[p.image.length-1].id||(p.image[p.image.length-1].id=d.id),!e.isUndoRedo&&e.isPublic&&(l={requestType:"insertImage",range:s.name+"!"+r,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:o,sheetIndex:n},this.parent.notify("actionComplete",{eventArgs:l,action:"insertImage"}))}}},e.prototype.refreshImgElem=function(){var e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&t.removeClass([e],"e-ss-overlay-active")},e.prototype.refreshInsDelImagePosition=function(e){for(var t,r,n,i=e.count,o=e.sheetIdx,a=this.parent.sheets[o],s=ke(e.rowIdx,e.colIdx,a),l=s.image.length,h=0;h<l;h++)t=document.getElementById(s.image[h].id),r="Row"===e.type?"insert"===e.status?s.image[h].top+20*i:s.image[h].top-20*i:s.image[h].top,n="Column"===e.type?"insert"===e.status?s.image[h].left+64*i:s.image[h].left-64*i:s.image[h].left,s.image[h].top=r,s.image[h].left=n,t.style.top=r+"px",t.style.left=n+"px"},e.prototype.refreshImgCellObj=function(e){var r,n,i=t.isUndefined(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,o=be(this.parent,i),a=ke(e.prevRowIdx,e.prevColIdx,o),s=ke(e.currentRowIdx,e.currentColIdx,o),l=a?a.image:[],h=l&&l.length?l.length:0;if(a&&a.image&&l.length>0){for(var d=0;d<h;d++)l[d]&&l[d].id===e.id&&((r=l[d]).height=e.currentHeight,r.width=e.currentWidth,r.top=e.currentTop,r.left=e.currentLeft,l.splice(d,1));if(s&&s.image&&(n=s.image,r&&n.push(r)),Fe(e.currentRowIdx,e.currentColIdx,o,n?{image:n}:{image:[r]},!0),"imageRefresh"===e.requestType&&!e.isUndoRedo){var p={requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:p,action:"imageRefresh"})}}},e.prototype.deleteImage=function(e){var t,r,n,i=this.parent.getActiveSheet(),o=document.getElementById(e.id);if(o){var a=void 0,s=void 0;if(i.frozenRows||i.frozenColumns){var l=o.getBoundingClientRect();a={clientY:l.top},s={clientX:l.left},l.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(a.target=this.parent.getColumnHeaderContent()),l.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(s.target=this.parent.getRowHeaderTable())}else a={clientY:o.offsetTop,isImage:!0},s={clientX:o.offsetLeft,isImage:!0};if(this.parent.notify(La,a),this.parent.notify(Na,s),t=a.clientY,r=s.clientX,n=i.name+"!"+g(t,r),!e.preventEventTrigger){var h={address:n,cancel:!1};if(this.parent.notify(Zt,{action:"deleteImage",eventArgs:h}),h.cancel)return}document.getElementById(e.id).remove()}else{var d=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,p=e.range&&e.range.indexOf("!")>0?fe(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,u=c(d);t=u[0],r=u[1],i=this.parent.sheets[p]}for(var f=ke(t,r,i).image,m=f.length,v={},y=0;y<m;y++)f[y].id===e.id&&(v=f.splice(y,1)[0]);Fe(t,r,i,{image:f},!0),e.preventEventTrigger||this.parent.notify(Yo,{action:"deleteImage",eventArgs:{address:n,id:v.id,imageData:v.src,cancel:!1}})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"spreadsheetImage"},e}();p.Chart.Inject(p.ColumnSeries,p.LineSeries,p.BarSeries,p.AreaSeries,p.StackingColumnSeries,p.StackingLineSeries,p.StackingBarSeries,p.ScatterSeries),p.Chart.Inject(p.StackingAreaSeries,p.Category,p.Legend,i.Tooltip,p.DataLabel),p.AccumulationChart.Inject(p.PieSeries,p.AccumulationTooltip,p.AccumulationDataLabel,p.AccumulationLegend);var nh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(wn,this.initiateChartHandler,this),this.parent.on(Pa,this.refreshChartCellObj,this),this.parent.on(An,this.updateChartHandler,this),this.parent.on(Ma,this.deleteChart,this),this.parent.on(_a,this.clearBorder,this),this.parent.on(Va,this.insertChartHandler,this),this.parent.on(za,this.chartRangeHandler,this),this.parent.on(Wa,this.chartDesignTabHandler,this),this.parent.on(Ga,this.updateChartElement,this),this.parent.on(Ya,this.undoRedoForChartDesign,this)},e.prototype.insertChartHandler=function(e){var t="Column";switch(e.id){case"clusteredColumn":t="Column";break;case"stackedColumn":t="StackingColumn";break;case"stackedColumn100":t="StackingColumn100";break;case"clusteredBar":t="Bar";break;case"stackedBar":t="StackingBar";break;case"stackedBar100":t="StackingBar100";break;case"area":t="Area";break;case"stackedArea":t="StackingArea";break;case"stackedArea100":t="StackingArea100";break;case"line":t="Line";break;case"stackedLine":t="StackingLine";break;case"stackedLine100":t="StackingLine100";break;case"pie":t="Pie";break;case"doughnut":t="Doughnut";break;case"scatter":t="Scatter"}var r=[{type:t}];e.isChart?this.parent.notify(Sn,{chart:r}):this.parent.notify(Wa,{chartType:t,triggerEvent:!0})},e.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,r=this.parent.chartColl,n=r.length,i=0;i<n;i++){var o=document.getElementById(r[i].id);e&&o&&r[i].id===t&&this.parent.notify(wn,{option:r[i],isRefresh:!0})}},e.prototype.getPropertyValue=function(e,r,n){var i=ke(e,r,be(this.parent,n));if(i){var o=void 0;if(i.format){var a={value:i.value,format:i.format,onLoad:!0,formattedText:i.value,isRightAlign:!1,cell:i,rowIndex:e.toString(),colIndex:r.toString()};if(this.parent.notify(ir,a),"number"==typeof a.value){var s=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");a.formattedText=a.formattedText.toString().replace(s,""),o=parseInt(a.formattedText.toString(),10)}else o=a.formattedText&&a.formattedText.toString()}else o=i.value;return t.isNullOrUndefined(o)?"":o}return""},e.prototype.updateChartHandler=function(e){var r=this.initiateChartHandler({option:e.chart,isRefresh:!0}),n=this.parent.element.querySelector("."+e.chart.id);if(n){var i=t.getComponent(n,"chart");t.isNullOrUndefined(i)&&(i=t.getComponent(n,"accumulationchart")),i.series=r,i.refresh()}},e.prototype.refreshChartCellObj=function(e){var r,n,i=t.isUndefined(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,o=be(this.parent,i),a=ke(e.prevRowIdx,e.prevColIdx,o),s=ke(e.currentRowIdx,e.currentColIdx,o),l=a?a.chart:[],h=l&&l.length?l.length:0;if(h){for(var d=0;d<h;d++)if(l[d].id===e.id.split("_overlay")[0]){(r=l[d]).height=e.currentHeight,r.width=e.currentWidth,r.top=e.currentTop,r.left=e.currentLeft,l.splice(d,1);for(var p=0,c=this.parent.chartColl.length;p<c;p++)r.id===this.parent.chartColl[p].id&&(r.height=e.currentHeight,this.parent.chartColl[p].width=e.currentWidth,this.parent.chartColl[p].top=e.currentTop,this.parent.chartColl[p].left=e.currentLeft)}if(s&&s.chart&&(n=s.chart,r&&n.push(r)),Fe(e.currentRowIdx,e.currentColIdx,o,n?{chart:n}:{chart:[r]},!0),"chartRefresh"===e.requestType&&!e.isUndoRedo){var u={requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:i};this.parent.notify("actionComplete",{eventArgs:u,action:"chartRefresh"})}}},e.prototype.processChartRange=function(e,r,n){var i,o,a,s=e[0],l=e[1],h=!1,d=e[2],p=e[3],c=s===d,u=l===p,f=this.getPropertyValue(s,p,r),g=this.getPropertyValue(d,l,r),m=this.getPropertyValue(s,l,r);return N(g)&&m||(h=!0),t.isNullOrUndefined(m)&&!c&&!u||"Scatter"===n.type&&e[3]-e[1]==1?(i=[s+1,l,d,l],o=[s+1,l+1,d,p],a=[s,l+1,s,p]):t.isNullOrUndefined(g)||!h||c||u?(o=[s,l,d,p],t.isNullOrUndefined(f)||N(f)||L(f)?t.isNullOrUndefined(m)&&(c||u)&&(a=[s,l,s,p],c?(o[1]=o[1]+1,a[3]=a[1]):o[0]=o[0]+1):(a=[s,l,s,p],o[0]=o[0]+1)):t.isNullOrUndefined(f)||N(f)&&m?(i=[s,l,d,l],o=[s,l+1,d,p]):(i=[s+1,l,d,l],o=[s+1,l+1,d,p],a=[s,l+1,s,p]),{xRange:i,yRange:o,lRange:a}},e.prototype.toIntrnlRange=function(e,t){return e?"string"==typeof e&&(e=c[e]):e=c[this.parent.sheets[t].selectedRange],e},e.prototype.getRangeData=function(e){e.range=this.toIntrnlRange(e.range,e.sheetIdx);var t=[];return this.pushRowData(e,e.range[0],e.range[1],e.range[2],e.range[3],t,[],!0,e.isYvalue),t},e.prototype.pushRowData=function(e,t,r,n,i,o,a,s,l){for(var h,d=r,p=this.parent.sheets[e.sheetIdx];t<=n;)if(He(p,t))t++;else{for(r=d;r<=i;)if(Ge(p,r))r++;else{var c=ke(t,r,p,!1,!0);if(c.format&&!l){var u={value:c.value,format:c.format,onLoad:!0,formattedText:c.value,rowIndex:t.toString(),colIndex:r.toString(),isRightAlign:!1,cell:c};this.parent.notify(ir,u),h=u.formattedText?u.formattedText.toString():""}else h=c.value||(0===c.value?0:"");o.push({value:h}),r++}t++}a.push(t)},e.prototype.toArrayData=function(e){for(var t,r=0,n=[],i=e.length;r<i;)t=e[r],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),r++;return n},e.prototype.getVirtualXValues=function(e){for(var t=1,r=[];t<e;)r.push(t.toString()),t++;return r},e.prototype.processChartSeries=function(e,r,n,i,o){e=e||{};var a,s,l,h,d,p,c,u="",f={},g={},m=0,v=0,y=[];r=t.isNullOrUndefined(r)?this.parent.getActiveSheet().index:r;var C=this.parent.sheets[r],x=this.getRangeData({range:i,sheetIdx:r,skipFormula:!0,isYvalue:!0}),b=i[2]-i[0]+1-this.parent.hiddenCount(i[0],i[2],"rows",C),S=i[3]-i[1]+1-this.parent.hiddenCount(i[0],i[2],"columns",C);e.isSeriesInRows?(s=o?this.toArrayData(this.getRangeData({range:o,sheetIdx:r,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(S+1),n&&(l=this.toArrayData(this.getRangeData({range:n,sheetIdx:r,skipFormula:!1,isYvalue:!1}))),h=b):(s=n?this.toArrayData(this.getRangeData({range:n,sheetIdx:r,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(b+1),o&&(l=this.toArrayData(this.getRangeData({range:o,sheetIdx:r,skipFormula:!1,isYvalue:!1}))),h=S);var w=s.length,I=e.isSeriesInRows?1:h;for(t.isNullOrUndefined(e.dataLabelSettings)||(f.visible=e.dataLabelSettings.visible,f.position=e.dataLabelSettings.position);m<h;){for(p=0,d=[],v=e.isSeriesInRows?v:m;p<w;)x[v]&&(N(a=x[v].value)?a=Number(a):(c=T(a),a=isNaN(c)?0:c),d.push({x:s[p],y:a})),v+=I,p++;if(u=l&&l.length>0?l[m]:"series"+m,e.type){var E=e.type;if("Line"===E||"StackingLine"===E||"StackingLine100"===E)g={dataSource:d,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{visible:!0,width:10,height:10,dataLabel:f}};else if("Scatter"===E)g={dataSource:d,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:f}};else if("Pie"===E||"Doughnut"===E){var R="Pie"===e.type?"0%":"40%",A=f.visible,k=t.isNullOrUndefined(f.position)?"Inside":"Outer"===f.position?"Outside":"Inside";g={dataSource:d,dataLabel:{visible:!t.isNullOrUndefined(A)&&A,position:k,name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",innerRadius:R}}else g={dataSource:d,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{dataLabel:f}}}y.push(g),m++}var F;return e.type&&(F={series:y,xRange:e.isSeriesInRows?o:n,yRange:i,lRange:e.isSeriesInRows?n:o}),F},e.prototype.primaryYAxisFormat=function(e){if(t.isNullOrUndefined(e))return"{value}";var r,n=ke(e[0],e[1],this.parent.getActiveSheet());if(n&&n.format){if("Accounting"===(r=H(n.format)))return"${value}";if("Currency"===r)return"${value}";if("Percentage"===r)return"{value}%"}return"{value}"},e.prototype.focusChartRange=function(e,t,r){var n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var i,o=this.parent.getActiveSheet(),a=!(!o.frozenRows&&!o.frozenColumns);r&&(a?i=r:this.parent.notify(Ua,{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[n[0],n[1]]})),e&&(a?i?(i[0]=Math.min(r[0],e[0]),i[1]=Math.min(r[1],e[1]),i[2]=Math.max(r[2],e[2]),i[3]=Math.max(r[3],e[3])):i=e:this.parent.notify(Ua,{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[n[2],n[3]]})),a&&i?this.parent.notify(Ua,{startcell:{rowIndex:Math.min(i[0],t[0]),colIndex:Math.min(i[1],t[1])},endcell:{rowIndex:Math.max(i[2],t[2]),colIndex:Math.max(i[3],t[3])},classes:[n[4],n[5]]}):this.parent.notify(Ua,{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[n[4],n[5]]})},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows){[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(function(e){t.detach(e)})}else for(var r=this.parent.getMainContent(),n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],i=0,o=n.length;i<o;i++)for(var a=r.querySelectorAll("."+n[i]),s=0,l=a.length;s<l;s++){a[s].classList.remove(n[i])}},e.prototype.initiateChartHandler=function(e){var r=e.option,n=!0;n=!!t.isNullOrUndefined(e.isInitCell)||!e.isInitCell,e.triggerEvent=!!t.isNullOrUndefined(e.triggerEvent)||e.triggerEvent;e.isRefresh=!t.isNullOrUndefined(e.isRefresh)&&e.isRefresh;var i,o,a=r.range&&r.range.indexOf("!")>0?fe(this.parent,r.range.split("!")[0]):this.parent.activeSheetIndex,s=be(this.parent,a),l=r.range?r.range:this.parent.getActiveSheet().selectedRange,h=c(l),d={};if(this.parent.allowChart||!s.isProtected){var u={sheetIndex:a,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:r,range:l,operation:"create"};if(d=u.options,l=u.range,d=d||{},h.length>0){h[2]-h[0]<h[3]-h[1]&&(i=!0)}d.isSeriesInRows=!!i||!!d.isSeriesInRows&&d.isSeriesInRows,e.dataSheetIdx=t.isNullOrUndefined(e.dataSheetIdx)?a:e.dataSheetIdx;var f=this.processChartRange(h,e.dataSheetIdx,d),g=f.xRange,m=f.yRange,v=f.lRange;a===this.parent.activeSheetIndex&&n&&this.focusChartRange(g,m,v);var y=this.processChartSeries(d,e.dataSheetIdx,g,m,v),C={majorGridLines:r.primaryXAxis&&r.primaryXAxis.majorGridLines&&!t.isNullOrUndefined(r.primaryXAxis.majorGridLines.width)?{width:r.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:r.primaryXAxis&&r.primaryXAxis.minorGridLines&&!t.isNullOrUndefined(r.primaryXAxis.minorGridLines.width)?{width:r.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:r.primaryXAxis&&r.primaryXAxis.minorGridLines&&r.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Category",visible:!r.primaryXAxis||r.primaryXAxis.visible,title:r.primaryXAxis?r.primaryXAxis.title:""},x={lineStyle:{width:0},majorGridLines:r.primaryYAxis&&r.primaryYAxis.majorGridLines&&!t.isNullOrUndefined(r.primaryYAxis.majorGridLines.width)?{width:r.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:r.primaryYAxis&&r.primaryYAxis.minorGridLines&&!t.isNullOrUndefined(r.primaryYAxis.minorGridLines.width)?{width:r.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:r.primaryYAxis&&r.primaryYAxis.minorGridLines&&r.primaryYAxis.minorGridLines.width>0?5:0,labelFormat:this.primaryYAxisFormat(m),visible:!r.primaryYAxis||r.primaryYAxis.visible,title:r.primaryYAxis?r.primaryYAxis.title:""};if(e.isRefresh)return y.series;if(e.triggerEvent){if(o={type:r.type,theme:r.theme,isSeriesInRows:r.isSeriesInRows,range:r.range,id:r.id,height:r.height,width:r.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},this.parent.notify(Zt,{eventArgs:o,action:"beforeInsertChart"}),o.cancel)return[];r.type=o.type,r.theme=o.theme,r.isSeriesInRows=o.isSeriesInRows,r.range=o.range,r.id=o.id,r.height=o.height,r.width=o.width}var b=r.id+"_overlay",w=this.parent.serviceLocator.getService(uh),I=!t.isNullOrUndefined(e.isInitCell)&&e.isInitCell?e.range:l,E=w.insertOverlayElement(b,I,S(this.parent,I));E.classList.add("e-datavisualization-chart"),E.style.width=r.width+"px",E.style.height=r.height+"px",s.frozenRows||s.frozenColumns?w.adjustFreezePaneSize(r,E,I):(E.style.top=t.isNullOrUndefined(r.top)?E.style.top:r.top+"px",E.style.left=t.isNullOrUndefined(r.left)?E.style.left:r.left+"px",r.top=parseInt(E.style.top.replace("px",""),10),r.left=parseInt(E.style.left.replace("px",""),10)),this.parent.notify(os,{height:r.height,width:r.width});var R="Pie"===r.type||"Doughnut"===r.type?{position:"Bottom",visible:!0}:{};t.isNullOrUndefined(r.legendSettings)||(R.visible=r.legendSettings.visible,R.position=r.legendSettings.position);var A=this.parent.createElement("div",{id:r.id,className:r.id}),k=r.theme||"Material";"Pie"!==r.type&&"Doughnut"!==r.type?(this.chart=new p.Chart({primaryXAxis:C,primaryYAxis:x,background:this.getThemeBgColor(k),chartArea:{border:{width:0}},title:r.title,legendSettings:R,theme:k,series:y.series,tooltip:{enable:!0},width:E.style.width,height:E.style.height,load:function(e){e.chart.theme=r.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(A)):(this.chart=new p.AccumulationChart({title:r.title,legendSettings:R,theme:k,background:this.getThemeBgColor(k),series:y.series,width:E.style.width,height:E.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,load:function(e){e.chart.theme=r.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(A)),E.appendChild(A),E.classList.contains("e-ss-overlay-active")&&this.parent.notify(qa,{id:E.id}),e.triggerEvent&&this.parent.notify(Yo,{eventArgs:o,action:"insertChart"})}},e.prototype.deleteChart=function(e){this.clearBorder();var r=null,n=this.parent.getActiveSheet();if(t.isNullOrUndefined(e.id)?(r=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=r?r.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",r=document.getElementById(e.id)),!t.isNullOrUndefined(e.id)){e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var i,o,a,s,l=!1,h=0,d=this.parent.chartColl.length;h<d;h++)if(this.parent.chartColl[h].id===e.id.split("_overlay")[0]){s=this.parent.chartColl[h];break}var p={id:s.id,range:s.range,type:s.type,theme:s.theme,height:s.height,width:s.width,isSeriesInRows:s.isSeriesInRows,isInitCell:!0,posRange:null,top:s.top,left:s.left,cancel:!1};if(r){var u=void 0,f=void 0;if(n.frozenRows||n.frozenColumns){var m=r.getBoundingClientRect();u={clientY:m.top},f={clientX:m.left},m.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(u.target=this.parent.getColumnHeaderContent()),m.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(f.target=this.parent.getRowHeaderTable())}else u={clientY:r.offsetTop,isImage:!0},f={clientX:r.offsetLeft,isImage:!0};this.parent.notify(kn,{id:e.id}),this.parent.notify(La,u),this.parent.notify(Na,f),l=!0,i=u.clientY,o=f.clientX,n=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify(kn,{id:e.id});var v=e.range&&e.range.indexOf("!")>0?fe(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,y=c(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);i=y[0],o=y[1],n=this.parent.sheets[v]}var C=ke(i,o,n);C&&(a=C.chart);var x=a?a.length:null;for(h=0;h<x;h++)e.id===a[h].id+"_overlay"&&a.splice(h,1);l&&(document.getElementById(e.id).remove(),this.parent.notify(ja,{})),Fe(i,o,n,{chart:a},!0),p.posRange=g(i,o),e.isUndoRedo||this.parent.notify(Yo,{eventArgs:p,action:"deleteChart"})}},e.prototype.updateChartModel=function(e,r,n,i,o){var a=r;r=r;var s=this.parent.chartColl[i].id;if(!(o&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(var l=0,h=n.chart.length;l<h;l++)if(n.chart[l].id===s)switch(e){case"PHAxes":case"PHAxisTitle":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),"PHAxes"===e?(n.chart[l].primaryXAxis.visible=r.primaryXAxis.visible,this.parent.chartColl[i].primaryXAxis.visible=r.primaryXAxis.visible):"PHAxisTitle"===e&&(n.chart[l].primaryXAxis.title=r.primaryXAxis.title,this.parent.chartColl[i].primaryXAxis.title=r.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),"PVAxes"===e?(n.chart[l].primaryYAxis.visible=r.primaryYAxis.visible,this.parent.chartColl[i].primaryYAxis.visible=r.primaryYAxis.visible):"PVAxisTitle"===e&&(n.chart[l].primaryYAxis.title=r.primaryYAxis.title,this.parent.chartColl[i].primaryYAxis.title=r.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":n.chart[l].title=r.title,this.parent.chartColl[i].title=r.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(t.isNullOrUndefined(n.chart[l].dataLabelSettings)&&(n.chart[l].dataLabelSettings={},this.parent.chartColl[i].dataLabelSettings={}),"DLNone"===e)n.chart[l].dataLabelSettings.visible=!1,this.parent.chartColl[i].dataLabelSettings.visible=!1;else{n.chart[l].dataLabelSettings.visible=!0,this.parent.chartColl[i].dataLabelSettings.visible=!0;var d=void 0;d=o?"Outside"===a.series[0].dataLabel.position?"Outer":"Middle":r.series[0].marker.dataLabel.position,n.chart[l].dataLabelSettings.position=d,this.parent.chartColl[i].dataLabelSettings.position=d}break;case"GLMajorHorizontal":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),t.isNullOrUndefined(n.chart[l].primaryYAxis.majorGridLines)&&(n.chart[l].primaryYAxis.majorGridLines={},this.parent.chartColl[i].primaryYAxis.majorGridLines={}),n.chart[l].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width,this.parent.chartColl[i].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),t.isNullOrUndefined(n.chart[l].primaryXAxis.majorGridLines)&&(n.chart[l].primaryXAxis.majorGridLines={},this.parent.chartColl[i].primaryXAxis.majorGridLines={}),n.chart[l].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width,this.parent.chartColl[i].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),t.isNullOrUndefined(n.chart[l].primaryYAxis.minorGridLines)&&(n.chart[l].primaryYAxis.minorGridLines={},this.parent.chartColl[i].primaryYAxis.minorGridLines={}),n.chart[l].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width,this.parent.chartColl[i].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),t.isNullOrUndefined(n.chart[l].primaryXAxis.minorGridLines)&&(n.chart[l].primaryXAxis.minorGridLines={},this.parent.chartColl[i].primaryXAxis.minorGridLines={}),n.chart[l].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width,this.parent.chartColl[i].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if(t.isNullOrUndefined(n.chart[l].legendSettings)&&(n.chart[l].legendSettings={},this.parent.chartColl[i].legendSettings={}),n.chart[l].legendSettings.visible=r.legendSettings.visible,this.parent.chartColl[i].legendSettings.visible=r.legendSettings.visible,"LegendNone"!==e){n.chart[l].legendSettings.position=r.legendSettings.position,this.parent.chartColl[i].legendSettings.position=r.legendSettings.position;break}}},e.prototype.updateChartElement=function(e,t,r,n,i,o,a,s){if(!(o&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var l;switch(e){case"PHAxes":(t=t).primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":(t=t).primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":(t=t).primaryXAxis.title=i;break;case"PVAxisTitle":(t=t).primaryYAxis.title=i;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=i;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(t=t,l=t.series,"DLNone"===e)for(var h=0,d=l.length;h<d;h++)o?l[h].dataLabel.visible=!1:l[h].marker.dataLabel.visible=!1;else for(h=0,d=l.length;h<d;h++)if(o){var p="DLOutsideend"===e?"Outside":"Inside";l[h].dataLabel.visible=!0,l[h].dataLabel.position=p}else{p="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":l[0].marker.dataLabel.position;l[h].marker.dataLabel.visible=!0,l[h].marker.dataLabel.position=p}t.series=l,o&&t.refresh();break;case"GLMajorHorizontal":(t=t).primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":(t=t).primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":(t=t).primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":(t=t).primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}if(this.updateChartModel(e,t,r,n,o),s){var c={addChartEle:e,id:t.element.id+"_overlay",title:i,address:a};this.parent.notify(Yo,{action:"chartDesign",eventArgs:c})}}},e.prototype.undoRedoForChartDesign=function(e){var r=document.getElementById(e.id);if(r){var n=this.getChartElement(r),i=t.getComponent(n,"chart");t.isNullOrUndefined(i)&&(i=t.getComponent(n,"accumulationchart"));for(var o,a=this.parent.getAddressInfo(e.address),s=ke(a.indices[0],a.indices[1],be(this.parent,a.sheetIndex)),l=this.getChartCollectionId(n.id),h=e.addChartEle,d=e.title,p=0;p<e.beforeActionData.cellDetails[0].chart.length;p++)if(n.id===e.beforeActionData.cellDetails[0].chart[p].id){o=e.beforeActionData.cellDetails[0].chart[p];break}if(e.switchRowColumn)this.switchRowColumn(l,n.id,i,s);else if(e.chartTheme)this.switchChartTheme(l,n.id,e.isUndo?o.theme:e.chartTheme,i,s);else if(e.chartType)this.switchChartType(l,n.id,e.isUndo?o.type:e.chartType,i,s);else if(e.addChartEle){if(e.isUndo){var c=void 0;switch(h){case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":h="Middle"===(c=o.dataLabelSettings&&o.dataLabelSettings.position)?"DLCenter":"Top"===c?"DLInsideend":"Bottom"===c?"DLInsidebase":"Outer"===c?"DLOutsideend":"DLNone";break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":o.legendSettings&&!o.legendSettings.visible?c="LegendNone":h="Right"===(c=o.legendSettings&&o.legendSettings.position)?"LegendsRight":"Left"===c?"LegendsLeft":"Bottom"===c?"LegendsBottom":"Top"===c?"LegendsTop":"LegendsBottom";break;case"PVAxisTitle":d=o.primaryYAxis&&o.primaryYAxis.title;break;case"PHAxisTitle":d=o.primaryXAxis&&o.primaryXAxis.title;break;case"ChartTitleNone":case"ChartTitleAbove":d=o.title}}this.updateChartElement(h,i,s,l,d,null,e.address)}}},e.prototype.chartDesignTabHandler=function(e){var r,n=!1,i=this.parent.sheets[this.parent.activeSheetIndex],o=e.switchRowColumn,a=e.chartType,s=e.chartTheme,l=e.addChartEle,h=null,d=e.id?document.getElementById(e.id):document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(d){var p,c,u="ChartTitleAbove"===l||"PHAxisTitle"===l||"PVAxisTitle"===l;if(i.frozenRows||i.frozenColumns){var f=d.getBoundingClientRect();p={clientY:f.top},c={clientX:f.left},f.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(p.target=this.parent.getColumnHeaderContent()),f.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(c.target=this.parent.getRowHeaderTable())}else p={clientY:d.offsetTop,isImage:!0},c={clientX:d.offsetLeft,isImage:!0};this.parent.notify(La,p),this.parent.notify(Na,c);var m=ke(p.clientY,c.clientX,i),v=i.name+"!"+g(p.clientY,c.clientX);if(e.triggerEvent){var y={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:d.id,address:v,cancel:!1};if(this.parent.notify(Zt,{action:"chartDesign",eventArgs:y}),y.cancel)return}var C=this.getChartElement(d),x=C.getAttribute("id");if(r=this.getChartCollectionId(x),C&&(h=t.getComponent(C,"chart"),t.isNullOrUndefined(h)&&(h=t.getComponent(C,"accumulationchart"),n=!0)),o&&!n&&this.switchRowColumn(r,x,h,m),a&&this.switchChartType(r,x,a,h,m),s&&this.switchChartTheme(r,x,s,h,m),l)if(u&&!e.title){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(l,h,m,r,n,v,e.triggerEvent)}else this.updateChartElement(l,h,m,r,e.title,n);if(e.triggerEvent&&!u){y={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:d.id,address:v};this.parent.notify(Yo,{action:"chartDesign",eventArgs:y})}}},e.prototype.switchRowColumn=function(e,r,n,i){this.parent.chartColl[e].isSeriesInRows=!!t.isNullOrUndefined(this.parent.chartColl[e].isSeriesInRows)||!this.parent.chartColl[e].isSeriesInRows;for(var o=0,a=i.chart.length;o<a;o++)i.chart[o].id===r&&(i.chart[o].isSeriesInRows=!!t.isNullOrUndefined(i.chart[o].isSeriesInRows)||!i.chart[o].isSeriesInRows);var s=this.initiateChartHandler({option:this.parent.chartColl[e],isRefresh:!0});n.series=s},e.prototype.switchChartTheme=function(e,t,r,n,i){this.parent.chartColl[e].theme=r;for(var o=0,a=i.chart.length;o<a;o++)i.chart[o].id===t&&(i.chart[o].theme=r);n.setProperties({theme:r,background:this.getThemeBgColor(r)},!0),n.refresh()},e.prototype.getThemeBgColor=function(e){var t;if(e.includes("Dark"))switch(e){case"MaterialDark":t="#383838";break;case"FabricDark":t="#242424";break;case"BootstrapDark":t="#1b1b1b";break;case"Bootstrap5Dark":t="#212529";break;case"TailwindDark":t="#1f2937";break;case"FluentDark":t="#1b1a19"}else t=e.includes("HighContrast")?"#000000":"#FFFFFF";return t},e.prototype.switchChartType=function(e,t,r,n,i){var o=this.parent.chartColl[e].type;this.parent.chartColl[e].type=r;for(var a=0,s=i.chart.length;a<s;a++)i.chart[a].id===t&&(i.chart[a].type=r);if("Pie"!==r&&"Doughnut"!==r)if("Pie"===o||"Doughnut"===o)this.changeCharType(e);else{a=0;for(var l=(h=n.series).length;a<l;a++)h[a].type=r;n.series=h,n.refresh()}else if("Pie"===o||"Doughnut"===o){var h;for(a=0,l=(h=n.series).length;a<l;a++)h[a].innerRadius="Pie"===r?"0%":"40%";n.series=h,n.refresh()}else this.changeCharType(e)},e.prototype.getChartElement=function(e){var r=e.querySelector(".e-chart");return t.isNullOrUndefined(r)&&(r=e.querySelector(".e-accumulationchart")),r},e.prototype.getChartCollectionId=function(e){for(var t,r=0,n=this.parent.chartColl.length;r<n;r++)e===this.parent.chartColl[r].id&&(t=r);return t},e.prototype.changeCharType=function(e){var r=document.getElementById(this.parent.chartColl[e].id),n=t.closest(r,".e-datavisualization-chart");n.remove(),this.parent.notify(wn,{option:this.parent.chartColl[e],isInitCell:!1,triggerEvent:!1,isPaste:!1}),r=document.getElementById(this.parent.chartColl[e].id),(n=t.closest(r,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||n.classList.add("e-ss-overlay-active")},e.prototype.titleDlgHandler=function(e,t,r,n,i,o,a){var s=this,l="";if(!i||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var h=this.parent.serviceLocator.getService(ph),d=this.parent.serviceLocator.getService(ch);d.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:"chart_abovechart"===e?h.getConstant("ChartTitle"):"PHAxisTitle"===e?h.getConstant("HorizontalAxisTitle"):h.getConstant("VerticalAxisTitle"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){d.dialogInstance.content=s.titleDlgContent(e,t),d.dialogInstance.dataBind(),s.parent.element.focus()},buttons:[{buttonModel:{content:h.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var i=s.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];l=i.getElementsByTagName("input")[0].value,d.hide(),s.updateChartElement(e,t,r,n,l,null,o,a)}}]}),d.dialogInstance.refresh()}},e.prototype.titleDlgContent=function(e,t){var r=this.parent.serviceLocator.getService(ph).getConstant("EnterTitle"),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),i=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:r}),o=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(i),n.appendChild(o),t&&(o.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:o.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:o.value:t.title?t.title:o.value),n},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(wn,this.initiateChartHandler),this.parent.off(Pa,this.refreshChartCellObj),this.parent.off(An,this.updateChartHandler),this.parent.off(Ma,this.deleteChart),this.parent.off(_a,this.clearBorder),this.parent.off(Va,this.insertChartHandler),this.parent.off(za,this.chartRangeHandler),this.parent.off(Wa,this.chartDesignTabHandler),this.parent.off(Ga,this.updateChartElement),this.parent.off(Ya,this.undoRedoForChartDesign))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&t.detach(e),this.chart=null},e.prototype.getModuleName=function(){return"spreadsheetChart"},e}(),ih=function(){function e(){Ah.Inject(Gl,Yl,Kl,yl,vl,bl,Sl,ml,zt,$l,Ql,Zl,Jl,wl,Xl,eh,El,Fl,Il,th,Al,Tl,Ll,Nl,Ol,Dl,Ml,Pl,Hl,rh,nh,Bl)}return e.prototype.getModuleName=function(){return"basic"},e.prototype.destroy=function(){},e}(),oh=function(){function e(){Ah.Inject(Gl,Yl,Kl,yl,vl,bl,Sl,ml,zt,$l,Zl,Jl,wl,Xl,eh,Il,El,Fl,th,Al,Tl,Ll,Nl,Dl,Ol,Ml,Pl,rh,Hl,nh,Bl)}return e.prototype.getModuleName=function(){return"all"},e.prototype.destroy=function(){},e}(),ah=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),sh=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},lh=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return ah(r,e),sh([t.Property(!1)],r.prototype,"isFinite",void 0),sh([t.Property(!0)],r.prototype,"enableVirtualization",void 0),r}(t.ChildProperty),hh=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return ah(r,e),sh([t.Property("Multiple")],r.prototype,"mode",void 0),r}(t.ChildProperty),dh="e-wraptext",ph="spreadsheetLocale",ch="dialog",uh="shape",fh={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},gh={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},mh={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},vh={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",Spreadsheet:"Spreadsheet",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",FileName:"File Name",EnterName:"Enter Name",InvalidFileName:"File name contains invalid character.",PROPER:"Converts a text to proper case; first letter to uppercase and other letters to lowercase.",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",ExtendValidation:"The selection contains some cells without data validation. Do you want to extend validation to these cells?",Yes:"Yes",No:"No",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",MultiRangeSortError:"This can't be done on a multiple range selection. Select a single range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"OK",Close:"Close",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Custom:"Custom",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",DataLimitExceeded:"File data is too large and it takes more time to process, do you want to continue?",FileSizeLimitExceeded:"File size is too large and it takes more time to process, do you want to continue?",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",T:"Checks whether a value is text or not and returns the text.",EXACT:"Checks whether a two text strings are exactly same and returns TRUE or FALSE.",LEN:"Returns a number of characters in a given string.",MOD:"Returns a remainder after a number is divided by divisor.",ODD:"Rounds a positive number up and negative number down to the nearest odd integer.",PI:"Returns the value of pi.",COUNTBLANK:"Returns the number of empty cells in a specified range of cells.",EVEN:"Rounds a positive number up and negative number down to the nearest even integer.",DECIMAL:"Converts a text representation of a number in a given base into a decimal number.",DEGREES:"Converts radians to degrees.",ADDRESS:"Returns a cell reference as text, given specified row and column numbers.",TIME:"Converts hours, minutes, seconds to the time formatted text.",CHAR:"Returns the character from the specified number.",CODE:"Returns the numeric code for the first character in a given string.",DOLLAR:"Converts the number to currency formatted text.",SMALL:"Returns the k-th smallest value in a given array.",LARGE:"Returns the k-th largest value in a given array.",FACT:"Returns the factorial of a number.",MEDIAN:"Returns the median of the given set of numbers.",EDATE:"Returns a date with given number of months before or after the specified date.",DATEVALUE:"Converts a date string into date value.",HOUR:"Returns the number of hours in a specified time string.",SECOND:"Returns the number of seconds in a specified time string.",MINUTE:"Returns the number of minutes in a specified time string.",NOW:"Returns the current date and time.",MONTH:"Returns the number of months in a specified date string.",TODAY:"Returns the current date as date value.",WEEKDAY:"Returns the day of the week corresponding to a date.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",UNIQUE:"Returns a unique values from a range or array",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select Locked cells",SelectUnLockedCells:"Select Unlocked Cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"Clear All",APPLY:"Apply",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",MinMaxError:"The Maximum must be greater than or equal to the Minimum.",MoreValidation:"This selection contains more than one validation. \n Erase current settings and continue?",FileNameError:"A file name can't contain characters like \\ / : * ? \" < > [ ] |",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",Save:"Save",EmptyFileName:"File name cannot be empty.",LargeName:"The name is too long.",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",Bootstrap5Dark:"Bootstrap5 Dark",Bootstrap5:"Bootstrap5",Tailwind:"Tailwind",TailwindDark:"Tailwind Dark",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",unProtectPassword:"Password",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnProtectWorkbook:"Unprotect Workbook",UnProtectPasswordAlert:"The password you supplied is not correct.",InCorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF document",AutoFillMergeAlertMsg:"To do this, all the merged cells need to be the same size",FillSeries:"Fill Series",CopyCells:"Copy Cells",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",CustomFormat:"Custom Number Formats",CustomFormatSample:"Type",UnProtectWorksheet:"Unprotect Sheet",ReEnterPassword:"Re-enter password to proceed",SheetPassword:"Password to unprotect sheet:",Fluent:"Fluent",FluentDark:"Fluent Dark"},yh=function(){function e(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return e.prototype.refreshSelectALLContent=function(){var e,t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){var r=this.getSelectAllTable().querySelector("thead"),n=this.rowRenderer.render();r.appendChild(n),e=this.parent.createElement("th",{className:"e-select-all-cell"}),n.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall",id:this.parent.element.id+"_select_all",attrs:{"aria-label":this.parent.serviceLocator.getService(ph).getConstant("SelectAll"),type:"button"}}))},e.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r,n=t.querySelector("table"),i=this.parent.getActiveSheet();if(e)n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px";else{r=this.parent.createElement("colgroup");var o=this.col.cloneNode();o.style.width=this.colGroupWidth+"px",r.appendChild(o),n.insertBefore(r,n.querySelector("tbody"))}(i.frozenRows||i.frozenColumns)&&(n=this.getSelectAllTable(),e?n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px":n.insertBefore(r.cloneNode(!0),n.querySelector("thead"))),this.setPanelWidth(i,t),this.setPanelHeight(i)},e.prototype.setPanelWidth=function(e,r){var n=this.getScrollSize(!0),i=this.getRowHeaderWidth(e),o=this.parent.enableRtl?"right":"left";if(e.frozenColumns){var a=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];a.style.height="calc(100% - "+n+"px)",a.style[o]=i-yt(1)+"Px",a.style.display=""}this.setHeaderPanelWidth(this.getSelectAllContent(),i),this.getColHeaderPanel().style.width="calc(100% - "+i+"px)",this.getColHeaderPanel().style[o]=i+"px",this.setHeaderPanelWidth(r,i),this.getContentPanel().style.width="calc(100% - "+i+"px)",this.getContentPanel().style[o]=i+"px";var s=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;s&&(n?s.style.height=n+1+"px":(s.style.height="1px",s.style.borderTopWidth="0px"),(s=s.firstElementChild).style[o]=i+"px",s.style.width="calc(100% - "+i+"px)",t.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===t.Browser.info.name&&(s.style.height="7px",s.style.top="-7px"))},e.prototype.getScrollSize=function(e){var t=parseInt(this.headerPanel.style[this.parent.enableRtl?"margin-left":"margin-right"],10);return t?t+(e?1:0):0},e.prototype.setHeaderPanelWidth=function(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(function(e){t+=parseInt(e.style.width,10)}),e.style.width=t+"px"},e.prototype.setPanelHeight=function(e){var r=this.getScrollSize(!0);if(e.frozenRows){var n=this.getColHeaderHeight(e);e.showHeaders||e.frozenColumns?this.headerPanel.style.height="":this.headerPanel.style.height=n+"px",this.contentPanel.style.height="calc(100% - "+(n+r)+"px)";var i=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];i.style.width=t.Browser.isDevice?"100%":"calc(100% - "+r+"px)",i.style.top=n-1-(e.showHeaders?1:0)+"px",i.style.display=""}else this.contentPanel.style.height="calc(100% - "+((e.showHeaders?yt(31):0)+r)+"px)"},e.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),r=this.parent.element.id;this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:r+"_row_header"})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var n=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&n.classList.add("e-frozen-columns"),e.frozenRows&&n.classList.add("e-frozen-rows"),this.updateHideHeaders(e,n),e.showGridLines||n.classList.add("e-hide-gridlines");var i=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:r+"_main_content"}));this.parent.allowScrolling||(i.style.overflow="hidden"),e.frozenRows&&n.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&n.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),t.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===t.Browser.info.name&&n.classList.add("e-mac-safari")},e.prototype.initHeaderPanel=function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"}))},e.prototype.createHeaderTable=function(){var e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)},e.prototype.updateTable=function(e,t,r){var n=this,i=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});i.classList.add("e-"+t+"-table"),r.appendChild(i),e.forEach(function(e){i.appendChild(n.parent.createElement(e))})},e.prototype.renderTable=function(e){var r,n,i,o=this,a=this.parent.getActiveSheet(),s=document.createDocumentFragment();if(s.appendChild(this.headerPanel),s.appendChild(this.contentPanel),this.parent.allowScrolling){var l=this.parent.createElement("div",{className:"e-scrollbar"});l.appendChild(this.parent.createElement("div",{className:"e-scroller"})),s.appendChild(l)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var h,d=this.parent.createElement("colgroup"),p=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var u=this.getSelectAllContent().querySelector("colgroup"),f=this.getRowHeaderPanel().querySelector("colgroup"),g=this.getSelectAllContent().querySelector("thead .e-header-row"),m=this.contentPanel.querySelector(".e-row-header tbody"),v=this.getSelectAllContent().querySelector("tbody"),y=this.headerPanel.querySelector(".e-column-header thead"),C=this.headerPanel.querySelector(".e-column-header tbody"),x=this.rowRenderer.render();y.appendChild(x),this.getColHeaderTable().insertBefore(d,y);var b=this.parent.frozenRowCount(a),S=this.parent.frozenColCount(a),w=re(a,S-1,!1,"columns");this.parent.notify(zi,{top:e.top,left:e.left});var I=a.colCount.toString(),E=a.colCount.toString(),R=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",I),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",E);var A;t.attributes(this.parent.getContentTable(),{"aria-rowcount":E,"aria-colcount":I}),e.cells.forEach(function(t,s){if((r=c(s))[1]!==e.indexes[1]&&n||(i=o.rowRenderer.render(r[0],!0),S&&b&&r[1]<S&&r[0]<b?((A=v.querySelector(".e-empty"))?v.insertBefore(i,A):v.appendChild(i),n=i):S&&r[1]<S?(m.appendChild(i),n=i):(n=o.rowRenderer.render(r[0]),b&&r[0]<b?(A=C.querySelector(".e-empty"))?C.insertBefore(n,A):C.appendChild(n):p.appendChild(n),r[1]===e.indexes[1]&&(b&&r[0]<b?v.appendChild(i):m.appendChild(i))),r[1]===e.indexes[1]&&o.cellRenderer.renderRowHeader(r[0],i)),o.cellRenderer.render({colIdx:r[1],rowIdx:r[0],cell:t,address:s,lastCell:r[1]===e.indexes[3],isHeightCheckNeeded:!0,row:n,hRow:i,pRow:n.previousSibling,pHRow:i.previousSibling,isRefreshing:e.isRefreshing,first:R?R.includes("Row")?r[0]===e.indexes[0]?"Row":R.includes("Column")&&r[1]===e.indexes[1]?"Column":"":r[1]===e.indexes[1]?"Column":"":""}),S&&r[1]===w&&(n=null),t&&t.format&&(Ne(t.format)||t.format.indexOf("*")>-1)&&o.parent.notify(ir,{cell:t,value:t.value,format:t.format,rowIndex:r[0],colIndex:r[1],td:o.parent.getCell(r[0],r[1])}),r[0]===e.indexes[0])if(S&&r[1]<S){h=o.updateCol(a,r[1],u);var l=f.querySelector(".e-empty");l?f.insertBefore(h.cloneNode(!0),l):f.appendChild(h.cloneNode(!0)),o.cellRenderer.renderColHeader(r[1],g)}else o.updateCol(a,r[1],d),o.cellRenderer.renderColHeader(r[1],x)}),this.parent[Xa]&&this.parent[Ka](),p.parentElement.insertBefore(d.cloneNode(!0),p),Ke(function(){if(o.parent){var t=o.parent.getMainContent(),r=document.getElementById(o.parent.element.id+"_sheet");if(r.childElementCount&&r.querySelector(".e-header-panel")!==o.headerPanel)for(var n=r.children,i=0;i<n.length;i++)n[i].classList.contains("e-frozen-row")||n[i].classList.contains("e-frozen-column")||n[i].classList.contains("e-ss-overlay")||r.removeChild(n[i]);if(r.appendChild(s),r.style.backgroundColor="",a.conditionalFormats&&a.conditionalFormats.length&&o.parent.notify(vn,{indexes:e.indexes}),o.checkRowHeightChanged(e,a),e.top&&(t.parentElement.scrollTop=e.top),e.left&&(t.scrollLeft=e.left,o.parent.getColumnHeaderContent().scrollLeft=e.left),o.parent.notify(Li,e),o.checkTableWidth(a),o.parent.notify(Oi,{action:"renderEditor"}),e.initLoad||o.parent.isOpen||o.parent.hideSpinner(),Ct(t,{busy:!1}),o.parent.trigger("dataBound",{}),o.parent.isEdit&&o.parent.notify(Ra,null),e.initLoad){var l=!0;if(o.parent.scrollSettings.enableVirtualization)for(i=0;i<a.ranges.length;i++)if(a.ranges[i].info.count-1>o.parent.viewport.bottomIndex){l=!1;break}l?o.parent.isReact?setTimeout(function(){o.parent&&o.triggerCreatedEvent()}):o.triggerCreatedEvent():o.parent.isOpen||o.parent.hideSpinner()}}})},e.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?(this.parent[sa].observers=this.parent.createdHandler.observers,this.parent.isAngular&&this.parent.createdHandler.currentObservers&&(this.parent[sa].currentObservers=this.parent.createdHandler.currentObservers)):this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger(sa,null),this.parent.notify(_o,null))},e.prototype.checkRowHeightChanged=function(e,t){var r={top:e.top,left:e.left,sheet:t};this.parent.notify(gs,r),e.top!=r.top&&(this.parent.scrollModule&&this.parent.scrollModule.offset.top.idx&&r.top-e.top<Ue(t,this.parent.scrollModule.offset.top.idx)&&(this.parent.scrollModule.offset.top.size=r.top),e.top=r.top),e.left!=r.left&&(this.parent.scrollModule&&this.parent.scrollModule.offset.left.idx&&r.left-e.left<je(t,this.parent.scrollModule.offset.left.idx)&&(this.parent.scrollModule.offset.left.size=r.left),e.left=r.left)},e.prototype.checkTableWidth=function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var t=We(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),r=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-r-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - "+r+"px)",this.getColHeaderPanel().style.width="calc(100% - "+r+"px)")}},e.prototype.clearCFResult=function(e){if(e.conditionalFormats&&e.conditionalFormats.length)for(var t=e.conditionalFormats,r=0;r<t.length;r++)delete t[r].result},e.prototype.refreshColumnContent=function(e){var t,r,n,i,o,a=this,s=0,l=this.parent.getActiveSheet(),h=document.createDocumentFragment(),d=document.createDocumentFragment(),p=this.parent.element.querySelector(".e-sheet-content tbody"),u=this.parent.element.querySelector(".e-column-header tbody"),f=this.parent.element.querySelector(".e-sheet-content colgroup");f=f.cloneNode(),h.appendChild(f),p=h.appendChild(p.cloneNode(!0));var g=f.cloneNode();d.appendChild(g);var m;m=this.parent.element.querySelector(".e-column-header thead");var v=(m=d.appendChild(m.cloneNode(!0))).querySelector("tr");v.innerHTML="";var y=this.parent.frozenRowCount(l),C=this.parent.frozenColCount(l);y&&(u=d.appendChild(u.cloneNode(!0)));var x=re(l,y-1,!1),b=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.topIndex!==re(l,0,!0);this.clearCFResult(l),e.cells.forEach(function(n,h){if((t=c(h))[0]===e.indexes[0]&&(o=a.updateCol(l,t[1],g),f.appendChild(o.cloneNode()),a.cellRenderer.renderColHeader(t[1],v)),t[1]-C===e.indexes[1]){if(!(r=t[0]<y?u.children[s]:p.children[s]))return;r.innerHTML="",s++}r&&(i=a.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:n,address:h,row:r,pRow:r.previousSibling,first:e.skipUpdateOnFirst||t[1]!==e.indexes[1]?b&&t[0]===e.indexes[0]?"Row":"":"Column",isRefreshing:!0,checkCF:!0}),a.checkColMerge(t,e.indexes,i,n),y&&t[0]===x&&(s=0))});var S=function(){$e(n=a.getColHeaderTable()),n.appendChild(d),$e(n=a.getContentTable()),n.appendChild(h),a.parent.notify(ji,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),a.parent.isEdit&&a.parent.notify(Aa,{}),a.parent.allowChart&&a.parent.notify(za,null),a.parent.isOpen||a.parent.hideSpinner(),Ct(a.parent.getMainContent(),{busy:!1})};e.insertDelete?S():Ke(function(){return S()})},e.prototype.refreshRowContent=function(e){var r,n,i,o,a=this,s=this.colGroupWidth,l=this.parent.getActiveSheet(),h=document.createDocumentFragment(),d=this.parent.createElement("tbody"),p=document.createDocumentFragment(),u=d.cloneNode();p.appendChild(u),h.appendChild(d);var f=this.parent.frozenColCount(l),g=re(l,f-1,!1,"columns"),m=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.leftIndex!==re(l,0,!0,"columns");this.clearCFResult(l),e.cells.forEach(function(t,l){(r=c(l))[1]!==e.indexes[1]&&n||(i=a.rowRenderer.render(r[0],!0),f&&r[1]<f?(u.appendChild(i),n=i):(r[1]===e.indexes[1]&&u.appendChild(i),n=a.rowRenderer.render(r[0]),d.appendChild(n)),r[1]===e.indexes[1]&&(a.cellRenderer.renderRowHeader(r[0],i),s=Ze(r[0]+1))),f&&(i=u.lastElementChild||i),o=a.cellRenderer.render({rowIdx:r[0],colIdx:r[1],cell:t,address:l,lastCell:r[1]===e.indexes[3],row:n,hRow:i,pRow:n.previousSibling,pHRow:i.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||r[0]!==e.indexes[0]?m&&r[1]===e.indexes[1]?"Column":"":"Row",isRefreshing:!0,checkCF:!0}),a.checkRowMerge(r,e.indexes,o,t),f&&r[1]===g&&(n=null)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),this.contentPanel.querySelector(".e-row-header tbody")&&(t.detach(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(p)),this.contentPanel.querySelector(".e-sheet-content tbody")&&(t.detach(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(h)),this.parent.notify(ji,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify(za,{}),this.parent.isEdit&&this.parent.notify(Aa,null),this.parent.isOpen||this.parent.hideSpinner(),Ct(this.parent.getMainContent(),{busy:!1})},e.prototype.updateCol=function(e,r,n){var i=this.col.cloneNode();if(i.style.width=t.formatUnit(je(e,r,null,!0)),n){var o=n.querySelector(".e-empty");return o?n.insertBefore(i,o):n.appendChild(i)}return i},e.prototype.updateColContent=function(e){var r=this;Ke(function(){var n,i,o,a,s,l,h,d=0,p=r.parent.getActiveSheet(),u=r.parent.element.querySelector(".e-column-header .e-header-row"),f=u.firstElementChild,g=r.parent.element.querySelector(".e-sheet-content colgroup"),m=r.parent.element.querySelector(".e-column-header colgroup"),v=g.firstElementChild,y=m.firstElementChild,C=r.parent.element.querySelector(".e-sheet-content tbody"),x=r.parent.element.querySelector(".e-column-header tbody"),b=r.parent.frozenRowCount(p),S=r.parent.frozenColCount(p),w=re(p,b-1,!1),I=re(p,e.indexes[0],!0);r.clearCFResult(p),e.cells.forEach(function(E,R){if(!l){if(n=c(R),"first"===e.direction&&n[1]===e.indexes[1]&&r.checkColMerge([n[0],r.parent.viewport.leftIndex+S],e.indexes,((n[0]<b?x:C).rows[d]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],ke(n[0],r.parent.viewport.leftIndex+S,p)||{}),n[0]===I&&("last"===e.direction?((s=r.col.cloneNode()).style.width=t.formatUnit(je(p,n[1],null,!0)),g.insertBefore(s,v),m.insertBefore(s.cloneNode(),y),r.cellRenderer.renderColHeader(n[1],u,f)):(s=r.updateCol(p,n[1],g),m.appendChild(s.cloneNode()),r.cellRenderer.renderColHeader(n[1],u)),r.parent.scrollSettings.enableVirtualization&&e.direction&&(t.detach(g[e.direction+"ElementChild"]),t.detach(m[e.direction+"ElementChild"]),t.detach(u[e.direction+"ElementChild"]))),n[1]===e.indexes[1]){if(n[0]<b)i=x.children[d];else if(!(i=C.children[d]))return void(l=!0);d++,o=i.firstElementChild}h={colIdx:n[1],rowIdx:n[0],cell:E,address:R,row:i,lastCell:n[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||n[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&n[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction,checkCF:!0},"last"===e.direction?(h.refChild=o,a=r.cellRenderer.render(h),r.checkColMerge(n,e.indexes,a,E,((n[0]<b?x:C).rows[d-1]||{cells:[]}).cells[1])):a=r.cellRenderer.render(h),r.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(i[e.direction+"ElementChild"]),b&&n[0]===w&&(d=0)}}),r.parent.notify(ji,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),r.parent.allowChart&&r.parent.notify(za,null),r.parent.isEdit&&r.parent.notify(Aa,{}),r.parent.isOpen||r.parent.hideSpinner(),Ct(r.parent.getMainContent(),{busy:!1})})},e.prototype.updateRowContent=function(e){var r,n,i,o,a=this,s=this.colGroupWidth,l=this.parent.getActiveSheet(),h=0,d=this.parent.getMainContent().querySelector("tbody"),p=this.parent.getRowHeaderContent().querySelector("tbody"),u=document.createDocumentFragment(),f=document.createDocumentFragment();this.parent.showSpinner();var g,m=this.parent.frozenColCount(l),v=this.parent.frozenRowCount(l),y=re(l,e.indexes[1],!0,"columns");this.clearCFResult(l),e.cells.forEach(function(C,x){o=c(x),"first"===e.direction&&o[0]===e.indexes[0]&&(void 0===g&&(g=(o[1]<m?p:d).rows[e.indexes[2]-e.indexes[0]+1]||null),a.checkRowMerge([a.parent.viewport.topIndex+v,o[1]],e.indexes,(g||{cells:[]}).cells[o[1]<m?h+1:h],ke(a.parent.viewport.topIndex+v,o[1],l)||{})),o[1]!==y&&r||(n=a.rowRenderer.render(o[0],!0),m&&o[1]<m?(u.appendChild(n),r=n):(r=a.rowRenderer.render(o[0]),f.appendChild(r),o[1]===y&&u.appendChild(n),a.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(d[e.direction+"ElementChild"])),o[1]===y&&(a.cellRenderer.renderRowHeader(o[0],n),s=Ze(o[0]+1),a.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(p[e.direction+"ElementChild"]))),m&&(n=u.lastElementChild||n),i=a.cellRenderer.render({colIdx:o[1],rowIdx:o[2],cell:C,address:x,lastCell:o[1]===e.indexes[3],row:r,pHRow:n.previousSibling,checkNextBorder:"last"===e.direction&&o[2]===e.indexes[2]?"Row":"",pRow:r.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:n,first:"last"!==e.direction||e.skipUpdateOnFirst||o[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction,checkCF:!0}),"last"===e.direction&&d.rows.length&&a.checkRowMerge(o,e.indexes,i,C,(o[1]<m?p:d).rows[0].cells[o[1]<m?h+1:h]),h++,m&&o[1]===m-1&&(r=null,g=void 0,h=0)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),"last"===e.direction?(p.insertBefore(u,p.firstElementChild),d.insertBefore(f,d.firstElementChild)):(p.appendChild(u),d.appendChild(f)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify(ji,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify(Aa,null),this.parent.allowChart&&this.parent.notify(za,{}),this.parent.isOpen||this.parent.hideSpinner(),Ct(this.parent.getMainContent(),{busy:!1})},e.prototype.checkRowMerge=function(e,r,n,i,o){if(this.parent.scrollSettings.enableVirtualization&&n&&(!t.isNullOrUndefined(i.rowSpan)||!t.isNullOrUndefined(i.colSpan))){var a=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e[0]===this.parent.viewport.topIndex+a){if(i.rowSpan<0){var s={td:n,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify(fa,s),s.insideFreezePane)return;this.parent.viewport.topIndex+a>=r[0]&&this.refreshPrevMerge(r[0]+1,e[1])}o&&(o.colSpan>1||o.rowSpan>1)&&this.cellRenderer.refresh(e[0]+(r[2]-r[0])+1,e[1],null,o)}else if(i.rowSpan>1){var l=r[2]+1;e[0]+i.rowSpan-1>l&&e[0]<l&&this.refreshPrevMerge(l,e[1],this.parent.viewport.topIndex+a)}}},e.prototype.refreshPrevMerge=function(e,t,r){var n=this.parent.getCell(e,t,this.parent.getRow(r||0,null,t));n&&n.rowSpan>1&&this.cellRenderer.refresh(e,t,null,n)},e.prototype.checkColMerge=function(e,r,n,i,o){if(this.parent.scrollSettings.enableVirtualization&&n&&e[1]===this.parent.viewport.leftIndex+this.parent.frozenColCount(this.parent.getActiveSheet())&&(!t.isNullOrUndefined(i.rowSpan)||!t.isNullOrUndefined(i.colSpan))){if(i.colSpan<0){var a={td:n,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify(fa,a),a.insideFreezePane)return}o&&(o.colSpan>1||o.rowSpan>1)&&this.cellRenderer.refresh(e[0],e[1]+(r[3]-r[1])+1,null,o)}},e.prototype.toggleGridlines=function(){var e=document.getElementById(this.parent.element.id+"_sheet");this.parent.getActiveSheet().showGridLines?e.classList.remove("e-hide-gridlines"):e.classList.add("e-hide-gridlines")},e.prototype.showHideHeaders=function(){var e=this,t=this.parent.getActiveSheet();Ke(function(){if(t.showHeaders){var r=e.getContentPanel();e.setPanelWidth(t,e.getRowHeaderPanel()),e.setPanelHeight(t),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=r.scrollLeft,e.parent.selectRange(t.selectedRange)}else{if(e.updateHideHeaders(t,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(t),e.parent.frozenColCount(t)||e.parent.frozenRowCount(t))e.setPanelWidth(t,e.getRowHeaderPanel()),e.parent.selectRange(t.selectedRange);else{e.getContentPanel().style.width="";var n=e.parent.enableRtl?"right":"left";e.getContentPanel().style[n]=""}e.getScrollElement().style.left=e.getRowHeaderWidth(t)+"px"}})},e.prototype.updateHideHeaders=function(e,t){e.showHeaders||t.classList.add("e-hide-headers")},e.prototype.rowHeightChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}},e.prototype.colWidthChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}},e.prototype.getRowHeaderWidth=function(e,t){var r=0;if(!t&&e.frozenColumns){var n=u(e.topLeftCell)[1];r=We(e,n,n+e.frozenColumns-1,!0)}return r+=e.showHeaders?yt(this.colGroupWidth):0},e.prototype.getColHeaderHeight=function(e,t){var r=u(e.topLeftCell)[0];return(e.showHeaders&&!t?yt(31):0)+Ve(e,r,r+e.frozenRows-1,!0)},e.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},e.prototype.getScrollElement=function(){var e=this.contentPanel.parentElement||this.contentPanel.nextElementSibling;return e&&e.querySelector(".e-scroller")},e.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},e.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},e.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},e.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},e.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},e.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},e.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},e.prototype.addEventListener=function(){this.parent.on(sa,this.triggerCreatedEvent,this),this.parent.on(yo,this.rowHeightChanged,this),this.parent.on(Co,this.colWidthChanged,this),this.parent.on(Di,this.removeEventListener,this)},e.prototype.destroy=function(){this.headerPanel=null,this.contentPanel=null,this.col=null,this.rowRenderer=null,this.cellRenderer=null,this.colGroupWidth=null,this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(sa,this.triggerCreatedEvent),this.parent.off(yo,this.rowHeightChanged),this.parent.off(Co,this.colWidthChanged),this.parent.off(Di,this.removeEventListener)},e}(),Ch=function(){function e(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=e.serviceLocator.getService("cell")}return e.prototype.render=function(e,r,n){var i=this.element.cloneNode();if(void 0===e)return i.classList.add("e-header-row"),i;i.classList.add("e-row");var o=this.parent.getActiveSheet();t.attributes(i,{"aria-rowindex":(e+1).toString()});var a=Ue(o,e,!0);return i.style.height=a+"px",a<20&&(i.style.lineHeight=a>0?a-1+"px":"0px"),r&&!n&&(a<20&&(i.style.lineHeight=a>=4?a-4+"px":a>0?a-1+"px":"0px",i.classList.contains("e-reach-fntsize")||i.classList.add("e-reach-fntsize")),He(o,e+1)&&!He(o,e-1)&&i.classList.add("e-hide-start"),0!==e&&He(o,e-1)&&!He(o,e+1)&&i.classList.add("e-hide-end")),i},e.prototype.refresh=function(e,t,r,n,i){var o,a=this,s=this.parent.getActiveSheet();if(n)o=this.render(e,n,i),this.cellRenderer.renderRowHeader(e,o);else{var l,h,d=function(){for(;l<=h;)Ge(s,l)||a.cellRenderer.render({colIdx:l,rowIdx:e,cell:ke(e,l,s),address:g(e,l),lastCell:l===h,row:o,hRow:r,isHeightCheckNeeded:!0,pRow:t,first:e===a.parent.viewport.topIndex&&re(s,e,!0)!==re(s,0,!0)?"Row":""}),l++},p=this.parent.frozenColCount(s);p&&(o=r,l=u(s.topLeftCell)[0],h=p-1,d()),o=this.render(e,n,i),l=this.parent.viewport.leftIndex+p,h=this.parent.viewport.rightIndex,d()}return o},e.prototype.destroy=function(){this.parent=null,this.element=null},e}(),xh=function(){function e(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on(jn,this.updateView,this),this.parent.on("calculateFormula",this.calculateFormula,this)}return e.prototype.renderColHeader=function(e,r,n){var i=this.th.cloneNode(),o=v(e+1);i.innerHTML=o;var a=this.parent.getActiveSheet();Ge(a,e+1)&&i.classList.add("e-hide-start"),0!==e&&Ge(a,e-1)&&i.classList.add("e-hide-end"),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:o,colIndex:e}),t.attributes(i,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"})},e.prototype.renderRowHeader=function(e,r,n){var i=this.element.cloneNode();t.addClass([i],"e-header-cell"),t.attributes(i,{role:"rowheader",tabindex:"-1"}),i.innerHTML=(e+1).toString(),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:""+(e+1),rowIndex:e})},e.prototype.render=function(e){var r=this.parent.getActiveSheet();if(e.td=this.element.cloneNode(),e.td.className="e-cell",t.attributes(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td),e.td;e.isRefresh=!1,this.update(e),e.checkCF&&e.cell&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(vn,{indexes:[e.rowIdx,e.colIdx],cell:e.cell,ele:e.td,isRender:!0}),e.td.classList.contains("e-cell-template")||this.parent.notify(zo,{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx}),e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td);var n={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx,needHeightCheck:!1,row:e.row};if(this.parent.trigger("beforeCellRender",n),!r.rows[e.rowIdx]||!r.rows[e.rowIdx].customHeight){if(n.element&&n.element.children.length||n.needHeightCheck){var i=n.element.cloneNode(!0);i.style.width=je(r,e.colIdx,!0)+"px",this.tableRow.appendChild(i)}if(e.lastCell&&this.tableRow.childElementCount||n.needHeightCheck){var o=e.row||this.parent.getRow(e.rowIdx),a=Ue(r,e.rowIdx),s=this.getRowHeightOnInit();if(s>a){var l=yt(s);o.style.height=l+"px",(e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height=l+"px",_e(r,e.rowIdx,s)}this.tableRow.innerHTML=""}}return this.setWrapByValue(r,e),n.element},e.prototype.setWrapByValue=function(e,t){t.cell&&!t.cell.wrap&&t.cell.value&&t.cell.value.toString().includes("\n")&&(Fe(t.rowIdx,t.colIdx,e,{wrap:!0},!0),this.parent.notify(Hr,{range:[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],wrap:!0,initial:!0,sheet:e,td:t.td,row:t.row,hRow:t.hRow}))},e.prototype.update=function(e){var r=this.parent.getActiveSheet(),n=this.processTemplates(e.cell,e.rowIdx,e.colIdx);if(n&&("string"==typeof n?e.td.innerHTML=n:($e(e.td),e.td.appendChild(n)),e.td.classList.add("e-cell-template")),e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(r,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(r,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return;if(e.cell&&!e.cell.hyperlink){var i=e.td.querySelector(".e-hyperlink");i&&t.detach(i)}!e.cell&&e.td.classList.contains("e-wraptext")&&e.td.classList.remove("e-wraptext")}e.cell&&e.cell.formula&&this.calculateFormula(e);var o={value:e.cell&&e.cell.value,type:e.cell&&H(e.cell.format),format:e.cell&&e.cell.format,formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIndex:e.rowIdx,colIndex:e.colIdx,isRowFill:!1,td:e.td};e.cell&&this.parent.notify(ir,o),t.attributes(e.td,{"aria-label":(o.formattedText?o.formattedText+" ":"")+e.address}),this.parent.refreshNode(e.td,{type:o.type,result:o.formattedText,curSymbol:t.getNumberDependable(this.parent.locale,"USD"),isRightAlign:o.isRightAlign,value:o.value||"",isRowFill:o.isRowFill});var a={};if(e.cell){if(e.cell.style&&(a=e.cell.style.properties?Te(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify(Sn,{chart:e.cell.chart,isInitCell:!0,range:g(e.rowIdx,e.colIdx),isUndoRedo:!1}),e.cell.hyperlink&&this.parent.notify(Do,{cell:e.cell,style:a,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.rowSpan>1){var s=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));s>1&&(e.td.rowSpan=s,this.mergeFreezeRow(r,e.rowIdx,e.colIdx,s,e.row))}if(e.cell.colSpan>1){var l=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");l>1&&(e.td.colSpan=l,this.mergeFreezeCol(r,e.rowIdx,e.colIdx,l))}if(e.cell.image)for(var h=0;h<e.cell.image.length;h++)e.cell.image[h]&&this.parent.notify(Da,{options:{src:e.cell.image[h].src,imageId:e.cell.image[h].id,height:e.cell.image[h].height,width:e.cell.image[h].width,top:e.cell.image[h].top,left:e.cell.image[h].left},range:m([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),e.lastCell&&this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(En,{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),this.applyStyle(e,a),"Row"===e.checkNextBorder){var d=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===d||e.cell&&e.cell.style&&e.cell.style.bottomPriority||this.parent.notify(hr,{style:{borderBottom:d},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){var p=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===p||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||this.parent.notify(hr,{style:{borderRight:p},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}e.cell&&e.cell.wrap&&this.parent.notify(Hr,{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:r,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&Ue(r,e.rowIdx)>20});var c=e.cell&&e.cell.validation||r.columns&&r.columns[e.colIdx]&&r.columns[e.colIdx].validation;c&&c.isHighlighted&&this.parent.notify(Wr,{range:m([e.rowIdx,e.colIdx]),td:e.td}),e.cell&&e.cell.validation&&e.cell.validation.isHighlighted&&this.parent.notify(Wr,{range:m([e.rowIdx,e.colIdx]),td:e.td})},e.prototype.applyStyle=function(e,r){(Object.keys(r).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(hr,{style:t.extend({},this.parent.commonCellStyle,r),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate,onActionUpdate:e.onActionUpdate})},e.prototype.calculateFormula=function(e){if(void 0!==e.cell.value&&null!==e.cell.value){var r={action:"checkFormulaAdded",added:!0,address:e.address,sheetId:(void 0===e.sheetIndex?this.parent.getActiveSheet():be(this.parent,e.sheetIndex)).id.toString()};if(this.parent.notify(pr,r),r.added)return}else e.formulaRefresh&&(e.cell.value="");var n=W(e.cell.formula),i={action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:n,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing};this.parent.notify(pr,i),e.cell.value=ke(e.rowIdx,e.colIdx,t.isNullOrUndefined(e.sheetIndex)?this.parent.getActiveSheet():be(this.parent,e.sheetIndex)).value},e.prototype.checkMerged=function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){var r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(cn,r);var n=this.parent.frozenRowCount(t),i=this.parent.frozenColCount(t);(t.frozenRows&&t.frozenColumns?r.range[0]<n&&r.range[1]<i?e.rowIdx<n&&e.colIdx<i:r.range[0]<n?e.rowIdx<n:!(r.range[1]<i)||e.colIdx<i:n?r.range[0]>=n||e.rowIdx<n:r.range[1]>=i||e.colIdx<i)&&(e.td.style.display="none")}else e.td.style.display="none";return e.cell.colSpan<0&&(this.parent.notify(ua,e),e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop})),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify(ua,e),e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),!0}return!1},e.prototype.mergeFreezeRow=function(e,r,n,i,o,a){var s=this.parent.frozenRowCount(e);if(s&&r<s&&r+(i-1)>=s){var l=void 0,h=0,d=void 0,p=this.parent.frozenColCount(e),c=o||this.parent.getRow(r,null,n),f=[].slice.call(c.parentElement.querySelectorAll(".e-empty"));if(a){var g=r+i-s;if(g<f.length)return;var m=0;if(g===f.length){var v=void 0,y=void 0,C=void 0;for(p&&n<p?(y=u(e.topLeftCell)[1],C=p):(y=this.parent.viewport.leftIndex+p,C=this.parent.viewport.rightIndex);y<C;y++)y!==n&&(v=ke(r,y,e,!1,!0)).rowSpan&&r+v.rowSpan-s>m&&(m=r+v.rowSpan-s);if(m===g)return}else m=g;var x=r+(i-1);for(y=m,C=f.length;y<C;y++)h+=Ue(e,x),x--,t.detach(f.pop());return this.updateSpanTop(n,p,h,!0),void(f.length||this.updateColZIndex(n,p,!0))}this.updateColZIndex(n,p);for(y=s,C=r+(i-1);y<=C;y++)h+=-(d=Ue(e,re(e,y,!0),!0)),s+f.length>y||((l=c.cloneNode()).classList.add("e-empty"),l.style.visibility="hidden",l.style.height=d+"px",c.parentElement.appendChild(l));this.updateSpanTop(n,p,h)}},e.prototype.updateSpanTop=function(e,t,r,n){var i=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(i.style.top,10))return;r=parseInt(i.style.top,10)+r}if(t&&e<t&&(n||!parseInt(i.style.top,10)||r<parseInt(i.style.top,10))){i.style.top=r+"px";var o=i.nextElementSibling;o&&(o.style.top=r+"px")}},e.prototype.mergeFreezeCol=function(e,r,n,i,o){var a=this.parent.frozenColCount(e);if(a&&n<a&&n+(i-1)>=a){var s=void 0,l=void 0,h=this.parent.frozenRowCount(e),d=(r<h?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),p=[].slice.call(d.querySelectorAll(".e-empty"));if(o){var c=n+i-a;if(c<p.length)return;var f=0;if(c===p.length){var g=void 0,m=void 0,v=void 0;for(h&&r<a?(m=h,v=u(e.topLeftCell)[0]):(m=this.parent.viewport.bottomIndex,v=this.parent.viewport.topIndex+h);v<m;v++)v!==r&&(g=ke(v,n,e,!1,!0)).colSpan&&n+g.colSpan-a>f&&(f=n+g.colSpan-a);if(f===c)return}else f=c;for(v=f,m=p.length;v<m;v++)t.detach(p.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(p.length||this.updateRowZIndex(r,h,!0))}this.updateRowZIndex(r,h);for(v=a,m=n+(i-1);v<=m;v++)a+p.length>v||((s=d.childNodes[0].cloneNode()).classList.add("e-empty"),s.style.visibility="hidden",l=je(e,re(e,v,!0,"columns"),null,!0),s.style.width=l+"px",d.appendChild(s),v===m&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}},e.prototype.updateColZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getColumnHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.updateSelectAllZIndex=function(e){var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");e?(this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),r&&(r.style.zIndex="")):this.parent.getRowHeaderContent().style.zIndex||this.parent.getColumnHeaderContent().style.zIndex?(this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),r&&(r.style.zIndex="4")):this.parent.getSelectAllContent().style.zIndex="2"},e.prototype.updatedHeaderZIndex=function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");r&&(r.style.zIndex="4"),t&&(t.style.zIndex="4")}},e.prototype.updateRowZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getRowHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.processTemplates=function(e,t,r){for(var n,i=this.parent.getActiveSheet(),o=i.ranges,a=0,s=o.length;a<s;a++)if(o[a].template&&(n=c(o[a].address.length?o[a].address:o[a].startCell))[0]<=t&&n[1]<=r&&n[2]>=t&&n[3]>=r){if(e)return this.compileCellTemplate(o[a].template,e);if(!ke(t,r,i,!0))return this.compileCellTemplate(o[a].template,ke(t,r,i,null,!0))}return""},e.prototype.compileCellTemplate=function(e,r){var n;if("string"==typeof e){var i=void 0;return i=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,n=t.compile(i),!this.parent.isVue||document.querySelector(e)?n(r,this.parent,"ranges","",!0)[0].outerHTML:n(r,this.parent,"ranges","")[0]}return(n=t.compile(e))(r,this.parent,"ranges","")[0]},e.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t},e.prototype.removeStyle=function(e,t,r){var n;if(e.style.length){var i=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,r+1])).borderLeft||n.border,o=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,r])).borderTop||n.border;i||o?[].slice.call(e.style).forEach(function(t){i&&o?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!i||t.indexOf("border-right")>-1||o&&"none"!==o)&&(!o||t.indexOf("border-bottom")>-1||i&&"none"!==i)||e.style.removeProperty(t)}):e.removeAttribute("style")}var a=this.parent.getCell(t-1,r);if(a&&a.style.borderBottom){var s=Number(a.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[s,r])).borderBottom||n.border||(a.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(r=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,r])).borderRight||n.border||(l.style.borderRight=""))},e.prototype.refreshRange=function(e,t,r,n,i){var o,a,s=this.parent.getActiveSheet(),l=e.slice();if(tt(this.parent,l,!0))for(var h=l[0];h<=l[2];h++)if(!He(s,h))for(var d=l[1];d<=l[3];d++)Ge(s,d)||(a=this.parent.getCell(h,d))&&(o={rowIdx:h,colIdx:d,td:a,cell:ke(h,d,s),isRefreshing:t,lastCell:d===l[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",onActionUpdate:n},this.update(o),i&&s.conditionalFormats&&s.conditionalFormats.length&&this.parent.notify(vn,{indexes:[h,d],isAction:!0}),this.parent.notify(zo,{td:a,rowIndex:h,colIndex:d}),r&&this.setWrapByValue(s,o))},e.prototype.refresh=function(e,t,r,n,i,o){var a=this.parent.getActiveSheet();if((n||!He(a,e)&&!Ge(a,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){var s=n||this.parent.getCell(e,t);if(!s)return;var l={rowIdx:e,colIdx:t,td:s,cell:ke(e,t,a),isRefresh:!0,lastCell:r,isHeightCheckNeeded:!0,manualUpdate:!0,first:""};this.update(l),i&&a.conditionalFormats&&a.conditionalFormats.length&&this.parent.notify(vn,{indexes:[e,t],isAction:!0}),this.parent.notify(zo,{td:s,rowIndex:e,colIndex:t}),o&&this.setWrapByValue(a,l)}},e.prototype.updateView=function(e){if(t.isNullOrUndefined(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex){if(!e.indexes){var r=this.parent.getActiveSheet(),n=this.parent.frozenRowCount(r),i=this.parent.frozenColCount(r),o=c(r.topLeftCell);n&&i&&this.refreshRange([o[0],o[1],n-1,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),n&&this.refreshRange([o[0],this.parent.viewport.leftIndex+i,n-1,this.parent.viewport.rightIndex],e.refreshing,e.checkWrap,!1,e.checkCF),i&&this.refreshRange([this.parent.viewport.topIndex+n,o[1],this.parent.viewport.bottomIndex,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),e.indexes=[this.parent.viewport.topIndex+n,this.parent.viewport.leftIndex+i,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]}this.refreshRange(e.indexes,e.refreshing,e.checkWrap,!1,e.checkCF)}else e.refreshing&&this.calculateFormula({cell:ke(e.indexes[0],e.indexes[1],be(this.parent,e.sheetIndex),!0,!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})},e.prototype.destroy=function(){this.parent.off(jn,this.updateView),this.parent.off("calculateFormula",this.calculateFormula),this.element=null,this.th=null,this.tableRow=null,this.parent=null},e}(),bh=function(){function e(e){this.parent=e,this.addEventListener(),this.instantiateRenderer()}return e.prototype.render=function(){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify(Ri,null),this.parent.notify(Ai,null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs?this.parent.notify(ki,null):(this.parent.notify(pr,{action:"initSheetInfo"}),this.parent.notify(pr,{action:"initiateDefinedNames"})),this.parent.isMobileView()&&(this.parent.notify(Ai,null),this.parent.notify(Ri,null)),(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),"None"===this.parent.selectionSettings.mode&&(this.parent.allowAutoFill=!1),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!this.parent.refreshing)},e.prototype.checkTopLeftCell=function(e,t,r,n,i){var o=this.parent.getActiveSheet();this.parent.showSpinner();var a,s="A1"===o.topLeftCell,l=u(o.topLeftCell);if(o.topLeftCell!==o.paneTopLeftCell&&(o.frozenRows||o.frozenColumns)){var h=u(o.paneTopLeftCell);a=this.parent.scrollSettings.enableVirtualization,s=o.frozenRows&&o.frozenColumns?l[0]+o.frozenRows===h[0]&&l[1]+o.frozenColumns===h[1]:o.frozenRows?l[0]+o.frozenRows===h[0]&&0===l[1]:l[1]+o.frozenColumns===h[1]&&0===l[0],l[0]&&h[0]>l[0]?this.parent.viewport.beforeFreezeHeight=Ve(o,0,l[0]-1,!0):this.parent.viewport.beforeFreezeHeight=0,l[1]&&h[1]>l[1]?this.parent.viewport.beforeFreezeWidth=We(o,0,l[1]-1,!0):this.parent.viewport.beforeFreezeWidth=0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;var d=this.parent.frozenRowCount(o),p=this.parent.frozenColCount(o);if(!this.parent.scrollSettings.enableVirtualization||s)this.refreshUI({rowIndex:l[0],colIndex:l[1],refresh:"All"},null,e,t,i),a&&(this.parent.viewport.topIndex=re(o,d,!0)-d,this.parent.viewport.leftIndex=re(o,p,!0,"columns")-p);else{var c=o.paneTopLeftCell===o.topLeftCell?l:u(o.paneTopLeftCell),f={preventScroll:!0};f.scrollTop=r||(c[0]>d?Ve(o,d,c[0]-1,!0):0),f.scrollLeft=n||(c[1]>p?We(o,p,c[1]-1,!0):0),this.parent.notify(xo,f);var g=this.parent.getThreshold("row"),m=o.frozenRows?l[0]:l[0]>g?re(o,l[0]-g,!0):0,v=[];o.frozenRows&&v.push(c[0]-g>d?c[0]-g:d),g=this.parent.getThreshold("col");var y=o.frozenColumns?l[1]:l[1]>g?re(o,l[1]-g,!0,"columns"):0;o.frozenColumns?(v.length||v.push(d),v.push(c[1]-g>p?c[1]-g:p)):v.length&&v.push(p),this.refreshUI({rowIndex:m,colIndex:y,refresh:"All",top:f.scrollTop,left:f.scrollLeft,frozenIndexes:v},null,e,t,i),a&&(d&&v[0]>=d&&(this.parent.viewport.topIndex=re(o,v[0],!0)-d),p&&v[1]>=p&&(this.parent.viewport.leftIndex=re(o,v[1],!0,"columns")-p))}},e.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()},e.prototype.refreshUI=function(e,r,n,i,o){var a=this;"All"!==e.refresh&&this.parent.showSpinner();var s=this.parent.serviceLocator.getService("sheet"),l=this.parent.getActiveSheet(),h=Ee(this.parent),d={rowCount:l.rowCount,colCount:l.colCount};if(e.frozenIndexes=e.frozenIndexes?e.frozenIndexes:[],!r)if(this.parent.scrollSettings.enableVirtualization){var p=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),c=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),f=this.parent.frozenRowCount(l),m=this.parent.frozenColCount(l);e.frozenIndexes.length&&(p+=e.frozenIndexes[0]-f,c+=e.frozenIndexes[1]-m),"Row"===e.refresh?p+=f:p+=l.frozenRows,"Column"===e.refresh?c+=m:c+=l.frozenColumns;var v=e.frozenIndexes[0]>f?e.frozenIndexes[0]:e.rowIndex+("Row"===e.refresh?f:l.frozenRows),y=this.parent.skipHidden(v,p,"rows",!1);if(p=y[1],v!==y[0]){(w=u(l.paneTopLeftCell))[0]===v&&this.parent.updateTopLeftCell(y[0]-f,w[1],"col")}y[0]-=f;var C=l.rowCount-1,x=0,b=e.rowIndex;if(this.parent.scrollSettings.isFinite&&p>C&&(x=p-C,p=re(l,C,!1),y[0]+f>re(l,f,!0))){E=(E=e.rowIndex-x)<0?0:E,E=this.decreaseHidden(E,e.rowIndex-1,f),e.top&&E<e.rowIndex&&this.parent.notify(fs,{height:Ve(l,E+f,e.rowIndex-1+f,!0),isRender:!0}),this.parent.viewport.topIndex=y[0]=E,b="Row"===e.refresh?E:b}"Row"===e.refresh?e.rowIndex=re(l,b+f,!0)-f:b=e.rowIndex=f?re(l,b,!0):y[0];var S=e.frozenIndexes[1]>m?e.frozenIndexes[1]:e.colIndex+("Column"===e.refresh?m:l.frozenColumns);if(y=this.parent.skipHidden(S,c,"columns",!1),c=y[1],S!==y[0]){var w;(w=u(l.paneTopLeftCell))[1]===S&&this.parent.updateTopLeftCell(w[0],y[0]-m,"row")}y[0]-=m,C=l.colCount-1,x=0;var I=e.colIndex;if(this.parent.scrollSettings.isFinite&&c>C&&(x=c-C,c=re(l,C,!1,"columns"),y[0]+m>re(l,m,!0,"columns"))){var E;E=(E=e.colIndex-x)>-1?E:0,E=this.decreaseHidden(E,e.colIndex-1,m,"columns"),e.left&&E<e.colIndex&&this.parent.notify(fs,{width:We(l,E+m,e.colIndex-1+m,!0),isRender:!0}),this.parent.viewport.leftIndex=y[0]=E,I="Column"===e.refresh?E:I}"Column"===e.refresh?e.colIndex=re(l,I+m,!0,"columns")-m:I=e.colIndex=m?re(l,I,!0,"columns"):y[0],"Row"===e.refresh&&(b+=f,f&&(p+=u(l.topLeftCell)[0]),c=this.parent.viewport.rightIndex),"Column"===e.refresh&&(I+=m,m&&(c+=u(l.topLeftCell)[1]),p=this.parent.viewport.bottomIndex),this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=p,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=c,r=g(b,I)+":"+g(p,c)}else"All"===e.refresh&&this.updateTopLeftScrollPosition(t.extend(e,{sheet:l})),this.parent.viewport.bottomIndex=l.rowCount-1,this.parent.viewport.rightIndex=l.colCount-1,r=g(e.rowIndex,e.colIndex)+":"+g(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex);"All"===e.refresh&&this.parent.trigger("beforeDataBound",{});var R=this.parent.isOpen||this.parent.refreshing;Ct(this.parent.getMainContent(),{busy:!0});var A=this.parent.sheets.length;pe(this.parent,h+"!"+r,null,null,e.frozenIndexes).then(function(t){if(a.parent&&!(A<a.parent.sheets.length)){var h=a.parent.sheets.indexOf(l);if(o||-1!==h&&h===a.parent.activeSheetIndex){var p,c=[e.rowIndex,e.colIndex].concat(u(r.split(":")[1]));switch(e.refresh){case"All":s.renderTable({cells:t,indexes:c,top:e.top,left:e.left,initLoad:n,isRefreshing:i,isOpen:R});break;case"Row":s.refreshRowContent({cells:t,indexes:c,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:d}),p={isEdit:!1},a.parent.notify(Ti,p),p.isEdit&&a.parent.notify(Oi,{action:"startEdit",refreshCurPos:!1});break;case"Column":s.refreshColumnContent({cells:t,indexes:c,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:d,insertDelete:e.insertDelete});break;case"RowPart":s.updateRowContent({cells:t,indexes:c,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:d});break;case"ColumnPart":s.updateColContent({cells:t,indexes:c,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:d})}a.parent&&a.parent[Xa]&&a.parent[Ka]()}else h>-1&&a.checkTopLeftCell()}}),this.parent.notify(qi,{refresh:e.refresh,skipTranslate:e.skipTranslate})},e.prototype.updateTopLeftScrollPosition=function(e){var t=u(e.sheet.topLeftCell),r=u(e.sheet.paneTopLeftCell);if(e.sheet.frozenRows){var n=this.parent.frozenRowCount(e.sheet);r[0]>n&&(e.top=Ve(e.sheet,n,r[0]-1,!0))}else e.rowIndex&&(e.rowIndex=0),0!==t[0]&&(e.top=Ve(e.sheet,0,t[0]-1,!0));if(e.sheet.frozenColumns){var i=this.parent.frozenColCount(e.sheet);r[1]>i&&(e.left=We(e.sheet,i,r[1]-1,!0))}else e.colIndex&&(e.colIndex=0),0!==t[1]&&(e.left=We(e.sheet,0,t[1]-1,!0))},e.prototype.removeSheet=function(){t.remove(document.getElementById(this.parent.element.id+"_sheet"))},e.prototype.refreshSheet=function(e,t,r,n){var i=0,o=0;if(t){var a=this.parent.element.getElementsByClassName("e-main-panel")[0];a&&(i=a.scrollTop);var s=this.parent.getMainContent();s&&(o=s.scrollLeft)}this.removeSheet(),this.renderSheet(),this.parent.notify(bo,{}),this.checkTopLeftCell(!1,e,i,o,n),r&&Pt(this.parent.element)},e.prototype.setSheetPanelSize=function(){var e,t=document.getElementById(this.parent.element.id+"_sheet_panel"),r=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(t.style.height="260px",e=230):(e=r.height-Je(t),t.style.height=e+"px",e-=32),this.parent.viewport.height=e,this.parent.viewport.width=r.width-32,this.parent.viewport.rowCount=this.roundValue(e,20),this.parent.viewport.colCount=this.roundValue(r.width,64)},e.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},e.prototype.moveOrDuplicateSheetHandler=function(e){this.parent.notify(Fi,null),e.refresh&&this.refreshSheet(e.isDuplicate)},e.prototype.decreaseHidden=function(e,t,r,n){void 0===n&&(n="rows"),e+=r,t+=r;for(var i=this.parent.getActiveSheet(),o=t;o>=e;o--)if(i[n][o]&&i[n][o].hidden&&--e<r){e=re(i,r,!0,n);break}return e-r},e.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new xh(this.parent)),this.parent.serviceLocator.register("row",new Ch(this.parent)),this.parent.serviceLocator.register("sheet",new yh(this.parent))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.serviceLocator.getService("row").destroy(),this.parent.serviceLocator.getService("cell").destroy(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Di,this.destroy,this),this.parent.on(Pn,this.moveOrDuplicateSheetHandler,this),this.parent.on(gs,this.updateTopLeftScrollPosition,this)},e.prototype.removeEventListener=function(){this.parent.off(Di,this.destroy),this.parent.off(Pn,this.moveOrDuplicateSheetHandler),this.parent.off(gs,this.updateTopLeftScrollPosition)},e}(),Sh=function(){function e(e){this.parent=e}return e.prototype.show=function(e,r){var n,o=this;r=!!t.isNullOrUndefined(r);var a=e.close||null,s={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){o.destroyDialog(),a&&a()},t.extend(s,e),r&&(n=this.parent.serviceLocator.getService(ph).getConstant(s.buttons.length?"Cancel":"Ok"),s.buttons.push({buttonModel:{content:n,isPrimary:0===s.buttons.length},click:this.hide.bind(this)}));var l=this.parent.createElement("div");document.body.appendChild(l),this.dialogInstance=new i.Dialog(s),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(l),this.dialogInstance.refreshPosition()},e.prototype.destroyDialog=function(){this.dialogInstance.destroy(),t.remove(this.dialogInstance.element),this.dialogInstance=null},e.prototype.hide=function(e){this.dialogInstance&&(e&&(this.dialogInstance.animationSettings.effect="None",this.dialogInstance.dataBind()),this.dialogInstance.hide())},e.prototype.destroy=function(){this.parent=null},e}(),wh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.initializeActionBegin=function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"begin",eventType:"format"})};var r=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var i=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeSort"})}},e.prototype.initializeActionComplete=function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"complete",eventType:"sorting"})};var r=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"complete",eventType:"cellSave"})}},e.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},e.prototype.actionBeginHandler=function(e){var t=e.preventAction;delete e.preventAction;var r={action:e.action};e.isUndo&&(r.isUndo=!0,delete e.isUndo),e.isRedo&&(r.isUndo=!1,delete e.isRedo),r.args=e,this.parent.trigger("actionBegin",r),t||"clipboard"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"filter"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"chartDesign"!==e.action&&"cellDelete"!==e.action&&"autofill"!==e.action&&"removeValidation"!==e.action&&"hyperlink"!==e.action&&"removeHyperlink"!==e.action&&"deleteImage"!==e.action||this.parent.notify(Bo,{args:e}),t&&(e.preventAction=!0),r.isUndo&&(e.isUndo=!0),!1===r.isUndo&&(e.isRedo=!0)},e.prototype.actionCompleteHandler=function(e){var t=e.preventAction;delete e.preventAction,this.parent.notify(Xt,e),e.preventEventTrigger||this.parent.trigger("actionComplete",e),t||"undoRedo"===e.action||"gotoSheet"===e.action||this.parent.notify(Ho,{args:e}),this.parent.notify(ss,null)},e.prototype.addEventListener=function(){this.parent.on(Yo,this.actionCompleteHandler,this),this.parent.on(Zt,this.actionBeginHandler,this),this.parent.on(Di,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(Yo,this.actionCompleteHandler),this.parent.off(Zt,this.actionBeginHandler),this.parent.off(Di,this.removeEventListener)},e}(),Ih=function(){function e(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e}return e.prototype.insertOverlayElement=function(e,t,r){var n=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay e-ss-overlay-active"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),i=c(t),o=this.parent.sheets[r],a=this.parent.frozenRowCount(o),s=this.parent.frozenColCount(o),l=rt(o,i,a,s,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);if(i[0]>=a&&i[1]<s){var h=this.parent.sheetModule.contentPanel;h.scrollTop&&(l.top-=h.scrollTop,l.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(i[1]>=s&&i[0]<a){var d=this.parent.getScrollElement();d.scrollLeft&&(l.left-=d.scrollLeft,l.left+=this.parent.sheetModule.getRowHeaderWidth(o))}var p;return i[0]<a||i[1]<s?(p=document.getElementById(this.parent.element.id+"_sheet"),a&&(i[0]>=a?l.top+=(o.showHeaders?31:0)+Ve(o,u(o.topLeftCell)[0],a-1):s||(l.left+=this.parent.sheetModule.getRowHeaderWidth(o,!0))),s&&(i[1]>=s?l.left+=this.parent.sheetModule.getRowHeaderWidth(o):a||(l.left+=o.showHeaders?31:0))):p=this.parent.getMainContent(),n.style.top=l.top+"px",n.style.left=l.left+"px",r===this.parent.activeSheetIndex&&(p.appendChild(n),this.renderResizeHandles(n),this.addEventListener(n)),this.originalWidth=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px","")),n},e.prototype.adjustFreezePaneSize=function(e,r,n){var i=c(n),o=this.parent.getActiveSheet(),a=this.parent.frozenRowCount(o),s=this.parent.frozenColCount(o);if(i[0]<a||i[1]<s?(t.isNullOrUndefined(e.top)||(r.style.top=e.top+(o.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),t.isNullOrUndefined(e.left)||(r.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(o,!0)-this.parent.viewport.beforeFreezeWidth+"px")):(t.isNullOrUndefined(e.top)||(r.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(a?Ve(o,u(o.topLeftCell)[0],a-1):0)+"px"),t.isNullOrUndefined(e.left)||(r.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(s?We(o,u(o.topLeftCell)[1],s-1):0)+"px")),t.isNullOrUndefined(e.top)){var l=u(o.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(a&&l===i[0]?0:Ve(o,a?l:0,i[0]-1))}if(t.isNullOrUndefined(e.left)){var h=u(o.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(s&&h===i[1]?0:We(o,s?h:0,i[1]-1))}},e.prototype.addEventListener=function(e){var r=e;t.EventHandler.add(r,"mousedown",this.overlayClickHandler,this),t.EventHandler.add(r,"mousemove",this.overlayMouseMoveHandler,this),t.EventHandler.add(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler,this),t.EventHandler.add(document,"mouseup",this.overlayMouseUpHandler,this),this.parent.on(os,this.setOriginalSize,this)},e.prototype.setOriginalSize=function(e){this.originalHeight=e.height,this.originalWidth=e.width},e.prototype.overlayMouseMoveHandler=function(e){var r,n,i,o,a,s,l=e.target,h=document.getElementsByClassName("e-ss-overlay-active")[0],d=this.parent.getActiveSheet(),p=d.frozenRows||d.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(d,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":r=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),n=e.clientY-(this.originalMouseY-this.originalResizeTop),r>20&&n>p[0]&&(h.style.height=r+"px",h.style.top=n+"px",this.resizedReorderTop=n,this.currenHeight=r,this.parent.notify(Rn,{height:h.style.height,width:h.style.width,overlayEle:h}));break;case"e-ss-overlay-r":(i=this.originalWidth+(e.pageX-this.originalMouseX))>20&&(h.style.width=i+"px",this.currentWidth=i,this.parent.notify(Rn,{height:h.style.height,width:h.style.width,overlayEle:h}));break;case"e-ss-overlay-b":(o=this.originalHeight+(e.pageY-this.originalMouseY))>20&&(h.style.height=o+"px",this.currenHeight=o,this.parent.notify(Rn,{height:h.style.height,width:h.style.width,overlayEle:h}));break;case"e-ss-overlay-l":a=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),s=e.clientX-(this.originalMouseX-this.originalResizeLeft),a>20&&s>p[1]&&(h.style.width=a+"px",h.style.left=s+"px",this.resizedReorderLeft=s,this.currentWidth=a,this.parent.notify(Rn,{height:h.style.height,width:h.style.width,overlayEle:h}))}else if(this.isOverlayClicked)if(t.closest(l,".e-sheet")&&!l.classList.contains("e-sheet-content")||l.classList.contains("e-cell")){if(!h)return;var c=e.clientX-this.diffX,u=e.clientY-this.diffY;c>p[1]&&(h.style.left=c+"px"),u>p[0]&&(h.style.top=u+"px"),this.resizedReorderLeft=c<0?0:c,this.resizedReorderTop=u<0?0:u}else this.overlayMouseUpHandler(e,!0)},e.prototype.overlayMouseUpHandler=function(e,r){if(this.parent&&!this.parent.getActiveSheet().isProtected){this.isResizerClicked=!1;var n=e.target,i=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");n.classList.contains("e-ss-overlay")||(n=t.closest(e.target,".e-datavisualization-chart")?t.closest(e.target,".e-datavisualization-chart"):n);var o=this.parent.getActiveSheet(),a={prevTop:o.frozenRows||o.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:o.frozenRows||o.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?this.resizedReorderLeft:this.originalReorderLeft,id:n.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||r){var s=void 0,l=void 0,h={clientY:a.prevTop,isImage:!0},d={clientX:a.prevLeft,isImage:!0},p=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(o.frozenRows||o.frozenColumns){if(!p)return;h.isImage=!1,d.isImage=!1,h.target=p,d.target=p,a.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(h.target=this.parent.getColumnHeaderContent()),a.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(d.target=this.parent.getRowHeaderTable());var c=p.getBoundingClientRect();s={clientY:c.top},l={clientX:c.left},c.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(s.target=this.parent.getColumnHeaderContent()),c.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable())}else s={clientY:a.currentTop,isImage:!0},l={clientX:a.currentLeft,isImage:!0};if(this.parent.notify(La,h),this.parent.notify(La,s),this.parent.notify(Na,d),this.parent.notify(Na,l),s.size&&(a.currentTop=s.size),l.size&&(a.currentLeft=l.size),a.prevRowIdx=h.clientY,a.prevColIdx=d.clientX,a.currentRowIdx=s.clientY,a.currentColIdx=l.clientX,(o.frozenColumns||o.frozenRows)&&!t.closest(p,".e-sheet-content")){var u=this.parent.frozenColCount(o),f=this.parent.frozenRowCount(o);if(a.currentRowIdx>=f&&a.currentColIdx>=u){var g=parseInt(p.style.top,10),m=parseInt(p.style.left,10);g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height;m+=this.parent.getScrollElement().scrollLeft,m-=this.parent.sheetModule.getRowHeaderWidth(o),p.style.top=g+"px",p.style.left=m+"px",this.parent.getMainContent().appendChild(p)}}i&&i[0]&&i[0].querySelector(".e-control")&&(a.id=i[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(a.id=p.id,i&&i[0]?(a.requestType="chartRefresh",this.parent.notify(Pa,a)):this.parent.notify(Ta,a),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(a.id=n.id.indexOf("overlay")>0?n.id:n.parentElement?n.parentElement.id:"",i&&i[0]?(a.requestType="chartRefresh",this.parent.notify(Pa,a)):this.parent.notify(Ta,a),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}},e.prototype.overlayClickHandler=function(e){if(!this.parent.getActiveSheet().isProtected){this.isOverlayClicked=!0;var r=e.target,n=e.target;r.classList.contains("e-ss-overlay")||(n=r.parentElement,t.closest(e.target,".e-datavisualization-chart")&&(n=t.closest(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px",""))));var i=this.parent.getActiveSheet();if((i.frozenColumns||i.frozenRows)&&t.closest(n,".e-sheet-content")){var o=parseInt(n.style.top,10),a=parseInt(n.style.left,10);o-=this.parent.sheetModule.contentPanel.scrollTop,o+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height;a-=this.parent.getScrollElement().scrollLeft,a+=this.parent.sheetModule.getRowHeaderWidth(i),n.style.top=o+"px",n.style.left=a+"px",document.getElementById(this.parent.element.id+"_sheet").appendChild(n)}this.originalReorderLeft=parseInt(n.style.left,10),this.originalReorderTop=parseInt(n.style.top,10),this.resizedReorderLeft=parseInt(n.style.left,10),this.resizedReorderTop=parseInt(n.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var s=document.getElementsByClassName("e-ss-overlay-active")[0];s&&t.removeClass([s],"e-ss-overlay-active"),document.getElementById(n.id).classList.add("e-ss-overlay-active"),r.classList.contains("e-ss-resizer")&&(this.resizer=r.classList[0],this.originalWidth=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),n.classList.contains("e-datavisualization-chart")&&(this.parent.notify(Fn,{id:n.id}),s||this.parent.notify(qa,{id:n.id}));var l=n.getBoundingClientRect();this.prevX=l.left,this.prevY=l.top}},e.prototype.renderResizeHandles=function(e){for(var t,r=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],n=0,i=e;r.length>n;)t=this.parent.createElement("div",{attrs:{class:r[n]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),i.appendChild(t),n++},e.prototype.removeEventListener=function(){var e=document.getElementById(this.parent.element.id+"_overlay");e&&(t.EventHandler.remove(e,"mousedown",this.overlayClickHandler),t.EventHandler.remove(e,"mousemove",this.overlayMouseMoveHandler)),t.EventHandler.remove(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler),t.EventHandler.remove(document,"mouseup",this.overlayMouseUpHandler),this.parent.off(os,this.setOriginalSize)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Eh=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rh=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Ah=function(e){function r(t,r){var i=e.call(this,t)||this;return i.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0},i.needsID=!0,n.Inject(Gl,Yl,Kl,yl,vl,bl,Sl,ml,zt,$l,Ql,Zl,Jl,wl,Xl,Tl,vi,qt,Jn,mi,Vt,pi,eh,ci,Il,Fl,ui,th,Al,yi,Ll,Nl,Ci,xi,Dl,bi,Ol,Ii,Ml,wi,Pl,Ei,rh,Hl,fi,Ss,nh,gi,Bl,ws),r&&i.appendTo(r),i}Eh(r,e),n=r,r.prototype.getCell=function(e,t,r){var n;return this.insideViewport(e,t)&&(r||(r=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),n=r?r.cells[t]:r),n},r.prototype.getRow=function(e,r,n){if(!r){var i=this.getActiveSheet(),o=this.frozenRowCount(i),a=this.frozenColCount(i);r=t.isNullOrUndefined(n)||e>o-1&&n>a-1?this.getContentTable():e<o&&n<a?this.sheetModule.getSelectAllTable():e<o?this.getColHeaderTable():this.getRowHeaderTable()}return e=this.getViewportIndex(e),r?r.rows[e]:null},r.prototype.hiddenCount=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.getActiveSheet());for(var i=0,o=e;o<=t;o++)n[r][o]&&n[r][o].hidden&&i++;return i},r.prototype.getViewportIndex=function(e,t){var r=this.getActiveSheet(),n=this.frozenColCount(r),i=this.frozenRowCount(r);if(t){if(n){var o=u(r.topLeftCell)[1];return e<n?(e-=this.hiddenCount(o,e,"columns"),(e-=o)+1):(e-=this.hiddenCount(this.viewport.leftIndex+n,e,"columns"),e-=this.viewport.leftIndex+n)}}else if(i){var a=u(r.topLeftCell)[0];return e<i?(e-=this.hiddenCount(a,e),(e-=a)+1):(e-=this.hiddenCount(this.viewport.topIndex+i,e),e-=this.viewport.topIndex+i)}return this.scrollSettings.enableVirtualization&&(t?(e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex):(e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex)),e},r.prototype.preRender=function(){e.prototype.preRender.call(this),this.serviceLocator=new tl,this.initServices()},r.prototype.initServices=function(){this.serviceLocator.register(ph,new t.L10n(this.getModuleName(),vh,this.locale)),this.serviceLocator.register(ch,new Sh(this)),this.serviceLocator.register("actionEvents",new wh(this)),this.serviceLocator.register(uh,new Ih(this))},r.prototype.render=function(){if(e.prototype.render.call(this),this.element.setAttribute("tabindex","0"),Ct(this.element,{role:"grid"}),this.renderModule=new bh(this),this.renderSpreadsheet(),this.wireEvents(),this.created)if(this[sa].observers){if(this[sa].observers.length>0){var t={observers:this[sa].observers};this.isAngular&&(t={observers:this[sa].observers,currentObservers:this[sa].observers},this[sa].currentObservers=[]),this.createdHandler=t,this[sa].observers=[]}}else this.createdHandler=this.created,this.setProperties({created:void 0},!0)},r.prototype.renderSpreadsheet=function(){this.cssClass&&t.addClass([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),i.createSpinner({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new Cl(this)),this.scrollSettings.enableVirtualization&&new xl(this),this.renderModule.render(),new Rl(this)},r.prototype.showSpinner=function(){i.showSpinner(this.element)},r.prototype.hideSpinner=function(){i.hideSpinner(this.element)},r.prototype.protectSheet=function(t,r,n){"string"==typeof t&&(t=fe(this,t)),t&&(this.setSheetPropertyOnMute(this.sheets[t],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[t],"password",n||""),this.setSheetPropertyOnMute(this.sheets[t],"protectSettings",r)),t=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),this.setSheetPropertyOnMute(this.getActiveSheet(),"password",n||""),e.prototype.protectSheet.call(this,t,r,n)},r.prototype.unprotectSheet=function(t){"string"==typeof t&&(t=fe(this,t)),t?this.sheets[t].isProtected=!1:this.getActiveSheet().isProtected=!1,e.prototype.unprotectSheet.call(this,t)},r.prototype.find=function(t){var r=this.getActiveSheet().activeCell;if(e.prototype.findHandler.call(this,t),!t.isAction)return r!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null},r.prototype.replace=function(r){r={value:r.value,mode:r.mode?r.mode:"Sheet",isCSen:!!r.isCSen&&r.isCSen,isEMatch:!!r.isEMatch&&r.isEMatch,searchBy:r.searchBy?r.searchBy:"By Row",replaceValue:r.replaceValue,replaceBy:r.replaceBy,sheetIndex:t.isUndefined(r.sheetIndex)?this.activeSheetIndex:r.sheetIndex,findOpt:r.findOpt?r.findOpt:""},e.prototype.replaceHandler.call(this,r)},r.prototype.findAll=function(e,t,r,n,i){var o=[],a={value:e,mode:t=t||"Sheet",sheetIndex:i=i||this.activeSheetIndex,isCSen:r=r||!1,isEMatch:n=n||!1,findCollection:o};return this.notify(sr,a),o},r.prototype.goTo=function(e){if(e.includes("!")){var t=e.split("!"),r=fe(this,t[0]);if(void 0===r)return;if(r!==this.activeSheetIndex){var n=t[1].split(":")[0],i=this.sheets[r];this.setSheetPropertyOnMute(i,"activeCell",n),this.setSheetPropertyOnMute(i,"selectedRange",t[1]);var o=u(n);if(i.frozenColumns||i.frozenRows){var a=u(i.topLeftCell);if(!(i.frozenRows&&o[0]<a[0]||i.frozenColumns&&o[1]<a[1])){var s=this.frozenRowCount(i),l=this.frozenColCount(i),h=[],d=[],p=u(i.paneTopLeftCell);s?(h.push(a[0]),o[0]>=s?d.push(o[0]):d.push(p[0])):(h.push(o[0]),d.push(o[0])),l?(h.push(a[1]),o[1]>=l?d.push(o[1]):d.push(p[1])):(h.push(o[1]),d.push(o[1])),this.setSheetPropertyOnMute(i,"topLeftCell",g(h[0],h[1])),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(d[0],d[1]))}}else o[0]<this.viewport.rowCount&&(o[0]=0),o[1]<this.viewport.colCount&&(o[1]=0),this.updateTopLeftCell(o[0],o[1],null,i);return this.activeSheetIndex=r,void this.dataBind()}}var f=c(e),m=this.getActiveSheet(),v=this.frozenRowCount(m),y=this.frozenColCount(m),C=this.insideViewport(f[0],f[1]);if(C){this.selectRange(e);var x=u(m.paneTopLeftCell),b=this.viewport.height-this.getScrollElement().parentElement.getBoundingClientRect().height,S=0,w=0;if(v)for(var I=u(m.topLeftCell)[0];I<v;I++)if((S+=Ue(m,I))>b){w=I;break}if(0===w)for(I=x[0];I<=this.viewport.bottomIndex;I++){if((S+=Ue(m,I))>b){w=I;break}I===this.viewport.bottomIndex&&(w=this.viewport.bottomIndex)}x[2]=w;var E=0;if(S=0,b=this.viewport.width-this.sheetModule.getScrollSize(),y)for(I=u(m.topLeftCell)[1];I<y;I++)if((S+=je(m,I))>b){E=I;break}if(0===E)for(I=x[1];I<=this.viewport.rightIndex;I++){if((S+=je(m,I))>b){E=I;break}I===this.viewport.rightIndex&&(E=this.viewport.rightIndex)}if(x[3]=E,f[0]>=x[0]&&f[0]<x[2]&&f[1]>=x[1]&&f[1]<x[3])return;if(v||y){if(x=[].concat(u(m.topLeftCell),[v,x[3]]),f[0]>=x[0]&&f[0]<x[2]&&f[1]>=x[1]&&f[1]<x[3])return;if(x[2]=w,x[3]=y,f[0]>=x[0]&&f[0]<x[2]&&f[1]>=x[1]&&f[1]<x[3])return}}var R,A,k,F,T,L,N=this.getMainContent().parentElement;f[0]===v?k=0:(k=Ve(m,v,f[0]-1,!0),this.scrollSettings.enableVirtualization&&(L=k+this.getContentTable().getBoundingClientRect().height)>(T=parseFloat(N.querySelector(".e-virtualtrack").style.height))&&(L+=10,(R=N.querySelector(".e-virtualtrack")).style.height=L+"px",Ke(function(){R.style.height=T+"px"}))),N.scrollTop=k,N=this.element.getElementsByClassName("e-scroller")[0],f[1]===y?k=0:(k=We(m,y,f[1]-1,!0),this.scrollSettings.enableVirtualization&&(L=k+this.getContentTable().getBoundingClientRect().width)>(F=parseFloat(N.querySelector(".e-virtualtrack").style.width))&&(L+=10,(R=N.querySelector(".e-virtualtrack")).style.width=L+"px",(A=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=L+"px",(R=this.getMainContent().querySelector(".e-virtualtrack")).style.width=L+"px",Ke(function(){R.style.width=F+"px",A.style.width=F+"px"}))),N.scrollLeft=k,C||this.selectRange(e)},r.prototype.insideViewport=function(e,t){var r=this.getActiveSheet();if(r.frozenRows||r.frozenColumns){var n=this.frozenRowCount(r),i=this.frozenColCount(r),o=u(r.topLeftCell);return(e>=o[0]&&e<n||e>=this.viewport.topIndex+n&&e<=this.viewport.bottomIndex)&&(t>=o[1]&&t<i||t>=this.viewport.leftIndex+i&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex},r.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet(!1,!0)},r.prototype.cut=function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify(to,e?{range:y(e),sId:this.sheets[fe(this,me(e))]?this.sheets[fe(this,me(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},r.prototype.copy=function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify(ro,e?{range:y(e),sId:this.sheets[fe(this,me(e))]?this.sheets[fe(this,me(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},r.prototype.paste=function(e,t){this.notify(no,{range:e?y(e):e,sIdx:e?fe(this,me(e)):e,type:t,isAction:!0,isInternal:!0})},r.prototype.updateAction=function(e){It(e,this)},r.prototype.setHeight=function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=t.formatUnit(this.height)},r.prototype.setWidth=function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=t.formatUnit(this.width)},r.prototype.setColWidth=function(e,r,n){void 0===e&&(e=64),void 0===r&&(r=0);var i=t.isNullOrUndefined(n)?this.getActiveSheet():this.sheets[n];if(i){var o=r,a="number"==typeof e?e+"px":e;r=t.isNullOrUndefined(r)?u(i.activeCell)[1]:r;var s=function(){ze(i,o).width=parseInt(a,10)>0?parseInt(a,10):0,i.columns[o].customWidth=!0},l=this.frozenColCount(i);if(i.id===this.getActiveSheet().id){if(r>=this.viewport.leftIndex+l&&r<=this.viewport.rightIndex||l&&r<l){r=this.getViewportIndex(r,!0);var h=je(i,o,null,!0);(p=yt(parseInt(a,10))-h)<0&&h<-p&&(p=-h),s(),this.notify(Co,{threshold:p,colIdx:o,checkWrapCell:!0}),bt(o,r,a,!0,this)}else{var d=je(i,r),p=void 0;p=parseInt(a,10)>0?-(d-parseInt(a,10)):-d,s(),this.notify(Co,{threshold:p,colIdx:r})}this.notify(ss,null)}else s()}},r.prototype.setRowHeight=function(e,r,n,i){void 0===e&&(e=20),void 0===r&&(r=0);var o=t.isNullOrUndefined(n)?this.getActiveSheet():this.sheets[n];if(o){var a=r,s="number"==typeof e?e+"px":e;r=t.isNullOrUndefined(r)?u(o.activeCell)[0]:r;var l=function(){_e(o,a,parseInt(s,10)>0?parseInt(s,10):0),o.rows[a].customHeight=!0};if(o.id===this.getActiveSheet().id){var h=this.frozenRowCount(o);if(r>=this.viewport.topIndex+h&&r<=this.viewport.bottomIndex||h&&r<h){r=this.getViewportIndex(a);var d=Ue(o,a,!0);(c=yt(parseInt(s,10))-d)<0&&d<-c&&(c=-d),l(),this.notify(yo,{threshold:c,rowIdx:a,isCustomHgt:!0}),t.isNullOrUndefined(i)&&(i=!1),i||(bt(a,r,s,!1,this),i=!1)}else{var p=Ue(o,r),c=void 0;c=parseInt(s,10)>0?-(p-parseInt(s,10)):-p,l(),this.notify(yo,{threshold:c,rowIdx:a})}this.notify(ss,null)}else l()}},r.prototype.autoFit=function(e){var t=this.getIndexes(e),r=t.startIdx,n=t.endIdx,i=t.isCol,o=i?f("XFD"):1048576;if(r<=o)for(n>o&&(n=o);r<=n;r++)this.notify($o,{idx:r,isCol:i})},r.prototype.getIndexes=function(e){var r,n,i,o;if(-1!==e.indexOf(":")){var a=e.split(":");i=a[0],o=a[1]}else i=e,o=e;if(!t.isNullOrUndefined(i)){var s=this.getAddress(i);i=s.address,r=s.isCol}if(!t.isNullOrUndefined(o)){var l=this.getAddress(o);o=l.address,n=l.isCol}var h=!0===r&&!0===n;return{startIdx:h?f(i.toUpperCase()):parseInt(i,10),endIdx:h?f(o.toUpperCase()):parseInt(o,10),isCol:h}},r.prototype.getAddress=function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,e=e.replace(/[0-9]/g,""),{address:e,isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:(e=(parseInt(e,10)-1).toString(),{address:e,isCol:t})},r.prototype.addHyperlink=function(e,t,r){this.insertHyperlink(e,t,r,!0)},r.prototype.removeHyperlink=function(e){this.notify(No,{range:e,preventEventTrigger:!0})},r.prototype.insertHyperlink=function(e,t,r,n){if(this.allowHyperlink){var i=void 0,o=void 0,a=void 0,s=this.getActiveSheet();a=c(t=t||s.name+"!"+s.activeCell);for(var l=this.getCell(a[0],a[1]),h=[],d=0;l&&d<l.classList.length;d++)h.push(l.classList[d]);var p={hyperlink:e,address:t,displayText:r,cancel:!1},u={hyperlink:e,address:t,displayText:r};if(n||(this.trigger(Tr,p),this.notify(Zt,{action:"hyperlink",eventArgs:p})),!p.cancel){var f={hyperlink:e=p.hyperlink,cell:t=p.address,displayText:r,triggerEvt:!n};if(this.notify(Or,f),t&&-1!==t.indexOf("!")){i=t.split("!");for(var g=this.sheets,m=0;m<g.length;m++)g[m].name===i[0]&&(o=m);s=this.sheets[o],t=i[1]}if(!s)return;if(t=t||this.getActiveSheet().activeCell,a=c(t),n||(this.trigger(Lr,u),this.notify(Yo,{action:"hyperlink",eventArgs:p})),s===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(a);for(d=0;d<h.length;d++)this.getCell(a[0],a[1]).classList.contains(h[d])||this.getCell(a[0],a[1]).classList.add(h[d]);this.notify(In,null)}}}},r.prototype.addDataValidation=function(t,r){e.prototype.addDataValidation.call(this,t,r)},r.prototype.removeDataValidation=function(t){e.prototype.removeDataValidation.call(this,t)},r.prototype.addInvalidHighlight=function(t){var r=t||this.dataValidationRange;if(r.indexOf(",")>-1){var n="";r.includes("!")&&(n=r.split("!")[0]+"!",r=r.split("!")[1]);for(var i=r.split(","),o=0;o<i.length-1;o++)e.prototype.addInvalidHighlight.call(this,n+i[o])}else e.prototype.addInvalidHighlight.call(this,r)},r.prototype.removeInvalidHighlight=function(t){var r=t||this.dataValidationRange;if(r.indexOf(",")>-1){var n="";r.includes("!")&&(n=r.split("!")[0]+"!",r=r.split("!")[1]);for(var i=r.split(","),o=0;o<i.length-1;o++)e.prototype.removeInvalidHighlight.call(this,n+i[o])}else e.prototype.removeInvalidHighlight.call(this,r)},r.prototype.conditionalFormat=function(t){e.prototype.conditionalFormat.call(this,t)},r.prototype.clearConditionalFormat=function(t){t=t||this.getActiveSheet().selectedRange,e.prototype.clearConditionalFormat.call(this,t)},r.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-Je(e)+"px"}},r.prototype.open=function(t){this.isOpen=!0,e.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},r.prototype.hideRow=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(gn,{startIndex:t,endIndex:r,hide:n}):e.prototype.hideRow.call(this,t,r,n)},r.prototype.hideColumn=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(gn,{startIndex:t,endIndex:r,hide:n,isCol:!0}):e.prototype.hideColumn.call(this,t,r,n)},r.prototype.clear=function(e){this.notify(xa,{options:e})},r.prototype.refresh=function(t){this[Xa]&&this[$a](),t?(this.notify(io,null),this.sheets.length=0,this.sheetNameCount=1,this.notify(Cr,{}),this.createSheet(),this.activeSheetIndex=this.sheets.length-1,this.notify(Fi,null),this.notify(pr,{action:"initSheetInfo"}),this.renderModule.refreshSheet(),this.openModule.isImportedFile=!1,this.openModule.unProtectSheetIdx=[]):e.prototype.refresh.call(this)},r.prototype.insertImage=function(e,t){var r;for(r=0;r<e.length;r++)this.notify(Da,{options:e[r],range:t||this.getActiveSheet().selectedRange,isPublic:!0})},r.prototype.deleteImage=function(e,t){this.notify(Oa,{id:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},r.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},r.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},r.prototype.getSelectAllContent=function(){return this.sheetModule.getSelectAllContent()},r.prototype.getScrollElement=function(){return this.sheetModule.getScrollElement()},r.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},r.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},r.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},r.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},r.prototype.isMobileView=function(){return(this.cssClass.indexOf("e-mobile-view")>-1||t.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},r.prototype.getValueRowCol=function(t,r,n,i,o,a){return e.prototype.getValueRowCol.call(this,t,r,n,i,o,a)},r.prototype.updateCell=function(t,r){r=r||this.getActiveSheet().activeCell,e.prototype.updateCell.call(this,t,r)},r.prototype.getRowData=function(t,r){return e.prototype.getRowData.call(this,t,r)},r.prototype.sort=function(t,r){var n=this;return this.allowSorting?e.prototype.sort.call(this,t,r).then(function(e){return n.notify(Fr,e),Promise.resolve(e)}):Promise.reject()},r.prototype.setValueRowCol=function(t,r,n,i,o){if("circular reference: "===r){var a={action:"isCircularReference",argValue:r};this.notify(Mi,a),r=a.argValue}e.prototype.setValueRowCol.call(this,t,r,n,i,o),this.notify(Oi,{action:"refreshDependentCellValue",rowIdx:n,colIdx:i,sheetIdx:ge(this,t)})},r.prototype.getModuleName=function(){return"spreadsheet"},r.prototype.refreshNode=function(e,r){var n;if(e){if(r){if(r.result=t.isNullOrUndefined(r.result)?"":r.result.toString(),!r.isRowFill){var i=t.select(".e-fill",e);i&&(t.detach(i),e.style.display="table-cell");var o=t.select(".e-fill-sec",e);o&&t.detach(o)}var a=t.select("#"+this.element.id+"_currency",e);if(a&&t.detach(a),"Accounting"===r.type&&N(r.value))return e.querySelector("a")?e.querySelector("a").textContent=r.result.split(r.curSymbol).join(""):e.innerHTML="",e.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:""+r.curSymbol,styles:"float: left"})),e.querySelector("a")||(e.innerHTML+=r.result.split(r.curSymbol).join("")),void e.classList.add("e-right-align");var s=void 0;!r.result||"true"!==r.result.toLowerCase()&&"false"!==r.result.toLowerCase()?s="e-right-align":(r.result=r.result.toUpperCase(),s="e-center-align",r.isRightAlign=!0),n=r.result,r.isRightAlign?e.classList.add(s):e.classList.remove(s)}n=t.isNullOrUndefined(n)?"":n;var l=e.lastChild;e.querySelector(".e-databar-value")&&(l=e.querySelector(".e-databar-value").lastChild),e.querySelector(".e-hyperlink")&&(l=e.querySelector(".e-hyperlink").lastChild);var h=e.querySelector(".e-wrap-content");h&&(h.lastChild||h.appendChild(document.createTextNode("")),l=h.lastChild),!l||3!==l.nodeType&&1!==l.nodeType?e.appendChild(document.createTextNode(n)):r.isRowFill||(l.nodeValue=n)}},r.prototype.calculateHeight=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=1);var n=e&&e.fontSize||this.cellStyle.fontSize,i="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*i*t+r*i},r.prototype.skipHidden=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.scrollSettings.isFinite);var i,o=this.getActiveSheet();this.scrollSettings.isFinite&&(i=("rows"===r?o.rowCount:o.colCount)-1);for(var a=e;a<=t;a++)if(o[r][a]&&o[r][a].hidden){if(e===a&&e++,t++,n&&t>i){t=i;break}}else if(!n&&this.scrollSettings.isFinite&&t>i&&o[r][a-1]&&o[r][a-1].hidden){t--;break}return[e,t]},r.prototype.updateActiveBorder=function(e,r){void 0===r&&(r=".e-ribbon");var n=t.select(r+" .e-tab-header .e-indicator",this.element);n.style.display="none",t.setStyleAttribute(n,{left:"",right:""}),t.setStyleAttribute(n,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),n.style.display=""},r.prototype.undo=function(){this.notify(Po,{isUndo:!0,isPublic:!0})},r.prototype.redo=function(){this.notify(Po,{isUndo:!1,isPublic:!0})},r.prototype.updateUndoRedoCollection=function(e){this.notify(Ho,{args:e,isPublic:!0})},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(Mi,t),t.isAdded},r.prototype.removeDefinedName=function(t,r){return e.prototype.removeDefinedName.call(this,t,r)},r.prototype.mouseClickHandler=function(e){this.notify(Hi,e)},r.prototype.mouseDownHandler=function(e){this.notify(Ni,e)},r.prototype.keyUpHandler=function(e){t.closest(e.target,".e-find-dlg")?this.notify(Qr,e):this.notify(Bi,e)},r.prototype.keyDownHandler=function(e){t.closest(e.target,".e-findtool-dlg")||this.notify(Ui,e)},r.prototype.freeze=function(e){if(!(!this.allowFreezePane||e.row<0||e.column<0)){if(e.triggerEvent){var t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(Zt,{eventArgs:t,action:"freezePanes"}),t.cancel)return}this.on(Li,this.freezePaneUpdated,this),this.freezePanes(e.row,e.column),this.notify(In,null)}},r.prototype.freezePaneUpdated=function(){this.off(Li,this.freezePaneUpdated);var e=this.getActiveSheet();this.notify(Yo,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})},r.prototype.wireEvents=function(){t.EventHandler.add(this.element,"click",this.mouseClickHandler,this),t.EventHandler.add(this.element,st(),this.mouseDownHandler,this),t.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),t.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),t.EventHandler.add(this.element,"noderefresh",this.refreshNode,this),this.on(is,this.freeze,this),this.on(Gn,this.refreshInsertDelete,this)},r.prototype.destroy=function(){this[Xa]&&this[$a](),this.unwireEvents(),this.notify(Di,null),e.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width"),this.sheetModule.destroy()},r.prototype.unwireEvents=function(){t.EventHandler.remove(this.element,"click",this.mouseClickHandler),t.EventHandler.remove(this.element,st(),this.mouseDownHandler),t.EventHandler.remove(this.element,"keyup",this.keyUpHandler),t.EventHandler.remove(this.element,"keydown",this.keyDownHandler),t.EventHandler.remove(this.element,"noderefresh",this.refreshNode),this.off(is,this.freeze),this.off(Gn,this.refreshInsertDelete)},r.prototype.refreshInsertDelete=function(e){var t,r=this;e.sheet.ranges.forEach(function(n){n.template&&n.address&&(t=c(n.address),r.updateRangeOnInsertDelete(e,t)&&(n.address=m(t)))}),this.setSheetPropertyOnMute(e.sheet,"ranges",e.sheet.ranges)},r.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(oo,{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.removeContextMenuItems=function(e,t){this.notify(ao,{items:e,isUniqueId:t})},r.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(so,{items:e,enable:t,isUniqueId:r})},r.prototype.enableFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(lo,{items:e,enable:t,isUniqueId:r})},r.prototype.hideFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(ho,{items:e,hide:t,isUniqueId:r})},r.prototype.addFileMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(po,{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.hideRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(co,{tabs:e,hide:t})},r.prototype.enableRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(uo,{tabs:e,enable:t})},r.prototype.addRibbonTabs=function(e,t){this.notify(fo,{items:e,insertBefore:t})},r.prototype.enableToolbarItems=function(e,t,r){this.notify(Qi,[{tab:e,items:t,enable:void 0===r||r}])},r.prototype.hideToolbarItems=function(e,t,r){void 0===r&&(r=!0),this.notify(mo,{tab:e,indexes:t,hide:r})},r.prototype.addToolbarItems=function(e,t,r){this.notify(go,{tab:e,items:t,index:r})},r.prototype.selectRange=function(e){this.isEdit&&this.notify(Oi,{action:"endEdit"}),this.notify(eo,{address:e})},r.prototype.startEdit=function(){this.notify(Oi,{action:"startEdit",isNewValueEdit:!1})},r.prototype.closeEdit=function(){this.notify(Oi,{action:"cancelEdit"})},r.prototype.endEdit=function(){this.notify(Oi,{action:"endEdit"})},r.prototype.onPropertyChanged=function(r,n){var i=this;e.prototype.onPropertyChanged.call(this,r,n);for(var o=function(e){var o=void 0,s=void 0;switch(e){case"enableRtl":if((o=a.getColumnHeaderContent())&&(o=o.parentElement),!o)break;r.enableRtl?(o.style.marginLeft=Qe()+"px",o.style.marginRight="",document.getElementById(a.element.id+"_sheet_panel").classList.add("e-rtl")):(o.style.marginRight=Qe()+"px",o.style.marginLeft="",document.getElementById(a.element.id+"_sheet_panel").classList.remove("e-rtl")),-1===Object.keys(r).indexOf("locale")&&a.renderModule.refreshSheet();break;case"cssClass":n.cssClass&&t.removeClass([a.element],n.cssClass.split(" ")),r.cssClass&&t.addClass([a.element],r.cssClass.split(" "));break;case"activeSheetIndex":a.renderModule.refreshSheet(),a.notify(So,{idx:r.activeSheetIndex});break;case"width":a.setWidth(),a.resize();break;case"height":a.setHeight(),a.resize();break;case"showRibbon":a.notify(Ri,{prop:"showRibbon",onPropertyChange:!0});break;case"showFormulaBar":a.notify(Ai,{uiUpdate:!0});break;case"showSheetTabs":a.notify(ki,null);break;case"cellStyle":a.renderModule.refreshSheet();break;case"allowEditing":if(a.allowEditing&&(a.notify(Oi,{action:"renderEditor"}),a.enableKeyboardNavigation)){a.enableKeyboardNavigation=!1,a.dataBind(),a.enableKeyboardNavigation=!0,a.dataBind();var l=a.selectionSettings.mode;"None"!==l&&(a.selectionSettings.mode="None",a.dataBind(),a.selectionSettings.mode=l,a.dataBind())}break;case"allowInsert":(s=a.element.getElementsByClassName("e-add-sheet-tab")[0])&&(s.disabled=!a.allowInsert,a.allowInsert?s.classList.contains("e-disabled")&&s.classList.remove("e-disabled"):s.classList.contains("e-disabled")||s.classList.add("e-disabled"));break;case"sheets":if(r.sheets===a.sheets){a.renderModule.refreshSheet(),a.notify(Fi,null),a.notify(pr,{action:"initSheetInfo"});break}var h;Object.keys(r.sheets).forEach(function(e,o){var a=r.sheets[e];if(a.ranges&&Object.keys(a.ranges).length){var s,l=Object.keys(a.ranges);l.forEach(function(e,t){a.ranges[e].info||(s=t)}),l.forEach(function(r,n){a.ranges[r].dataSource&&(t.isUndefined(s)||!t.isUndefined(s)&&s===n)&&i.notify(Gt,{sheetIdx:e,rangeIdx:r,isLastRange:l.length-1===n,changedData:a.ranges[r].dataSource})})}else if(a.paneTopLeftCell&&n.sheets&&n.sheets[e]&&n.sheets[e].paneTopLeftCell){if(i.activeSheetIndex!==Number(e))return;var d=u(a.paneTopLeftCell),p=u(n.sheets[e].paneTopLeftCell);if(d[0]!==p[0]){var c=i.frozenRowCount(i.getActiveSheet()),f=d[0]>c?Ve(i.getActiveSheet(),c,d[0]-1):0;i.notify(as,{top:f})}if(d[1]!==p[1]){var g=i.frozenColCount(i.getActiveSheet()),m=d[1]>g?We(i.getActiveSheet(),g,d[1]-1):0;i.notify(as,{left:m})}}else if(0===o&&i.renderModule.refreshSheet(),i.showSheetTabs&&a.name&&!h){var v=t.select(".e-sheet-tabs-items",i.element),y=Number(e);v.children[y+1]?i.notify(Oo,{items:v,value:a.name,idx:y}):(i.notify(Fi,null),h=!0)}});break;case"locale":a.refresh();break;case"currencyCode":a.notify("updateView",{});break;case"password":a.password.length>0&&a.showSheetTabs&&(a.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),a.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(a.isProtected){var d=a.element.getElementsByClassName("e-add-sheet-tab")[0];d&&(d.disabled=a.isProtected,a.isProtected?d.classList.contains("e-disabled")&&d.classList.add("e-disabled"):d.classList.contains("e-disabled")||d.classList.remove("e-disabled"))}break;case"allowFreezePane":a.notify(Ri,{prop:"allowFreezePane",onPropertyChange:!0})}},a=this,s=0,l=Object.keys(r);s<l.length;s++){o(l[s])}},r.prototype.requiredModules=function(){return Xe(this)},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.filter=function(t,r){return this.allowFiltering?(r=r||this.getActiveSheet().selectedRange,e.prototype.filter.call(this,t,r)):Promise.reject()},r.prototype.clearFilter=function(e){this.notify(Wo,{field:e})},r.prototype.applyFilter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={predicates:e,range:t,isInternal:!0,promise:new Promise(function(e,t){e(void 0)})};return this.notify(Vo,r),r.promise},r.prototype.addCustomFunction=function(t,r,n){e.prototype.addCustomFunction.call(this,t,r,n),this.notify(Zo,null)};var n;return Rh([t.Property("")],r.prototype,"cssClass",void 0),Rh([t.Property(!0)],r.prototype,"allowScrolling",void 0),Rh([t.Property(!0)],r.prototype,"allowResizing",void 0),Rh([t.Property(!0)],r.prototype,"showAggregate",void 0),Rh([t.Property(!0)],r.prototype,"enableClipboard",void 0),Rh([t.Property(!0)],r.prototype,"enableContextMenu",void 0),Rh([t.Property(!0)],r.prototype,"enableKeyboardNavigation",void 0),Rh([t.Property(!0)],r.prototype,"enableKeyboardShortcut",void 0),Rh([t.Property(!0)],r.prototype,"allowUndoRedo",void 0),Rh([t.Property(!0)],r.prototype,"allowWrap",void 0),Rh([t.Complex({},hh)],r.prototype,"selectionSettings",void 0),Rh([t.Complex({},lh)],r.prototype,"scrollSettings",void 0),Rh([t.Event()],r.prototype,"beforeCellRender",void 0),Rh([t.Event()],r.prototype,"beforeSelect",void 0),Rh([t.Event()],r.prototype,"select",void 0),Rh([t.Event()],r.prototype,"contextMenuBeforeOpen",void 0),Rh([t.Event()],r.prototype,"fileMenuBeforeOpen",void 0),Rh([t.Event()],r.prototype,"contextMenuBeforeClose",void 0),Rh([t.Event()],r.prototype,"dialogBeforeOpen",void 0),Rh([t.Event()],r.prototype,"fileMenuBeforeClose",void 0),Rh([t.Event()],r.prototype,"contextMenuItemSelect",void 0),Rh([t.Event()],r.prototype,"fileMenuItemSelect",void 0),Rh([t.Event()],r.prototype,"beforeDataBound",void 0),Rh([t.Event()],r.prototype,"dataBound",void 0),Rh([t.Event()],r.prototype,"dataSourceChanged",void 0),Rh([t.Event()],r.prototype,"cellEdit",void 0),Rh([t.Event()],r.prototype,"cellEditing",void 0),Rh([t.Event()],r.prototype,"cellSave",void 0),Rh([t.Event()],r.prototype,"beforeCellSave",void 0),Rh([t.Event()],r.prototype,"created",void 0),Rh([t.Event()],r.prototype,"beforeSort",void 0),Rh([t.Event()],r.prototype,"beforeHyperlinkCreate",void 0),Rh([t.Event()],r.prototype,"afterHyperlinkCreate",void 0),Rh([t.Event()],r.prototype,"beforeHyperlinkClick",void 0),Rh([t.Event()],r.prototype,"afterHyperlinkClick",void 0),Rh([t.Event()],r.prototype,"beforeConditionalFormat",void 0),Rh([t.Event()],r.prototype,"actionBegin",void 0),Rh([t.Event()],r.prototype,"actionComplete",void 0),Rh([t.Event()],r.prototype,"openComplete",void 0),Rh([t.Event()],r.prototype,"sortComplete",void 0),Rh([t.Property("USD")],r.prototype,"currencyCode",void 0),r=n=Rh([t.NotifyPropertyChanges],r)}(ol);e.Workbook=ol,e.Range=Ks,e.UsedRange=$s,e.Sheet=Zs,e.getSheetIndex=fe,e.getSheetIndexFromId=ge,e.getSheetNameFromAddress=me,e.getSheetIndexByName=ve,e.updateSelectedRange=ye,e.getSelectedRange=Ce,e.getSingleSelectedRange=xe,e.getSheet=be,e.getSheetNameCount=Se,e.getMaxSheetId=we,e.initSheet=Ie,e.getSheetName=Ee,e.moveSheet=Re,e.duplicateSheet=Ae,e.Row=ll,e.getRow=Me,e.setRow=Pe,e.isHiddenRow=He,e.isFilterHidden=Be,e.getRowHeight=Ue,e.setRowHeight=_e,e.getRowsHeight=Ve,e.Column=pl,e.getColumn=ze,e.setColumn=qe,e.getColumnWidth=je,e.getColumnsWidth=We,e.isHiddenCol=Ge,e.checkColumnValidation=Ye,e.Cell=el,e.getCell=ke,e.setCell=Fe,e.skipDefaultValue=Te,e.wrap=Le,e.getColorCode=Ne,e.getCustomColors=De,e.isCustomDateTime=Oe,e.getData=pe,e.getValueFromFormat=ce,e.getModel=function(e,r){var n,i,o;if(t.isUndefined(e[r])||!e[r]||e[r].index!==r)for(var a=0;a<=r;a++)if(e&&e[a]){if((n=e[a].index-a)>0){for(e.forEach(function(e,t){e&&e.index&&(o=e.index,i=1),e&&!e.index&&0!==t&&(e.index=o+i),i++});n--;)e.splice(a,0,null);a+=n}}else e?e[a]=null:e=[];return e[r]},e.processIdx=ue,e.getRangeIndexes=c,e.getCellIndexes=u,e.getColIndex=f,e.getCellAddress=g,e.getRangeAddress=m,e.getColumnHeaderText=v,e.getIndexesFromAddress=y,e.getRangeFromAddress=C,e.getAddressFromSelectedRange=x,e.getAddressInfo=b,e.getSheetIndexFromAddress=S,e.getSwapRange=w,e.isSingleCell=E,e.executeTaskAsync=R,e.WorkbookBasicModule=Is,e.WorkbookAllModule=Es,e.getWorkbookRequiredModules=j,e.CellStyle=ks,e.FilterCollection=Fs,e.SortCollection=Ts,e.DefineName=Ls,e.ProtectSettings=Ns,e.Hyperlink=Ds,e.Validation=Os,e.Format=Ms,e.ConditionalFormat=Ps,e.LegendSettings=Hs,e.DataLabelSettings=Bs,e.MajorGridLines=Us,e.MinorGridLines=_s,e.Axis=Vs,e.Chart=zs,e.Image=qs,e.AutoFillSettings=js,e.workbookDestroyed=jt,e.updateSheetFromDataSource=Wt,e.dataSourceChanged=Gt,e.dataChanged=Yt,e.triggerDataChange=Xt,e.workbookOpen=Kt,e.beginSave=$t,e.beginAction=Zt,e.sortImport=Qt,e.ribbonFind=Jt,e.exportDialog=er,e.getFilteredCollection=tr,e.saveCompleted=rr,e.applyNumberFormatting=nr,e.getFormattedCellObject=ir,e.refreshCellElement=or,e.setCellFormat=ar,e.findAllValues=sr,e.textDecorationUpdate=lr,e.applyCellFormat=hr,e.updateUsedRange="updateUsedRange",e.updateRowColCount=dr,e.workbookFormulaOperation=pr,e.workbookEditOperation=cr,e.checkDateFormat=ur,e.getFormattedBarText=fr,e.activeCellChanged=gr,e.openSuccess=mr,e.openFailure=vr,e.sheetCreated=yr,e.sheetsDestroyed=Cr,e.aggregateComputation=xr,e.getUniqueRange=br,e.removeUniquecol=Sr,e.checkUniqueRange=wr,e.reApplyFormula=Ir,e.clearFormulaDependentCells=Er,e.formulaInValidation=Rr,e.beforeSort="beforeSort",e.initiateSort=Ar,e.updateSortedDataOnCell=kr,e.sortComplete=Fr,e.sortRangeAlert="sortRangeAlert",e.initiatelink="initiatelink",e.beforeHyperlinkCreate=Tr,e.afterHyperlinkCreate=Lr,e.beforeHyperlinkClick=Nr,e.afterHyperlinkClick=Dr,e.addHyperlink="addHyperlink",e.setLinkModel=Or,e.beforeFilter="beforeFilter",e.initiateFilter=Mr,e.filterComplete="filterComplete",e.filterRangeAlert=Pr,e.clearAllFilter="clearAllFilter",e.wrapEvent=Hr,e.onSave=Br,e.insert=Ur,e.deleteAction=_r,e.insertModel=Vr,e.deleteModel=zr,e.isValidation=qr,e.cellValidation=jr,e.addHighlight=Wr,e.dataValidate="dataValidate",e.findNext=Gr,e.findPrevious=Yr,e.goto=Xr,e.findWorkbookHandler="findHandler",e.replace=Kr,e.replaceAll=$r,e.showDialog=Zr,e.findKeyUp=Qr,e.removeHighlight=Jr,e.queryCellInfo=en,e.count=tn,e.findCount="findCount",e.protectSheetWorkBook=rn,e.updateToggle=nn,e.protectsheetHandler=on,e.replaceAllDialog=an,e.unprotectsheetHandler=sn,e.workBookeditAlert="editAlert",e.setLockCells=ln,e.applyLockCells="applyLockCells",e.setMerge=hn,e.applyMerge=dn,e.mergedRange=pn,e.activeCellMergedRange=cn,e.insertMerge=un,e.pasteMerge=fn,e.hideShow=gn,e.setCFRule=mn,e.applyCF=vn,e.clearCFRule=yn,e.clear=Cn,e.clearCF=xn,e.setImage=bn,e.setChart=Sn,e.initiateChart=wn,e.refreshRibbonIcons=In,e.refreshChart=En,e.refreshChartSize=Rn,e.updateChart=An,e.deleteChartColl=kn,e.initiateChartModel="initiateChartModel",e.focusChartBorder=Fn,e.saveError=Tn,e.validationHighlight=Ln,e.updateFilter=Nn,e.beforeInsert=Dn,e.beforeDelete=On,e.deleteHyperlink=Mn,e.moveOrDuplicateSheet=Pn,e.setAutoFill=Hn,e.refreshCell=Bn,e.getFillInfo=Un,e.getautofillDDB=_n,e.rowFillHandler=Vn,e.getTextSpace=zn,e.refreshClipboard=qn,e.updateView=jn,e.selectionComplete=Wn,e.refreshInsertDelete=Gn,e.getUpdatedFormulaOnInsertDelete=Yn,e.beforeCellUpdate=Xn,e.duplicateSheetFilterHandler=Kn,e.unMerge=$n,e.checkIsFormula=W,e.isCellReference=G,e.isChar=Y,e.isRowSelected=X,e.isColumnSelected=K,e.inRange=$,e.isInMultipleRange=Z,e.isInRange=Q,e.getSplittedAddressForColumn=J,e.isLocked=ee,e.isValidCellReference=te,e.skipHiddenIdx=re,e.isHeightCheckNeeded=ne,e.getUpdatedFormula=ie,e.updateCell=oe,e.getDataRange=ae,e.insertFormatRange=se,e.deleteFormatRange=le,e.updateCFModel=he,e.checkRange=de,e.toFraction=A,e.getGcd=k,e.intToDate=F,e.dateToInt=T,e.isDateTime=L,e.isNumber=N,e.toDate=D,e.parseIntValue=O,e.workbookLocale=Ws,e.localeData=Gs,e.DataBind=zt,e.WorkbookOpen=qt,e.WorkbookSave=Jn,e.WorkbookFormula=pi,e.WorkbookNumberFormat=Vt,e.getFormatFromType=P,e.getTypeFromFormat=H,e.WorkbookSort=ci,e.WorkbookFilter=ui,e.WorkbookImage=fi,e.WorkbookChart=gi,e.WorkbookCellFormat=mi,e.WorkbookEdit=vi,e.WorkbookHyperlink=yi,e.WorkbookInsert=Ci,e.WorkbookDelete=xi,e.WorkbookDataValidation=bi,e.WorkbookFindAndReplace=wi,e.WorkbookProtectSheet=Ii,e.WorkbookMerge=Ei,e.WorkbookConditionalFormat=Ss,e.WorkbookAutoFill=ws,e.getRequiredModules=Xe,e.ribbon=Ri,e.formulaBar=Ai,e.sheetTabs=ki,e.refreshSheetTabs=Fi,e.isFormulaBarEdit=Ti,e.contentLoaded=Li,e.mouseDown=Ni,e.spreadsheetDestroyed=Di,e.editOperation=Oi,e.formulaOperation=Mi,e.formulaBarOperation=Pi,e.click=Hi,e.keyUp=Bi,e.keyDown=Ui,e.formulaKeyUp="formulaKeyUp",e.formulaBarUpdate="formulaBarUpdate",e.onVerticalScroll=_i,e.onHorizontalScroll=Vi,e.beforeContentLoaded=zi,e.beforeVirtualContentLoaded=qi,e.virtualContentLoaded=ji,e.contextMenuOpen="contextMenuOpen",e.cellNavigate=Wi,e.mouseUpAfterSelection=Gi,e.cMenuBeforeOpen=Yi,e.insertSheetTab=Xi,e.removeSheetTab=Ki,e.renameSheetTab=$i,e.ribbonClick=Zi,e.refreshRibbon="ribbonRefresh",e.enableToolbarItems=Qi,e.tabSwitch=Ji,e.selectRange=eo,e.cut=to,e.copy=ro,e.paste=no,e.clearCopy=io,e.dataBound="dataBound",e.beforeDataBound="beforeDataBound",e.addContextMenuItems=oo,e.removeContextMenuItems=ao,e.enableContextMenuItems=so,e.enableFileMenuItems=lo,e.hideFileMenuItems=ho,e.addFileMenuItems=po,e.hideRibbonTabs=co,e.enableRibbonTabs=uo,e.addRibbonTabs=fo,e.addToolbarItems=go,e.hideToolbarItems=mo,e.beforeRibbonCreate=vo,e.rowHeightChanged=yo,e.colWidthChanged=Co,e.onContentScroll=xo,e.deInitProperties=bo,e.activeSheetChanged=So,e.renameSheet=wo,e.initiateCustomSort=Io,e.applySort=Eo,e.collaborativeUpdate=Ro,e.autoFit=Ao,e.updateToggleItem=ko,e.initiateHyperlink=Fo,e.editHyperlink=To,e.openHyperlink=Lo,e.removeHyperlink=No,e.createHyperlinkElement=Do,e.sheetNameUpdate=Oo,e.hideSheet=Mo,e.performUndoRedo=Po,e.updateUndoRedoCollection=Ho,e.setActionData=Bo,e.getBeforeActionData=Uo,e.clearUndoRedoCollection=_o,e.initiateFilterUI=Vo,e.renderFilterCell=zo,e.reapplyFilter=qo,e.filterByCellValue=jo,e.clearFilter=Wo,e.getFilteredColumn=Go,e.completeAction=Yo,e.filterCellKeyDown=Xo,e.getFilterRange=Ko,e.setAutoFit=$o,e.refreshFormulaDatasource=Zo,e.setScrollEvent=Qo,e.initiateDataValidation=Jo,e.validationError="validationError",e.startEdit="startEdit",e.invalidData=ea,e.clearInvalid="clearInvalid",e.protectSheet=ta,e.applyProtect=ra,e.unprotectSheet="unprotectSheet",e.protectCellFormat=na,e.gotoDlg=ia,e.findDlg=oa,e.findHandler=aa,e.created=sa,e.editAlert=la,e.setUndoRedo=ha,e.enableFormulaInput=da,e.protectSelection=pa,e.hiddenMerge=ca,e.checkPrevMerge=ua,e.checkMerge=fa,e.removeDataValidation=ga,e.showAggregate=ma,e.goToSheet=va,e.showSheet=ya,e.renderCFDlg=Ca,e.clearViewer=xa,e.initiateFormulaReference=ba,e.initiateCur=Sa,e.clearCellRef=wa,e.editValue=Ia,e.addressHandle=Ea,e.initiateEdit=Ra,e.forRefSelRender=Aa,e.insertImage=ka,e.refreshImgElem=Fa,e.refreshImgCellObj=Ta,e.getRowIdxFromClientY=La,e.getColIdxFromClientX=Na,e.createImageElement=Da,e.deleteImage=Oa,e.deleteChart=Ma,e.refreshChartCellObj=Pa,e.refreshImagePosition=Ha,e.updateTableWidth=Ba,e.focusBorder=Ua,e.clearChartBorder=_a,e.insertChart=Va,e.chartRangeSelection=za,e.insertDesignChart=qa,e.removeDesignChart=ja,e.chartDesignTab=Wa,e.addChartEle=Ga,e.undoRedoForChartDesign=Ya,e.isReact=Xa,e.renderReactTemplates=Ka,e.clearTemplate=$a,e.protectWorkbook=Za,e.unProtectWorkbook=Qa,e.getPassWord=Ja,e.setProtectWorkbook=es,e.removeWorkbookProtection=ts,e.importProtectWorkbook=rs,e.selectionStatus=ns,e.freeze=is,e.overlayEleSize=os,e.updateScroll=as,e.positionAutoFillElement=ss,e.hideAutoFillOptions=ls,e.performAutoFill=hs,e.selectAutoFillRange=ds,e.autoFill="autoFill",e.fillRange=ps,e.hideAutoFillElement=cs,e.unProtectSheetPassword=us,e.updateTranslate=fs,e.getUpdatedScrollPosition=gs,e.updateScrollValue=ms,e.beforeCheckboxRender=vs,e.refreshCheckbox=ys,e.renderInsertDlg=Cs,e.toggleFormulaBar=xs,e.toggleProtect=bs,e.getUpdateUsingRaf=Ke,e.removeAllChildren=$e,e.getColGroupWidth=Ze,e.getScrollBarWidth=Qe,e.getSiblingsHeight=Je,e.inView=tt,e.getCellPosition=rt,e.setPosition=nt,e.removeRangeEle=it,e.locateElem=ot,e.setStyleAttribute=at,e.getStartEvent=st,e.getMoveEvent=lt,e.getEndEvent=ht,e.isTouchStart=dt,e.isTouchMove=pt,e.isTouchEnd=ct,e.isMouseDown=ut,e.isMouseMove=ft,e.isMouseUp=gt,e.getClientX=mt,e.getClientY=vt,e.getDPRValue=yt,e.setAriaOptions=Ct,e.destroyComponent=xt,e.setResize=bt,e.setWidthAndHeight=St,e.setTextLineHeight=function(e){ul=e},e.findMaxValue=wt,e.updateAction=It,e.hasTemplate=Et,e.setRowEleHeight=Rt,e.getTextHeight=At,e.getLineHeight=kt,e.getTextWidth=Ft,e.getLines=Tt,e.getBorderHeight=Lt,e.getExcludedColumnWidth=Nt,e.getTextHeightWithBorder=Dt,e.setMaxHgt=Ot,e.getMaxHgt=Mt,e.focus=Pt,e.isLockedCells=Ht,e.isDiscontinuousRange=Bt,e.clearRange=Ut,e.BasicModule=ih,e.AllModule=oh,e.ScrollSettings=lh,e.SelectionSettings=hh,e.DISABLED="e-disabled",e.WRAPTEXT=dh,e.locale=ph,e.dialog=ch,e.actionEvents="actionEvents",e.overlay=uh,e.fontColor=fh,e.fillColor=gh,e.keyCodes=mh,e.defaultLocale=vh,e.Spreadsheet=Ah,e.Clipboard=ml,e.Edit=vl,e.Selection=yl,e.Scroll=Cl,e.VirtualScroll=xl,e.KeyboardNavigation=bl,e.KeyboardShortcut=Sl,e.CellFormat=wl,e.Resize=Il,e.CollaborativeEditing=El,e.ShowHide=Rl,e.SpreadsheetHyperlink=Al,e.UndoRedo=Fl,e.WrapText=Tl,e.Insert=Ll,e.Delete=Nl,e.DataValidation=Dl,e.ProtectSheet=Ol,e.FindAndReplace=Ml,e.Merge=Pl,e.ConditionalFormatting=Hl,e.AutoFill=Bl,e.Ribbon=Gl,e.FormulaBar=Yl,e.Formula=Xl,e.SheetTabs=Kl,e.Open=$l,e.Save=Zl,e.ContextMenu=Ql,e.NumberFormat=Jl,e.Sort=eh,e.Filter=th,e.SpreadsheetImage=rh,e.SpreadsheetChart=nh,e.Render=bh,e.SheetRender=yh,e.RowRenderer=Ch,e.CellRenderer=xh,e.Calculate=ai,e.FormulaError=si,e.FormulaInfo=li,e.CalcSheetFamilyItem=hi,e.getAlphalabel=q,e.ValueChangedArgs=di,e.Parser=ni,e.CalculateCommon=ei,e.isUndefined=function(e){return void 0===e},e.getSkeletonVal=B,e.isExternalFileLink=U,e.getModules=_,e.getValue=V,e.setValue=z,e.ModuleLoader=ti,e.BasicFormulas=ri,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-spreadsheet.umd.min.js.map
